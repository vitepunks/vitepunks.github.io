{"version":3,"sources":["clients/vite.client.ts","util/types.ts","common/constants.ts","util/common.util.ts","util/retry.util.ts","util/task.ts","util/file.util.ts","search/punk.search.ts","util/compress.util.ts","util/ensure.ts","contracts/punks.contract.ts","util/filter.util.ts","util/moment.util.ts","datasources/base.datasource.ts","util/transform.util.ts","datasources/mock.datasource.ts","util/format.util.ts","contracts/base.contract.ts","datasources/vite.datasource.ts","contexts/common.context.ts","mutations/market.ts","mutations/punk.ts","queries/punk.ts","queries/market.ts","queries/general.ts","clients/apollo.client.ts","common/network.ts","features/layout/components/footer/component.tsx","features/layout/components/header-loading/component.tsx","features/layout/components/main-scroll/component.tsx","features/layout/components/main-wrapper/component.tsx","contexts/web3.tsx","contexts/connectedWeb3.tsx","features/main/components/loading/component.tsx","util/snackbar.util.ts","features/common/components/alert/component.tsx","util/url.util.ts","features/marketplace/components/browse-item/component.tsx","features/account/components/details/component.tsx","features/common/components/test/component.tsx","services/punk.service.ts","features/landing/components/main-image/component.tsx","features/common/components/test-image/component.tsx","util/token.util.ts","features/common/components/click-once-button/component.tsx","features/common/components/countdown/component.tsx","features/common/components/fa-icon/component.tsx","features/landing/components/mints-remaining/component.tsx","features/landing/components/main/component.tsx","features/common/components/tooltip/component.tsx","features/main/components/qrcode/component.tsx","features/main/components/login/component.tsx","features/layout/components/header/component.tsx","services/market.service.ts","util/icon.util.ts","util/explorer.util.ts","features/common/components/explorer-link/component.tsx","features/common/components/event-list/component.tsx","features/marketplace/components/browse-activity/component.tsx","features/marketplace/components/browse-items-filter/component.tsx","features/marketplace/components/browse-items/component.tsx","features/marketplace/components/browse/component.tsx","features/marketplace/components/item/component.tsx","features/punk/components/image/component.tsx","features/punk/components/dialog-mint/component.tsx","features/punk/components/activity/component.tsx","hooks/punk.hook.ts","features/punk/components/dialog-bid/component.tsx","features/punk/components/dialog-offer/component.tsx","features/punk/components/dialog/component.tsx","features/punk/components/info-actions/component.tsx","features/punk/components/info/component.tsx","features/punk/components/main/component.tsx","features/main/components/dialog-transaction/component.tsx","services/general.service.ts","features/main/components/quota/component.tsx","features/main/components/main/component.tsx","App.tsx","reportWebVitals.ts","theme.tsx","index.tsx","util/logger.ts","util/emitter.ts","common/config.ts","wallet/types.ts","wallet/connector.ts","wallet/factory.ts","wallet/store.ts","wallet/manager.ts","__generated__/globalTypes.ts"],"names":["WS_RPC","require","logger","getLogger","providerOptions","retryTimes","retryInterval","ViteClient","_network","_retryCount","_isConnected","_connector","_provider","_client","_emitter","_walletManager","_connectorFactory","initAsync","network","a","Promise","resolve","reject","info","create","rpcUrl","isResolved","on","emitReInit","err","error","ViteAPI","path","this","getEmitter","getWalletManager","WalletConnectorFactory","destroy","type","param","abiutils","encodeParameter","jsonFunction","methodName","encodeLogSignature","method","args","result","RetryUtil","promiseRetry","request","catch","message","toLowerCase","includes","CommonUtil","timeout","Error","requestAsync","BigNumber","address","blockCount","balanceInfoMap","CommonConstants","VITE_TOKEN_ID","balance","currentQuota","maxQuota","stakeAmount","account","toAddress","amount","tokenId","block","accountBlock","createAccountBlock","sendAccountBlockAsync","beneficiaryAddress","abi","params","binary","code","responseLatency","quotaMultiplier","randomDegree","contractAddress","offchaincode","data","encodeFunctionCall","dataBase64","Buffer","from","toString","selfAddr","offChainCode","resultBytes","outputs","i","length","push","offchainDecodeResult","decodeParameters","resultList","name","value","vmLog","topics","j","abiItem","decodeVmLogByAbiItem","topic","decodeLog","inputs","utils","_Buffer","slice","event","fromHeight","toHeight","gt","toFixed","payload","addressHeightRange","midHeight","plus","div","getEventsByBlockAsync","arr2","subscribe","unsubscribe","listener","results","console","log","decodeVmLog","vmlog","height","undefined","timestamp","Date","now","Task","blockByHeight","receiveBlockHash","blockByHash","getAccountBlockStatus","start","blocks","ab","sendBlockHash","hash","RECEIVE_PER_ROUND","receiveTransactionAsync","receiveAllOnroadTxAsync","WebWalletAccount","setProvider","setPrivateKey","privateKey","autoSetPreviousAccountBlock","sign","send","SessionWalletAccount","connector","emitConfirmTransactionDialog","sendTransactionAsync","status","resolveAccountBlockData","statusTxt","blockType","bytes","client","getViteClient","DocumentState","WalletType","OrderType","PunkSortType","PunkDialogType","PunkEventType","MarketplaceTab","MarketEventType","GlobalEvent","ViteQuotaType","VmLogEvent","TypeNames","Punk","PunkExtended","PunkEvent","APP_NAME","PUNK_NAME","USE_MOCK_DATASOURCE","NETWORK_ID","WEB_WALLET_STORAGE_SPACE","SESSION_WALLET_STORAGE_SPACE","BG_URL","ITEM_BG_URL","SAMPLE_PUNK_URL","LANDING_IMAGE_URL","QUOTA_WIKI_URL","DISCORD_URL","TWITTER_URL","QUOTA_THRESHOLD","EXPLORER_URL","ZERO_ADDRESS","CURRENCY_NAME","CURRENCY_DECIMALS","TOTAL_MINTS","Networks","id","networkId","connectorUrl","PunkSortTypes","OrderBy","ASC","DESC","PunkSortBy","ID","RANK","PunkEventTypes","Unknown","Mint","Offer","NewBid","CancelBid","Buy","CancelOffer","DefaultPunkFilterValues","sortBy","orderBy","search","String","isNaN","parseInt","isFinite","isString","trim","defaultValue","isNullOrWhitespace","ms","setTimeout","JSON","stringify","encoding","Uint8Array","url","fetch","blob","min","max","Math","floor","random","current","goal","Big","mul","toNumber","total","rpp","page","uuidv4","truncateString","str","maxLength","substr","truncateStringInTheMiddle","strPositionStart","strPositionEnd","getDocumentState","document","visibilityState","Hidden","Active","fn","retries","task","interval","_taskTimer","_taskInterval","_task","_callback","_onStop","_run","callback","window","clearTimeout","FileUtilType","_index","clear","FlexsearchDocument","tag","index","punks","p","add","query","isNumber","mappedResult","split","limit","map","e","enrich","intersectedResult","intersection","ids","intersectionWith","o","CompressUtil","pako","gzip","to","ungzip","Ensure","property","propertyName","FileUtil","BrowserFileUtil","response","arrayBuffer","text","LocalFileUtil","fs","readFileSync","AbiItemType","getFileUtil","Browser","Local","FilterUtil","sort","order","Number","rank","MomentUtil","moment","locale","navigator","language","date","unix","utc","local","getLocal","format","getLocalTime","getLocalDate","unit","diff","duration","BaseDataSource","_moment","_fileUtil","_actionPrice","_mintPrice","_punkSearch","_punkAttributes","_punks","_punksFiltered","searchTerm","items","readFileAsync","attributes","parse","decompress","toUint8Array","punk","__typename","image","unshift","initPunkAttributesAsync","initPunksAsync","disposeProtected","getActiveAccount","notNull","punkId","_limit","_offset","_sort","_order","_search","hasChanged","sortPunks","getMarketInfoAsync","actionPrice","mintPrice","uuid","TransformUtil","number","toMaybeBigNumber","defaultBigNumber","getTime","accountBlockHash","accountBlockHeight","eventType","toBigNumber","fromAddress","MockDataSource","_events","clearMock","events","toPunkEvent","reverse","_address","_id","_height","blockHeight","filter","find","getPunkAsync","itemIndex","bidder","getPunkOwnerAsync","seller","minAmount","onlySellTo","marketStarted","mintsRemaining","shiftedBy","_tokenId","_amount","ds","FormatUtil","defaultMessage","graphQLErrors","toLocaleString","BaseContract","_minQuota","_contract","objectFromEntries","entries","Object","fromEntries","entry","basePath","initAsyncProtected","_quota","getQuotaAsync","lte","_account","_methodName","_params","ensureQuotaAsync","callContractAsync","result1","waitForAccountBlockAsync","result2","formatMessage","stakeForQuotaAsync","logs","createAddressListenerAsync","PunksContract","_abiMap","Map","_path","punksContract","CommonConfig","CONTRACT_ADDRESS","set","getDeveloper","getAbiItem","getMarketInfo","isContract","balanceOf","ownerOf","getMappedIndex","totalSupply","getTokensOf","tokenURI","getBaseUrl","getOffer","getBid","transferEvent","marketChangedEvent","punkChangedEvent","_type","_name","_abiItemType","get","callOffChainMethodAsync","getAbiItemByType","offChain","_price","MintPrice","ActionPrice","toBoolean","market_started","mints_remaining","mint_price","action_price","_started","_owner","_refId","_indices","_startIndex","_baseUrl","_punkId","isForSale","hasBid","_minSalePrice","_fee","_minPrice","contract","ViteDataSource","_listener","handleVmLogAsync","removeListener","dispose","encodedLogSignature","getEventsFromHeight","getAccountBlockHeightAsync","toPunkEvents","ownerOfAsync","getTokensOfAsync","getBidAsync","getOfferAsync","checkQuotaAsync","getMintPriceAsync","mintAsync","getAccount","getFeeAsync","fee","offerToAddressAsync","offerAsync","cancelOfferAsync","buyAsync","enterBidAsync","acceptBidAsync","cancelBidAsync","MarketChanged","PunkChanged","marketEvent","emitMarketChanged","punkEvent","emitPunkChanged","Array","isArray","transformed","decoded","getActionPriceAsync","IS_PRODUCTION","quota","emitQuotaChanged","CommonContext","_datasource","initBaseAsync","context","getCommonContext","OFFER_MUTATION","gql","CANCEL_OFFER_MUTATION","BUY_MUTATION","BID_MUTATION","ACCEPT_BID_MUTATION","CANCEL_BID_MUTATION","MarketMutations","offer","parent","datasource","cancelOffer","buy","bid","bidAsync","acceptBid","cancelBid","MINT_MUTATION","PunkMutations","mint","PUNK_FIELDS","PUNK_EVENT_FIELDS","GET_PUNK_ATTRIBUTES_QUERY","GET_PUNK_EVENTS_QUERY","GET_PUNK_OWNER_QUERY","GET_PUNK_QUERY","GET_PUNKS_QUERY","GET_PUNKS_BY_ADDRESS_QUERY","PunkQueries","punkAttributes","getPunkAttributesAsync","punkEvents","offset","getPunkEventsAsync","punkOwner","getPunksAsync","punksByAddress","getPunksByAddressAsync","GET_MARKET_INFO_QUERY","GET_MARKET_BID_QUERY","GET_MARKET_OFFER_QUERY","GET_MARKET_EVENTS_QUERY","MarketQueries","marketInfo","marketBid","getMarketBidAsync","marketOffer","getMarketOfferAsync","marketEvents","getMarketEventsAsync","GET_QUOTA_QUERY","GeneralQueries","ApolloClientWrapper","ApolloClient","cache","InMemoryCache","typePolicies","Query","fields","offsetLimitPagination","resolvers","GraphQLScalarType","description","serialize","parseValue","Mutation","headers","process","getApolloClient","manager","_networkHeight","_setNetworkCallback","cb","getNetworkManager","Root","styled","theme","Footer","Typography","TitleTypography","HeaderLoading","props","AppBar","position","Toolbar","variant","MainScrollStyled","MainScrollInner","MainScroll","children","restProps","Container","maxWidth","MainWrapperStyled","MainWrapper","Web3Context","React","createContext","Web3Provider","useState","setError","wallet","setWallet","setNetwork","onSetWalletCallback","onSetNetworkCallback","Provider","ConnectedWeb3Context","useConnectedWeb3Context","useContext","ConnectedWeb3","connection","setConnection","web3Context","useWeb3Context","commonContext","useEffect","initWallet","networkManager","getNetwork","logout","useCallback","removeWallet","location","reload","active","SnackbarUtil","emitConnectWalletDialog","snackbar","enqueueSnackbar","Alert","color","backgroundColor","toJsonString","Paper","Box","sx","padding","textAlign","UrlUtil","CustomCardMedia","PunkImage","MarketplaceBrowseItem","Card","CardActionArea","component","RouterLink","item","backgroundImage","getPunkUrl","CardContent","overflow","Chip","label","mb","mr","size","EmptyResult","loading","AccountDetails","useParams","isLoading","setIsLoading","hasMore","setHasMore","useQuery","variables","fetchPolicy","fetchMoreDataAsync","currentLength","fetchMore","pt","gutterBottom","pb","dataLength","next","loader","Grid","container","spacing","justifyContent","alignItems","xs","md","scrollableTarget","marginBottom","sm","lg","Test","walletManager","viteClient","onClick","confetti","particleCount","spread","getWallet","Button","PunkService","_apollo","getById","_fetchPolicy","getOwnerAsync","getEventsAsync","getExtendedAsync","_punk","defaultPunkExtended","ownerQuery","bidQuery","offerQuery","punkExtended","owner","mutate","mutation","Boolean","service","getPunkService","ImageContainer","Image","Img1","Img2","LandingMainImage","imageUrl1","setImageUrl1","imageUrl2","setImageUrl2","setImageUrlsAsync","punkId1","punk1","punkId2","punk2","TestImage","TokenUtil","bn","tokenDecimals","decimals","pow","decimalPlaces","ROUND_DOWN","toFormat","ClickOnceButton","mounted","useRef","isDisabled","setIsDisabled","handleClick","callbackFn","enqueueError","LoadingButton","fullWidth","disabled","startIcon","Countdown","useMemo","getDuration","days","hours","minutes","seconds","state","setState","asSeconds","FontAwesomeSvgIcon","forwardRef","ref","icon","width","svgPathData","SvgIcon","viewBox","d","style","opacity","MintsRemaining","pct","setPct","minValue","elevation","px","Skeleton","animation","formatNumber","LinearProgress","LandingMain","displayNumber","setMintPrice","setMarketStarted","canMint","setCanMint","setMintsRemaining","emitter","punkService","refetch","handleEvent","DocumentVisibilityChanged","off","formatBigNumber","handleMintAsync","enqueueMessage","mt","direction","display","paragraph","Link","underline","href","target","toISOString","Stack","minWidth","alt","src","marginTop","IconButton","faTwitter","faDiscord","ExtendedBootstrapTooltip","BootstrapTooltip","tooltipClasses","tooltip","className","Tooltip","classes","popper","palette","common","white","boxShadow","shadows","fontSize","arrow","black","typography","pxToRem","border","QrCode","elementRef","defaultOpt","ecLevel","HIGH","minVersion","background","mode","modes","DRAW_WITH_IMAGE_BOX","radius","mSize","innerHTML","qrcode","generate","then","LoginDialog","uri","setUri","mnemonic","setMnemonic","onClose","open","setOpen","connectorFactory","handleCreateSession","createAsync","ConnectWalletDialog","Dialog","DialogTitle","DialogContent","DialogContentText","ENABLE_MNEMONIC_LOGIN","FormControl","InputLabel","htmlFor","Input","onChange","autoComplete","createWebWallet","Header","navigate","useNavigate","useTheme","matches","useMediaQuery","breakpoints","up","loginOpen","setLoginOpen","showAccount","textDecoration","title","Fragment","placement","MarketService","getMarketService","IconUtil","getBuyEventTypeIcon","faDonate","getClaimEventTypeIcon","faGift","getOfferEventTypeIcon","faFileInvoiceDollar","getCancelSaleEventTypeIcon","faPowerOff","getCancelGiftEventTypeIcon","faEraser","getPunkEventTypeIcon","faTrophy","faHandHoldingUsd","faBan","faQuestion","ExplorerLinkType","ExplorerUtil","baseUrl","endsWith","substring","DEFAULT_BASE_URL","_tx","ExplorerLink","getUrl","Address","getAddressUrl","getTxUrl","setUrl","CustomAvatar","Avatar","CustomTableCell","TableCell","EventTableRow","momentUtil","TableRow","scope","getEventName","align","Transaction","getLocalReverseFormatted","getFromUnix","EventListLoading","EventList","newEvents","TableContainer","Table","stickyHeader","TableHead","TableBody","MarketplaceBrowseActivity","setEvents","setNewEvents","onCompleted","refresh","addNewEvent","MarketplaceBrowseItemsFilter","values","setValues","attributesQuery","emitEvent","oldValues","newValues","emitPunkFilterValuesChanged","Autocomplete","multiple","freeSolo","options","getOptionLabel","option","join","filterSelectedOptions","renderInput","TextField","FormGroup","Select","labelId","MenuItem","ToggleButtonGroup","exclusive","ToggleButton","transform","MarketplaceLoading","MarketplaceBrowseItems","setFilter","PunkFilterValuesChanged","scrollThreshold","TabPanel","other","role","hidden","MarketplaceBrowse","initialValue","tab","Activity","setValue","borderBottom","borderColor","Tabs","newValue","Tab","MarketplaceItem","CardContainer","Img","maxHeight","MintDialog","setPunkId","punkImage","setPunkImage","zIndex","handleClose","transitionDuration","keepMounted","paddingBottom","DialogActions","PunkActivity","PunkBidDialog","setAmount","setDisabled","changeAmount","updateFee","handleConfirmAsync","refetchAsync","autoFocus","startAdornment","InputAdornment","PunkOfferDialog","setAddress","lt","placeholder","PunkDialog","setFee","BID","OFFER","PunkInfoActions","hasOwner","setHasOwner","showAll","showAny","showBuy","showClaim","showBid","showSell","showAcceptBid","showCancelBid","showCancelSale","showCancelGift","showButtonState","setShowButtonState","dialogState","setDialogState","isOwner","handleFailureAsync","handleBuyAsync","isClaim","actionName","handleAcceptBidAsync","handleCancelBidAsync","handleCancelSaleAsync","isGift","actName","handleOpenDialog","faCheck","InfoContainer","BottomContent","PunkInfo","setPunkExtended","dateRef","setDateRef","notifyOnNetworkStatusChange","refetchWritePolicy","all","newOwner","newBid","newOffer","usePunkInfo","Verified","borderRadius","ml","PunkDetails","Transition","Slide","ConfirmTransactionDialog","TransitionComponent","getContractQuota","QuotaContainer","QuotaAlert","ContractQuota","setQuota","showContainer","setShowContainer","setInterval","quotaResult","gte","clearInterval","minus","QuotaChanged","eq","severity","endIcon","Main","visibility","setVisibility","basename","BASENAME","useSnackbar","emitVisibilityChanged","ReInit","addEventListener","removeEventListener","element","Background","App","apolloClient","LocalizationProvider","dateAdapter","DateAdapter","maxSnack","ApolloProvider","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","createTheme","fontFamily","primary","main","secondary","ReactDOM","render","ThemeProvider","CssBaseline","querySelector","LogEventModel","init","banner","assign","noop","ExtendedConsoleLogger","ENABLE_LOGGER","toLocaleTimeString","mapFn","e1","isEnabled","createLogEventModel","prototype","bind","call","debug","warn","GlobalEmitter","emit","EventEmitter","WalletAccountType","Wallet","accounts","baseInitinit","createAccount","forEach","Web","WebWallet","Session","SessionWallet","session","WalletAccount","baseInit","WalletConnector","opts","meta","saveSession","stopBizHeartBeat","sessionAccounts","existing","updateWalletStore","res","rej","sendCustomRequest","r","updateSession","Connector","getValidSession","bridge","lastAccount","createConnector","createSession","WalletStore","_webWalletKey","_sessionWalletKey","localStorage","removeItem","sessionStorage","getItem","fromJS","saveData","setItem","WalletManager","_store","_wallet","_mnemonicDeriveIndex","_setWalletCallback","updateWallet","validateMnemonic","resetWallet","createWebWalletAccount","setActiveAccount","deriveAddress","mnemonics","createAddressByPrivateKey","validateMnemonics"],"mappings":"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","file":"static/js/main.adba5bf5.chunk.js","sourcesContent":["import { abi as abiutils, accountBlock, utils, ViteAPI } from \"@vite/vitejs\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport { CommonConstants } from \"../common/constants\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getEmitter, IGlobalEmitter } from \"../util/emitter\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { RetryUtil } from \"../util/retry.util\";\r\nimport { Task } from \"../util/task\";\r\nimport { Network, ViteQuotaResult, ViteVmLog, ViteVmLogEvent, VmLog } from \"../util/types\";\r\nimport { getWalletManager, IWalletConnector, SessionWalletAccount, WalletAccount, WalletConnectorFactory, WalletManager, WebWalletAccount } from \"../wallet\";\r\nconst { WS_RPC } = require('@vite/vitejs-ws');\r\n\r\nconst logger = getLogger();\r\n\r\nconst providerTimeout = 10000;\r\nconst providerOptions = { retryTimes: 10, retryInterval: 1000 };\r\n\r\nexport class ViteClient {\r\n  private _network?: Network;\r\n  private _retryCount: number;\r\n  private _isConnected: boolean;\r\n  private _connector?: IWalletConnector;\r\n  private _provider?: any;\r\n  private _client?: any;\r\n  private readonly _emitter: IGlobalEmitter;\r\n  private readonly _walletManager: WalletManager;\r\n  private readonly _connectorFactory: WalletConnectorFactory;\r\n\r\n  constructor() {\r\n    this._retryCount = 0;\r\n    this._isConnected = false;\r\n    this._emitter = getEmitter();\r\n    this._walletManager = getWalletManager();\r\n    this._connectorFactory = new WalletConnectorFactory(this._walletManager);\r\n  }\r\n\r\n  get isConnected(): boolean {\r\n    return this._isConnected;\r\n  }\r\n\r\n  get connector(): Maybe<IWalletConnector> {\r\n    return this._connector;\r\n  }\r\n\r\n  initAsync = async (network: Network) => new Promise<void>((resolve, reject) => {\r\n    logger.info(\"initAsync\", network)();\r\n    this._network = network;\r\n    this._connector = this._connectorFactory.create(network);\r\n    this._provider = new WS_RPC(network.rpcUrl, providerTimeout, providerOptions);\r\n    let isResolved = false;\r\n    // https://github.com/vitelabs/vite.js/blob/master/src/WS/index.js\r\n    this._provider.on('close', () => {\r\n      logger.info('Vite provider closed')();\r\n      this._emitter.emitReInit();\r\n    });\r\n    this._provider.on('error', (err: any) => {\r\n      logger.error('Vite provider error', this._retryCount)();\r\n      if (isResolved) return;\r\n      this._isConnected = false;\r\n      if (this._retryCount >= providerOptions.retryTimes) {\r\n        reject(err);\r\n      } else {\r\n        this._retryCount++;\r\n      }\r\n    });\r\n    this._client = new ViteAPI(this._provider, () => {\r\n      logger.info(`ViteAPI connected to ${this._provider.path}`)();\r\n      isResolved = true;\r\n      this._retryCount = 0;\r\n      this._isConnected = true;\r\n      resolve();\r\n    });\r\n  });\r\n\r\n  dispose(): void {\r\n    logger.info(\"Disposing ViteClient\")();\r\n    this._provider?.destroy();\r\n    this._isConnected = false;\r\n  }\r\n\r\n  encodeParameter(type: string, param: string): string {\r\n    return abiutils.encodeParameter(type, param);\r\n  }\r\n\r\n  encodeLogSignature(jsonFunction: any, methodName?: string): string {\r\n    return abiutils.encodeLogSignature(jsonFunction, methodName);\r\n  }\r\n\r\n  async requestAsync(method: string, ...args: any[]): Promise<any> {\r\n    if (this._isConnected && this._client) {\r\n      const result = RetryUtil.promiseRetry(async () => {\r\n        return this._client.request(method, ...args).catch(async (error: any) => {\r\n          if (error?.message?.toLowerCase().includes(\"connection error\")) {\r\n            logger.error(\"CONNECTION ERROR -> reconnect\", this._network)();\r\n            this._emitter.emitReInit();\r\n            await CommonUtil.timeout(3000);\r\n            throw error;\r\n          } else {\r\n            throw error;\r\n          }\r\n        })\r\n      });\r\n      return result;\r\n    } else {\r\n      throw new Error('Vite client is not ready to make requests.');\r\n    }\r\n  }\r\n\r\n  async getSnapshotChainHeightAsync(): Promise<BigNumber> {\r\n    const result = await this.requestAsync('ledger_getSnapshotChainHeight');\r\n    return new BigNumber(result);\r\n  }\r\n\r\n  async getAccountBlockHeightAsync(address: string): Promise<BigNumber> {\r\n    const result = await this.requestAsync(\"ledger_getAccountInfoByAddress\", address);\r\n    return new BigNumber(result.blockCount);\r\n  }\r\n\r\n  async getBalanceAsync(address: string): Promise<BigNumber> {\r\n    const result = await this.requestAsync(\"ledger_getAccountInfoByAddress\", address);\r\n    return new BigNumber(result.balanceInfoMap[CommonConstants.VITE_TOKEN_ID].balance);\r\n  }\r\n\r\n  async getQuotaAsync(address: string): Promise<ViteQuotaResult> {\r\n    const result = await this.requestAsync(\"contract_getQuotaByAccount\", address);\r\n    return {\r\n      currentQuota: new BigNumber(result.currentQuota),\r\n      maxQuota: new BigNumber(result.maxQuota),\r\n      stakeAmount: new BigNumber(result.stakeAmount)\r\n    }\r\n  }\r\n\r\n  async sendAsync(account: WalletAccount, toAddress: string, amount: string, tokenId: any = CommonConstants.VITE_TOKEN_ID): Promise<any> {\r\n    let block = accountBlock\r\n      .createAccountBlock(\"send\", {\r\n        address: account.address,\r\n        toAddress: toAddress,\r\n        tokenId,\r\n        amount\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async stakeForQuotaAsync(account: WalletAccount, beneficiaryAddress: string, amount: string): Promise<any> {\r\n    let block = accountBlock\r\n      .createAccountBlock(\"stakeForQuota\", {\r\n        address: account.address,\r\n        beneficiaryAddress: beneficiaryAddress,\r\n        amount\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async callContractAsync(account: WalletAccount, methodName: string, abi: any, params: any, toAddress: string, amount: string = '0', tokenId: any = CommonConstants.VITE_TOKEN_ID): Promise<any> {\r\n    let block = accountBlock\r\n      .createAccountBlock(\"callContract\", {\r\n        address: account.address,\r\n        abi,\r\n        methodName,\r\n        tokenId,\r\n        amount,\r\n        toAddress,\r\n        params,\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async createContractAsync(account: WalletAccount, abi: any, binary: any): Promise<any> {\r\n    let responseLatency = 1;\r\n    let quotaMultiplier = 10;\r\n    let randomDegree = 1;\r\n    let block = accountBlock\r\n      .createAccountBlock(\"createContract\", {\r\n        address: account.address,\r\n        abi,\r\n        code: binary,\r\n        responseLatency,\r\n        params: [],\r\n        quotaMultiplier,\r\n        randomDegree\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async callOffChainMethodAsync(contractAddress: string, abi: any, offchaincode: string, params: any): Promise<any> {\r\n    let data = abiutils.encodeFunctionCall(abi, params);\r\n    let dataBase64 = Buffer.from(data, \"hex\").toString(\"base64\");\r\n    let result = await this.requestAsync(\"contract_callOffChainMethod\", {\r\n      selfAddr: contractAddress,\r\n      offChainCode: offchaincode,\r\n      data: dataBase64,\r\n    });\r\n    if (result) {\r\n      let resultBytes = Buffer.from(result, \"base64\").toString(\"hex\");\r\n      let outputs = [];\r\n      for (let i = 0; i < abi.outputs.length; i++) {\r\n        outputs.push(abi.outputs[i].type);\r\n      }\r\n      let offchainDecodeResult = abiutils.decodeParameters(outputs, resultBytes);\r\n      let resultList = [];\r\n      if (offchainDecodeResult) {\r\n        for (let i = 0; i < abi.outputs.length; i++) {\r\n          if (abi.outputs[i].name) {\r\n            resultList.push({\r\n              name: abi.outputs[i].name,\r\n              value: offchainDecodeResult[i],\r\n            });\r\n          } else {\r\n            resultList.push({\r\n              name: \"\",\r\n              value: offchainDecodeResult[i],\r\n            });\r\n          }\r\n        }\r\n      }\r\n      return resultList;\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  decodeVmLog(vmLog: ViteVmLog, abi: any): Maybe<VmLog> {\r\n    let topics = vmLog.topics;\r\n    for (let j = 0; j < abi.length; j++) {\r\n      let abiItem = abi[j];\r\n      if (abiutils.encodeLogSignature(abiItem) === topics[0]) {\r\n        let result = this.decodeVmLogByAbiItem(vmLog, abiItem);\r\n        if (result) {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  decodeVmLogByAbiItem(vmLog: ViteVmLog, abiItem: any): Maybe<VmLog> {\r\n    if (!vmLog || !vmLog.data || !vmLog.topics) {\r\n      return undefined;\r\n    }\r\n    let topics = vmLog.topics;\r\n    let log: VmLog = {\r\n      topic: topics[0],\r\n      args: abiutils.decodeLog(\r\n        abiItem.inputs,\r\n        utils._Buffer.from(vmLog.data, \"base64\").toString(\"hex\"),\r\n        topics.slice(1)\r\n      ),\r\n      event: abiItem.name,\r\n    };\r\n    return log;\r\n  }\r\n\r\n  async getEventsByBlockAsync(address: string, fromHeight: BigNumber, toHeight: BigNumber, topics?: string[][]): Promise<ViteVmLogEvent[]> {\r\n    if (fromHeight.gt(toHeight)) {\r\n      logger.info(`getEventsByBlockAsync ${fromHeight.toFixed()} > ${toHeight.toFixed()}`)();\r\n      return [];\r\n    }\r\n    const payload = {\r\n      addressHeightRange: {\r\n        [address]: {\r\n          fromHeight: fromHeight.toFixed(),\r\n          toHeight: toHeight.toFixed(),\r\n        },\r\n      },\r\n      topics: topics\r\n    };\r\n    try {\r\n      const result = await this.requestAsync(\"ledger_getVmLogsByFilter\", payload);\r\n      return result;\r\n    } catch (error) {\r\n      const midHeight = fromHeight.plus(toHeight).div(2);\r\n      logger.info(`Divide and conquer block fromHeight: ${fromHeight.toFixed()} toHeight: ${toHeight.toFixed()} midHeight: ${midHeight.toFixed()}`)();\r\n      //const arr1 = await this.getEventsByBlockAsync(address, fromHeight, midHeight, topics);\r\n      const arr2 = await this.getEventsByBlockAsync(address, midHeight.plus(1), toHeight, topics);\r\n      //return [...arr1, ...arr2];\r\n      return arr2;\r\n    }\r\n  }\r\n\r\n  async createAddressListenerAsync(address: string): Promise<any> {\r\n    const payload = {\r\n      addressHeightRange: {\r\n        [address]: {\r\n          fromHeight: \"0\",\r\n          toHeight: \"0\",\r\n        },\r\n      },\r\n    };\r\n    const result = await this._client?.subscribe(\"createVmlogSubscription\", payload);\r\n    return result;\r\n  }\r\n\r\n  removeListener(event: any): void {\r\n    logger.info('removeListener')();\r\n    this._client?.unsubscribe(event);\r\n  }\r\n\r\n  async waitForNextVmLogEventAsync(listener: any, abi: any): Promise<Maybe<VmLog>> {\r\n    logger.info('waitForNextVmLogEvent')();\r\n    return new Promise(async (resolve) => {\r\n      // listener = EventEmitter\r\n      // https://github.com/vitelabs/vite.js/blob/14b87a6ddc68fe5836816f949f85d6161e6cfed8/src/viteAPI/eventEmitter.ts\r\n      listener.on(async (results: any[]) => {\r\n        if (results.length !== 1) {\r\n          console.log(results)\r\n          throw new Error('Unexpected results');\r\n        }\r\n        const result = results[results.length - 1];\r\n        // console.log(result);\r\n        const vmLog = this.decodeVmLog(result.vmlog, abi);\r\n        logger.info(\"vmLog\", vmLog)();\r\n        // https://github.com/vitelabs/vite.js/blob/14b87a6ddc68fe5836816f949f85d6161e6cfed8/src/viteAPI/provider.ts\r\n        // Don't unsubscribe, listener should be reusable!\r\n        // provider.unsubscribe(listener);\r\n        resolve(vmLog);\r\n      });\r\n    });\r\n  }\r\n\r\n  async waitForAccountBlockAsync(address: string, height: string): Promise<any> {\r\n    return new Promise(async (resolve, reject) => {\r\n      let result: any = undefined;\r\n      let error: any = undefined;\r\n      let timestamp = Date.now();\r\n      const task = new Task(async () => {\r\n        try {\r\n          if (Date.now() - timestamp >= providerTimeout) {\r\n            throw new Error(\"Task timed out\")\r\n          }\r\n\r\n          let blockByHeight = await this.requestAsync(\r\n            'ledger_getAccountBlockByHeight',\r\n            address,\r\n            height\r\n          );\r\n\r\n          if (!blockByHeight) {\r\n            return true;\r\n          }\r\n\r\n          let receiveBlockHash = blockByHeight.receiveBlockHash;\r\n          if (!receiveBlockHash) {\r\n            return true;\r\n          }\r\n\r\n          let blockByHash = await this.requestAsync('ledger_getAccountBlockByHash', receiveBlockHash);\r\n          if (!blockByHash) {\r\n            return true;\r\n          }\r\n\r\n          result = {\r\n            ...this.getAccountBlockStatus(blockByHash),\r\n            accountBlock: blockByHash\r\n          }\r\n\r\n          return false;\r\n        } catch (err) {\r\n          error = err;\r\n          return false;\r\n        }\r\n      }, 500);\r\n      task.start(() => {\r\n        if (error) {\r\n          reject(error);\r\n        } else {\r\n          resolve(result);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  async receiveTransactionAsync(account: WalletAccount, block?: any): Promise<any> {\r\n    if (!block) {\r\n      // get the first unreceived block\r\n      let blocks = await this.requestAsync(\r\n        \"ledger_getUnreceivedBlocksByAddress\",\r\n        account.address,\r\n        0,\r\n        1\r\n      );\r\n      if (blocks && blocks.length > 0) {\r\n        block = blocks[0];\r\n      }\r\n    }\r\n\r\n    if (!block) {\r\n      logger.info(`No Unreceived Blocks: ${account.address}`)();\r\n      return;\r\n    }\r\n\r\n    let ab = accountBlock\r\n      .createAccountBlock(\"receive\", {\r\n        address: account.address,\r\n        sendBlockHash: block.hash,\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, ab);\r\n  }\r\n\r\n  async receiveAllOnroadTxAsync(account: WalletAccount): Promise<void> {\r\n    const RECEIVE_PER_ROUND = 10;\r\n    let blocks = await this.requestAsync(\r\n      \"ledger_getUnreceivedBlocksByAddress\",\r\n      account.address,\r\n      0,\r\n      RECEIVE_PER_ROUND\r\n    );\r\n\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      let block = blocks[i];\r\n      await this.receiveTransactionAsync(account, block);\r\n    }\r\n    if (blocks.length >= RECEIVE_PER_ROUND) {\r\n      await this.receiveAllOnroadTxAsync(account);\r\n    }\r\n  }\r\n\r\n  private async sendAccountBlockAsync(account: WalletAccount, block: any): Promise<any> {\r\n    if (account instanceof WebWalletAccount) {\r\n      block = block.setProvider(this._client).setPrivateKey(account.privateKey);\r\n      await block.autoSetPreviousAccountBlock();\r\n      const result = await block.sign().send();\r\n      return result;\r\n    } else if (account instanceof SessionWalletAccount) {\r\n      if (this.connector) {\r\n        this._emitter.emitConfirmTransactionDialog(true);\r\n        try {\r\n          const result = await this.connector.sendTransactionAsync({\r\n            block: block.accountBlock\r\n          });\r\n          this._emitter.emitConfirmTransactionDialog(false);\r\n          return result;\r\n        } catch (error) {\r\n          this._emitter.emitConfirmTransactionDialog(false);\r\n          throw error\r\n        }\r\n      } else {\r\n        throw new Error(\"Connector is not defined\");\r\n      }\r\n    } else {\r\n      throw new Error(\"Account not supported\");\r\n    }\r\n  }\r\n\r\n  private getAccountBlockStatus(accountBlock: any) {\r\n    let status = this.resolveAccountBlockData(accountBlock);\r\n    let statusTxt = '';\r\n    switch (status) {\r\n      case 0:\r\n        statusTxt = '0, Execution succeed';\r\n        break;\r\n      case 1:\r\n        statusTxt = '1, Execution reverted';\r\n        break;\r\n      case 2:\r\n        statusTxt = '2, Max call depth exceeded';\r\n        break;\r\n    }\r\n    return {\r\n      status,\r\n      statusTxt\r\n    };\r\n  }\r\n\r\n  private resolveAccountBlockData(accountBlock: any) {\r\n    if (\r\n      (accountBlock.blockType !== 4 && accountBlock.blockType !== 5) ||\r\n      !accountBlock.data\r\n    ) {\r\n      return 0;\r\n    }\r\n    let bytes = utils._Buffer.from(accountBlock.data, 'base64');\r\n\r\n    if (bytes.length !== 33) {\r\n      return 0;\r\n    }\r\n    return bytes[32];\r\n  }\r\n}\r\n\r\nconst client = new ViteClient();\r\n\r\nexport const getViteClient = () => {\r\n  return client;\r\n}","import BigNumber from \"bignumber.js\"\r\n\r\nexport enum DocumentState {\r\n  Unknown,\r\n  Hidden,\r\n  Active\r\n}\r\n\r\nexport enum WalletType {\r\n  MetaMask = 'MetaMask',\r\n}\r\n\r\nexport enum OrderType {\r\n  ASC = 0,\r\n  DESC = 1\r\n}\r\n\r\nexport type Network = {\r\n  id: number\r\n  networkId: number\r\n  name: string\r\n  rpcUrl: string\r\n  connectorUrl: string\r\n}\r\n\r\nexport interface GenericType {\r\n  name: string\r\n  type: string\r\n}\r\n\r\nexport type DisplayBigNumber = {\r\n  number: BigNumber\r\n  displayNumber: string\r\n}\r\n\r\nexport type Contract = {\r\n  address: string\r\n  contractName: string\r\n  binary: string\r\n  offChain: string\r\n  abi: any[]\r\n}\r\n\r\nexport const TypeNames = {\r\n  Punk: \"Punk\",\r\n  PunkExtended: \"PunkExtended\",\r\n  PunkEvent: \"PunkEvent\"\r\n}\r\n\r\nexport type Punk = {\r\n  __typename: string\r\n  id: string\r\n  rank: number\r\n  image: string\r\n  attributes: string[]\r\n}\r\n\r\nexport type PunkExtended = Punk & {\r\n  owner?: Maybe<string>\r\n  bid?: Maybe<MarketBid>\r\n  offer?: Maybe<MarketOffer>\r\n}\r\n\r\nexport type PunkFilterValues = {\r\n  sortBy: string\r\n  orderBy: string\r\n  search: string\r\n}\r\n\r\nexport enum PunkSortType {\r\n  ID = 0,\r\n  RANK = 1\r\n}\r\n\r\nexport type PunkDialogState = {\r\n  type: PunkDialogType\r\n  open: boolean\r\n}\r\n\r\nexport enum PunkDialogType {\r\n  BID = 0,\r\n  OFFER = 1\r\n}\r\n\r\nexport enum PunkEventType {\r\n  Unknown,\r\n  Mint,\r\n  Offer,\r\n  NewBid,\r\n  CancelBid,\r\n  Buy,\r\n  CancelOffer\r\n}\r\n\r\nexport type PunkEvent = {\r\n  __typename: string\r\n  id: string\r\n  accountBlockHash: string\r\n  accountBlockHeight: BigNumber\r\n  timestamp: BigNumber\r\n  eventType: number\r\n  punkId: number\r\n  amount?: Maybe<BigNumber>\r\n  fromAddress?: Maybe<string>\r\n  toAddress?: Maybe<string>\r\n}\r\n\r\nexport type PunkEvents = {\r\n  blockHeight: BigNumber\r\n  events: PunkEvent[]\r\n}\r\n\r\nexport type PunkChangedEvent = {\r\n  accountBlockHash: string\r\n  accountBlockHeight: BigNumber\r\n  timestamp: BigNumber\r\n  eventType: PunkEventType\r\n  punkId: number\r\n  amount?: Maybe<BigNumber>\r\n  fromAddress?: Maybe<string>\r\n  toAddress?: Maybe<string>\r\n}\r\n\r\nexport type FilteredCollection<T> = {\r\n  sortBy: string\r\n  orderBy: string\r\n  searchTerm?: string\r\n  items: T[]\r\n}\r\n\r\nexport enum MarketplaceTab {\r\n  Items = 'items',\r\n  Activity = 'activity'\r\n}\r\n\r\nexport enum MarketEventType {\r\n  Unknown,\r\n  Start,\r\n  Stop,\r\n  MintPrice,\r\n  ActionPrice\r\n}\r\n\r\nexport type MarketChangedEvent = {\r\n  timestamp: BigNumber\r\n  eventType: MarketEventType\r\n  value: BigNumber\r\n}\r\n\r\nexport type ContractMarketInfo = {\r\n  market_started: string\r\n  mints_remaining: string\r\n  mint_price: string\r\n  action_price: string\r\n}\r\n\r\nexport type MarketInfo = {\r\n  marketStarted: boolean\r\n  mintsRemaining: number\r\n  mintPrice: BigNumber\r\n  actionPrice: BigNumber\r\n}\r\n\r\nexport type MarketOffer = {\r\n  itemIndex: BigNumber\r\n  seller: string\r\n  minAmount: BigNumber\r\n  onlySellTo?: Maybe<string>\r\n}\r\n\r\nexport type ContractMarketOffer = MarketOffer & {\r\n  isForSale: boolean\r\n}\r\n\r\nexport type MarketBid = {\r\n  itemIndex: BigNumber\r\n  bidder: string\r\n  amount: BigNumber\r\n}\r\n\r\nexport type ContractMarketBid = MarketBid & {\r\n  hasBid: boolean\r\n}\r\n\r\nexport enum GlobalEvent {\r\n  ReInit = 'ReInit',\r\n  DocumentVisibilityChanged = 'DocumentVisibilityChanged',\r\n  ConfirmTransactionDialog = 'ConfirmTransactionDialog',\r\n  ConnectWalletDialog = 'ConnectWalletDialog',\r\n  QuotaChanged = 'QuotaChanged',\r\n  PunkFilterValuesChanged = 'PunkFilterValuesChanged',\r\n  MarketChanged = 'MarketChanged',\r\n  PunkChanged = 'PunkChanged'\r\n}\r\n\r\nexport enum ViteQuotaType {\r\n  Account = \"Account\",\r\n  Contract = \"Contract\"\r\n}\r\n\r\nexport type ViteQuotaResult = {\r\n  currentQuota: BigNumber\r\n  maxQuota: BigNumber\r\n  stakeAmount: BigNumber\r\n}\r\n\r\nexport type ViteSubscriptionResult = {\r\n  logs: any[],\r\n  listener: any\r\n}\r\n\r\nexport type ViteVmLogEvent = {\r\n  accountBlockHash: string\r\n  accountBlockHeight: string\r\n  address: string\r\n  vmlog: ViteVmLog\r\n}\r\n\r\nexport type ViteVmLog = {\r\n  data: string\r\n  topics: string[]\r\n}\r\n\r\nexport type VmLog = {\r\n  event: string\r\n  topic: string\r\n  args: any\r\n}\r\n\r\nexport enum VmLogEvent {\r\n  MarketChanged = 'MarketChanged',\r\n  PunkChanged = 'PunkChanged'\r\n}","import BigNumber from \"bignumber.js\"\r\nimport { GenericType, Network, PunkEventType, PunkFilterValues } from \"../util/types\"\r\nimport { OrderBy, PunkSortBy } from \"../__generated__/globalTypes\"\r\n\r\nexport const CommonConstants = {\r\n  APP_NAME: 'VitePunks',\r\n  PUNK_NAME: 'VitePunk',\r\n  USE_MOCK_DATASOURCE: false,\r\n  NETWORK_ID: 2,\r\n  WEB_WALLET_STORAGE_SPACE: 'VITEPUNKS_WEB_WALLET',\r\n  SESSION_WALLET_STORAGE_SPACE: 'VITEPUNKS_SESSION_WALLET',\r\n  BG_URL: './assets/images/bg.png',\r\n  ITEM_BG_URL: './assets/images/item_bg.png',\r\n  SAMPLE_PUNK_URL: './assets/images/punk_8311.png',\r\n  LANDING_IMAGE_URL: './assets/images/landing.png',\r\n  QUOTA_WIKI_URL: 'https://github.com/vitepunks/resources/wiki',\r\n  DISCORD_URL: 'https://discord.gg/FsB2uZTn5u',\r\n  TWITTER_URL: 'https://twitter.com/VitePunks',\r\n  QUOTA_THRESHOLD: new BigNumber(\"100000\"),\r\n  EXPLORER_URL: 'https://buidl.viteview.xyz/#/', // 'https://vitescan.io/'\r\n  ZERO_ADDRESS: 'vite_0000000000000000000000000000000000000000a4f3a0cb58',\r\n  VITE_TOKEN_ID: 'tti_5649544520544f4b454e6e40',\r\n  CURRENCY_NAME: 'VITE',\r\n  CURRENCY_DECIMALS: 18,\r\n  TOTAL_MINTS: 10000\r\n}\r\n\r\nexport const Networks: Network[] = [\r\n  {\r\n    id: 0,\r\n    networkId: 0,\r\n    name: 'UNKNOWN',\r\n    rpcUrl: '',\r\n    connectorUrl: ''\r\n  },\r\n  {\r\n    id: 1,\r\n    networkId: 1,\r\n    name: 'MAINNET',\r\n    rpcUrl: 'wss://node.vite.net/gvite/ws',\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  },\r\n  {\r\n    id: 2,\r\n    networkId: 2,\r\n    name: 'TESTNET',\r\n    rpcUrl: 'wss://buidl.vite.net/gvite/ws', //'ws://localhost:41420/', //'wss://buidl.vite.net/gvite/ws', // https://buidl.vite.net/gvite\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  },\r\n  {\r\n    id: 3,\r\n    networkId: 2,\r\n    name: 'TESTNET+MOCK',\r\n    rpcUrl: 'wss://buidl.vite.net/gvite/ws',\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  },\r\n  {\r\n    id: 4,\r\n    networkId: 5,\r\n    name: 'DEBUG',\r\n    rpcUrl: 'ws://localhost:23457',\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  }\r\n]\r\n\r\nexport const OrderTypes: GenericType[] = [\r\n  {\r\n    name: \"Asc\",\r\n    type: OrderBy.ASC\r\n  },\r\n  {\r\n    name: \"Desc\",\r\n    type: OrderBy.DESC\r\n  }\r\n]\r\n\r\n\r\nexport const PunkSortTypes: GenericType[] = [\r\n  {\r\n    name: \"Id\",\r\n    type: PunkSortBy.ID\r\n  },\r\n  {\r\n    name: \"Rank\",\r\n    type: PunkSortBy.RANK\r\n  }\r\n]\r\n\r\nexport const PunkEventTypes: GenericType[] = [\r\n  {\r\n    name: \"Unknown\",\r\n    type: PunkEventType.Unknown.toString()\r\n  },\r\n  {\r\n    name: \"Mint\",\r\n    type: PunkEventType.Mint.toString()\r\n  },\r\n  {\r\n    name: \"Sale offer\",\r\n    type: PunkEventType.Offer.toString()\r\n  },\r\n  {\r\n    name: \"New bid\",\r\n    type: PunkEventType.NewBid.toString()\r\n  },\r\n  {\r\n    name: \"Cancel bid\",\r\n    type: PunkEventType.CancelBid.toString()\r\n  },\r\n  {\r\n    name: \"Buy\",\r\n    type: PunkEventType.Buy.toString()\r\n  },\r\n  {\r\n    name: \"Clear offer\",\r\n    type: PunkEventType.CancelOffer.toString()\r\n  },\r\n]\r\n\r\nexport const DefaultPunkFilterValues: PunkFilterValues = {\r\n  sortBy: PunkSortBy.ID,\r\n  orderBy: OrderBy.DESC,\r\n  search: \"\"\r\n}","import Big from 'big.js';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { DocumentState } from './types';\r\n\r\nexport abstract class CommonUtil {\r\n  static isString(value: any): boolean {\r\n    return typeof value === 'string' || value instanceof String;\r\n  }\r\n\r\n  static isNumber(value: any): boolean {\r\n    return !isNaN(parseInt(value)) && isFinite(value);\r\n  }\r\n\r\n  static isNullOrWhitespace(value?: Maybe<string>): boolean {\r\n    if (!CommonUtil.isString(value)) {\r\n      // console.log('Expected a string but got: ', value);\r\n      return true;\r\n    } else {\r\n      return value === null || value === undefined || value.trim() === '';\r\n    }\r\n  }\r\n\r\n  static isNullOrDefault(value?: string, defaultValue?: string): boolean {\r\n    return CommonUtil.isNullOrWhitespace(value) || value === defaultValue\r\n  }\r\n\r\n  static timeout(ms: number): Promise<void> {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  static truncateString = (str: Maybe<string>, maxLength: number) => {\r\n    if (str) {\r\n      if (maxLength < str.length) {\r\n        return `${str.substr(0, maxLength)}...`\r\n      }\r\n    }\r\n    return str\r\n  }\r\n\r\n  static truncateStringInTheMiddle = (str: Maybe<string>, strPositionStart: number, strPositionEnd: number) => {\r\n    if (str) {\r\n      const minTruncatedLength = strPositionStart + strPositionEnd\r\n      if (minTruncatedLength < str.length) {\r\n        return `${str.substr(0, strPositionStart)}...${str.substr(str.length - strPositionEnd, str.length)}`\r\n      }\r\n    }\r\n    return str\r\n  }\r\n\r\n  static toJsonString(data: any): string {\r\n    return JSON.stringify(data, null, 2);\r\n  }\r\n\r\n  public static toUint8Array(data: string, encoding: BufferEncoding = 'utf8'): Uint8Array {\r\n    return new Uint8Array(Buffer.from(data, encoding));\r\n  }\r\n\r\n  public static getDocumentState = () => {\r\n    if (document.visibilityState === 'hidden') {\r\n      return DocumentState.Hidden;\r\n    }\r\n    return DocumentState.Active;\r\n  };\r\n\r\n\r\n  static async imageUrlToBlob(url: string): Promise<Blob> {\r\n    return (await fetch(url)).blob();\r\n  }\r\n\r\n  static random(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n  }\r\n\r\n  static calculatePercentage(current: Maybe<string>, goal: Maybe<string>): number {\r\n    try {\r\n      if (current && goal) {\r\n        return Math.floor(Big(current).div(Big(goal)).mul(100).toNumber());\r\n      }\r\n    } catch (error) {\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  static calculateMaxRows(total: number, rpp: number, page: number): number {\r\n    return Math.min(Math.min(total - rpp * page, rpp), total);\r\n  }\r\n\r\n  static uuid(): string {\r\n    return uuidv4();\r\n  }\r\n}","export abstract class RetryUtil {\r\n  // https://stackoverflow.com/questions/45444601/promise-retries-until-success-failure-with-typescript\r\n  static async promiseRetry<T>(fn: () => Promise<T>, retries = 5, err?: any): Promise<T> {\r\n    await new Promise(resolve => setTimeout(resolve, (5 - retries) * 1000));\r\n    return !retries ? Promise.reject(err) : fn().catch(error => RetryUtil.promiseRetry(fn, (retries - 1), error));\r\n  }\r\n}","export class Task {\r\n  private _taskTimer: NodeJS.Timeout | undefined\r\n  private _taskInterval: number\r\n  private _task: () => Promise<boolean>\r\n  private _callback?: () => any\r\n\r\n  constructor(task: () => Promise<boolean>, interval: number) {\r\n    this._task = task;\r\n    this._taskInterval = interval;\r\n\r\n    return this;\r\n  }\r\n\r\n  _run(): void {\r\n    this._taskTimer = setTimeout(async () => {\r\n      if (!this._task) {\r\n        this._onStop();\r\n        return;\r\n      }\r\n      if (!(await this._task())) {\r\n        this._onStop();\r\n        return;\r\n      }\r\n      this._run();\r\n    }, this._taskInterval);\r\n  }\r\n\r\n  _onStop() {\r\n    this._callback && this._callback();\r\n  }\r\n\r\n  start(callback?: () => any): void {\r\n    this._callback = callback;\r\n    if (this._taskTimer) {\r\n      return;\r\n    }\r\n\r\n    this._run();\r\n  }\r\n\r\n\r\n  stop(): void {\r\n    this._onStop();\r\n    if (!this._taskTimer) {\r\n      return;\r\n    }\r\n    window.clearTimeout(this._taskTimer);\r\n    this._taskTimer = undefined;\r\n  }\r\n}","import fs from 'fs';\r\n\r\nexport abstract class FileUtil {\r\n  abstract readFileAsync(path: string, encoding?: BufferEncoding): Promise<any>;\r\n}\r\n\r\nexport class BrowserFileUtil extends FileUtil {\r\n  async readFileAsync(path: string, encoding: BufferEncoding = 'utf8'): Promise<any> {\r\n    const response = await fetch(path);\r\n    switch (encoding) {\r\n      case 'binary':\r\n        return response.arrayBuffer();\r\n      default:\r\n        return response.text();\r\n    }\r\n\r\n  }\r\n}\r\n\r\nexport class LocalFileUtil extends FileUtil {\r\n  public async readFileAsync(path: string, encoding: BufferEncoding = 'utf8'): Promise<any> {\r\n    return Promise.resolve(fs.readFileSync(path, encoding));\r\n  }\r\n}\r\n\r\nexport enum FileUtilType {\r\n  Browser = 0,\r\n  Local = 1\r\n}\r\n\r\nexport const getFileUtil = (type: FileUtilType = FileUtilType.Browser) => {\r\n  switch (type) {\r\n    case FileUtilType.Local:\r\n      return new LocalFileUtil();\r\n    default:\r\n      return new BrowserFileUtil();\r\n  }\r\n}","import { Document as FlexsearchDocument } from \"flexsearch\";\r\nimport { intersection, intersectionWith } from \"lodash\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Punk } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class PunkSearch {\r\n  private _index!: FlexsearchDocument<Punk, false>\r\n\r\n  constructor() {\r\n    this.clear();\r\n  }\r\n\r\n  private clear(): void {\r\n    this._index = new FlexsearchDocument({\r\n      document: {\r\n        id: \"id\",\r\n        tag: \"attributes\",\r\n        index: [\"id\"]\r\n      },\r\n      //preset: \"memory\",\r\n      //tokenize: \"forward\"\r\n    });\r\n  }\r\n\r\n  index(punks: Punk[]): void {\r\n    if (punks) {\r\n      this.clear();\r\n      for (const p of punks) {\r\n        this._index.add(p)\r\n      }\r\n    }\r\n  }\r\n\r\n  search(query: string, punks?: Maybe<Punk[]>): Maybe<Punk[]> {\r\n    try {\r\n      if (!punks || CommonUtil.isNullOrWhitespace(query)) {\r\n        return punks;\r\n      }\r\n      if (CommonUtil.isNumber(query)) {\r\n        const index = parseInt(query);\r\n        if (index > 0) {\r\n          const p = punks[index - 1];\r\n          return !p ? [] : [p];\r\n        }\r\n      }\r\n      const result = this._index.search({\r\n        tag: query.split(','),\r\n        limit: 10000\r\n      });\r\n      const mappedResult = result.map(e => e.result);\r\n      if (mappedResult.length > 0) {\r\n        if (mappedResult.length === 1) {\r\n          return this.enrich(mappedResult[0].map(e => e.toString()), punks);\r\n        } else {\r\n          const intersectedResult = intersection(...mappedResult);\r\n          return this.enrich(intersectedResult.map(e => e.toString()), punks);\r\n        }\r\n      }\r\n      return undefined;\r\n    } catch (error) {\r\n      logger.error(error)();\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private enrich(ids: string[], punks: Punk[]): Punk[] {\r\n    return intersectionWith(punks, ids, (o, id) => o.id === id)\r\n  }\r\n}\r\n\r\nconst search = new PunkSearch();\r\n\r\nexport const getPunkSearch = () => {\r\n  return search;\r\n}","import pako from \"pako\";\r\n\r\nexport abstract class CompressUtil {\r\n  static compress(data: any): string {\r\n    return pako.gzip(data, { to: \"string\" });\r\n  }\r\n\r\n  static decompress(data: any): string {\r\n    return pako.ungzip(data, { to: \"string\" });\r\n  }\r\n}","export class Ensure {\r\n\r\n  public static notNull(property: any, propertyName: string, message?: string) {\r\n    if (property === null || property === undefined) {\r\n      if (message) {\r\n        throw new Error(message);\r\n      } else {\r\n        throw new Error('Unexpected null exception. ' + propertyName);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static notNullOrWhiteSpace(property: Maybe<string>, propertyName: string, message?: string) {\r\n    if (property === null || property === undefined || property?.trim() === '') {\r\n      if (message) {\r\n        throw new Error(message);\r\n      } else {\r\n        throw new Error('Unexpected null exception. ' + propertyName);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static maxLength(property: Maybe<string>, propertyName: string, maxLength: number) {\r\n    if (property && property.length > maxLength) {\r\n      throw new Error(`${propertyName} exceeds the maximum length of ${maxLength}`);\r\n    }\r\n  }\r\n\r\n}\r\n","import BigNumber from \"bignumber.js\";\r\nimport * as _path from \"path\";\r\nimport { CommonConfig } from \"../common/config\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { CompressUtil } from \"../util/compress.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { TransformUtil } from \"../util/transform.util\";\r\nimport { ContractMarketBid, ContractMarketInfo, ContractMarketOffer, MarketEventType, MarketInfo } from \"../util/types\";\r\nimport { WalletAccount } from \"../wallet\";\r\nimport { BaseContract } from \"./base.contract\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport enum AbiItemType {\r\n  getDeveloper,\r\n  getMarketInfo,\r\n  isContract,\r\n  balanceOf,\r\n  ownerOf,\r\n  getMappedIndex,\r\n  totalSupply,\r\n  getTokensOf,\r\n  tokenURI,\r\n  getBaseUrl,\r\n  getOffer,\r\n  getBid,\r\n  transferEvent,\r\n  marketChangedEvent,\r\n  punkChangedEvent\r\n}\r\n\r\nexport class PunksContract extends BaseContract {\r\n  private _abiMap: Map<AbiItemType, any>;\r\n\r\n  constructor() {\r\n    super();\r\n    this._abiMap = new Map<AbiItemType, any>();\r\n  }\r\n\r\n  protected async initAsyncProtected(basePath: string): Promise<void> {\r\n    const punksContract = await this._fileUtil.readFileAsync(_path.resolve(basePath, \"Punks.gz\"), \"binary\");\r\n    this._contract = JSON.parse(CompressUtil.decompress(CommonUtil.toUint8Array(punksContract, \"binary\")));\r\n    this._contract.address = CommonConfig.CONTRACT_ADDRESS;\r\n    this._abiMap.set(AbiItemType.getDeveloper, this.getAbiItem(\"offchain\", \"getDeveloper\"));\r\n    this._abiMap.set(AbiItemType.getMarketInfo, this.getAbiItem(\"offchain\", \"getMarketInfo\"));\r\n    this._abiMap.set(AbiItemType.isContract, this.getAbiItem(\"offchain\", \"isContract\"));\r\n    this._abiMap.set(AbiItemType.balanceOf, this.getAbiItem(\"offchain\", \"balanceOf\"));\r\n    this._abiMap.set(AbiItemType.ownerOf, this.getAbiItem(\"offchain\", \"ownerOf\"));\r\n    this._abiMap.set(AbiItemType.getMappedIndex, this.getAbiItem(\"offchain\", \"getMappedIndex\"));\r\n    this._abiMap.set(AbiItemType.totalSupply, this.getAbiItem(\"offchain\", \"totalSupply\"));\r\n    this._abiMap.set(AbiItemType.getTokensOf, this.getAbiItem(\"offchain\", \"getTokensOf\"));\r\n    this._abiMap.set(AbiItemType.tokenURI, this.getAbiItem(\"offchain\", \"tokenURI\"));\r\n    this._abiMap.set(AbiItemType.getBaseUrl, this.getAbiItem(\"offchain\", \"getBaseUrl\"));\r\n    this._abiMap.set(AbiItemType.getOffer, this.getAbiItem(\"offchain\", \"getOffer\"));\r\n    this._abiMap.set(AbiItemType.getBid, this.getAbiItem(\"offchain\", \"getBid\"));\r\n    this._abiMap.set(AbiItemType.transferEvent, this.getAbiItem(\"event\", \"Transfer\"));\r\n    this._abiMap.set(AbiItemType.marketChangedEvent, this.getAbiItem(\"event\", \"MarketChanged\"));\r\n    this._abiMap.set(AbiItemType.punkChangedEvent, this.getAbiItem(\"event\", \"PunkChanged\"));\r\n  }\r\n\r\n  private getAbiItem(_type: string, _name: string): any {\r\n    return this._contract.abi.find(e => e.type === _type && e.name === _name);\r\n  }\r\n\r\n  getAbiItemByType(_abiItemType: AbiItemType): any {\r\n    return this._abiMap.get(_abiItemType);\r\n  }\r\n\r\n  private async callOffChainMethodAsync(_abiItemType: AbiItemType, _params: any): Promise<any> {\r\n    return this._client.callOffChainMethodAsync(this._contract.address, this.getAbiItemByType(_abiItemType), this._contract.offChain, _params);\r\n  }\r\n\r\n  async setMintPriceAsync(_account: WalletAccount, _price: string): Promise<any> {\r\n    logger.info(\"setMintPriceAsync\", _price)();\r\n    return this.callContractAsync(_account, 'setPrice', [MarketEventType.MintPrice, _price]);\r\n  }\r\n\r\n  async setActionPriceAsync(_account: WalletAccount, _price: string): Promise<any> {\r\n    logger.info(\"setActionPriceAsync\", _price)();\r\n    return this.callContractAsync(_account, 'setPrice', [MarketEventType.ActionPrice, _price]);\r\n  }\r\n\r\n  async getDeveloperAsync(): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getDeveloper, []);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getDeveloperAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async setDeveloperAsync(_account: WalletAccount, _address: string): Promise<any> {\r\n    logger.info(\"setDeveloperAsync\", _address)();\r\n    return this.callContractAsync(_account, 'setDeveloper', [_address]);\r\n  }\r\n\r\n  async getMarketInfoAsync(): Promise<MarketInfo> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getMarketInfo, []);\r\n    const e = this.objectFromEntries(result) as ContractMarketInfo;\r\n    logger.info(\"getMarketInfoAsync\", e)();\r\n    return {\r\n      marketStarted: this.toBoolean(e.market_started),\r\n      mintsRemaining: parseInt(e.mints_remaining),\r\n      mintPrice: TransformUtil.toBigNumber(e.mint_price),\r\n      actionPrice: TransformUtil.toBigNumber(e.action_price)\r\n    };\r\n  }\r\n\r\n  async setMarketStartedAsync(_account: WalletAccount, _started: boolean): Promise<any> {\r\n    logger.info(\"setMarketStartedAsync\", _started)();\r\n    return this.callContractAsync(_account, 'setMarketStarted', [_started]);\r\n  }\r\n\r\n  async isContractAsync(_address: string): Promise<boolean> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.isContract, [_address]);\r\n    if (!result) {\r\n      return false;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"isContractAsync\", value)();\r\n    return this.toBoolean(value);\r\n  }\r\n\r\n  async balanceOfAsync(_owner: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.balanceOf, [_owner]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"balanceOfAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async ownerOfAsync(_tokenId: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.ownerOf, [_tokenId]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"ownerOfAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async getMappedIndexAsync(_refId: string): Promise<Maybe<BigNumber>> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getMappedIndex, [_refId]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getMappedIndexAsync\", _refId, \":\", value)();\r\n    return TransformUtil.toBigNumber(value);\r\n  }\r\n\r\n  async setMappedIndicesAsync(_account: WalletAccount, _indices: string[], _startIndex: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'setMappedIndices', [_indices, _startIndex]);\r\n  }\r\n\r\n  async mintAsync(_account: WalletAccount, _mintPrice: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'mint', [], _mintPrice);\r\n  }\r\n\r\n  async totalSupplyAsync(_owner: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.totalSupply, []);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"totalSupplyAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async getTokensOfAsync(_owner: string): Promise<string[]> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getTokensOf, [_owner]);\r\n    if (!result) {\r\n      return [];\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getTokensOfAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async tokenURIAsync(_tokenId: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.tokenURI, [_tokenId]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"tokenURIAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async getBaseUrlAsync(): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getBaseUrl, []);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getBaseUrlAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async setBaseUrlAsync(_account: WalletAccount, _baseUrl: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'setBaseUrl', [_baseUrl]);\r\n  }\r\n\r\n  async getOfferAsync(_punkId: string): Promise<ContractMarketOffer> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getOffer, [_punkId]);\r\n    logger.info(\"getOfferAsync\", \"_punkId\", _punkId, result)();\r\n    return {\r\n      isForSale: this.toBoolean(result[0].value),\r\n      itemIndex: new BigNumber(_punkId),\r\n      seller: result[1].value,\r\n      minAmount: new BigNumber(result[2].value),\r\n      onlySellTo: TransformUtil.toAddress(result[3].value)\r\n    };\r\n  }\r\n\r\n  async getBidAsync(_punkId: string): Promise<ContractMarketBid> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getBid, [_punkId]);\r\n    logger.info(\"getBidAsync\", \"_punkId\", _punkId, result)();\r\n    return {\r\n      hasBid: this.toBoolean(result[0].value),\r\n      itemIndex: new BigNumber(_punkId),\r\n      bidder: result[1].value,\r\n      amount: new BigNumber(result[2].value)\r\n    };\r\n  }\r\n\r\n  async cancelOfferAsync(_account: WalletAccount, _punkId: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'cancelOffer', [_punkId]);\r\n  }\r\n\r\n  async offerAsync(_account: WalletAccount, _punkId: string, _minSalePrice: string, _fee?: Maybe<string>): Promise<any> {\r\n    logger.info(`offerAsync punkId: ${_punkId} minSalePrice: ${_minSalePrice} fee: ${_fee}`)();\r\n    return this.callContractAsync(_account, 'offer', [_punkId, _minSalePrice], _fee ?? undefined);\r\n  }\r\n\r\n  async offerToAddressAsync(_account: WalletAccount, _punkId: string, _minSalePrice: string, _address: string, _fee?: Maybe<string>): Promise<any> {\r\n    logger.info(`offerToAddressAsync punkId: ${_punkId} minSalePrice: ${_minSalePrice} address: ${_address} fee: ${_fee}`)();\r\n    return this.callContractAsync(_account, 'offerToAddress', [_punkId, _minSalePrice, _address], _fee ?? undefined);\r\n  }\r\n\r\n  async buyAsync(_account: WalletAccount, _punkId: string, _amount: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'buy', [_punkId], _amount);\r\n  }\r\n\r\n  async cancelBidAsync(_account: WalletAccount, _punkId: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'cancelBid', [_punkId]);\r\n  }\r\n\r\n  async enterBidAsync(_account: WalletAccount, _punkId: string, _amount: string, _fee?: Maybe<string>): Promise<any> {\r\n    logger.info(`enterBidAsync punkId: ${_punkId} amount: ${_amount} fee: ${_fee}`)();\r\n    let amount = _amount;\r\n    if (_fee && !CommonUtil.isNullOrWhitespace(_fee)) {\r\n      amount = new BigNumber(_amount).plus(new BigNumber(_fee)).toFixed();\r\n      logger.info(`enterBidAsync amount+fee: ${amount}`)();\r\n    }\r\n    return this.callContractAsync(_account, 'enterBid', [_punkId], amount);\r\n  }\r\n\r\n  async acceptBidAsync(_account: WalletAccount, _punkId: string, _minPrice: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'acceptBid', [_punkId, _minPrice]);\r\n  }\r\n}\r\n\r\nconst contract = new PunksContract();\r\n\r\nexport const getPunksContract = () => {\r\n  return contract;\r\n}","import { orderBy } from \"lodash\";\r\nimport { OrderBy, PunkSortBy } from \"../__generated__/globalTypes\";\r\nimport { Punk } from \"./types\";\r\n\r\nexport abstract class FilterUtil {\r\n  static sortPunks(sort: PunkSortBy, order: OrderBy, punks?: Maybe<Punk[]>): Maybe<Punk[]> {\r\n    if (!punks || !sort || !order) {\r\n      return punks;\r\n    }\r\n    switch (sort) {\r\n      case PunkSortBy.ID:\r\n        return orderBy(\r\n          punks,\r\n          (p: Punk) => Number(p.id),\r\n          order === OrderBy.ASC ? 'asc' : 'desc',\r\n        )\r\n      case PunkSortBy.RANK:\r\n        return orderBy(\r\n          punks,\r\n          (p: Punk) => p.rank,\r\n          order === OrderBy.ASC ? 'asc' : 'desc',\r\n        )\r\n      default:\r\n        return punks;\r\n    }\r\n  }\r\n}","import moment from 'moment';\r\n\r\nexport class MomentUtil {\r\n  constructor() {\r\n    moment.locale(navigator.language);\r\n  }\r\n\r\n  public setLocale(language: string): void {\r\n    moment.locale(language);\r\n  }\r\n\r\n  public get(): moment.Moment {\r\n    return moment()\r\n  }\r\n\r\n  public getFromUnix(date: number) {\r\n    return moment.unix(date);\r\n  }\r\n\r\n  public getFromMilliseconds(date: number) {\r\n    return moment(date, 'x');\r\n  }\r\n\r\n  public getLocal(date: any): moment.Moment {\r\n    return moment.utc(date).local();\r\n  }\r\n\r\n  public getLocalTime(date: any): string {\r\n    return this.getLocal(date).format('LTS');\r\n  }\r\n\r\n  public getLocalDate(date: any): string {\r\n    return this.getLocal(date).format('L');\r\n  }\r\n\r\n  public getLocalFormatted(date: any): string {\r\n    return this.getLocalTime(date) + ' ' + this.getLocalDate(date);\r\n  }\r\n\r\n  public getLocalReverseFormatted(date: any): string {\r\n    return this.getLocalDate(date) + ' ' + this.getLocalTime(date);\r\n  }\r\n\r\n  public getDuration(date: any, unit: moment.unitOfTime.DurationConstructor | undefined = \"seconds\"): moment.Duration {\r\n    const diff = moment(date).unix() - moment().unix();\r\n    return moment.duration(diff, unit);\r\n  }\r\n\r\n  public isExpired(timestamp: any): boolean {\r\n    try {\r\n      if (timestamp) {\r\n        return moment.utc().unix() >= Number(timestamp);\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n}","import { BigNumber } from \"bignumber.js\";\r\nimport { DefaultPunkFilterValues } from \"../common/constants\";\r\nimport { getPunkSearch, PunkSearch } from \"../search\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { CompressUtil } from \"../util/compress.util\";\r\nimport { getEmitter, IGlobalEmitter } from \"../util/emitter\";\r\nimport { Ensure } from \"../util/ensure\";\r\nimport { FileUtil, getFileUtil } from \"../util/file.util\";\r\nimport { FilterUtil } from \"../util/filter.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { MomentUtil } from \"../util/moment.util\";\r\nimport { FilteredCollection, MarketBid, MarketInfo, MarketOffer, Network, Punk, PunkEvents, TypeNames, ViteQuotaResult } from \"../util/types\";\r\nimport { getWalletManager, WalletAccount, WalletManager } from \"../wallet\";\r\nimport { OrderBy, PunkSortBy } from \"../__generated__/globalTypes\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport interface IDataSource {\r\n  initBaseAsync(network: Network): Promise<void>;\r\n  initAsync(network: Network): Promise<void>;\r\n  dispose(): void;\r\n  getQuotaAsync(_address: string): Promise<ViteQuotaResult>;\r\n  getPunkAttributesAsync(): Promise<string[]>;\r\n  getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  getPunkOwnerAsync(_id: string): Promise<Maybe<string>>;\r\n  getPunkAsync(_id: string): Promise<Punk>;\r\n  getPunksAsync(_limit: number, _offset: number, _sort: string, _order: string, _search: string): Promise<Punk[]>;\r\n  getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]>;\r\n  getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>>;\r\n  getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>>;\r\n  getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  getMarketInfoAsync(): Promise<MarketInfo>;\r\n  getActionPriceAsync(): Promise<BigNumber>;\r\n  getMintPriceAsync(): Promise<BigNumber>;\r\n  mintAsync(): Promise<boolean>;\r\n  offerAsync(_id: string, _amount: string, _address?: Maybe<string>): Promise<boolean>;\r\n  cancelOfferAsync(_id: string): Promise<boolean>;\r\n  buyAsync(_id: string, _amount: string): Promise<boolean>;\r\n  bidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  acceptBidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  cancelBidAsync(_id: string): Promise<boolean>;\r\n}\r\n\r\nexport abstract class BaseDataSource implements IDataSource {\r\n  protected readonly _emitter: IGlobalEmitter;\r\n  protected _moment: MomentUtil = new MomentUtil();\r\n  protected readonly _fileUtil: FileUtil;\r\n  protected _actionPrice?: BigNumber;\r\n  protected _mintPrice?: BigNumber;\r\n  private readonly _walletManager: WalletManager;\r\n  private readonly _punkSearch: PunkSearch;\r\n  private _punkAttributes!: string[];\r\n  private _punks!: Punk[];\r\n  private _punksFiltered!: FilteredCollection<Punk>;\r\n\r\n  constructor() {\r\n    this._emitter = getEmitter();\r\n    this._fileUtil = getFileUtil();\r\n    this._walletManager = getWalletManager();\r\n    this._punkSearch = getPunkSearch();\r\n    this.clear();\r\n  }\r\n\r\n  private clear(): void {\r\n    this._punkAttributes = [];\r\n    this._punks = [];\r\n    this._punksFiltered = {\r\n      sortBy: DefaultPunkFilterValues.sortBy,\r\n      orderBy: DefaultPunkFilterValues.orderBy,\r\n      searchTerm: DefaultPunkFilterValues.search,\r\n      items: []\r\n    }\r\n  }\r\n\r\n  private async initPunkAttributesAsync(): Promise<void> {\r\n    let attributes = await this._fileUtil.readFileAsync(\"./assets/data/punk_attributes.json\");\r\n    attributes = JSON.parse(attributes);\r\n    this._punkAttributes = attributes;\r\n  }\r\n\r\n  private async initPunksAsync(): Promise<void> {\r\n    let punks = await this._fileUtil.readFileAsync(\"./assets/data/punks.gz\", \"binary\");\r\n    punks = JSON.parse(CompressUtil.decompress(CommonUtil.toUint8Array(punks)));\r\n    for (let index = 0; index < punks.length; index++) {\r\n      const p = punks[index];\r\n      const punk: Punk = {\r\n        __typename: TypeNames.Punk,\r\n        id: p.index.toString(),\r\n        rank: p.rank,\r\n        image: p.image,\r\n        attributes: p.attributes\r\n      };\r\n      this._punks.push(punk);\r\n      if (this._punksFiltered.orderBy === OrderBy.ASC) {\r\n        this._punksFiltered.items.push(punk);\r\n      } else {\r\n        this._punksFiltered.items.unshift(punk);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  async initBaseAsync(network: Network): Promise<void> {\r\n    logger.info(\"Init BaseDataSource\")();\r\n    this._moment = new MomentUtil();\r\n    this.clear();\r\n    await this.initPunkAttributesAsync();\r\n    await this.initPunksAsync();\r\n    await this.initAsync(network);\r\n    this._punkSearch.index(this._punks);\r\n  }\r\n\r\n  dispose(): void {\r\n    logger.info(\"Disposing BaseDataSource\")();\r\n    this.disposeProtected();\r\n  }\r\n\r\n  getAccount(): WalletAccount {\r\n    const account = this._walletManager.getActiveAccount();\r\n    Ensure.notNull(account, \"account\", \"Please connect your wallet first.\");\r\n    return account as WalletAccount;\r\n  }\r\n\r\n  async getPunkAttributesAsync(): Promise<string[]> {\r\n    return this._punkAttributes;\r\n  }\r\n\r\n  async getPunkAsync(id: string): Promise<Punk> {\r\n    if (!CommonUtil.isNumber(id)) {\r\n      throw new Error(\"Invalid punk identifier.\");\r\n    }\r\n    const punkId = parseInt(id) - 1;\r\n    if (punkId < 0 || punkId >= this._punks.length) {\r\n      throw new Error(\"Punk does not exist.\");\r\n    }\r\n    return this._punks[punkId];\r\n  }\r\n\r\n  async getPunksAsync(_limit: number, _offset: number, _sort: string, _order: string, _search: string): Promise<Punk[]> {\r\n    // check if sort, order or search changed -> update punksFiltered\r\n    let hasChanged = false;\r\n    if (this._punksFiltered.searchTerm !== _search) {\r\n      hasChanged = true;\r\n      this._punksFiltered.searchTerm = _search;\r\n      this._punksFiltered.items = this._punkSearch.search(_search, this._punks) ?? [];\r\n    }\r\n    if (hasChanged || this._punksFiltered.sortBy !== _sort || this._punksFiltered.orderBy !== _order) {\r\n      logger.info(\"limit\", _limit, \"offset\", _offset, \"sort\", _sort, \"order\", _order)();\r\n      this._punksFiltered.sortBy = _sort;\r\n      this._punksFiltered.orderBy = _order;\r\n      this._punksFiltered.items = FilterUtil.sortPunks(this._punksFiltered.sortBy as PunkSortBy, this._punksFiltered.orderBy as OrderBy, this._punksFiltered.items) ?? [];\r\n    }\r\n    return this._punksFiltered.items.slice(_offset, _offset + _limit);\r\n  }\r\n\r\n  async getActionPriceAsync(): Promise<BigNumber> {\r\n    if (!this._actionPrice) {\r\n      const result = await this.getMarketInfoAsync();\r\n      this._actionPrice = result.actionPrice;\r\n    }\r\n    return this._actionPrice;\r\n  }\r\n\r\n  async getMintPriceAsync(): Promise<BigNumber> {\r\n    if (!this._mintPrice) {\r\n      const result = await this.getMarketInfoAsync();\r\n      this._mintPrice = result.mintPrice;\r\n    }\r\n    return this._mintPrice;\r\n  }\r\n\r\n  protected createId(): string {\r\n    return CommonUtil.uuid();\r\n  }\r\n\r\n  abstract initAsync(network: Network): Promise<void>;\r\n  protected abstract disposeProtected(): void;\r\n  abstract getQuotaAsync(_address: string): Promise<ViteQuotaResult>;\r\n  abstract getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  abstract getPunkOwnerAsync(_id: string): Promise<Maybe<string>>;\r\n  abstract getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]>;\r\n  abstract getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>>;\r\n  abstract getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>>;\r\n  abstract getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  abstract getMarketInfoAsync(): Promise<MarketInfo>;\r\n  abstract mintAsync(): Promise<boolean>;\r\n  abstract offerAsync(_id: string, _amount: string, _address?: Maybe<string>): Promise<boolean>;\r\n  abstract cancelOfferAsync(_id: string): Promise<boolean>;\r\n  abstract buyAsync(_id: string, _amount: string): Promise<boolean>;\r\n  abstract bidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  abstract acceptBidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  abstract cancelBidAsync(_id: string): Promise<boolean>;\r\n}","import { BigNumber } from 'bignumber.js';\r\nimport { CommonConstants } from '../common/constants';\r\nimport { CommonUtil } from './common.util';\r\nimport { PunkEvent, TypeNames } from './types';\r\n\r\nexport abstract class TransformUtil {\r\n  static get defaultBigNumber(): BigNumber {\r\n    return new BigNumber(\"0\");\r\n  }\r\n\r\n  static toBigNumber(number: string): BigNumber {\r\n    return TransformUtil.toMaybeBigNumber(number) ?? TransformUtil.defaultBigNumber;\r\n  }\r\n\r\n  static toMaybeBigNumber(number: Maybe<string>): Maybe<BigNumber> {\r\n    if (!number || (CommonUtil.isNullOrWhitespace(number) && !CommonUtil.isNumber(number))) {\r\n      return undefined;\r\n    }\r\n    return new BigNumber(number);\r\n  }\r\n\r\n  static toAddress(value: string): Maybe<string> {\r\n    if (CommonUtil.isNullOrWhitespace(value) || value === CommonConstants.ZERO_ADDRESS) {\r\n      return undefined;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  static toTimestamp(date: Maybe<Date>): string {\r\n    if (date) {\r\n      return Math.floor(date.getTime() / 1000).toString();\r\n    }\r\n    return \"0\";\r\n  }\r\n\r\n  static toPunkEvent(event: any): PunkEvent {\r\n    return {\r\n      __typename: event.__typename ?? TypeNames.PunkEvent,\r\n      id: event.id ?? `${event.accountBlockHash}-${event.accountBlockHeight}-${event.eventType}`,\r\n      accountBlockHash: event.accountBlockHash,\r\n      accountBlockHeight: TransformUtil.toBigNumber(event.accountBlockHeight),\r\n      timestamp: TransformUtil.toBigNumber(event.timestamp),\r\n      eventType: Number(event.eventType),\r\n      punkId: event.punkId,\r\n      amount: TransformUtil.toBigNumber(event.amount),\r\n      fromAddress: TransformUtil.toAddress(event.fromAddress) ?? '',\r\n      toAddress: TransformUtil.toAddress(event.toAddress) ?? ''\r\n    };\r\n  }\r\n}","import { BigNumber } from \"bignumber.js\";\r\nimport { BaseDataSource } from \".\";\r\nimport { CommonConstants } from \"../common/constants\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { TransformUtil } from \"../util/transform.util\";\r\nimport { MarketBid, MarketInfo, MarketOffer, Network, Punk, PunkEvent, PunkEvents, PunkEventType, ViteQuotaResult } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class MockDataSource extends BaseDataSource {\r\n  private _events!: PunkEvent[];\r\n\r\n  constructor() {\r\n    super();\r\n    this.clearMock();\r\n  }\r\n\r\n  private clearMock(): void {\r\n    this._events = [];\r\n  }\r\n\r\n  async initAsync(network: Network): Promise<void> {\r\n    logger.info('Init MockDataSource')();\r\n    let events = await this._fileUtil.readFileAsync(\"./assets/data/mock_events.json\");\r\n    events = JSON.parse(events);\r\n    this.clearMock();\r\n    for (let index = 0; index < events.length; index++) {\r\n      const e = events[index];\r\n      this._events.push(TransformUtil.toPunkEvent(e));\r\n    }\r\n    this._events = this._events.reverse();\r\n  }\r\n\r\n  protected disposeProtected(): void {\r\n    logger.info('Dispose MockDataSource')();\r\n    this.clearMock();\r\n  }\r\n\r\n  async getQuotaAsync(_address: string): Promise<ViteQuotaResult> {\r\n    return {\r\n      currentQuota: new BigNumber(\"1000\"),\r\n      maxQuota: new BigNumber(\"2000\"),\r\n      stakeAmount: new BigNumber(\"10000\")\r\n    };\r\n  }\r\n\r\n  async getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"id\", _id, \"limit\", _limit, \"offset\", _offset, \"height\", _height)();\r\n    await CommonUtil.timeout(2000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return {\r\n        blockHeight: TransformUtil.defaultBigNumber,\r\n        events: []\r\n      };\r\n    }\r\n    return {\r\n      blockHeight: TransformUtil.defaultBigNumber,\r\n      events: this._events.filter(e => e.punkId === parseInt(_id)).slice(_offset, _offset + _limit)\r\n    };\r\n  }\r\n\r\n  async getPunkOwnerAsync(_id: string): Promise<Maybe<string>> {\r\n    await CommonUtil.timeout(2000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return undefined;\r\n    }\r\n    const e = this._events.find(e => e.punkId.toString() === _id && e.eventType === PunkEventType.Mint);\r\n    if (!e) {\r\n      return undefined;\r\n    }\r\n    return e.toAddress;\r\n  }\r\n\r\n  async getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]> {\r\n    logger.info(\"_address\", _address, \"limit\", _limit, \"offset\", _offset)();\r\n    const punks = [\r\n      await this.getPunkAsync(\"101\"),\r\n      await this.getPunkAsync(\"201\"),\r\n      await this.getPunkAsync(\"301\"),\r\n      await this.getPunkAsync(\"401\"),\r\n      await this.getPunkAsync(\"501\"),\r\n      await this.getPunkAsync(\"601\"),\r\n      await this.getPunkAsync(\"701\"),\r\n      await this.getPunkAsync(\"801\"),\r\n      await this.getPunkAsync(\"9999\")\r\n    ];\r\n    return punks.slice(_offset, _offset + _limit);\r\n  }\r\n\r\n  async getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>> {\r\n    await CommonUtil.timeout(1000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return undefined;\r\n    }\r\n    const e = this._events.find(e => e.punkId.toString() === _id && e.eventType === PunkEventType.NewBid);\r\n    if (!e) {\r\n      return undefined;\r\n    }\r\n    return {\r\n      itemIndex: TransformUtil.toBigNumber(_id),\r\n      bidder: e.fromAddress ?? CommonConstants.ZERO_ADDRESS,\r\n      amount: e.amount ?? TransformUtil.defaultBigNumber\r\n    }\r\n  }\r\n\r\n  async getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>> {\r\n    await CommonUtil.timeout(1000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return undefined;\r\n    }\r\n    const e = this._events.find(e => e.punkId.toString() === _id && e.eventType === PunkEventType.Offer);\r\n    if (!e) {\r\n      return undefined;\r\n    }\r\n    const seller = await this.getPunkOwnerAsync(_id);\r\n    return {\r\n      itemIndex: TransformUtil.toBigNumber(_id),\r\n      seller: seller ?? CommonConstants.ZERO_ADDRESS,\r\n      minAmount: e.amount ?? TransformUtil.defaultBigNumber,\r\n      onlySellTo: e.toAddress\r\n    }\r\n  }\r\n\r\n  async getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"limit\", _limit, \"offset\", _offset)();\r\n    await CommonUtil.timeout(500);\r\n    return {\r\n      blockHeight: new BigNumber(\"0\"),\r\n      events: this._events.slice(_offset, _offset + _limit)\r\n    }\r\n  }\r\n\r\n  async getMarketInfoAsync(): Promise<MarketInfo> {\r\n    logger.info(\"getMarketInfoAsync\")();\r\n    return {\r\n      marketStarted: true,\r\n      mintsRemaining: CommonConstants.TOTAL_MINTS - this._events.filter(e => e.eventType === PunkEventType.Mint).length,\r\n      mintPrice: new BigNumber(\"12\").shiftedBy(18),\r\n      actionPrice: new BigNumber(\"3.1\").shiftedBy(18),\r\n    };\r\n  }\r\n\r\n  async mintAsync(): Promise<boolean> {\r\n    throw new Error(\"Method 'mintAsync' not implemented.\");\r\n  }\r\n\r\n  async offerAsync(_id: string, _tokenId: string, _amount: string, _address?: string | null): Promise<boolean> {\r\n    logger.info(\"offerAsync\", \"id\", _id, \"tokenId\", _tokenId, \"amount\", _amount, \"address\", _address)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async cancelOfferAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelOfferAsync\", \"id\", _id)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async buyAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"buyAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async bidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"bidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async acceptBidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"acceptBidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async cancelBidAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelBidAsync\", \"id\", _id)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n}\r\n\r\nconst ds = new MockDataSource();\r\n\r\nexport const getMockDataSource = () => {\r\n  return ds;\r\n}","import { CommonUtil } from './common.util';\r\n\r\nexport abstract class FormatUtil {\r\n  static formatMessage(data: any): string {\r\n    const defaultMessage = \"Something went wrong. Probably your account has insufficient balance or quota.\"\r\n    if (data) {\r\n      console.log(data)\r\n      let message: string\r\n      if (!CommonUtil.isString(data)) {\r\n        if (data.message) {\r\n          message = data.message\r\n        }\r\n        else if (data.error?.message) {\r\n          message = data.error.message\r\n        } else if (data.graphQLErrors) {\r\n          if (data.graphQLErrors.length > 0) {\r\n            message = data.graphQLErrors[0].message\r\n          } else {\r\n            message = defaultMessage\r\n          }\r\n        } else {\r\n          message = JSON.stringify(data)\r\n          if (message === \"{}\") {\r\n            message = defaultMessage\r\n          }\r\n        }\r\n      } else {\r\n        message = data\r\n      }\r\n      if (message.length > 128) {\r\n        return message.substr(0, 128) + \"...\"\r\n      }\r\n      return message\r\n    }\r\n    return defaultMessage\r\n  }\r\n\r\n  static formatNumber(number: Maybe<number>): string {\r\n    if (!number) {\r\n      return \"0\";\r\n    }\r\n    return number.toLocaleString(navigator.language ?? 'en-US');\r\n  }\r\n}","import BigNumber from \"bignumber.js\";\r\nimport { ViteClient } from \"../clients/vite.client\";\r\nimport { FileUtil, getFileUtil } from \"../util/file.util\";\r\nimport { FormatUtil } from \"../util/format.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Contract, ViteSubscriptionResult } from \"../util/types\";\r\nimport { WalletAccount } from \"../wallet\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport abstract class BaseContract {\r\n  protected readonly _fileUtil: FileUtil;\r\n  private readonly _minQuota: BigNumber = new BigNumber(\"10000\");\r\n  protected _client!: ViteClient;\r\n  protected _contract!: Contract;\r\n\r\n  constructor() {\r\n    this._fileUtil = getFileUtil();\r\n  }\r\n\r\n  async initAsync(client: ViteClient, basePath: string): Promise<void> {\r\n    this._client = client;\r\n    await this.initAsyncProtected(basePath);\r\n  }\r\n\r\n  protected abstract initAsyncProtected(basePath: string): Promise<void>;\r\n\r\n  get contract(): Contract {\r\n    return this._contract;\r\n  }\r\n\r\n  protected async ensureQuotaAsync(_quota: BigNumber = this._minQuota): Promise<void> {\r\n    const result = await this._client.getQuotaAsync(this._contract.address);\r\n    if (result.currentQuota.lte(_quota)) {\r\n      throw new Error(\"Contract has insufficient quota\");\r\n    }\r\n  }\r\n\r\n  protected toBoolean(value: string): boolean {\r\n    if (value === \"0\") {\r\n      return false;\r\n    } else if (value === \"1\") {\r\n      return true;\r\n    } else {\r\n      throw new Error(`Value ${value} is not boolean`)\r\n    }\r\n  }\r\n\r\n  protected objectFromEntries = (entries: any) => {\r\n    return Object.fromEntries(\r\n      entries.map((entry: any) => {\r\n        return [entry.name, entry.value];\r\n      })\r\n    );\r\n  }\r\n\r\n  protected async callContractAsync(_account: WalletAccount, _methodName: string, _params: any[], amount?: string, tokenId?: string): Promise<any> {\r\n    await this.ensureQuotaAsync();\r\n    try {\r\n      const result1 = await this._client.callContractAsync(_account, _methodName, this._contract.abi, _params, this._contract.address, amount, tokenId);\r\n      const result2 = await this._client.waitForAccountBlockAsync(_account.address, result1.height);\r\n      return result2;\r\n    } catch (error: any) {\r\n      const message = FormatUtil.formatMessage(error);\r\n      if (message) {\r\n        throw new Error(message)\r\n      } else {\r\n        throw new Error(\"Error\");\r\n      }\r\n    }\r\n  }\r\n\r\n  async stakeForQuotaAsync(_account: WalletAccount, _amount: string): Promise<any> {\r\n    const result1 = await this._client.stakeForQuotaAsync(_account, this._contract.address, _amount);\r\n    const result2 = await this._client.waitForAccountBlockAsync(_account.address, result1.height);\r\n    return result2;\r\n  }\r\n\r\n  async createAddressListenerAsync(): Promise<ViteSubscriptionResult> {\r\n    const logs: any[] = [];\r\n    const listener = await this._client.createAddressListenerAsync(this._contract.address);\r\n    listener.on((results: any[]) => {\r\n      for (let index = 0; index < results.length; index++) {\r\n        const result = results[index];\r\n        logger.info(result)();\r\n        const vmLog = this._client.decodeVmLog(result.vmlog, this._contract.abi);\r\n        logs.push(vmLog);\r\n      }\r\n    });\r\n\r\n    return {\r\n      logs,\r\n      listener\r\n    }\r\n  }\r\n}","import { BigNumber } from \"bignumber.js\";\r\nimport { BaseDataSource } from \".\";\r\nimport { getViteClient, ViteClient } from \"../clients/vite.client\";\r\nimport { CommonConfig } from \"../common/config\";\r\nimport { AbiItemType, getPunksContract, PunksContract } from \"../contracts/punks.contract\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { TransformUtil } from \"../util/transform.util\";\r\nimport { MarketBid, MarketChangedEvent, MarketEventType, MarketInfo, MarketOffer, Network, Punk, PunkChangedEvent, PunkEvent, PunkEvents, ViteQuotaResult, ViteVmLogEvent, VmLog, VmLogEvent } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class ViteDataSource extends BaseDataSource {\r\n  private readonly _client: ViteClient;\r\n  private readonly _contract: PunksContract;\r\n  private _listener: any;\r\n\r\n  constructor() {\r\n    super();\r\n    this._client = getViteClient();\r\n    this._contract = getPunksContract();\r\n  }\r\n\r\n  async initAsync(network: Network): Promise<void> {\r\n    logger.info('Init ViteDataSource')();\r\n    this.disposeProtected();\r\n    await this._client.initAsync(network);\r\n    await this._contract.initAsync(this._client, \"./assets/contracts\");\r\n    this._listener = await this._client.createAddressListenerAsync(this._contract.contract.address);\r\n    this._listener.on((results: ViteVmLogEvent[]) => {\r\n      if (!this._contract?.contract.abi) {\r\n        logger.error('Could not decode vmlog because contract abi is not defined.')();\r\n      } else {\r\n        for (let index = 0; index < results.length; index++) {\r\n          const result = results[index];\r\n          const vmLog = this._client.decodeVmLog(result.vmlog, this._contract.contract.abi);\r\n          logger.info(vmLog ?? result)();\r\n          if (vmLog) {\r\n            this.handleVmLogAsync(result.accountBlockHash, result.accountBlockHeight, vmLog);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  protected disposeProtected(): void {\r\n    logger.info('Dispose ViteDataSource')();\r\n    if (this._listener) {\r\n      this._client.removeListener(this._listener);\r\n    }\r\n    this._client.dispose();\r\n  }\r\n\r\n  async getQuotaAsync(_address: string): Promise<ViteQuotaResult> {\r\n    return this._client.getQuotaAsync(_address);\r\n  }\r\n\r\n  async getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"id\", _id, \"limit\", _limit, \"offset\", _offset, \"height\", _height)();\r\n    if (CommonUtil.isNullOrWhitespace(_id)) {\r\n      return {\r\n        blockHeight: TransformUtil.defaultBigNumber,\r\n        events: []\r\n      };\r\n    }\r\n    const abiItem = this._contract.getAbiItemByType(AbiItemType.punkChangedEvent);\r\n    const encodedLogSignature = this._client.encodeLogSignature(abiItem);\r\n    const topics: string[][] = [\r\n      [\r\n        encodedLogSignature\r\n      ],\r\n      [\r\n        // don't filter based on eventType\r\n      ],\r\n      [\r\n        // filter based on punkId\r\n        this._client.encodeParameter('uint256', _id)\r\n      ]\r\n    ]\r\n    const fromHeight = this.getEventsFromHeight();\r\n    const toHeight = await this.getAccountBlockHeightAsync(this._contract.contract.address, _height);\r\n    let result = await this._client.getEventsByBlockAsync(this._contract.contract.address, fromHeight, toHeight, topics);\r\n    result = result?.reverse().slice(_offset, _offset + _limit);\r\n    const events = this.toPunkEvents(result);\r\n    return {\r\n      blockHeight: toHeight,\r\n      events: events\r\n    };\r\n  }\r\n\r\n  async getPunkOwnerAsync(_id: string): Promise<Maybe<string>> {\r\n    const result = await this._contract.ownerOfAsync(_id);\r\n    return result;\r\n  }\r\n\r\n  async getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]> {\r\n    logger.info(\"_address\", _address, \"limit\", _limit, \"offset\", _offset)();\r\n    if (CommonUtil.isNullOrWhitespace(_address)) {\r\n      return [];\r\n    }\r\n    let result = await this._contract.getTokensOfAsync(_address);\r\n    result = result.slice(_offset, _offset + _limit);\r\n    const punks = [];\r\n    for (const id of result) {\r\n      const punk = await this.getPunkAsync(id);\r\n      punks.push(punk)\r\n    }\r\n    return punks;\r\n  }\r\n\r\n  async getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>> {\r\n    const result = await this._contract.getBidAsync(_id);\r\n    if (!result || !result.hasBid) {\r\n      return null;\r\n    }\r\n    return {\r\n      itemIndex: result.itemIndex,\r\n      amount: result.amount,\r\n      bidder: result.bidder\r\n    };\r\n  }\r\n\r\n  async getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>> {\r\n    const result = await this._contract.getOfferAsync(_id);\r\n    if (!result || !result.isForSale) {\r\n      return null;\r\n    }\r\n    return {\r\n      itemIndex: result.itemIndex,\r\n      minAmount: result.minAmount,\r\n      seller: result.seller,\r\n      onlySellTo: result.onlySellTo ?? ''\r\n    };\r\n  }\r\n\r\n  async getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"limit\", _limit, \"offset\", _offset)();\r\n    const abiItem = this._contract.getAbiItemByType(AbiItemType.punkChangedEvent);\r\n    const encodedLogSignature = this._client.encodeLogSignature(abiItem);\r\n    const topics: string[][] = [\r\n      [\r\n        encodedLogSignature\r\n      ]\r\n    ]\r\n    const fromHeight = this.getEventsFromHeight();\r\n    const toHeight = await this.getAccountBlockHeightAsync(this._contract.contract.address, _height);\r\n    let result = await this._client.getEventsByBlockAsync(this._contract.contract.address, fromHeight, toHeight, topics);\r\n    result = result?.reverse().slice(_offset, _offset + _limit);\r\n    const events = this.toPunkEvents(result);\r\n    return {\r\n      blockHeight: toHeight,\r\n      events: events\r\n    };\r\n  }\r\n\r\n  async getMarketInfoAsync(): Promise<MarketInfo> {\r\n    const result = await this._contract.getMarketInfoAsync();\r\n    this._actionPrice = result.actionPrice;\r\n    this._mintPrice = result.mintPrice;\r\n    logger.info(\"getMarketInfoAsync\", result)();\r\n    return result;\r\n  }\r\n\r\n  async mintAsync(): Promise<boolean> {\r\n    await this.checkQuotaAsync();\r\n    const mintPrice = await this.getMintPriceAsync();\r\n    const result = await this._contract.mintAsync(this.getAccount(), mintPrice.toFixed());\r\n    logger.info(\"mintAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async offerAsync(_id: string, _amount: string, _address?: string | null): Promise<boolean> {\r\n    logger.info(\"offerAsync\", \"id\", _id, \"amount\", _amount, \"address\", _address)();\r\n    await this.checkQuotaAsync();\r\n    const fee = await this.getFeeAsync();\r\n    let result;\r\n    if (_address && !CommonUtil.isNullOrWhitespace(_address)) {\r\n      result = await this._contract.offerToAddressAsync(this.getAccount(), _id, _amount, _address, fee);\r\n    } else {\r\n      result = await this._contract.offerAsync(this.getAccount(), _id, _amount, fee);\r\n    }\r\n    logger.info(\"offerAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async cancelOfferAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelOfferAsync\", \"id\", _id)();\r\n    await this.checkQuotaAsync();\r\n    const result = await this._contract.cancelOfferAsync(this.getAccount(), _id);\r\n    logger.info(\"cancelOfferAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async buyAsync(_id: string, _amount: string): Promise<boolean> {\r\n    await this.checkQuotaAsync();\r\n    logger.info(\"buyAsync\", \"id\", _id, \"amount\", _amount)();\r\n    const result = await this._contract.buyAsync(this.getAccount(), _id, _amount);\r\n    logger.info(\"buyAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async bidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"bidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await this.checkQuotaAsync();\r\n    const fee = await this.getFeeAsync();\r\n    const result = await this._contract.enterBidAsync(this.getAccount(), _id, _amount, fee);\r\n    logger.info(result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async acceptBidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"acceptBidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await this.checkQuotaAsync();\r\n    const result = await this._contract.acceptBidAsync(this.getAccount(), _id, _amount);\r\n    logger.info(\"acceptBidAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async cancelBidAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelBidAsync\", \"id\", _id)();\r\n    await this.checkQuotaAsync();\r\n    const result = await this._contract.cancelBidAsync(this.getAccount(), _id);\r\n    logger.info(\"cancelBidAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  private async handleVmLogAsync(accountBlockHash: string, accountBlockHeight: string, vmlog: VmLog): Promise<void> {\r\n    try {\r\n      switch (vmlog.event) {\r\n        case VmLogEvent.MarketChanged:\r\n          const marketEvent: MarketChangedEvent = {\r\n            timestamp: new BigNumber(vmlog.args.timestamp),\r\n            eventType: parseInt(vmlog.args.eventType),\r\n            value: new BigNumber(vmlog.args.value)\r\n          }\r\n          switch (marketEvent.eventType) {\r\n            case MarketEventType.ActionPrice:\r\n              this._actionPrice = marketEvent.value;\r\n              break;\r\n            case MarketEventType.MintPrice:\r\n              this._mintPrice = marketEvent.value;\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          this._emitter.emitMarketChanged(marketEvent);\r\n          break;\r\n        case VmLogEvent.PunkChanged:\r\n          const punkEvent: PunkChangedEvent = {\r\n            accountBlockHash: accountBlockHash,\r\n            accountBlockHeight: new BigNumber(accountBlockHeight),\r\n            timestamp: new BigNumber(vmlog.args.timestamp),\r\n            eventType: parseInt(vmlog.args.eventType),\r\n            punkId: parseInt(vmlog.args.punkId),\r\n            amount: new BigNumber(vmlog.args.amount),\r\n            fromAddress: vmlog.args.fromAddress,\r\n            toAddress: vmlog.args.toAddress\r\n          }\r\n          this._emitter.emitPunkChanged(punkEvent);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      logger.error(error)();\r\n    }\r\n  }\r\n\r\n  private toPunkEvents(events: ViteVmLogEvent[]): PunkEvent[] {\r\n    if (!Array.isArray(events)) {\r\n      return [];\r\n    }\r\n    const result: PunkEvent[] = [];\r\n    for (const e of events) {\r\n      const transformed = this.toPunkEvent(e);\r\n      if (transformed) {\r\n        result.push(transformed);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private toPunkEvent(event: ViteVmLogEvent): Maybe<PunkEvent> {\r\n    if (!event) {\r\n      return null;\r\n    }\r\n    const abiItem = this._contract.getAbiItemByType(AbiItemType.punkChangedEvent);\r\n    const decoded = this._client.decodeVmLogByAbiItem(event.vmlog, abiItem);\r\n    if (!decoded) {\r\n      return null;\r\n    }\r\n    const transformed = {\r\n      accountBlockHash: event.accountBlockHash,\r\n      accountBlockHeight: event.accountBlockHeight,\r\n      timestamp: decoded.args.timestamp,\r\n      eventType: decoded.args.eventType,\r\n      punkId: decoded.args.punkId,\r\n      amount: decoded.args.amount,\r\n      fromAddress: decoded.args.fromAddress,\r\n      toAddress: decoded.args.toAddress\r\n    };\r\n    return TransformUtil.toPunkEvent(transformed);\r\n  }\r\n\r\n  private async getFeeAsync(): Promise<Maybe<string>> {\r\n    const actionPrice = await this.getActionPriceAsync();\r\n    if (actionPrice.gt(0)) {\r\n      return actionPrice.toFixed();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private async getAccountBlockHeightAsync(_address: string, _height?: Maybe<string>): Promise<BigNumber> {\r\n    let height = new BigNumber(\"0\");\r\n    if (_height && !CommonUtil.isNullOrWhitespace(_height)) {\r\n      height = new BigNumber(_height);\r\n    } else {\r\n      height = await this._client.getAccountBlockHeightAsync(_address);\r\n    }\r\n    return height;\r\n  }\r\n\r\n  private getEventsFromHeight(): BigNumber {\r\n    if (CommonConfig.IS_PRODUCTION) {\r\n      // Hide events before official launch\r\n      return new BigNumber(\"1150\");\r\n    }\r\n    return new BigNumber(\"0\");\r\n  }\r\n\r\n  private async checkQuotaAsync(): Promise<void> {\r\n    const address = this._contract.contract.address;\r\n    const quota = await this.getQuotaAsync(address);\r\n    this._emitter.emitQuotaChanged(address, quota);\r\n  }\r\n}\r\n\r\nconst ds = new ViteDataSource();\r\n\r\nexport const getViteDataSource = () => {\r\n  return ds;\r\n}","import { CommonConfig } from \"../common/config\";\r\nimport { CommonConstants, Networks } from \"../common/constants\";\r\nimport { getMockDataSource, IDataSource } from \"../datasources\";\r\nimport { getViteDataSource } from \"../datasources/vite.datasource\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Network } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class CommonContext {\r\n  private _network!: Network;\r\n  private _datasource!: IDataSource;\r\n\r\n  async initAsync(): Promise<void> {\r\n    if (CommonConstants.USE_MOCK_DATASOURCE) {\r\n      this._datasource = getMockDataSource();\r\n    } else {\r\n      this._datasource = getViteDataSource();\r\n    }\r\n    const networkId = CommonConfig.NETWORK_ID;\r\n    this._network = Networks.find(e => e.id === networkId) ?? Networks[0];\r\n    await this._datasource.initBaseAsync(this._network);\r\n  }\r\n\r\n  dispose(): void {\r\n    logger.info(\"Disposing CommonContext\")();\r\n    this._datasource?.dispose();\r\n  }\r\n\r\n  get network(): Network {\r\n    return this._network;\r\n  }\r\n\r\n  get datasource(): IDataSource {\r\n    return this._datasource;\r\n  }\r\n}\r\n\r\nconst context = new CommonContext();\r\n\r\nexport const getCommonContext = () => {\r\n  return context;\r\n}\r\n","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\n\r\nexport const OFFER_MUTATION = gql`\r\n  mutation Offer($id: ID!, $amount: String!, $address: String) {\r\n    offer(id: $id, amount: $amount, address: $address) @client\r\n  }\r\n`;\r\n\r\nexport const CANCEL_OFFER_MUTATION = gql`\r\n  mutation CancelOffer($id: ID!) {\r\n    cancelOffer(id: $id) @client\r\n  }\r\n`;\r\n\r\nexport const BUY_MUTATION = gql`\r\n  mutation Buy($id: ID!, $amount: String!) {\r\n    buy(id: $id, amount: $amount) @client\r\n  }\r\n`;\r\n\r\nexport const BID_MUTATION = gql`\r\n  mutation Bid($id: ID!, $amount: String!) {\r\n    bid(id: $id, amount: $amount) @client\r\n  }\r\n`;\r\n\r\nexport const ACCEPT_BID_MUTATION = gql`\r\n  mutation AcceptBid($id: ID!, $amount: String!) {\r\n    acceptBid(id: $id, amount: $amount) @client\r\n  }\r\n`;\r\n\r\nexport const CANCEL_BID_MUTATION = gql`\r\n  mutation CancelBid($id: ID!) {\r\n    cancelBid(id: $id) @client\r\n  }\r\n`;\r\n\r\nexport const MarketMutations = {\r\n  async offer(parent: any, { id, amount, address }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.offerAsync(id, amount, address);\r\n  },\r\n  async cancelOffer(parent: any, { id }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.cancelOfferAsync(id);\r\n  },\r\n  async buy(parent: any, { id, amount }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.buyAsync(id, amount);\r\n  },\r\n  async bid(parent: any, { id, amount }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.bidAsync(id, amount);\r\n  },\r\n  async acceptBid(parent: any, { id, amount }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.acceptBidAsync(id, amount);\r\n  },\r\n  async cancelBid(parent: any, { id }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.cancelBidAsync(id);\r\n  },\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\n\r\nexport const MINT_MUTATION = gql`\r\n  mutation Mint {\r\n    mint @client\r\n  }\r\n`;\r\n\r\nexport const PunkMutations = {\r\n  async mint(parent: any, params: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.mintAsync();\r\n  },\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\nimport { Punk, PunkEvents } from \"../util/types\";\r\n\r\nexport const PUNK_FIELDS = gql`\r\n  fragment PunkFields on Punk {\r\n    id\r\n    rank\r\n    image\r\n    attributes\r\n  }\r\n`;\r\n\r\nexport const PUNK_EVENT_FIELDS = gql`\r\n  fragment PunkEventFields on PunkEvent {\r\n    id\r\n    accountBlockHash\r\n    accountBlockHeight\r\n    timestamp\r\n    eventType\r\n    punkId\r\n    amount\r\n    fromAddress\r\n    toAddress\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_ATTRIBUTES_QUERY = gql`\r\n  query GetPunkAttributes {\r\n    punkAttributes @client\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_EVENTS_QUERY = gql`\r\n  ${PUNK_EVENT_FIELDS}\r\n  query GetPunkEvents($id: String!, $limit: Int!, $offset: Int!, $height: String) {\r\n    punkEvents(id: $id, limit: $limit, offset: $offset, height: $height) @client {\r\n      blockHeight\r\n      events {\r\n        ...PunkEventFields\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_OWNER_QUERY = gql`\r\n  query GetPunkOwner($id: String!) {\r\n    punkOwner(id: $id) @client\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_QUERY = gql`\r\n  ${PUNK_FIELDS}\r\n  query GetPunk($id: ID!) {\r\n    punk(id: $id) @client {\r\n      ...PunkFields\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_PUNKS_QUERY = gql`\r\n  ${PUNK_FIELDS}\r\n  query GetPunks($limit: Int!, $offset: Int!, $sort: PunkSortBy!, $order: OrderBy!, $search: String) {\r\n    punks(limit: $limit, offset: $offset, sort: $sort, order: $order, search: $search) @client {\r\n      ...PunkFields\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_PUNKS_BY_ADDRESS_QUERY = gql`\r\n  ${PUNK_FIELDS}\r\n  query GetPunksByAddress($address: String!, $limit: Int!, $offset: Int!) {\r\n    punksByAddress(address: $address, limit: $limit, offset: $offset) @client {\r\n      ...PunkFields\r\n    }\r\n  }\r\n`;\r\n\r\nexport const PunkQueries = {\r\n  async punkAttributes(parent: any, params: any, context: ApolloContext): Promise<string[]> {\r\n    const result = await context.client.datasource.getPunkAttributesAsync();\r\n    return result;\r\n  },\r\n  async punkEvents(parent: any, { id, limit, offset, height }: any, context: ApolloContext): Promise<PunkEvents> {\r\n    const result = await context.client.datasource.getPunkEventsAsync(id, limit, offset, height);\r\n    return result;\r\n  },\r\n  async punkOwner(parent: any, { id }: any, context: ApolloContext): Promise<Maybe<string>> {\r\n    const result = await context.client.datasource.getPunkOwnerAsync(id);\r\n    return result;\r\n  },\r\n  async punk(parent: any, { id }: any, context: ApolloContext): Promise<Punk> {\r\n    const result = await context.client.datasource.getPunkAsync(id);\r\n    return result;\r\n  },\r\n  async punks(parent: any, { limit, offset, sort, order, search }: any, context: ApolloContext): Promise<Punk[]> {\r\n    const result = await context.client.datasource.getPunksAsync(limit, offset, sort, order, search);\r\n    return result;\r\n  },\r\n  async punksByAddress(parent: any, { address, limit, offset }: any, context: ApolloContext): Promise<Punk[]> {\r\n    const result = await context.client.datasource.getPunksByAddressAsync(address, limit, offset);\r\n    return result;\r\n  },\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\nimport { MarketBid, MarketInfo, MarketOffer, PunkEvents } from \"../util/types\";\r\nimport { PUNK_EVENT_FIELDS } from \"./punk\";\r\n\r\nexport const GET_MARKET_INFO_QUERY = gql`\r\n  query GetMarketInfo {\r\n    marketInfo @client {\r\n      marketStarted\r\n      mintsRemaining\r\n      mintPrice\r\n      actionPrice\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_MARKET_BID_QUERY = gql`\r\n  query GetMarketBid($id: String!) {\r\n    marketBid(id: $id) @client {\r\n      itemIndex\r\n      bidder\r\n      amount\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_MARKET_OFFER_QUERY = gql`\r\n  query GetMarketOffer($id: String!) {\r\n    marketOffer(id: $id) @client {\r\n      itemIndex\r\n      seller\r\n      minAmount\r\n      onlySellTo\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_MARKET_EVENTS_QUERY = gql`\r\n  ${PUNK_EVENT_FIELDS}\r\n  query GetMarketEvents($limit: Int!, $offset: Int!, $height: String) {\r\n    marketEvents(limit: $limit, offset: $offset, height: $height) @client {\r\n      blockHeight\r\n      events {\r\n        ...PunkEventFields\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nexport const MarketQueries = {\r\n  async marketInfo(parent: any, params: any, context: ApolloContext): Promise<MarketInfo> {\r\n    const result = await context.client.datasource.getMarketInfoAsync();\r\n    return result;\r\n  },\r\n  async marketBid(parent: any, { id }: any, context: ApolloContext): Promise<Maybe<MarketBid>> {\r\n    const result = await context.client.datasource.getMarketBidAsync(id);\r\n    return result;\r\n  },\r\n  async marketOffer(parent: any, { id }: any, context: ApolloContext): Promise<Maybe<MarketOffer>> {\r\n    const result = await context.client.datasource.getMarketOfferAsync(id);\r\n    return result;\r\n  },\r\n  async marketEvents(parent: any, { limit, offset, height }: any, context: ApolloContext): Promise<PunkEvents> {\r\n    const result = await context.client.datasource.getMarketEventsAsync(limit, offset, height);\r\n    return result;\r\n  }\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\nimport { ViteQuotaResult } from \"../util/types\";\r\n\r\nexport const GET_QUOTA_QUERY = gql`\r\n  query GetQuota($address: String!) {\r\n    quota(address: $address) @client {\r\n      currentQuota\r\n      maxQuota\r\n      stakeAmount\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GeneralQueries = {\r\n  async quota(parent: any, { address }: any, context: ApolloContext): Promise<Maybe<ViteQuotaResult>> {\r\n    const result = await context.client.datasource.getQuotaAsync(address);\r\n    return result;\r\n  },\r\n}","import { ApolloClient, InMemoryCache, NormalizedCacheObject } from '@apollo/client';\r\nimport { offsetLimitPagination } from '@apollo/client/utilities';\r\nimport BigNumber from 'bignumber.js';\r\nimport { GraphQLScalarType } from 'graphql';\r\nimport { getCommonContext } from '../contexts/common.context';\r\nimport { IDataSource } from '../datasources';\r\nimport { MarketMutations, PunkMutations } from '../mutations';\r\nimport { MarketQueries, PunkQueries } from '../queries';\r\nimport { GeneralQueries } from '../queries/general';\r\n\r\nexport type ApolloContext = {\r\n  cache: InMemoryCache,\r\n  client: ApolloClientWrapper,\r\n  clientAwareness: any,\r\n  getCacheKey: (obj: any) => string | undefined\r\n}\r\n\r\nexport class ApolloClientWrapper extends ApolloClient<NormalizedCacheObject> {\r\n  get datasource(): IDataSource {\r\n    return getCommonContext().datasource;\r\n  }\r\n}\r\n\r\nconst cache: InMemoryCache = new InMemoryCache({\r\n  typePolicies: {\r\n    Query: {\r\n      fields: {\r\n        // https://www.apollographql.com/docs/react/pagination/offset-based/\r\n        punks: offsetLimitPagination([\"order\", \"sort\"]),\r\n        punksByAddress: offsetLimitPagination(),\r\n        //marketEvents: offsetLimitPagination()\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nconst bigNumberScalar = new GraphQLScalarType({\r\n  name: 'BigNumber',\r\n  description: 'BigNumber custom scalar type',\r\n  serialize(value: BigNumber) {\r\n    return value.toFixed();\r\n  },\r\n  parseValue(value: string) {\r\n    return new BigNumber(value);\r\n  }\r\n});\r\n\r\nconst resolvers: any = {\r\n  BigNumber: bigNumberScalar,\r\n  Query: {\r\n    ...GeneralQueries,\r\n    ...PunkQueries,\r\n    ...MarketQueries\r\n  },\r\n  Mutation: {\r\n    ...PunkMutations,\r\n    ...MarketMutations\r\n  }\r\n};\r\n\r\n// https://www.apollographql.com/docs/react/networking/authentication/#header\r\nconst client = new ApolloClientWrapper({\r\n  // link: authLink.concat(httpLink),\r\n  cache: cache,\r\n  resolvers,\r\n  headers: {\r\n    'client-name': process.env.REACT_APP_NAME || 'client',\r\n    'client-version': process.env.REACT_APP_VERSION || '0',\r\n  },\r\n})\r\n\r\nexport const getApolloClient = () => {\r\n  return client;\r\n}","import BigNumber from \"bignumber.js\";\r\nimport { Network } from \"../util/types\";\r\n\r\nexport class NetworkManager {\r\n  private _networkHeight: BigNumber;\r\n  private _network?: Maybe<Network>;\r\n  private _setNetworkCallback?: (network?: Maybe<Network>) => void;\r\n\r\n  constructor() {\r\n    this._networkHeight = new BigNumber(\"0\");\r\n  }\r\n\r\n  set networkHeight(height: BigNumber) {\r\n    this._networkHeight = height;\r\n  }\r\n\r\n  get networkHeight(): BigNumber {\r\n    return this._networkHeight;\r\n  }\r\n\r\n  set onSetNetworkCallback(cb: (network?: Maybe<Network>) => void) {\r\n    this._setNetworkCallback = cb;\r\n  }\r\n\r\n  getNetwork(): Maybe<Network> {\r\n    return this._network;\r\n  }\r\n\r\n  setNetwork(network?: Maybe<Network>): void {\r\n    this._network = network;\r\n    if (this._setNetworkCallback) {\r\n      this._setNetworkCallback(this._network);\r\n    }\r\n  }\r\n}\r\n\r\nconst manager = new NetworkManager();\r\n\r\nexport const getNetworkManager = () => {\r\n  return manager;\r\n}","import { styled, Typography } from '@mui/material';\r\n\r\nconst Root = styled('div')(\r\n  ({ theme }) => `\r\n  padding-bottom: 10px;\r\n  padding-top: 10px;\r\n  padding-left: 24px;\r\n  padding-right: 24px;\r\n  text-align: right;\r\n`,\r\n);\r\n\r\nexport const Footer = () => {\r\n  return (\r\n    <>\r\n      <Root>\r\n        <Typography>v{process.env.REACT_APP_VERSION}</Typography>\r\n      </Root>\r\n    </>\r\n  )\r\n}\r\n","import { AppBar, styled, Toolbar, Typography } from '@mui/material';\r\nimport React from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\n\r\nconst Root = styled('div')(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n`,\r\n);\r\n\r\nconst TitleTypography = styled(Typography)(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n  margin-left: 10px !important;\r\n`,\r\n);\r\n\r\nexport const HeaderLoading: React.FC = (props: any) => {\r\n  return (\r\n    <Root>\r\n      <AppBar position=\"static\">\r\n        <Toolbar>\r\n          <TitleTypography variant=\"h6\">\r\n            {CommonConstants.APP_NAME}\r\n          </TitleTypography>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Root>\r\n  )\r\n}","import { Container, styled } from '@mui/material';\r\nimport * as React from 'react';\r\n\r\nconst MainScrollStyled = styled('div')(\r\n  ({ theme }) => `\r\n  display: flex;\r\n  flex-direction: column;\r\n  flex-grow: 1;\r\n  align-items: center;\r\n  padding-bottom: 15px;\r\n  padding-top: 30px;\r\n  overflow: auto;\r\n  overflow-x: hidden;\r\n`,\r\n);\r\n\r\nconst MainScrollInner = styled('div')(\r\n  ({ theme }) => `\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n`,\r\n);\r\n\r\nexport const MainScroll: React.FC = props => {\r\n  const { children, ...restProps } = props\r\n\r\n  return (\r\n    <MainScrollStyled id=\"mainscroll\" {...restProps}>\r\n      <Container maxWidth=\"xl\">\r\n        <MainScrollInner>{children}</MainScrollInner>\r\n      </Container>\r\n    </MainScrollStyled>\r\n  )\r\n}\r\n","import { styled } from '@mui/material';\r\nimport React from 'react';\r\n\r\nconst MainWrapperStyled = styled('div')(\r\n  ({ theme }) => `\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100vh;\r\n`,\r\n);\r\n\r\nexport const MainWrapper: React.FC = props => {\r\n  const { children, ...restProps } = props\r\n\r\n  return <MainWrapperStyled {...restProps}>{children}</MainWrapperStyled>\r\n}\r\n","import React, { useState } from 'react';\r\nimport { getNetworkManager } from '../common/network';\r\nimport { Network } from '../util/types';\r\nimport { getWalletManager, SessionWallet, WebWallet } from '../wallet';\r\n\r\nexport interface IWeb3Context {\r\n  setError: (error: Error) => void,\r\n  error?: Maybe<Error>,\r\n  wallet?: Maybe<WebWallet | SessionWallet>\r\n  network?: Maybe<Network>\r\n}\r\n\r\nconst Web3Context = React.createContext<Maybe<IWeb3Context>>(undefined)\r\n\r\nexport const useWeb3Context = () => {\r\n  const context = React.useContext(Web3Context)\r\n\r\n  if (!context) {\r\n    throw new Error('Component rendered outside the provider tree')\r\n  }\r\n\r\n  return context\r\n}\r\n\r\ninterface Props {\r\n  children?: React.ReactNode\r\n}\r\n\r\nexport const Web3Provider: React.FC<Props> = (props: Props) => {\r\n  const [error, setError] = useState<Maybe<Error>>(null)\r\n  const [wallet, setWallet] = useState<Maybe<WebWallet | SessionWallet>>(null)\r\n  const [network, setNetwork] = useState<Maybe<Network>>(null)\r\n\r\n  const walletManager = getWalletManager()\r\n  walletManager.onSetWalletCallback = setWallet\r\n\r\n  const networkManager = getNetworkManager()\r\n  networkManager.onSetNetworkCallback = setNetwork\r\n\r\n  const context: IWeb3Context = {\r\n    setError,\r\n    error,\r\n    wallet,\r\n    network\r\n  }\r\n\r\n  return (\r\n    <Web3Context.Provider value={context}>{props.children}</Web3Context.Provider>\r\n  )\r\n}\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { CommonConfig } from '../common/config';\r\nimport { Networks } from '../common/constants';\r\nimport { getNetworkManager } from '../common/network';\r\nimport { MainLoading } from '../features/main/components/loading';\r\nimport { getLogger } from '../util/logger';\r\nimport { Network } from '../util/types';\r\nimport { getWalletManager } from '../wallet';\r\nimport { getCommonContext } from './common.context';\r\nimport { useWeb3Context } from './web3';\r\n\r\nconst logger = getLogger()\r\n\r\nexport interface IConnectedWeb3Context {\r\n  account?: string\r\n  network?: Maybe<Network>\r\n  logout: () => void\r\n}\r\n\r\nconst ConnectedWeb3Context = React.createContext<Maybe<IConnectedWeb3Context>>(undefined)\r\n\r\n/**\r\n * This hook can only be used by components under the `ConnectedWeb3` component. Otherwise it will throw.\r\n */\r\nexport const useConnectedWeb3Context = () => {\r\n  const context = React.useContext(ConnectedWeb3Context)\r\n\r\n  if (!context) {\r\n    throw new Error('Component rendered outside the provider tree')\r\n  }\r\n\r\n  return context\r\n}\r\n\r\ninterface Props {\r\n  children?: React.ReactNode\r\n}\r\n\r\n/**\r\n * Component used to render components that depend on Web3 being available. These components can then\r\n * `useConnectedWeb3Context` safely to get web3 stuff without having to null check it.\r\n */\r\nexport const ConnectedWeb3: React.FC<Props> = (props: Props) => {\r\n  const [connection, setConnection] = useState<IConnectedWeb3Context | null>(null)\r\n  const web3Context = useWeb3Context()\r\n  const commonContext = getCommonContext()\r\n\r\n  const { wallet, network } = web3Context\r\n\r\n  useEffect(() => {\r\n    if (!wallet) {\r\n      const walletManager = getWalletManager()\r\n      walletManager.initWallet()\r\n    }\r\n  }, [wallet])\r\n\r\n  useEffect(() => {\r\n    if (!network) {\r\n      const networkManager = getNetworkManager()\r\n      const networkId = CommonConfig.NETWORK_ID;\r\n      networkManager.setNetwork(Networks.find(e => e.id === networkId))\r\n      logger.info(\"Network:\", networkManager.getNetwork())()\r\n    }\r\n  }, [network])\r\n\r\n  const logout = useCallback(() => {\r\n    const walletManager = getWalletManager()\r\n    walletManager.removeWallet()\r\n    window.location.reload()\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const value = {\r\n      account: wallet?.active?.address,\r\n      network,\r\n      logout\r\n    }\r\n\r\n    logger.info('ConnectedWeb3.account', wallet?.active?.address)()\r\n\r\n    const initAsync = async () => {\r\n      if (network) {\r\n        logger.info('Init ConnectedWeb3')()\r\n        try {\r\n          setConnection(null)\r\n          await commonContext.initAsync()\r\n          setConnection(value)\r\n        } catch (error) {\r\n          logger.error(error)();\r\n        }\r\n      }\r\n    }\r\n    initAsync()\r\n    return () => {\r\n      commonContext.dispose()\r\n    }\r\n  }, [wallet, network, logout, commonContext])\r\n\r\n  if (!connection) {\r\n    return MainLoading()\r\n  }\r\n\r\n  const value = {\r\n    ...connection\r\n  }\r\n\r\n  return (\r\n    <ConnectedWeb3Context.Provider value={value}>{props.children}</ConnectedWeb3Context.Provider>\r\n  )\r\n}","\r\nimport { Typography } from '@mui/material';\r\nimport { Footer } from '../../../layout/components/footer';\r\nimport { HeaderLoading } from '../../../layout/components/header-loading';\r\nimport { MainScroll } from '../../../layout/components/main-scroll';\r\nimport { MainWrapper } from '../../../layout/components/main-wrapper';\r\n\r\nexport const MainLoading = () => {\r\n\r\n  return (\r\n    <MainWrapper>\r\n      <HeaderLoading />\r\n      <MainScroll>\r\n        <Typography>Loading...</Typography>\r\n      </MainScroll>\r\n      <Footer />\r\n    </MainWrapper>\r\n  )\r\n}\r\n","import { ProviderContext } from \"notistack\";\r\nimport { getEmitter } from \"./emitter\";\r\nimport { FormatUtil } from \"./format.util\";\r\n\r\nexport abstract class SnackbarUtil {\r\n  static snackbar: ProviderContext;\r\n  static enqueueError(error: any): void {\r\n    const message = FormatUtil.formatMessage(error);\r\n    if (message === \"Session currently disconnected\") {\r\n      const emitter = getEmitter();\r\n      emitter.emitConnectWalletDialog(true);\r\n    }\r\n    SnackbarUtil.snackbar.enqueueSnackbar(message);\r\n  }\r\n  static enqueueMessage(message: string): void {\r\n    SnackbarUtil.snackbar.enqueueSnackbar(message);\r\n  }\r\n}","import React from 'react';\r\nimport { Box, Paper, Typography } from '@mui/material';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\n\r\ninterface Props {\r\n  message: string\r\n  type: 'default' | 'warning'\r\n  error?: any\r\n  color?: string\r\n  backgroundColor?: string\r\n}\r\n\r\nexport const Alert: React.FC<Props> = (props: Props) => {\r\n  let color = '#000000';\r\n  let backgroundColor = 'rgba(255, 255, 255, 0.5)';\r\n\r\n  switch (props.type) {\r\n    case 'warning':\r\n      color = '#611a15';\r\n      backgroundColor = 'rgba(255, 0, 0, 0.1)';\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  if (props.error) {\r\n    console.log(CommonUtil.toJsonString(props.error));\r\n  }\r\n\r\n  return (\r\n    <Paper>\r\n      <Box sx={{\r\n        color: props.color ?? color,\r\n        backgroundColor: props.backgroundColor ?? backgroundColor,\r\n        padding: '15px',\r\n        textAlign: 'center'\r\n      }}>\r\n        <Typography>{props.message}</Typography>\r\n      </Box>\r\n    </Paper>\r\n  );\r\n}\r\n","import { CommonUtil } from \"./common.util\";\r\n\r\nexport abstract class UrlUtil {\r\n  static getPunkUrl(image?: Maybe<string>): string {\r\n    if (image && !CommonUtil.isNullOrWhitespace(image)) {\r\n      return `https://cdn.vitepunks.com/punks/iso/${image}`;\r\n    }\r\n    return \"\";\r\n  }\r\n}","import { Box, CardActionArea, Chip, styled } from '@mui/material';\r\nimport Card from '@mui/material/Card';\r\nimport CardContent from '@mui/material/CardContent';\r\nimport Typography from '@mui/material/Typography';\r\nimport React from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { Punk } from '../../../../util/types';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\n\r\nconst CustomCardMedia = styled('div')(({ theme }) => (`\r\n  height: 320px;\r\n  // animation: lightning 4s ease-out infinite;\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n`));\r\n\r\nconst PunkImage = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  image-rendering: pixelated;\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  item: Punk\r\n}\r\n\r\nexport const MarketplaceBrowseItem: React.FC<Props> = (props: Props) => {\r\n\r\n  return (\r\n    <Card>\r\n      <CardActionArea component={RouterLink} to={`/punk/${props.item.id}`}>\r\n        <CustomCardMedia>\r\n          <PunkImage sx={{ backgroundImage: `url('${UrlUtil.getPunkUrl(props.item.image)}')` }} />\r\n        </CustomCardMedia>\r\n        <CardContent sx={{ p: 0 }}>\r\n          <Typography variant=\"h6\" component=\"div\" sx={{ p: 1 }}>\r\n            {CommonConstants.PUNK_NAME} #{props.item.id}\r\n          </Typography>\r\n          <Box sx={{ height: \"70px\", overflow: \"auto\" }}>\r\n            <Box sx={{ p: 1 }}>\r\n              {props.item.attributes?.map((a: string) => (\r\n                <Chip key={a} label={a} variant=\"outlined\" sx={{ mb: 1, mr: 1 }} size=\"small\" />\r\n              ))}\r\n            </Box>\r\n          </Box>\r\n        </CardContent>\r\n      </CardActionArea>\r\n    </Card>\r\n  )\r\n}\r\n","import { ApolloError, QueryResult, useQuery } from '@apollo/client';\r\nimport { Container, Grid, Typography } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport { useParams } from 'react-router-dom';\r\nimport { GET_PUNKS_BY_ADDRESS_QUERY } from '../../../../queries';\r\nimport { GetPunksByAddress, GetPunksByAddressVariables, GetPunksByAddress_punksByAddress } from '../../../../queries/__generated__/GetPunksByAddress';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { Punk } from '../../../../util/types';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { MarketplaceBrowseItem } from '../../../marketplace/components/browse-item';\r\n\r\ninterface EmptyResultProps {\r\n  error: ApolloError | undefined\r\n  query: QueryResult<GetPunksByAddress, GetPunksByAddressVariables>\r\n}\r\n\r\nconst EmptyResult: React.FC<EmptyResultProps> = (props: EmptyResultProps) => {\r\n  return (\r\n    <>\r\n      {props.error ? (\r\n        <Alert message={FormatUtil.formatMessage(props.error)} type=\"warning\"></Alert>\r\n      ) : (\r\n        <>\r\n          {props.query.loading || (props.query.data && props.query.data.punksByAddress.length > 0) ? (\r\n            <></>\r\n          ) : (\r\n            <Alert message=\"No punks found\" type=\"default\" ></Alert>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport const AccountDetails: React.FC = (props: any) => {\r\n  const { address } = useParams();\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n\r\n  const query = useQuery<GetPunksByAddress, GetPunksByAddressVariables>(GET_PUNKS_BY_ADDRESS_QUERY, {\r\n    variables: {\r\n      address: address ?? \"\",\r\n      offset: 0,\r\n      limit: limit\r\n    },\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    const currentLength = query.data?.punksByAddress.length ?? 0;\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await query.fetchMore({\r\n        variables: {\r\n          offset: currentLength,\r\n          limit: limit\r\n        }\r\n      });\r\n      setHasMore(result.data.punksByAddress.length >= limit);\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Typography variant=\"h2\" component=\"div\" textAlign=\"center\" sx={{ pt: 3 }}>\r\n        Account\r\n      </Typography>\r\n      <Typography variant=\"subtitle1\" component=\"div\" textAlign=\"center\" gutterBottom>\r\n        {address}\r\n      </Typography>\r\n      <Container sx={{ pt: 3, pb: 6 }} maxWidth=\"xl\">\r\n        {isLoading || (query.data && query.data.punksByAddress.length > 0) ? (\r\n          <InfiniteScroll\r\n            dataLength={query.data?.punksByAddress.length ?? 0}\r\n            next={fetchMoreDataAsync}\r\n            hasMore={hasMore}\r\n            loader={\r\n              <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n                <Grid item key='1' xs={12} md={6}>\r\n                  {isLoading ? (\r\n                    <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n                  ) : (\r\n                    <EmptyResult error={error} query={query}></EmptyResult>\r\n                  )}\r\n                </Grid>\r\n              </Grid>\r\n            }\r\n            scrollableTarget=\"mainscroll\"\r\n          >\r\n            <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\" marginBottom={3}>\r\n              {query.data?.punksByAddress.map((p: GetPunksByAddress_punksByAddress) => (\r\n                <Grid item key={p.id} xs={12} sm={6} md={4} lg={3}>\r\n                  <MarketplaceBrowseItem item={p as Punk}></MarketplaceBrowseItem>\r\n                </Grid>\r\n              ))}\r\n            </Grid>\r\n          </InfiniteScroll>\r\n        ) : (\r\n          <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n            <Grid item key='1' xs={12} md={6}>\r\n              <EmptyResult error={error} query={query}></EmptyResult>\r\n            </Grid>\r\n          </Grid>\r\n        )}\r\n      </Container>\r\n    </>\r\n  )\r\n}\r\n","import { Button } from '@mui/material';\r\nimport confetti from 'canvas-confetti';\r\nimport React, { useCallback } from 'react';\r\nimport { getViteClient } from '../../../../clients/vite.client';\r\nimport { getWalletManager } from '../../../../wallet';\r\n\r\nexport const Test = () => {\r\n  const walletManager = getWalletManager();\r\n  const viteClient = getViteClient();\r\n\r\n  const onClick = useCallback(() => {\r\n    confetti({\r\n      particleCount: 150,\r\n      spread: 60\r\n    });\r\n    const wallet = walletManager.getWallet();\r\n    if (wallet?.active) {\r\n      viteClient.receiveAllOnroadTxAsync(wallet.active);\r\n    }\r\n  }, [viteClient, walletManager]);\r\n  return (\r\n    <>\r\n      Test {process.env.REACT_APP_VERSION} {process.env.REACT_APP_EXPLORER_URL}\r\n      <Button onClick={onClick}>Test</Button>\r\n    </>\r\n  );\r\n}\r\n","import { ApolloClient, FetchPolicy, NormalizedCacheObject } from \"@apollo/client\";\r\nimport { getApolloClient } from \"../clients/apollo.client\";\r\nimport { MINT_MUTATION } from \"../mutations\";\r\nimport { Mint } from \"../mutations/__generated__/Mint\";\r\nimport { GET_MARKET_BID_QUERY, GET_MARKET_OFFER_QUERY, GET_PUNK_EVENTS_QUERY, GET_PUNK_OWNER_QUERY, GET_PUNK_QUERY } from \"../queries\";\r\nimport { GetMarketBid, GetMarketBidVariables } from \"../queries/__generated__/GetMarketBid\";\r\nimport { GetMarketOffer, GetMarketOfferVariables } from \"../queries/__generated__/GetMarketOffer\";\r\nimport { GetPunk, GetPunkVariables } from \"../queries/__generated__/GetPunk\";\r\nimport { GetPunkEvents, GetPunkEventsVariables } from \"../queries/__generated__/GetPunkEvents\";\r\nimport { GetPunkOwner, GetPunkOwnerVariables } from \"../queries/__generated__/GetPunkOwner\";\r\nimport { Punk, PunkExtended, TypeNames } from \"../util/types\";\r\n\r\nclass PunkService {\r\n  private readonly _apollo: ApolloClient<NormalizedCacheObject>;\r\n\r\n  constructor() {\r\n    this._apollo = getApolloClient();\r\n  }\r\n\r\n  getById = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetPunk, GetPunkVariables>({\r\n      query: GET_PUNK_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getOwnerAsync = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetPunkOwner, GetPunkOwnerVariables>({\r\n      query: GET_PUNK_OWNER_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getBidAsync = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketBid, GetMarketBidVariables>({\r\n      query: GET_MARKET_BID_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getOfferAsync = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketOffer, GetMarketOfferVariables>({\r\n      query: GET_MARKET_OFFER_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getEventsAsync = (_id: string, _offset: number, _limit: number, _height?: Maybe<string>, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetPunkEvents, GetPunkEventsVariables>({\r\n      query: GET_PUNK_EVENTS_QUERY,\r\n      variables: {\r\n        id: _id,\r\n        offset: _offset,\r\n        limit: _limit,\r\n        height: _height\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getExtendedAsync = async (_punk: Punk, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    const defaultPunkExtended = {\r\n      __typename: TypeNames.PunkExtended,\r\n      id: _punk.id,\r\n      rank: _punk.rank,\r\n      image: _punk.image,\r\n      attributes: _punk.attributes\r\n    };\r\n    const ownerQuery = await this.getOwnerAsync(_punk.id, _fetchPolicy);\r\n    const bidQuery = await this.getBidAsync(_punk.id, _fetchPolicy);\r\n    const offerQuery = await this.getOfferAsync(_punk.id, _fetchPolicy);\r\n\r\n    const punkExtended: PunkExtended = {\r\n      ...defaultPunkExtended,\r\n      owner: ownerQuery.data.punkOwner,\r\n      bid: bidQuery.data.marketBid,\r\n      offer: offerQuery.data.marketOffer\r\n    }\r\n\r\n    const error = ownerQuery.error || bidQuery.error || offerQuery.error;\r\n    const loading = ownerQuery.loading || bidQuery.loading || offerQuery.loading;\r\n\r\n    return {\r\n      punkExtended,\r\n      ownerQuery,\r\n      bidQuery,\r\n      offerQuery,\r\n      error,\r\n      loading\r\n    };\r\n  }\r\n\r\n  async mintAsync(): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Mint>({\r\n      mutation: MINT_MUTATION\r\n    });\r\n    return Boolean(result.data?.mint ?? false);\r\n  }\r\n}\r\n\r\nconst service = new PunkService();\r\n\r\nexport const getPunkService = () => {\r\n  return service;\r\n}","import { styled } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\n\r\nconst ImageContainer = styled('div')(\r\n  ({ theme }) => `\r\n  position: relative;\r\n  width: 80vw;\r\n  height: 80vw; \r\n  max-width: 400px;\r\n  max-height: 400px;\r\n  animation: lightning 4s ease-out infinite;\r\n`,\r\n);\r\n\r\nconst Image = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  border: 5px solid #fff;\r\n  border-radius: 50%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n`,\r\n);\r\n\r\nconst Img1 = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.SAMPLE_PUNK_URL}');\r\n  border-radius: 50%;\r\n  animation: toggle 4s linear -2s infinite alternate;\r\n  image-rendering: pixelated;\r\n`,\r\n);\r\n\r\n\r\nconst Img2 = styled('img')(\r\n  ({ theme }) => `\r\n  top: 0;\r\n  left: 0;\r\n  position: fixed;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  border: 5px solid #fff;\r\n  border-radius: 50%;\r\n  visibility: hidden;\r\n  animation: toggle 4s linear 2s infinite alternate;\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  punkId1?: Maybe<number>\r\n  punkId2?: Maybe<number>\r\n}\r\n\r\n\r\nexport const LandingMainImage: React.FC<Props> = (props: Props) => {\r\n  const [imageUrl1, setImageUrl1] = useState<Maybe<string>>(undefined);\r\n  const [imageUrl2, setImageUrl2] = useState<Maybe<string>>(undefined);\r\n  const service = getPunkService();\r\n\r\n  useEffect(() => {\r\n    const setImageUrlsAsync = async () => {\r\n      if (props.punkId1) {\r\n        const punk1 = await service.getById(props.punkId1.toString());\r\n        setImageUrl1(UrlUtil.getPunkUrl(punk1.data.punk.image));\r\n      }\r\n      if (props.punkId2) {\r\n        const punk2 = await service.getById(props.punkId2.toString());\r\n        setImageUrl2(UrlUtil.getPunkUrl(punk2.data.punk.image));\r\n      }\r\n    }\r\n    setImageUrlsAsync();\r\n  }, [props.punkId1, props.punkId2, service])\r\n\r\n  return (\r\n    <ImageContainer>\r\n      <Image>\r\n        <Img1 sx={{ backgroundImage: `url('${imageUrl1 ?? CommonConstants.SAMPLE_PUNK_URL}')` }} />\r\n        <Img2 sx={{ backgroundImage: `url('${imageUrl2 ?? CommonConstants.SAMPLE_PUNK_URL}')` }} />\r\n      </Image>\r\n    </ImageContainer>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { LandingMainImage } from '../../../landing/components/main-image';\r\n\r\nexport const TestImage = () => {\r\n  return (\r\n    <>\r\n      <LandingMainImage punkId1={5667} punkId2={3848}></LandingMainImage>\r\n    </>\r\n  );\r\n}\r\n","import { BigNumber } from \"bignumber.js\";\r\n\r\nexport abstract class TokenUtil {\r\n  static formatBigNumber(bn: BigNumber, tokenDecimals: number, decimals: number): string {\r\n    return bn.div(new BigNumber(\"10\").pow(tokenDecimals)).decimalPlaces(decimals, BigNumber.ROUND_DOWN).toFormat();\r\n  }\r\n}","import { LoadingButton } from '@mui/lab';\r\nimport { SxProps, Theme } from '@mui/system';\r\nimport React from 'react';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n  size?: 'small' | 'medium' | 'large'\r\n  variant?: 'text' | 'outlined' | 'contained'\r\n  color?: 'inherit' | 'primary' | 'secondary' | 'success' | 'error' | 'info' | 'warning',\r\n  fullWidth?: boolean\r\n  autoFocus?: boolean\r\n  disabled?: boolean\r\n  startIcon?: React.ReactNode;\r\n  sx?: SxProps<Theme>\r\n  callbackFn: () => Promise<void>\r\n}\r\n\r\nexport const ClickOnceButton: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [isDisabled, setIsDisabled] = React.useState(false);\r\n\r\n  const handleClick = async () => {\r\n    setIsDisabled(true);\r\n    try {\r\n      await props.callbackFn();\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(FormatUtil.formatMessage(error));\r\n    }\r\n    if (mounted.current) {\r\n      setIsDisabled(false);\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <LoadingButton\r\n      loading={isDisabled}\r\n      size={props.size ?? \"small\"}\r\n      variant={props.variant ?? \"contained\"}\r\n      color={props.color ?? \"primary\"}\r\n      fullWidth={props.fullWidth}\r\n      disabled={props.disabled}\r\n      onClick={handleClick}\r\n      startIcon={props.startIcon}\r\n      sx={props.sx}\r\n    >\r\n      {props.children}\r\n    </LoadingButton>\r\n  );\r\n}\r\n","import { Typography } from '@mui/material';\r\nimport React from 'react';\r\nimport { MomentUtil } from '../../../../util/moment.util';\r\n\r\ninterface Props {\r\n  date: string\r\n}\r\n\r\ntype CountdownState = {\r\n  days: number\r\n  hours: number\r\n  minutes: number\r\n  seconds: number\r\n}\r\n\r\nexport const Countdown: React.FC<Props> = (props: Props) => {\r\n  const moment = React.useMemo<MomentUtil>(() => {\r\n    return new MomentUtil();\r\n  }, []);\r\n  const duration = moment.getDuration(props.date);\r\n  const mounted = React.useRef(false);\r\n  const [state, setState] = React.useState<CountdownState>({\r\n    days: duration.days() > 0 ? duration.days() : 0,\r\n    hours: duration.hours() > 0 ? duration.hours() : 0,\r\n    minutes: duration.minutes() > 0 ? duration.minutes() : 0,\r\n    seconds: duration.seconds() > 0 ? duration.seconds() : 0\r\n  });\r\n\r\n  if (duration.asSeconds() > 0) {\r\n    setTimeout(() => {\r\n      const duration = moment.getDuration(props.date);\r\n      if (mounted.current) {\r\n        setState({\r\n          days: duration.days(),\r\n          hours: duration.hours(),\r\n          minutes: duration.minutes(),\r\n          seconds: duration.seconds()\r\n        });\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n      <b>{state.days}</b> days <b>{state.hours}</b> hours <b>{state.minutes}</b> minutes <b>{state.seconds}</b> seconds\r\n    </Typography>\r\n  );\r\n}\r\n","import { SvgIcon } from \"@mui/material\";\r\nimport React from \"react\";\r\n\r\ntype FontAwesomeSvgIconProps = {\r\n  icon: any;\r\n};\r\n\r\nexport const FontAwesomeSvgIcon = React.forwardRef<SVGSVGElement, FontAwesomeSvgIconProps>(\r\n  (props, ref) => {\r\n    const { icon } = props;\r\n\r\n    const {\r\n      icon: [width, height, , , svgPathData],\r\n    } = icon;\r\n\r\n    return (\r\n      <SvgIcon ref={ref} viewBox={`0 0 ${width} ${height}`}>\r\n        {typeof svgPathData === 'string' ? (\r\n          <path d={svgPathData} />\r\n        ) : (\r\n          /**\r\n           * A multi-path Font Awesome icon seems to imply a duotune icon. The 0th path seems to\r\n           * be the faded element (referred to as the \"secondary\" path in the Font Awesome docs)\r\n           * of a duotone icon. 40% is the default opacity.\r\n           *\r\n           * @see https://fontawesome.com/how-to-use/on-the-web/styling/duotone-icons#changing-opacity\r\n           */\r\n          svgPathData.map((d: string, i: number) => (\r\n            <path style={{ opacity: i === 0 ? 0.4 : 1 }} d={d} />\r\n          ))\r\n        )}\r\n      </SvgIcon>\r\n    );\r\n  },\r\n);","import { Box, LinearProgress, Paper, Skeleton, Typography } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\n\r\ninterface Props {\r\n  loading: boolean\r\n  mintsRemaining?: Maybe<number>\r\n}\r\n\r\nexport const MintsRemaining: React.FC<Props> = (props: Props) => {\r\n  const [pct, setPct] = useState(100);\r\n\r\n  useEffect(() => {\r\n    if (props.mintsRemaining && props.mintsRemaining > 0) {\r\n      const minValue = props.mintsRemaining === CommonConstants.TOTAL_MINTS ? 100 : 90;\r\n      setPct(Math.min(minValue, props.mintsRemaining / CommonConstants.TOTAL_MINTS * 100));\r\n    } else {\r\n      setPct(100);\r\n    }\r\n  }, [props.mintsRemaining]);\r\n\r\n  return (\r\n    <Paper elevation={3} sx={{ width: \"60%\", textAlign: \"center\", mb: 3 }}>\r\n      <Box sx={{ px: 2, pt: 2, pb: 1.5 }}>\r\n        {props.loading || !props.mintsRemaining ? (\r\n          <Skeleton animation=\"wave\" width=\"50%\"></Skeleton>\r\n        ) : (\r\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n            <b>{FormatUtil.formatNumber(props.mintsRemaining)}</b> of {FormatUtil.formatNumber(CommonConstants.TOTAL_MINTS)} mintable\r\n          </Typography>\r\n        )}\r\n      </Box>\r\n      <LinearProgress sx={{ height: \"8px\" }} variant=\"determinate\" color={pct <= 40 ? \"error\" : \"primary\"} value={pct} />\r\n    </Paper>\r\n  );\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { faDiscord, faTwitter } from '@fortawesome/free-brands-svg-icons';\r\nimport { Box, Button, Container, Grid, IconButton, Link, Paper, Stack, Typography } from '@mui/material';\r\nimport BigNumber from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { GET_MARKET_INFO_QUERY } from '../../../../queries';\r\nimport { GetMarketInfo } from '../../../../queries/__generated__/GetMarketInfo';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { MomentUtil } from '../../../../util/moment.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { DisplayBigNumber, DocumentState, GlobalEvent, MarketChangedEvent, PunkChangedEvent } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\nimport { Countdown } from '../../../common/components/countdown';\r\nimport { FontAwesomeSvgIcon } from '../../../common/components/fa-icon';\r\nimport { MintsRemaining } from '../mints-remaining';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const LandingMain = () => {\r\n  const moment = React.useMemo<MomentUtil>(() => {\r\n    return new MomentUtil();\r\n  }, []);\r\n  const date = moment.getLocal(\"2021-12-21T17:00:00+0000\");\r\n\r\n  const mounted = React.useRef(false);\r\n  const [mintPrice, setMintPrice] = useState<DisplayBigNumber>({\r\n    number: new BigNumber(\"0\"),\r\n    displayNumber: \"0\"\r\n  });\r\n  const [marketStarted, setMarketStarted] = useState(false);\r\n  const [canMint, setCanMint] = useState(false);\r\n  const [mintsRemaining, setMintsRemaining] = useState<Maybe<number>>(undefined);\r\n  const emitter = getEmitter();\r\n  const punkService = getPunkService();\r\n\r\n  const query = useQuery<GetMarketInfo>(GET_MARKET_INFO_QUERY, {\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  const refetch = query.refetch;\r\n\r\n  useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (state === DocumentState.Active) {\r\n        logger.info(\"Refreshing market info\")();\r\n        refetch();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: MarketChangedEvent) => {\r\n      logger.info(`eventType: ${e.eventType} amount: ${e.value.toFixed()} timestamp: ${e.timestamp.toFixed()}`)();\r\n      refetch();\r\n    }\r\n    emitter.on(GlobalEvent.MarketChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.MarketChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      logger.info(`eventType: ${e.eventType} punkId: ${e.punkId} amount: ${e.amount?.toFixed()} fromAddress: ${e.fromAddress} toAddress: ${e.toAddress} timestamp: ${e.timestamp.toFixed()}`)();\r\n      refetch();\r\n    }\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const info = query.data?.marketInfo;\r\n    if (info && mounted.current) {\r\n      setMintPrice({\r\n        number: new BigNumber(info.mintPrice),\r\n        displayNumber: TokenUtil.formatBigNumber(new BigNumber(info.mintPrice), CommonConstants.CURRENCY_DECIMALS, 2)\r\n      });\r\n      setMarketStarted(info.marketStarted);\r\n      setCanMint(info.marketStarted && info.mintsRemaining > 0);\r\n      setMintsRemaining(info.mintsRemaining);\r\n    }\r\n  }, [query.data]);\r\n\r\n  const handleMintAsync = async () => {\r\n    try {\r\n      const result = await punkService.mintAsync();\r\n      if (result) {\r\n        SnackbarUtil.enqueueMessage(\"Mint success\");\r\n      } else {\r\n        SnackbarUtil.enqueueError(\"Mint failed\");\r\n      }\r\n    } catch (error) {\r\n      logger.error(error)();\r\n      SnackbarUtil.enqueueError(error);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Container maxWidth=\"lg\" sx={{ mt: 10 }}>\r\n      <Grid container spacing={3} direction=\"row\" justifyContent=\"center\" alignItems=\"center\" marginBottom={3}>\r\n        <Grid item sm={12} md={6}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <div>\r\n              <Typography variant=\"h3\" color=\"primary\">\r\n                {CommonConstants.APP_NAME}\r\n              </Typography>\r\n              <Typography variant=\"subtitle1\" color=\"textSecondary\" paragraph>\r\n                The very first NFT collection powered by <Link underline=\"hover\" href=\"https://www.vite.org/\" target=\"_blank\">Vite chain</Link>. Now is your chance to make Vite history and become owner of an isometric punk.\r\n                Get yourself ready for the metaverse.\r\n                {!marketStarted ? (\r\n                  <>\r\n                    &nbsp;Minting will open in:\r\n                  </>\r\n\r\n                ) : (\r\n                  <>\r\n                    &nbsp;Mint a punk for {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME} now!\r\n                  </>\r\n                )}\r\n              </Typography>\r\n              {!marketStarted ? (\r\n                <Paper elevation={3} sx={{ p: 2, width: \"60%\", textAlign: \"center\", mb: 3 }}>\r\n                  <Countdown date={date.toISOString()}></Countdown>\r\n                </Paper>\r\n              ) : (\r\n                <MintsRemaining loading={query.loading} mintsRemaining={mintsRemaining}></MintsRemaining>\r\n              )}\r\n              <Stack spacing={2} direction=\"row\">\r\n                <ClickOnceButton variant=\"contained\" color=\"primary\" callbackFn={handleMintAsync} sx={{ minWidth: \"100px\" }} disabled={!canMint}>\r\n                  Mint\r\n                </ClickOnceButton>\r\n                <Button variant=\"outlined\" color=\"primary\" component={RouterLink} to='/marketplace'>\r\n                  Browse\r\n                </Button>\r\n              </Stack>\r\n            </div>\r\n          </Box>\r\n        </Grid>\r\n        <Grid item sm={12} md={6}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            {/* <LandingMainImage></LandingMainImage> */}\r\n            <img alt=\"main\" src={CommonConstants.LANDING_IMAGE_URL}></img>\r\n          </Box>\r\n        </Grid>\r\n        <Grid item xs={12} marginTop={10}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n              Connect with us\r\n            </Typography>\r\n          </Box>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <Stack spacing={2} direction=\"row\">\r\n              <IconButton aria-label=\"Twitter\" href={CommonConstants.TWITTER_URL} target=\"_blank\">\r\n                <FontAwesomeSvgIcon icon={faTwitter} />\r\n              </IconButton>\r\n              <IconButton aria-label=\"Discord\" href={CommonConstants.DISCORD_URL} target=\"_blank\">\r\n                <FontAwesomeSvgIcon icon={faDiscord} />\r\n              </IconButton>\r\n            </Stack>\r\n          </Box>\r\n        </Grid>\r\n        <Grid item xs={12} marginTop={10}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <div>\r\n              <Typography variant=\"h5\" color=\"textSecondary\" textAlign=\"center\" paragraph>\r\n                Disclaimer\r\n              </Typography>\r\n              <Typography variant=\"subtitle1\" color=\"textSecondary\" textAlign=\"center\" paragraph>\r\n                The intention of {CommonConstants.APP_NAME} is to showcase the capabilities of the Vite Blockchain. {CommonConstants.APP_NAME} is not affiliated with CryptoPunks and LarvaLabs.\r\n                The value of a {CommonConstants.PUNK_NAME} is not related to the value of a CryptoPunk. {CommonConstants.APP_NAME} is a homage to the CryptoPunk project of LarvaLabs.\r\n                With {CommonConstants.APP_NAME} we thank LarvaLabs for their pioneering and for creating the CryptoPunk project. The project that basically started the ever growing NFT movement.\r\n\r\n                {marketStarted && mintPrice.number.gt(0) && (\r\n                  <>\r\n                    &nbsp;Why mint for {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME}?\r\n                    The minting of {CommonConstants.APP_NAME} is set at {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME}.\r\n                    This means that during the initial minting phase, you will be able to generate a random punk for {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME}.\r\n                    When all 10,000 Punks are minted, you can get a Punk by using the marketplace.\r\n\r\n                    That the minting is set at {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME} has a couple of reasons. As you know, keeping up, maintaining and further developing a system costs money.\r\n                    We want to keep {CommonConstants.APP_NAME} running for years to come and we hope to integrate {CommonConstants.APP_NAME} with other NFT marketplaces in the near future.\r\n                  </>\r\n                )}\r\n              </Typography>\r\n            </div>\r\n          </Box>\r\n        </Grid>\r\n      </Grid>\r\n    </Container >\r\n  );\r\n}\r\n","import { styled } from '@mui/material/styles';\r\nimport Tooltip, { tooltipClasses, TooltipProps } from '@mui/material/Tooltip';\r\nimport * as React from 'react';\r\n\r\nexport interface CustomTooltipProps extends TooltipProps {\r\n  fullWidth?: boolean\r\n}\r\n\r\nexport const ExtendedBootstrapTooltip: React.FC<CustomTooltipProps> = (props: CustomTooltipProps) => {\r\n  return (\r\n    <BootstrapTooltip {...props} sx={{ [`& .${tooltipClasses.tooltip}`]: { maxWidth: \"none\" } }}></BootstrapTooltip>\r\n  )\r\n}\r\n\r\nexport const LightTooltip = styled(({ className, ...props }: TooltipProps) => (\r\n  <Tooltip {...props} classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: theme.palette.common.white,\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    boxShadow: theme.shadows[1],\r\n    fontSize: 11,\r\n  },\r\n}));\r\n\r\nexport const BootstrapTooltip = styled(({ className, ...props }: TooltipProps) => (\r\n  <Tooltip {...props} arrow classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.arrow}`]: {\r\n    color: theme.palette.common.black,\r\n  },\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: theme.palette.common.black,\r\n  },\r\n}));\r\n\r\nexport const HtmlTooltip = styled(({ className, ...props }: TooltipProps) => (\r\n  <Tooltip {...props} classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: '#f5f5f9',\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    maxWidth: 220,\r\n    fontSize: theme.typography.pxToRem(12),\r\n    border: '1px solid #dadde9',\r\n  },\r\n}));","import { ecLevel, modes, qrcode } from 'qrcode.es';\r\nimport React, { useEffect, useRef } from 'react';\r\n\r\ninterface Props {\r\n  text?: string\r\n}\r\n\r\nexport const QrCode: React.FC<Props> = (props: Props) => {\r\n  const elementRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const defaultOpt = {\r\n      size: 240,\r\n      ecLevel: ecLevel.HIGH,\r\n      minVersion: 4,\r\n      background: '#fff',\r\n      mode: modes.DRAW_WITH_IMAGE_BOX,\r\n      radius: 0,\r\n      image: process.env.PUBLIC_URL + '/assets/images/logo640.png',\r\n      mSize: 0.3\r\n    };\r\n\r\n    if (props.text && elementRef.current) {\r\n      elementRef.current.innerHTML = ''\r\n      const q = new qrcode(elementRef.current);\r\n      q.generate(props.text, defaultOpt).then(() => {\r\n        console.log('QR code generated')\r\n      });\r\n    }\r\n  }, [props.text])\r\n\r\n  return (\r\n    <div ref={elementRef}></div>\r\n  );\r\n}\r\n","import { Button, Dialog, DialogContent, DialogContentText, DialogTitle, FormControl, Input, InputLabel, Link, Typography } from '@mui/material';\r\nimport { Box } from '@mui/system';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConfig } from '../../../../common/config';\r\nimport { getCommonContext } from '../../../../contexts/common.context';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { GlobalEvent } from '../../../../util/types';\r\nimport { getWalletManager, WalletConnectorFactory } from '../../../../wallet';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\nimport { QrCode } from '../qrcode';\r\n\r\nconst logger = getLogger();\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  setOpen: React.Dispatch<React.SetStateAction<boolean>>;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const LoginDialog: React.FC<Props> = (props: Props) => {\r\n  const [uri, setUri] = useState<string>(\"\");\r\n  const [error, setError] = useState(false);\r\n  const [mnemonic, setMnemonic] = useState<Maybe<string>>(undefined);\r\n  const { onClose, open, setOpen } = props;\r\n  const context = getCommonContext();\r\n  const walletManager = getWalletManager();\r\n  const emitter = getEmitter();\r\n  const connectorFactory = React.useMemo<WalletConnectorFactory>(() => {\r\n    return new WalletConnectorFactory(walletManager);\r\n  }, [walletManager]);\r\n  const handleCreateSession = React.useCallback(async () => {\r\n    try {\r\n      const connector = await connectorFactory.createAsync(context.network);\r\n      logger.info(connector.uri)();\r\n      setUri(connector.uri);\r\n      setError(false);\r\n    } catch (error) {\r\n      logger.error(error)();\r\n      setError(true);\r\n    }\r\n  }, [connectorFactory, context.network]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (open: boolean) => {\r\n      setOpen(open)\r\n    }\r\n    emitter.on(GlobalEvent.ConnectWalletDialog, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.ConnectWalletDialog, handleEvent)\r\n      setUri(\"\");\r\n      setError(false);\r\n    };\r\n  }, [emitter, setOpen]);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      setMnemonic(undefined);\r\n      handleCreateSession();\r\n    }\r\n  }, [open, handleCreateSession]);\r\n\r\n  const handleClose = () => {\r\n    onClose();\r\n  };\r\n\r\n  const handleMnemonicChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    setMnemonic(event.target.value);\r\n  };\r\n\r\n  const handleLogin = () => {\r\n    const wallet = walletManager.createWebWallet(CommonUtil.isNullOrWhitespace(mnemonic) ? process.env.REACT_APP_MNEMONIC ?? \"\" : mnemonic ?? \"\");\r\n    if (!wallet) {\r\n      SnackbarUtil.enqueueError('Invalid mnemonic');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog onClose={handleClose} open={open} maxWidth=\"xs\">\r\n      <DialogTitle>Connect Wallet</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          Scan the QR code via Vite Wallet App\r\n        </DialogContentText>\r\n        <Box sx={{ mt: 2, textAlign: \"center\" }}>\r\n          {CommonUtil.isNullOrWhitespace(uri) ? (\r\n            <>\r\n              {error ? (\r\n                <>\r\n                  <Typography gutterBottom>Error</Typography>\r\n                  <ClickOnceButton variant=\"outlined\" callbackFn={handleCreateSession}>Retry</ClickOnceButton>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  Loading...\r\n                </>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <QrCode text={uri}></QrCode>\r\n          )}\r\n          <DialogContentText marginTop={1}>\r\n            Don't have the Vite Wallet App? <Link underline=\"hover\" href=\"https://vite.org/airdrop\" target=\"_blank\">Download here</Link>\r\n          </DialogContentText>\r\n        </Box>\r\n        {CommonConfig.ENABLE_MNEMONIC_LOGIN && (\r\n          <Box sx={{ mt: 2, textAlign: \"center\" }}>\r\n            <FormControl fullWidth variant=\"standard\" >\r\n              <InputLabel htmlFor=\"mnemonic\">Mnemonic</InputLabel>\r\n              <Input\r\n                id=\"mnemonic\"\r\n                value={mnemonic}\r\n                onChange={handleMnemonicChange}\r\n                type=\"text\"\r\n                autoComplete=\"new-password\"\r\n              />\r\n            </FormControl>\r\n            <Button variant=\"contained\" sx={{ mt: 1 }} onClick={handleLogin}>Use test account</Button>\r\n          </Box>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","import AccountCircleTwoToneIcon from '@mui/icons-material/AccountCircleTwoTone';\r\nimport LogoutIcon from '@mui/icons-material/Logout';\r\nimport ShoppingCartIcon from '@mui/icons-material/ShoppingCart';\r\nimport { AppBar, Button, Chip, styled, Toolbar, Typography, useMediaQuery, useTheme } from '@mui/material';\r\nimport React from 'react';\r\nimport { Link as RouterLink, useNavigate } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { ExtendedBootstrapTooltip } from '../../../common/components/tooltip';\r\nimport { LoginDialog } from '../../../main/components/login';\r\n\r\nconst Root = styled('div')(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n`);\r\n\r\nconst TitleTypography = styled(Typography)(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n  margin-left: 10px !important;\r\n`);\r\n\r\nexport const Header: React.FC = (props: any) => {\r\n  const navigate = useNavigate();\r\n  const theme = useTheme();\r\n  const matches = useMediaQuery(theme.breakpoints.up('sm'));\r\n  const context = useConnectedWeb3Context();\r\n  const [loginOpen, setLoginOpen] = React.useState(false);\r\n\r\n  const handleClickLogin = () => {\r\n    setLoginOpen(true);\r\n  };\r\n\r\n  const handleClickLogout = () => {\r\n    context.logout();\r\n  };\r\n\r\n  const handleLoginClose = () => {\r\n    setLoginOpen(false);\r\n  };\r\n\r\n  const truncateAddress = (address?: string) => {\r\n    return CommonUtil.truncateStringInTheMiddle(address, 10, 5)\r\n  }\r\n\r\n  const showAccount = () => {\r\n    navigate(`/account/${context.account}`);\r\n  }\r\n\r\n  return (\r\n    <Root>\r\n      <AppBar position=\"static\" color=\"transparent\">\r\n        <Toolbar>\r\n          <a href=\"/\" style={{ height: \"40px\" }}>\r\n            <img src={\"./assets/images/logo640.png\"} alt=\"logo\" width=\"40\" />\r\n          </a>\r\n          <TitleTypography variant=\"h6\" color=\"#fff\">\r\n            <a href=\"/\" style={{ color: \"inherit\", textDecoration: \"inherit\" }}>\r\n              {CommonConstants.APP_NAME}\r\n            </a>\r\n          </TitleTypography>\r\n          <Button sx={{ mr: 2 }} component={RouterLink} to='/marketplace'>\r\n            {matches ? (\r\n              <>\r\n                Marketplace\r\n              </>\r\n            ) : (\r\n              <ShoppingCartIcon />\r\n            )}\r\n          </Button>\r\n          {context.account ? (\r\n            <>\r\n              <ExtendedBootstrapTooltip sx={{ mr: 1 }} title={\r\n                <React.Fragment>\r\n                  <p>{context.account}</p>\r\n                </React.Fragment>\r\n              } placement=\"bottom\" arrow>\r\n                {matches ? (\r\n                  <Chip icon={<AccountCircleTwoToneIcon />} label={truncateAddress(context.account)} variant=\"outlined\" onClick={showAccount} />\r\n                ) : (\r\n                  <Button color=\"inherit\" onClick={showAccount}>\r\n                    <AccountCircleTwoToneIcon />\r\n                  </Button>\r\n                )}\r\n              </ExtendedBootstrapTooltip>\r\n              <Button color=\"inherit\" onClick={handleClickLogout}>\r\n                <LogoutIcon />\r\n              </Button>\r\n            </>\r\n          ) : (\r\n            <Button variant=\"contained\" color=\"primary\" onClick={handleClickLogin}>\r\n              Connect wallet\r\n            </Button>\r\n          )}\r\n          <LoginDialog open={loginOpen} setOpen={setLoginOpen} onClose={handleLoginClose}></LoginDialog>\r\n        </Toolbar>\r\n      </AppBar >\r\n    </Root >\r\n  )\r\n}","import { ApolloClient, FetchPolicy, NormalizedCacheObject } from \"@apollo/client\";\r\nimport { getApolloClient } from \"../clients/apollo.client\";\r\nimport { ACCEPT_BID_MUTATION, BID_MUTATION, BUY_MUTATION, CANCEL_BID_MUTATION, CANCEL_OFFER_MUTATION, OFFER_MUTATION } from \"../mutations\";\r\nimport { AcceptBid, AcceptBidVariables } from \"../mutations/__generated__/AcceptBid\";\r\nimport { Bid, BidVariables } from \"../mutations/__generated__/Bid\";\r\nimport { Buy, BuyVariables } from \"../mutations/__generated__/Buy\";\r\nimport { CancelBid, CancelBidVariables } from \"../mutations/__generated__/CancelBid\";\r\nimport { CancelOffer, CancelOfferVariables } from \"../mutations/__generated__/CancelOffer\";\r\nimport { Offer, OfferVariables } from \"../mutations/__generated__/Offer\";\r\nimport { GET_MARKET_EVENTS_QUERY, GET_MARKET_INFO_QUERY } from \"../queries\";\r\nimport { GetMarketEvents, GetMarketEventsVariables } from \"../queries/__generated__/GetMarketEvents\";\r\nimport { GetMarketInfo } from \"../queries/__generated__/GetMarketInfo\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\n\r\nclass MarketService {\r\n  private readonly _apollo: ApolloClient<NormalizedCacheObject>;\r\n\r\n  constructor() {\r\n    this._apollo = getApolloClient();\r\n  }\r\n\r\n  getMarketInfoAsync = (_fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketInfo>({\r\n      query: GET_MARKET_INFO_QUERY,\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getEventsAsync = (_offset: number, _limit: number, _height?: Maybe<string>, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketEvents, GetMarketEventsVariables>({\r\n      query: GET_MARKET_EVENTS_QUERY,\r\n      variables: {\r\n        offset: _offset,\r\n        limit: _limit,\r\n        height: _height\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  async offerAsync(id: string, amount: string, address?: Maybe<string>): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Offer, OfferVariables>({\r\n      mutation: OFFER_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount,\r\n        address: CommonUtil.isNullOrWhitespace(address) ? undefined : address\r\n      }\r\n    });\r\n    return Boolean(result.data?.offer ?? false);\r\n  }\r\n\r\n  async cancelOfferAsync(id: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<CancelOffer, CancelOfferVariables>({\r\n      mutation: CANCEL_OFFER_MUTATION,\r\n      variables: {\r\n        id: id\r\n      }\r\n    });\r\n    return Boolean(result.data?.cancelOffer ?? false);\r\n  }\r\n\r\n  async buyAsync(id: string, amount: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Buy, BuyVariables>({\r\n      mutation: BUY_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount\r\n      }\r\n    });\r\n    return Boolean(result.data?.buy ?? false);\r\n  }\r\n\r\n  async bidAsync(id: string, amount: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Bid, BidVariables>({\r\n      mutation: BID_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount\r\n      }\r\n    });\r\n    return Boolean(result.data?.bid ?? false);\r\n  }\r\n\r\n  async acceptBidAsync(id: string, amount: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<AcceptBid, AcceptBidVariables>({\r\n      mutation: ACCEPT_BID_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount\r\n      }\r\n    });\r\n    return Boolean(result.data?.acceptBid ?? false);\r\n  }\r\n\r\n  async cancelBidAsync(id: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<CancelBid, CancelBidVariables>({\r\n      mutation: CANCEL_BID_MUTATION,\r\n      variables: {\r\n        id: id\r\n      }\r\n    });\r\n    return Boolean(result.data?.cancelBid ?? false);\r\n  }\r\n}\r\n\r\nconst service = new MarketService();\r\n\r\nexport const getMarketService = () => {\r\n  return service;\r\n}","import { faBan, faDonate, faEraser, faFileInvoiceDollar, faGift, faHandHoldingUsd, faPowerOff, faQuestion, faTrophy } from '@fortawesome/free-solid-svg-icons';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { PunkEventType } from './types';\r\n\r\nexport abstract class IconUtil {\r\n  static getBuyEventTypeIcon = () => {\r\n    return faDonate;\r\n  }\r\n  static getClaimEventTypeIcon = () => {\r\n    return faGift;\r\n  }\r\n  static getOfferEventTypeIcon = () => {\r\n    return faFileInvoiceDollar;\r\n  }\r\n  static getCancelSaleEventTypeIcon = () => {\r\n    return faPowerOff;\r\n  }\r\n  static getCancelGiftEventTypeIcon = () => {\r\n    return faEraser;\r\n  }\r\n  static getPunkEventTypeIcon = (eventType: PunkEventType, amount?: Maybe<BigNumber>) => {\r\n    switch (eventType) {\r\n      case PunkEventType.Mint:\r\n        return faTrophy;\r\n      case PunkEventType.Offer:\r\n        if (amount && amount.gt(0)) {\r\n          return IconUtil.getOfferEventTypeIcon();\r\n        }\r\n        return IconUtil.getClaimEventTypeIcon();\r\n      case PunkEventType.NewBid:\r\n        return faHandHoldingUsd;;\r\n      case PunkEventType.CancelBid:\r\n        return faBan;\r\n      case PunkEventType.Buy:\r\n        if (amount && amount.gt(0)) {\r\n          return IconUtil.getBuyEventTypeIcon();\r\n        }\r\n        return IconUtil.getClaimEventTypeIcon();\r\n      case PunkEventType.CancelOffer:\r\n        if (amount && amount.gt(0)) {\r\n          return IconUtil.getCancelSaleEventTypeIcon();\r\n        }\r\n        return IconUtil.getCancelGiftEventTypeIcon();\r\n      default:\r\n        return faQuestion;\r\n    }\r\n  }\r\n}","import { CommonConfig } from \"../common/config\";\r\nimport { CommonUtil } from \"./common.util\";\r\n\r\nexport abstract class ExplorerUtil {\r\n  private static DEFAULT_BASE_URL = \"https://vitescan.io\";\r\n\r\n  private static getBaseUrl(_baseUrl?: string): string {\r\n    let baseUrl = _baseUrl;\r\n    if (!baseUrl || CommonUtil.isNullOrWhitespace(baseUrl)) {\r\n      baseUrl = CommonConfig.EXPLORER_URL;\r\n    }\r\n    baseUrl = baseUrl.endsWith('/') ? baseUrl.substring(0, baseUrl.length - 1) : baseUrl;\r\n    return baseUrl;\r\n  }\r\n\r\n  static getAddressUrl(_address?: Maybe<string>, _baseUrl?: string): string {\r\n    const baseUrl = ExplorerUtil.getBaseUrl(_baseUrl);\r\n    if (baseUrl === ExplorerUtil.DEFAULT_BASE_URL) {\r\n      return `${baseUrl}/address/${_address}`;\r\n    }\r\n    return `${baseUrl}/account/${_address}`;\r\n  }\r\n\r\n  static getTxUrl(_tx?: Maybe<string>, _baseUrl?: string): string {\r\n    const baseUrl = ExplorerUtil.getBaseUrl(_baseUrl);\r\n    if (baseUrl === ExplorerUtil.DEFAULT_BASE_URL) {\r\n      return `${baseUrl}/tx/${_tx}`;\r\n    }\r\n    return `${baseUrl}/tx/${_tx}`;\r\n  }\r\n}","import { Link } from '@mui/material';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { ExplorerUtil } from '../../../../util/explorer.util';\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n  value?: Maybe<string>\r\n  type: ExplorerLinkType\r\n}\r\n\r\nexport enum ExplorerLinkType {\r\n  Address,\r\n  Transaction\r\n}\r\n\r\nexport const ExplorerLink: React.FC<Props> = (props: Props) => {\r\n  const getUrl = useCallback(() => {\r\n    if (!props.value || CommonUtil.isNullOrWhitespace(props.value)) {\r\n      return undefined;\r\n    }\r\n    switch (props.type) {\r\n      case ExplorerLinkType.Address:\r\n        return ExplorerUtil.getAddressUrl(props.value);\r\n      default:\r\n        return ExplorerUtil.getTxUrl(props.value);\r\n    }\r\n  }, [props.value, props.type]);\r\n  const [url, setUrl] = useState<Maybe<string>>(getUrl());\r\n\r\n  useEffect(() => {\r\n    setUrl(getUrl());\r\n  }, [props.value, props.type, getUrl]);\r\n\r\n  if (!url || CommonUtil.isNullOrWhitespace(url)) {\r\n    return (\r\n      <>\r\n        {props.children}\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Link underline=\"hover\" href={url} target=\"_blank\">\r\n      {props.children}\r\n    </Link>\r\n  );\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { Avatar, Grid, Link, Paper, styled, Table, TableBody, TableCell, TableContainer, TableHead, TableRow } from '@mui/material';\r\nimport React from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants, PunkEventTypes } from '../../../../common/constants';\r\nimport { GET_PUNK_QUERY } from '../../../../queries';\r\nimport { GetPunk, GetPunkVariables } from '../../../../queries/__generated__/GetPunk';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { IconUtil } from '../../../../util/icon.util';\r\nimport { MomentUtil } from '../../../../util/moment.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { PunkEvent, PunkEventType } from '../../../../util/types';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\nimport { Alert } from '../alert';\r\nimport { ExplorerLink, ExplorerLinkType } from '../explorer-link';\r\nimport { ExtendedBootstrapTooltip } from '../tooltip';\r\n\r\ninterface EventTableRowProps {\r\n  item: PunkEvent\r\n}\r\n\r\nconst CustomAvatar = styled(Avatar)(({ theme }) => (`\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  image-rendering: pixelated;\r\n  margin-right: 10px;\r\n`));\r\n\r\nconst CustomTableCell = styled(TableCell)(({ theme }) => (`\r\n  background-color: rgba(255, 255, 255, 0.3);\r\n`));\r\n\r\nconst EventTableRow: React.FC<EventTableRowProps> = (props: EventTableRowProps) => {\r\n  const query = useQuery<GetPunk, GetPunkVariables>(GET_PUNK_QUERY, {\r\n    variables: {\r\n      id: props.item.punkId.toString()\r\n    }\r\n  });\r\n  const momentUtil = new MomentUtil();\r\n\r\n  const formatTimestamp = (timestamp: any) => {\r\n    return momentUtil.getLocalReverseFormatted(momentUtil.getFromUnix(timestamp));\r\n  }\r\n\r\n  const getEventName = (): string => {\r\n    const eventType = props.item.eventType as PunkEventType;\r\n    switch (eventType) {\r\n      case PunkEventType.Offer:\r\n        if (!props.item.amount || props.item.amount.lte(0)) {\r\n          return \"Gift\";\r\n        }\r\n        break;\r\n      case PunkEventType.Buy:\r\n        if (!props.item.amount || props.item.amount.lte(0)) {\r\n          return \"Claim gift\";\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return PunkEventTypes[props.item.eventType].name;\r\n  }\r\n\r\n  return (\r\n    <TableRow sx={{ '&:last-child td, &:last-child th': { border: 0 } }}>\r\n      <TableCell component=\"th\" scope=\"row\">\r\n        <FontAwesomeIcon icon={IconUtil.getPunkEventTypeIcon(props.item.eventType as PunkEventType, props.item.amount)} /> <b>{getEventName()}</b>\r\n      </TableCell>\r\n      <TableCell>\r\n        <Link underline=\"hover\" component={RouterLink} to={`/punk/${props.item.punkId}`} display=\"flex\" alignItems=\"center\">\r\n          <CustomAvatar variant=\"rounded\" src={UrlUtil.getPunkUrl(query.data?.punk.image)}>\r\n          </CustomAvatar>\r\n          {CommonConstants.PUNK_NAME} #{props.item.punkId}\r\n        </Link>\r\n      </TableCell>\r\n      <TableCell>\r\n        {props.item.amount?.gt(0) ? `${TokenUtil.formatBigNumber(props.item.amount, CommonConstants.CURRENCY_DECIMALS, 2)} ${CommonConstants.CURRENCY_NAME}` : ''}\r\n      </TableCell>\r\n      <TableCell>\r\n        <ExplorerLink type={ExplorerLinkType.Address} value={props.item.fromAddress}>\r\n          <ExtendedBootstrapTooltip title={props.item.fromAddress ?? \"\"}>\r\n            <span>{CommonUtil.truncateStringInTheMiddle(props.item.fromAddress, 10, 5)}</span>\r\n          </ExtendedBootstrapTooltip>\r\n        </ExplorerLink>\r\n      </TableCell>\r\n      <TableCell>\r\n        <ExplorerLink type={ExplorerLinkType.Address} value={props.item.toAddress}>\r\n          <ExtendedBootstrapTooltip title={props.item.toAddress ?? \"\"}>\r\n            <span>{CommonUtil.truncateStringInTheMiddle(props.item.toAddress, 10, 5)}</span>\r\n          </ExtendedBootstrapTooltip>\r\n        </ExplorerLink>\r\n      </TableCell>\r\n      <TableCell align=\"right\">\r\n        <ExplorerLink type={ExplorerLinkType.Transaction} value={props.item.accountBlockHash}>\r\n          {formatTimestamp(props.item.timestamp.toFixed())}\r\n        </ExplorerLink>\r\n      </TableCell>\r\n    </TableRow>\r\n  )\r\n}\r\n\r\nconst EventListLoading: React.FC<Props> = (props: Props) => {\r\n  return (\r\n    <Grid item key='1' xs={12} md={6}>\r\n      {props.loading ? (\r\n        <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n      ) : (\r\n        <>\r\n          {props.error ? (\r\n            <Alert message={FormatUtil.formatMessage(props.error)} type=\"warning\"></Alert>\r\n          ) : (\r\n            <>\r\n              {props.events.length > 0 ? (\r\n                <></>\r\n              ) : (\r\n                <Alert message=\"No activity yet\" type=\"default\"></Alert>\r\n              )}\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n    </Grid>\r\n  )\r\n}\r\n\r\ninterface Props {\r\n  events: PunkEvent[]\r\n  newEvents: PunkEvent[]\r\n  error: any\r\n  loading: boolean\r\n  hasMore: boolean\r\n  height?: number\r\n  fetchMoreDataAsync(): Promise<void>\r\n}\r\n\r\nexport const EventList: React.FC<Props> = (props: Props) => {\r\n  return (\r\n    <Paper\r\n      id=\"event-list\"\r\n      style={{\r\n        height: props.height ?? 300,\r\n        overflow: 'auto',\r\n        backgroundColor: 'rgba(255, 255, 255, 0.5)'\r\n      }}\r\n    >\r\n      {props.newEvents.length > 0 || props.events.length > 0 ? (\r\n        <InfiniteScroll\r\n          dataLength={props.events.length ?? 0}\r\n          next={props.fetchMoreDataAsync}\r\n          hasMore={props.hasMore}\r\n          loader={\r\n            <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n              <EventListLoading {...props}></EventListLoading>\r\n            </Grid>\r\n          }\r\n          scrollableTarget=\"event-list\"\r\n        >\r\n          <TableContainer>\r\n            <Table stickyHeader>\r\n              <TableHead>\r\n                <TableRow>\r\n                  <CustomTableCell></CustomTableCell>\r\n                  <CustomTableCell><b>Punk</b></CustomTableCell>\r\n                  <CustomTableCell><b>Amount</b></CustomTableCell>\r\n                  <CustomTableCell><b>From</b></CustomTableCell>\r\n                  <CustomTableCell><b>To</b></CustomTableCell>\r\n                  <CustomTableCell align=\"right\"><b>Date</b></CustomTableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {props.newEvents.map((e: PunkEvent) => (\r\n                  <EventTableRow key={`new-events-${e.id}`} item={e} />\r\n                ))}\r\n                {props.events.map((e: PunkEvent) => (\r\n                  <EventTableRow key={`events-${e.id}`} item={e} />\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          </TableContainer>\r\n        </InfiniteScroll>) : (\r\n        <Grid sx={{ height: \"100%\" }} container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n          <EventListLoading {...props}></EventListLoading>\r\n        </Grid>\r\n      )}\r\n    </Paper>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { GET_MARKET_EVENTS_QUERY } from '../../../../queries';\r\nimport { GetMarketEvents, GetMarketEventsVariables } from '../../../../queries/__generated__/GetMarketEvents';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TransformUtil } from '../../../../util/transform.util';\r\nimport { DocumentState, GlobalEvent, PunkChangedEvent, PunkEvent } from '../../../../util/types';\r\nimport { EventList } from '../../../common/components/event-list';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const MarketplaceBrowseActivity: React.FC = (props: any) => {\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n  const [events, setEvents] = useState<PunkEvent[]>([]);\r\n  const [newEvents, setNewEvents] = useState<PunkEvent[]>([]);\r\n  const service = getMarketService();\r\n  const emitter = getEmitter();\r\n\r\n  const query = useQuery<GetMarketEvents, GetMarketEventsVariables>(GET_MARKET_EVENTS_QUERY, {\r\n    variables: {\r\n      offset: 0,\r\n      limit: limit\r\n    },\r\n    fetchPolicy: 'network-only',\r\n    onCompleted: (data) => {\r\n      setEvents(data.marketEvents.events.map(e => TransformUtil.toPunkEvent(e)));\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    logger.info(\"fetchMoreDataAsync\", events.length)();\r\n    const blockHeight: Maybe<string> = query.data?.marketEvents.blockHeight.toString();\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await service.getEventsAsync(events.length, limit, blockHeight);\r\n      setHasMore(result.data.marketEvents.events.length >= limit);\r\n      if (result.data.marketEvents.events.length > 0) {\r\n        setEvents([\r\n          ...events,\r\n          ...result.data.marketEvents.events.map(e => TransformUtil.toPunkEvent(e))\r\n        ]);\r\n      }\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const refetch = query.refetch;\r\n\r\n  const refresh = useCallback(() => {\r\n    logger.info(\"Refreshing market activity\")();\r\n    refetch();\r\n    setNewEvents([]);\r\n  }, [refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (state === DocumentState.Active) {\r\n        refresh();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refresh]);\r\n\r\n  const addNewEvent = useCallback((e: PunkChangedEvent) => {\r\n    setNewEvents([\r\n      TransformUtil.toPunkEvent(e),\r\n      ...newEvents\r\n    ]);\r\n  }, [newEvents]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      logger.info(\"newMarketEvent\", e)();\r\n      addNewEvent(e);\r\n    }\r\n    logger.info('emitter.on', GlobalEvent.PunkChanged)();\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent);\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.PunkChanged)();\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, addNewEvent]);\r\n\r\n  return (\r\n    <EventList\r\n      events={events}\r\n      newEvents={newEvents}\r\n      error={error}\r\n      loading={isLoading}\r\n      hasMore={hasMore}\r\n      height={500}\r\n      fetchMoreDataAsync={fetchMoreDataAsync}>\r\n    </EventList>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport SortIcon from '@mui/icons-material/Sort';\r\nimport { Autocomplete, FormControl, FormGroup, Grid, InputLabel, MenuItem, Select, SelectChangeEvent, Stack, TextField, ToggleButton, ToggleButtonGroup } from '@mui/material';\r\nimport React, { SyntheticEvent, useState } from 'react';\r\nimport { DefaultPunkFilterValues, PunkSortTypes } from '../../../../common/constants';\r\nimport { GET_PUNK_ATTRIBUTES_QUERY } from '../../../../queries';\r\nimport { GetPunkAttributes } from '../../../../queries/__generated__/GetPunkAttributes';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { PunkFilterValues } from '../../../../util/types';\r\nimport { OrderBy, PunkSortBy } from '../../../../__generated__/globalTypes';\r\n\r\nexport const MarketplaceBrowseItemsFilter: React.FC = () => {\r\n  const [values, setValues] = useState<PunkFilterValues>(DefaultPunkFilterValues);\r\n  const emitter = getEmitter();\r\n\r\n  const attributesQuery = useQuery<GetPunkAttributes>(GET_PUNK_ATTRIBUTES_QUERY, {\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  const emitEvent = (oldValues: PunkFilterValues, newValues: PunkFilterValues) => {\r\n    emitter.emitPunkFilterValuesChanged(oldValues, newValues);\r\n  }\r\n\r\n  const handleSortByChange = (event: SelectChangeEvent) => {\r\n    const newValues: PunkFilterValues = { ...values, sortBy: event.target.value as PunkSortBy };\r\n    setValues(newValues);\r\n    emitEvent(values, newValues);\r\n  };\r\n\r\n  const handleSearchChange = (event: SyntheticEvent<Element, Event>, value: string[]) => {\r\n    const newValues: PunkFilterValues = { ...values, search: value.join(',') };\r\n    setValues(newValues);\r\n    emitEvent(values, newValues);\r\n  };\r\n\r\n  const handleCheckedChange = (event: React.MouseEvent<HTMLElement, MouseEvent>, value: any) => {\r\n    const newValues: PunkFilterValues = { ...values, orderBy: value };\r\n    setValues(newValues);\r\n    emitEvent(values, newValues);\r\n  };\r\n\r\n  return (\r\n    <Grid container sx={{ mb: 2 }} spacing={3}>\r\n      <Grid item md={3}></Grid>\r\n      <Grid item xs={12} md={6}>\r\n        <Autocomplete\r\n          multiple\r\n          freeSolo\r\n          id=\"search-autocomplete\"\r\n          options={attributesQuery.data?.punkAttributes ?? []}\r\n          getOptionLabel={(option) => option}\r\n          size=\"small\"\r\n          fullWidth={true}\r\n          onChange={handleSearchChange}\r\n          filterSelectedOptions\r\n          renderInput={(params) => (\r\n            <TextField\r\n              {...params}\r\n              label=\"Search\"\r\n            />\r\n          )}\r\n        />\r\n      </Grid>\r\n      <Grid item xs={12} md={3}>\r\n        <FormGroup>\r\n          <Stack direction=\"row\" justifyContent=\"end\" spacing={2}>\r\n            <FormControl size=\"small\">\r\n              <InputLabel id=\"sortby-select-label\">Sort by</InputLabel>\r\n              <Select\r\n                labelId=\"sortby-select-label\"\r\n                id=\"sortby-select\"\r\n                value={values.sortBy}\r\n                label=\"Sort by\"\r\n                onChange={handleSortByChange}\r\n              >\r\n                {PunkSortTypes.map(e => (\r\n                  <MenuItem key={e.type} value={e.type}>{e.name}&nbsp;</MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n            {/* <Stack direction=\"row\" alignItems=\"center\" >\r\n              <Switch color=\"default\" checked={values.orderByAsc} onChange={handleCheckedChange('orderByAsc')} />\r\n              {values.orderByAsc ? (\r\n                <ArrowUpward fontSize=\"small\" />\r\n              ) : (\r\n                <ArrowDownward fontSize=\"small\" />\r\n              )}\r\n            </Stack> */}\r\n            <ToggleButtonGroup size=\"small\" exclusive value={values.orderBy} onChange={handleCheckedChange}>\r\n              <ToggleButton value={OrderBy.ASC}>\r\n                <SortIcon sx={{ transform: \"rotate(180deg)\" }} />\r\n              </ToggleButton>\r\n              <ToggleButton value={OrderBy.DESC}>\r\n                <SortIcon />\r\n              </ToggleButton>\r\n            </ToggleButtonGroup>\r\n          </Stack>\r\n        </FormGroup>\r\n      </Grid>\r\n    </Grid>\r\n  )\r\n}\r\n","import { ApolloError, QueryResult, useQuery } from '@apollo/client';\r\nimport { Grid } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport { DefaultPunkFilterValues } from '../../../../common/constants';\r\nimport { GET_PUNKS_QUERY } from '../../../../queries';\r\nimport { GetPunks, GetPunksVariables, GetPunks_punks } from '../../../../queries/__generated__/GetPunks';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { GlobalEvent, Punk, PunkFilterValues } from '../../../../util/types';\r\nimport { OrderBy, PunkSortBy } from '../../../../__generated__/globalTypes';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { MarketplaceBrowseItem } from '../browse-item';\r\nimport { MarketplaceBrowseItemsFilter } from '../browse-items-filter';\r\n\r\nconst logger = getLogger()\r\n\r\ninterface EmptyResultProps {\r\n  error: ApolloError | undefined\r\n  query: QueryResult<GetPunks, GetPunksVariables>\r\n}\r\n\r\nconst EmptyResult: React.FC<EmptyResultProps> = (props: EmptyResultProps) => {\r\n  return (\r\n    <>\r\n      {props.error ? (\r\n        <Alert message={FormatUtil.formatMessage(props.error)} type=\"warning\"></Alert>\r\n      ) : (\r\n        <>\r\n          {props.query.loading || (props.query.data && props.query.data.punks.length > 0) ? (\r\n            <></>\r\n          ) : (\r\n            <Alert message=\"No punks found\" type=\"default\" ></Alert>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\ninterface MarketplaceLoadingProps {\r\n  loading: boolean\r\n  error: ApolloError | undefined\r\n  query: QueryResult<GetPunks, GetPunksVariables>\r\n}\r\n\r\nconst MarketplaceLoading: React.FC<MarketplaceLoadingProps> = (props: MarketplaceLoadingProps) => {\r\n  return (\r\n    <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n      <Grid item key='1' xs={12} md={6}>\r\n        {props.loading ? (\r\n          <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n        ) : (\r\n          <EmptyResult error={props.error} query={props.query}></EmptyResult>\r\n        )}\r\n      </Grid>\r\n    </Grid>\r\n  )\r\n}\r\n\r\nexport const MarketplaceBrowseItems: React.FC = (props: any) => {\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n  const [filter, setFilter] = useState<PunkFilterValues>({\r\n    sortBy: DefaultPunkFilterValues.sortBy,\r\n    orderBy: DefaultPunkFilterValues.orderBy,\r\n    search: ''\r\n  })\r\n  const emitter = getEmitter();\r\n\r\n  const query = useQuery<GetPunks, GetPunksVariables>(GET_PUNKS_QUERY, {\r\n    variables: {\r\n      offset: 0,\r\n      limit: limit,\r\n      sort: filter.sortBy as PunkSortBy,\r\n      order: filter.orderBy as OrderBy,\r\n      search: filter.search\r\n    },\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    const currentLength = query.data?.punks.length ?? 0;\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await query.fetchMore({\r\n        variables: {\r\n          offset: currentLength,\r\n          limit: limit\r\n        }\r\n      });\r\n      setHasMore(result.data.punks.length >= limit);\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const refetch = query.refetch;\r\n\r\n  useEffect(() => {\r\n    refetch({\r\n      offset: 0,\r\n      limit: limit,\r\n      sort: filter.sortBy as PunkSortBy,\r\n      order: filter.orderBy as OrderBy,\r\n      search: filter.search\r\n    })\r\n  }, [filter, refetch])\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (oldValues: PunkFilterValues, newValues: PunkFilterValues) => {\r\n      setHasMore(true);\r\n      setFilter({\r\n        sortBy: newValues.sortBy,\r\n        orderBy: newValues.orderBy,\r\n        search: newValues.search\r\n      });\r\n    }\r\n    emitter.on(GlobalEvent.PunkFilterValuesChanged, handleEvent)\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.PunkFilterValuesChanged)()\r\n      emitter.off(GlobalEvent.PunkFilterValuesChanged, handleEvent)\r\n    };\r\n  }, [emitter])\r\n\r\n  return (\r\n    <>\r\n      <MarketplaceBrowseItemsFilter></MarketplaceBrowseItemsFilter>\r\n      {isLoading || (query.data && query.data.punks.length > 0) ? (\r\n        <InfiniteScroll\r\n          dataLength={query.data?.punks.length ?? 0}\r\n          next={fetchMoreDataAsync}\r\n          hasMore={hasMore}\r\n          loader={\r\n            <MarketplaceLoading loading={isLoading} error={error} query={query}></MarketplaceLoading>\r\n          }\r\n          scrollThreshold=\"200px\"\r\n          scrollableTarget=\"mainscroll\"\r\n        >\r\n          <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\" marginBottom={3}>\r\n            {query.data?.punks.map((p: GetPunks_punks) => (\r\n              <Grid item key={p.id} xs={12} sm={6} md={4} lg={3}>\r\n                <MarketplaceBrowseItem item={p as Punk}></MarketplaceBrowseItem>\r\n              </Grid>\r\n            ))}\r\n          </Grid>\r\n        </InfiniteScroll>\r\n      ) : (\r\n        <MarketplaceLoading loading={isLoading} error={error} query={query}></MarketplaceLoading>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import GridOnIcon from '@mui/icons-material/GridOn';\r\nimport TimelineIcon from '@mui/icons-material/Timeline';\r\nimport { Box, Container, Tab, Tabs, Typography } from '@mui/material';\r\nimport React from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { MarketplaceTab } from '../../../../util/types';\r\nimport { MarketplaceBrowseActivity } from '../browse-activity';\r\nimport { MarketplaceBrowseItems } from '../browse-items';\r\n\r\ninterface TabPanelProps {\r\n  children?: React.ReactNode;\r\n  index: number;\r\n  value: number;\r\n}\r\n\r\nfunction TabPanel(props: TabPanelProps) {\r\n  const { children, value, index, ...other } = props;\r\n\r\n  return (\r\n    <div\r\n      role=\"tabpanel\"\r\n      hidden={value !== index}\r\n      id={`marketplace-tabpanel-${index}`}\r\n      aria-labelledby={`marketplace-tab-${index}`}\r\n      {...other}\r\n    >\r\n      {value === index && (\r\n        <Box sx={{ p: 2 }}>\r\n          {children}\r\n        </Box>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport const MarketplaceBrowse: React.FC = (props: any) => {\r\n  const navigate = useNavigate();\r\n  const { tab } = useParams();\r\n  const getTab = (): number => {\r\n    if (tab === MarketplaceTab.Activity) {\r\n      return 1;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  const initialValue = getTab();\r\n  const [value, setValue] = React.useState<number>(initialValue);\r\n  if (initialValue !== value) {\r\n    setValue(initialValue)\r\n  }\r\n\r\n  const handleChange = (event: React.SyntheticEvent, newValue: number) => {\r\n    setValue(newValue);\r\n    switch (newValue) {\r\n      case 1:\r\n        navigate(\"/marketplace/activity\");\r\n        break;\r\n      default:\r\n        navigate(\"/marketplace\");\r\n        break;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Typography variant=\"h2\" component=\"div\" textAlign=\"center\" sx={{ pt: 3 }} gutterBottom>\r\n        Marketplace\r\n      </Typography>\r\n      <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>\r\n        <Tabs value={value} onChange={handleChange}>\r\n          <Tab icon={<GridOnIcon />} label=\"Items\" value={0} />\r\n          <Tab icon={<TimelineIcon />} label=\"Activity\" value={1} />\r\n        </Tabs>\r\n      </Box>\r\n      <Container sx={{ pb: 6 }} maxWidth=\"xl\">\r\n        <TabPanel value={value} index={0}>\r\n          <MarketplaceBrowseItems></MarketplaceBrowseItems>\r\n        </TabPanel>\r\n        <TabPanel value={value} index={1}>\r\n          <Box marginTop={5}>\r\n            <MarketplaceBrowseActivity></MarketplaceBrowseActivity>\r\n          </Box>\r\n        </TabPanel>\r\n      </Container>\r\n    </>\r\n  )\r\n}\r\n","import React from 'react';\r\n\r\nexport const MarketplaceItem: React.FC = (props: any) => {\r\n  return (\r\n    <>\r\n      MarketplaceItem\r\n    </>\r\n  )\r\n}\r\n","import { Card } from '@mui/material';\r\nimport { styled } from '@mui/material/styles';\r\nimport * as React from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\n\r\nconst CardContainer = styled(Card)(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100vw; \r\n  background-color: rgba(255, 255, 255, 0.5);\r\n`,\r\n);\r\n\r\nconst ImageContainer = styled('div')(\r\n  ({ theme }) => `\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n`,\r\n);\r\n\r\nconst Image = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n`,\r\n);\r\n\r\nconst Img = styled('img')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: contain;\r\n  image-rendering: pixelated;\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  image: string\r\n  maxHeight?: string\r\n}\r\n\r\nexport const PunkImage: React.FC<Props> = (props: Props) => {\r\n  return (\r\n    <CardContainer sx={{ maxHeight: props.maxHeight ?? \"400px\" }}>\r\n      <ImageContainer>\r\n        <Image>\r\n          <Img sx={{ backgroundImage: `url('${UrlUtil.getPunkUrl(props.image)}')` }} />\r\n        </Image>\r\n      </ImageContainer>\r\n    </CardContainer>\r\n  );\r\n}","import { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Link } from '@mui/material';\r\nimport confetti from 'canvas-confetti';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { GlobalEvent, PunkChangedEvent, PunkEventType } from '../../../../util/types';\r\nimport { PunkImage } from '../image';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const MintDialog: React.FC = () => {\r\n  const [open, setOpen] = useState(false);\r\n  const [punkId, setPunkId] = useState(-1);\r\n  const [punkImage, setPunkImage] = useState(\"\");\r\n  const emitter = getEmitter();\r\n  const service = getPunkService();\r\n  const context = useConnectedWeb3Context();\r\n\r\n  useEffect(() => {\r\n    const handleEvent = async (e: PunkChangedEvent) => {\r\n      //logger.info(`eventType: ${e.eventType} punkId: ${e.punkId} amount: ${e.amount?.toString()} fromAddress: ${e.fromAddress} toAddress: ${e.toAddress} timestamp: ${e.timestamp.toString()}`)();\r\n      if (e.eventType === PunkEventType.Mint && e.toAddress?.toLowerCase() === context.account?.toLowerCase()) {\r\n        logger.info(\"Show mint dialog\")();\r\n        const punk = await service.getById(e.punkId.toString());\r\n        setPunkId(e.punkId);\r\n        setPunkImage(punk.data.punk.image);\r\n        setOpen(true);\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent)\r\n    };\r\n  }, [emitter, service, context.account, setOpen]);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      const triggerConfetti = () => {\r\n        confetti({\r\n          particleCount: 200,\r\n          spread: 100,\r\n          zIndex: 9999\r\n        });\r\n      }\r\n      for (let index = 1; index < 4; index++) {\r\n        setTimeout(() => {\r\n          triggerConfetti();\r\n        }, index * 225);\r\n      }\r\n    }\r\n  }, [open]);\r\n\r\n  const handleClose = () => {\r\n    setPunkImage(\"\");\r\n    setOpen(false);\r\n  };\r\n\r\n  if (punkId < 0) {\r\n    return (\r\n      <>\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      transitionDuration={500}\r\n      keepMounted\r\n      onClose={handleClose}\r\n      style={{ zIndex: 9999 }}\r\n    >\r\n      <DialogTitle>🎉 Mint success!</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText paddingBottom={1}>\r\n          You have successfully minted <Link underline=\"hover\" component={RouterLink} to={`/punk/${punkId}`} onClick={handleClose}>{CommonConstants.PUNK_NAME} #{punkId}</Link>\r\n        </DialogContentText>\r\n        <PunkImage image={punkImage} maxHeight=\"300px\"></PunkImage>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>\r\n          Close\r\n        </Button>\r\n        <Button component={RouterLink} to={`/account/${context.account}`} variant=\"contained\" onClick={handleClose}>\r\n          My punks\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { GET_PUNK_EVENTS_QUERY } from '../../../../queries';\r\nimport { GetPunkEvents, GetPunkEventsVariables } from '../../../../queries/__generated__/GetPunkEvents';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TransformUtil } from '../../../../util/transform.util';\r\nimport { DocumentState, GlobalEvent, Punk, PunkChangedEvent, PunkEvent } from '../../../../util/types';\r\nimport { EventList } from '../../../common/components/event-list';\r\n\r\nconst logger = getLogger();\r\n\r\ninterface Props {\r\n  item: Punk\r\n}\r\n\r\nexport const PunkActivity: React.FC<Props> = (props: Props) => {\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n  const [events, setEvents] = useState<PunkEvent[]>([]);\r\n  const [newEvents, setNewEvents] = useState<PunkEvent[]>([]);\r\n  const service = getPunkService();\r\n  const emitter = getEmitter();\r\n\r\n  const query = useQuery<GetPunkEvents, GetPunkEventsVariables>(GET_PUNK_EVENTS_QUERY, {\r\n    variables: {\r\n      id: props.item.id,\r\n      offset: 0,\r\n      limit: limit\r\n    },\r\n    fetchPolicy: 'network-only',\r\n    onCompleted: (data) => {\r\n      setEvents(data.punkEvents.events.map(e => TransformUtil.toPunkEvent(e)));\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    logger.info(\"fetchMoreDataAsync\", events.length)();\r\n    const blockHeight: Maybe<string> = query.data?.punkEvents.blockHeight.toString();\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await service.getEventsAsync(props.item.id, events.length, limit, blockHeight);\r\n      setHasMore(result.data.punkEvents.events.length >= limit);\r\n      if (result.data.punkEvents.events.length > 0) {\r\n        setEvents([\r\n          ...events,\r\n          ...result.data.punkEvents.events.map(e => TransformUtil.toPunkEvent(e))\r\n        ]);\r\n      }\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const refetch = query.refetch;\r\n\r\n  const refresh = useCallback(() => {\r\n    logger.info(\"Refreshing punk activity\")();\r\n    refetch();\r\n    setNewEvents([]);\r\n  }, [refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (state === DocumentState.Active) {\r\n        refresh();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refresh]);\r\n\r\n  const addNewEvent = useCallback((e: PunkChangedEvent) => {\r\n    setNewEvents([\r\n      TransformUtil.toPunkEvent(e),\r\n      ...newEvents\r\n    ]);\r\n  }, [newEvents]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      logger.info(\"newPunkEvent\", e)();\r\n      if (e.punkId === parseInt(props.item.id)) {\r\n        addNewEvent(e);\r\n      }\r\n    }\r\n    logger.info('emitter.on', GlobalEvent.PunkChanged)();\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent);\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.PunkChanged)();\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, props.item.id, addNewEvent]);\r\n\r\n  return (\r\n    <EventList\r\n      events={events}\r\n      newEvents={newEvents}\r\n      error={error}\r\n      loading={isLoading}\r\n      hasMore={hasMore}\r\n      fetchMoreDataAsync={fetchMoreDataAsync}>\r\n    </EventList>\r\n  )\r\n}\r\n","import { FetchPolicy, useQuery } from \"@apollo/client\";\r\nimport React from \"react\";\r\nimport { GET_MARKET_BID_QUERY, GET_MARKET_OFFER_QUERY, GET_PUNK_OWNER_QUERY } from \"../queries\";\r\nimport { GetMarketBid, GetMarketBidVariables } from \"../queries/__generated__/GetMarketBid\";\r\nimport { GetMarketOffer, GetMarketOfferVariables } from \"../queries/__generated__/GetMarketOffer\";\r\nimport { GetPunkOwner, GetPunkOwnerVariables } from \"../queries/__generated__/GetPunkOwner\";\r\nimport { getPunkService } from \"../services/punk.service\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Punk, PunkExtended, TypeNames } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport const usePunkInfo = (_punk: Punk, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n  const defaultPunkExtended = React.useMemo<PunkExtended>(() => {\r\n    return {\r\n      __typename: TypeNames.PunkExtended,\r\n      id: _punk.id,\r\n      rank: _punk.rank,\r\n      image: _punk.image,\r\n      attributes: _punk.attributes\r\n    };\r\n  }, [_punk]);\r\n  const [punkExtended, setPunkExtended] = React.useState<PunkExtended>(defaultPunkExtended);\r\n  const [dateRef, setDateRef] = React.useState<Date>(new Date(0));\r\n\r\n  const ownerQuery = useQuery<GetPunkOwner, GetPunkOwnerVariables>(GET_PUNK_OWNER_QUERY, {\r\n    variables: {\r\n      id: _punk.id.toString()\r\n    },\r\n    notifyOnNetworkStatusChange: true,\r\n    fetchPolicy: _fetchPolicy,\r\n    refetchWritePolicy: \"overwrite\",\r\n    onCompleted: (data) => {\r\n      setPunkExtended({\r\n        ...punkExtended,\r\n        owner: data.punkOwner\r\n      });\r\n    }\r\n  });\r\n\r\n  const bidQuery = useQuery<GetMarketBid, GetMarketBidVariables>(GET_MARKET_BID_QUERY, {\r\n    variables: {\r\n      id: _punk.id.toString()\r\n    },\r\n    notifyOnNetworkStatusChange: true,\r\n    fetchPolicy: _fetchPolicy,\r\n    refetchWritePolicy: \"overwrite\",\r\n    onCompleted: (data) => {\r\n      setPunkExtended({\r\n        ...punkExtended,\r\n        bid: data.marketBid\r\n      });\r\n    }\r\n  });\r\n\r\n  const offerQuery = useQuery<GetMarketOffer, GetMarketOfferVariables>(GET_MARKET_OFFER_QUERY, {\r\n    variables: {\r\n      id: _punk.id.toString()\r\n    },\r\n    notifyOnNetworkStatusChange: true,\r\n    fetchPolicy: _fetchPolicy,\r\n    refetchWritePolicy: \"overwrite\",\r\n    onCompleted: (data) => {\r\n      setPunkExtended({\r\n        ...punkExtended,\r\n        offer: data.marketOffer\r\n      });\r\n    }\r\n  });\r\n\r\n  const error = ownerQuery.error || bidQuery.error || offerQuery.error;\r\n  const loading = ownerQuery.loading || bidQuery.loading || offerQuery.loading;\r\n\r\n  const refetchAsync = async () => {\r\n    logger.info(\"refetchAsync\", new Date().getTime(), dateRef.getTime())();\r\n    if (new Date().getTime() >= dateRef.getTime() + 500) {\r\n      setDateRef(new Date());\r\n      let newOwner;\r\n      let newBid;\r\n      let newOffer;\r\n      try {\r\n        await Promise.all([\r\n          ownerQuery.refetch().then(e => newOwner = e.data.punkOwner),\r\n          bidQuery.refetch().then(e => newBid = e.data.marketBid),\r\n          offerQuery.refetch().then(e => newOffer = e.data.marketOffer)\r\n        ]);\r\n        logger.info(`Refetching punk ${_punk.id}`, newOwner, newBid, newOffer)();\r\n        setPunkExtended({\r\n          ...defaultPunkExtended,\r\n          owner: newOwner,\r\n          bid: newBid,\r\n          offer: newOffer\r\n        });\r\n      } catch (error) {\r\n        logger.error(error)();\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    punkExtended,\r\n    error,\r\n    loading,\r\n    refetchAsync\r\n  };\r\n}\r\n\r\nexport const usePunkInfoV2 = (_punk: Punk, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n  const service = getPunkService();\r\n  const defaultPunkExtended = React.useMemo<PunkExtended>(() => {\r\n    return {\r\n      __typename: TypeNames.PunkExtended,\r\n      id: _punk.id,\r\n      rank: _punk.rank,\r\n      image: _punk.image,\r\n      attributes: _punk.attributes\r\n    };\r\n  }, [_punk]);\r\n  const [punkExtended, setPunkExtended] = React.useState<PunkExtended>(defaultPunkExtended);\r\n  const [loading, setLoading] = React.useState<boolean>(true);\r\n  const [error, setError] = React.useState<Maybe<any>>(undefined);\r\n\r\n  const refetchAsync = async () => {\r\n    setLoading(true);\r\n    setError(undefined);\r\n    try {\r\n      const { punkExtended, loading, error } = await service.getExtendedAsync(_punk, _fetchPolicy);\r\n      setPunkExtended(punkExtended);\r\n      setLoading(loading);\r\n      setError(error);\r\n    } catch (error) {\r\n      setLoading(false);\r\n      setError(error);\r\n    }\r\n  }\r\n\r\n  return {\r\n    punkExtended,\r\n    loading,\r\n    error,\r\n    refetchAsync\r\n  }\r\n}\r\n\r\n","import { FetchPolicy } from '@apollo/client';\r\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, FormControl, Input, InputAdornment, InputLabel } from '@mui/material';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { PunkDialogState, PunkExtended } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\n\r\ninterface Props {\r\n  item: PunkExtended\r\n  state: PunkDialogState\r\n  fee: BigNumber\r\n  updateFee: (_fetchPolicy?: FetchPolicy) => Promise<void>\r\n  setState: React.Dispatch<React.SetStateAction<PunkDialogState>>\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkBidDialog: React.FC<Props> = (props: Props) => {\r\n  const [amount, setAmount] = useState<string>(\"\");\r\n  const [disabled, setDisabled] = useState<boolean>(false);\r\n  const service = getMarketService();\r\n\r\n  const changeAmount = (amount: string) => {\r\n    setAmount(amount);\r\n    setDisabled(CommonUtil.isNullOrWhitespace(amount) || new BigNumber(amount).lte(0));\r\n  }\r\n\r\n  const updateFee = props.updateFee;\r\n\r\n  useEffect(() => {\r\n    if (props.state.open) {\r\n      changeAmount(\"\");\r\n      updateFee(\"cache-first\");\r\n    }\r\n  }, [props.state, updateFee]);\r\n\r\n  const handleClose = () => {\r\n    props.setState({\r\n      ...props.state,\r\n      open: false\r\n    })\r\n  };\r\n\r\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    changeAmount(event.target.value);\r\n  };\r\n\r\n  const handleConfirmAsync = async () => {\r\n    try {\r\n      const _amount = new BigNumber(amount).shiftedBy(CommonConstants.CURRENCY_DECIMALS);\r\n      const _success = await service.bidAsync(props.item.id, _amount.toFixed());\r\n      if (_success) {\r\n        SnackbarUtil.enqueueMessage(\"Bid success\");\r\n        handleClose();\r\n      } else {\r\n        SnackbarUtil.enqueueError(\"Error\");\r\n        updateFee();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog onClose={handleClose} open={props.state.open} maxWidth=\"xs\" fullWidth>\r\n      <DialogTitle>Bid</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          Place a bid for {CommonConstants.PUNK_NAME} #{props.item.id}\r\n        </DialogContentText>\r\n        <FormControl fullWidth sx={{ mt: 2 }} variant=\"standard\" >\r\n          <InputLabel htmlFor=\"amount\">Amount</InputLabel>\r\n          <Input\r\n            id=\"amount\"\r\n            value={amount}\r\n            onChange={handleChange}\r\n            type=\"number\"\r\n            autoFocus\r\n            startAdornment={<InputAdornment position=\"start\">${CommonConstants.CURRENCY_NAME}</InputAdornment>}\r\n          />\r\n        </FormControl>\r\n        {props.fee.gt(0) && (\r\n          <DialogContentText align='right'>\r\n            + {TokenUtil.formatBigNumber(props.fee, CommonConstants.CURRENCY_DECIMALS, 2)} {CommonConstants.CURRENCY_NAME} protocol fee\r\n          </DialogContentText>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>Cancel</Button>\r\n        <ClickOnceButton size=\"medium\" color=\"primary\" callbackFn={handleConfirmAsync} disabled={disabled}>\r\n          Confirm\r\n        </ClickOnceButton>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { FetchPolicy } from '@apollo/client';\r\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, FormControl, Input, InputAdornment, InputLabel } from '@mui/material';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { PunkDialogState, PunkExtended } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\n\r\ninterface Props {\r\n  item: PunkExtended\r\n  state: PunkDialogState\r\n  fee: BigNumber\r\n  updateFee: (_fetchPolicy?: FetchPolicy) => Promise<void>\r\n  setState: React.Dispatch<React.SetStateAction<PunkDialogState>>\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkOfferDialog: React.FC<Props> = (props: Props) => {\r\n  const [amount, setAmount] = useState<string>(\"\");\r\n  const [address, setAddress] = useState<string>(\"\");\r\n  const [disabled, setDisabled] = useState<boolean>(false);\r\n  const service = getMarketService();\r\n\r\n  const changeAmount = (amount: string) => {\r\n    setAmount(amount);\r\n    setDisabled(CommonUtil.isNullOrWhitespace(amount) || new BigNumber(amount).lt(0));\r\n  }\r\n\r\n  const updateFee = props.updateFee;\r\n\r\n  useEffect(() => {\r\n    if (props.state.open) {\r\n      changeAmount(\"\");\r\n      setAddress(\"\");\r\n      updateFee(\"cache-first\");\r\n    }\r\n  }, [props.state, updateFee]);\r\n\r\n  const handleClose = () => {\r\n    props.setState({\r\n      ...props.state,\r\n      open: false\r\n    })\r\n  };\r\n\r\n  const handleAmountChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    changeAmount(event.target.value);\r\n  };\r\n\r\n  const handleAddressChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    setAddress(event.target.value);\r\n  };\r\n\r\n  const handleConfirmAsync = async () => {\r\n    try {\r\n      const _amount = new BigNumber(amount).shiftedBy(CommonConstants.CURRENCY_DECIMALS);\r\n      const _success = await service.offerAsync(props.item.id, _amount.toFixed(), CommonUtil.isNullOrWhitespace(address) ? undefined : address);\r\n      if (_success) {\r\n        SnackbarUtil.enqueueMessage(\"Listed for sale\");\r\n        handleClose();\r\n      } else {\r\n        SnackbarUtil.enqueueError(\"Error\");\r\n        updateFee();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog onClose={handleClose} open={props.state.open} maxWidth=\"xs\" fullWidth>\r\n      <DialogTitle>Sell</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          List {CommonConstants.PUNK_NAME} #{props.item.id} for sale\r\n        </DialogContentText>\r\n        <FormControl fullWidth sx={{ mt: 2 }} variant=\"standard\" >\r\n          <InputLabel htmlFor=\"amount\">Amount</InputLabel>\r\n          <Input\r\n            id=\"amount\"\r\n            value={amount}\r\n            onChange={handleAmountChange}\r\n            type=\"number\"\r\n            autoFocus\r\n            startAdornment={<InputAdornment position=\"start\">${CommonConstants.CURRENCY_NAME}</InputAdornment>}\r\n          />\r\n        </FormControl>\r\n        {props.fee.gt(0) ? (\r\n          <DialogContentText align='right'>\r\n            + {TokenUtil.formatBigNumber(props.fee, CommonConstants.CURRENCY_DECIMALS, 2)} {CommonConstants.CURRENCY_NAME} protocol fee\r\n          </DialogContentText>\r\n        ) : (\r\n          <Box marginTop={2}></Box>\r\n        )}\r\n        <FormControl fullWidth variant=\"standard\" >\r\n          <InputLabel htmlFor=\"address\">Address (optional)</InputLabel>\r\n          <Input\r\n            id=\"address\"\r\n            value={address}\r\n            onChange={handleAddressChange}\r\n            placeholder=\"Only this address will be eligible to buy\"\r\n            type=\"text\"\r\n          />\r\n        </FormControl>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>Cancel</Button>\r\n        <ClickOnceButton size=\"medium\" color=\"primary\" callbackFn={handleConfirmAsync} disabled={disabled}>\r\n          Confirm\r\n        </ClickOnceButton>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { FetchPolicy } from '@apollo/client';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TransformUtil } from '../../../../util/transform.util';\r\nimport { GlobalEvent, MarketChangedEvent, MarketInfo, PunkDialogState, PunkDialogType, PunkExtended } from '../../../../util/types';\r\nimport { PunkBidDialog } from '../dialog-bid';\r\nimport { PunkOfferDialog } from '../dialog-offer';\r\n\r\nconst logger = getLogger();\r\n\r\ninterface Props {\r\n  item: PunkExtended\r\n  state: PunkDialogState\r\n  setState: React.Dispatch<React.SetStateAction<PunkDialogState>>\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkDialog: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [fee, setFee] = useState<BigNumber>(TransformUtil.defaultBigNumber);\r\n  const service = getMarketService();\r\n  const emitter = getEmitter();\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  const updateFee = useCallback(async (_fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    if (mounted.current) {\r\n      setFee(TransformUtil.defaultBigNumber);\r\n      try {\r\n        const result = await service.getMarketInfoAsync(_fetchPolicy);\r\n        if (mounted.current) {\r\n          const info = result.data.marketInfo as MarketInfo;\r\n          if (info && info.actionPrice.gt(0)) {\r\n            setFee(info.actionPrice);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        logger.error(error)();\r\n      }\r\n    }\r\n  }, [service]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: MarketChangedEvent) => {\r\n      logger.info(`eventType: ${e.eventType} amount: ${e.value.toFixed()} timestamp: ${e.timestamp.toFixed()}`)();\r\n      updateFee();\r\n    }\r\n    logger.info('emitter.on', GlobalEvent.MarketChanged)();\r\n    emitter.on(GlobalEvent.MarketChanged, handleEvent);\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.MarketChanged)();\r\n      emitter.off(GlobalEvent.MarketChanged, handleEvent);\r\n    };\r\n  }, [emitter, updateFee]);\r\n\r\n  switch (props.state.type) {\r\n    case PunkDialogType.BID:\r\n      return <PunkBidDialog item={props.item} state={props.state} fee={fee} updateFee={updateFee} setState={props.setState} refetchAsync={props.refetchAsync}></PunkBidDialog>\r\n    case PunkDialogType.OFFER:\r\n      return <PunkOfferDialog item={props.item} state={props.state} fee={fee} updateFee={updateFee} setState={props.setState} refetchAsync={props.refetchAsync}></PunkOfferDialog>\r\n    default:\r\n      return <></>\r\n  }\r\n}\r\n","import { faCheck } from '@fortawesome/free-solid-svg-icons';\r\nimport { Button, Stack } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { IconUtil } from '../../../../util/icon.util';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { PunkDialogState, PunkDialogType, PunkEventType, PunkExtended } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\nimport { FontAwesomeSvgIcon } from '../../../common/components/fa-icon';\r\nimport { PunkDialog } from '../dialog';\r\n\r\nconst logger = getLogger();\r\n\r\ntype ShowButtonState = {\r\n  showAny: boolean\r\n  showBuy: boolean\r\n  showClaim: boolean\r\n  showBid: boolean\r\n  showSell: boolean\r\n  showAcceptBid: boolean\r\n  showCancelBid: boolean\r\n  showCancelSale: boolean\r\n  showCancelGift: boolean\r\n}\r\n\r\ninterface Props {\r\n  marketStarted: boolean,\r\n  item: PunkExtended,\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkInfoActions: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [hasOwner, setHasOwner] = useState<boolean>(false);\r\n  const [showAll] = useState<boolean>(false);\r\n  const [showButtonState, setShowButtonState] = useState<ShowButtonState>({\r\n    showAny: false,\r\n    showBuy: false,\r\n    showClaim: false,\r\n    showBid: false,\r\n    showSell: false,\r\n    showAcceptBid: false,\r\n    showCancelBid: false,\r\n    showCancelSale: false,\r\n    showCancelGift: false\r\n  })\r\n  const [dialogState, setDialogState] = useState<PunkDialogState>({\r\n    type: PunkDialogType.BID,\r\n    open: false\r\n  });\r\n  const context = useConnectedWeb3Context();\r\n  const service = getMarketService();\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (mounted.current) {\r\n      let isOwner = props.item.owner?.toLowerCase() === context.account?.toLowerCase();\r\n      const state: ShowButtonState = {\r\n        showAny: false,\r\n        showBuy: false,\r\n        showClaim: false,\r\n        showBid: false,\r\n        showSell: false,\r\n        showAcceptBid: false,\r\n        showCancelBid: false,\r\n        showCancelSale: false,\r\n        showCancelGift: false\r\n      }\r\n      // setHasOwner\r\n      if (props.item.owner && !CommonUtil.isNullOrWhitespace(props.item.owner)) {\r\n        setHasOwner(true);\r\n      } else {\r\n        setHasOwner(false);\r\n      }\r\n      if (props.marketStarted && !CommonUtil.isNullOrWhitespace(context.account)) {\r\n        state.showAny = true;\r\n      }\r\n      if (!isOwner && props.item.offer && (CommonUtil.isNullOrWhitespace(props.item.offer.onlySellTo) || props.item.offer.onlySellTo?.toLowerCase() === context.account?.toLowerCase())) {\r\n        if (props.item.offer.minAmount.gt(0)) {\r\n          state.showBuy = true;\r\n        } else {\r\n          state.showClaim = true;\r\n        }\r\n      }\r\n      if (!isOwner && props.item.bid?.bidder.toLowerCase() !== context.account?.toLowerCase()) {\r\n        state.showBid = true;\r\n      }\r\n      if (isOwner && !props.item.offer) {\r\n        state.showSell = true;\r\n      }\r\n      if (isOwner && props.item.bid) {\r\n        state.showAcceptBid = true;\r\n      }\r\n      if (!isOwner && props.item.bid?.bidder.toLowerCase() === context.account?.toLowerCase()) {\r\n        state.showCancelBid = true;\r\n      }\r\n      if (isOwner && props.item.offer) {\r\n        if (props.item.offer.minAmount.gt(0)) {\r\n          state.showCancelSale = true;\r\n        } else {\r\n          state.showCancelGift = true;\r\n        }\r\n      }\r\n      setShowButtonState(state);\r\n    }\r\n  }, [props.marketStarted, props.item, context.account]);\r\n\r\n  const handleFailureAsync = async () => {\r\n    SnackbarUtil.enqueueMessage('Transaction failed');\r\n    try {\r\n      // Update actionPrice just in case\r\n      await service.getMarketInfoAsync();\r\n    } catch (error) {\r\n      logger.error(error)();\r\n    }\r\n  }\r\n\r\n  const handleBuyAsync = async (isClaim: boolean = false) => {\r\n    try {\r\n      if (!props.item.offer) {\r\n        throw new Error(`${CommonConstants.PUNK_NAME} #${props.item.id} is not for sale`);\r\n      }\r\n      const success = await service.buyAsync(props.item.id, props.item.offer.minAmount.toFixed());\r\n      if (success) {\r\n        const actionName = isClaim ? \"claimed\" : \"bought\";\r\n        SnackbarUtil.enqueueMessage(`Congratulations! You ${actionName} ${CommonConstants.PUNK_NAME} #${props.item.id}`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleAcceptBidAsync = async () => {\r\n    try {\r\n      if (!props.item.bid) {\r\n        throw new Error(`${CommonConstants.PUNK_NAME} #${props.item.id} has no bid`);\r\n      }\r\n      const success = await service.acceptBidAsync(props.item.id, props.item.bid.amount.toFixed());\r\n      if (success) {\r\n        SnackbarUtil.enqueueMessage(`Congratulations! You sold ${CommonConstants.PUNK_NAME} #${props.item.id}`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleCancelBidAsync = async () => {\r\n    try {\r\n      const success = await service.cancelBidAsync(props.item.id);\r\n      if (success) {\r\n        SnackbarUtil.enqueueMessage(`Bid cancelled`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleCancelSaleAsync = async (isGift: boolean = false) => {\r\n    try {\r\n      const success = await service.cancelOfferAsync(props.item.id);\r\n      if (success) {\r\n        const actName = isGift ? \"Gift\" : \"Sale\";\r\n        SnackbarUtil.enqueueMessage(`${actName} cancelled`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleOpenDialog = (type: PunkDialogType) => {\r\n    if (mounted.current) {\r\n      setDialogState({\r\n        ...dialogState,\r\n        type: type,\r\n        open: true\r\n      })\r\n    }\r\n  }\r\n\r\n  if (!hasOwner || !showButtonState.showAny) {\r\n    return (\r\n      <></>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Stack spacing={1} direction=\"row\">\r\n        {(showAll || showButtonState.showBuy) && (\r\n          <ClickOnceButton\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getBuyEventTypeIcon()} />}\r\n            callbackFn={handleBuyAsync}>\r\n            Buy\r\n          </ClickOnceButton>\r\n        )}\r\n        {(showAll || showButtonState.showClaim) && (\r\n          <ClickOnceButton\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getClaimEventTypeIcon()} />}\r\n            callbackFn={async () => { await handleBuyAsync(true) }}>\r\n            Claim\r\n          </ClickOnceButton>\r\n        )}\r\n        {(showAll || showButtonState.showBid) && (\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getPunkEventTypeIcon(PunkEventType.NewBid)} />}\r\n            onClick={() => { handleOpenDialog(PunkDialogType.BID) }}>\r\n            Bid\r\n          </Button>\r\n        )}\r\n        {(showAll || showButtonState.showSell) && (\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getOfferEventTypeIcon()} />}\r\n            onClick={() => { handleOpenDialog(PunkDialogType.OFFER) }}>\r\n            Sell\r\n          </Button>\r\n        )}\r\n        {(showAll || showButtonState.showAcceptBid) && (\r\n          <ClickOnceButton\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={faCheck} />}\r\n            callbackFn={handleAcceptBidAsync}>\r\n            Accept bid\r\n          </ClickOnceButton>\r\n        )}\r\n      </Stack>\r\n      {(showAll || showButtonState.showCancelBid || showButtonState.showCancelSale || showButtonState.showCancelGift) && (\r\n        <Stack spacing={1} direction=\"row\" marginTop={1}>\r\n          {(showAll || showButtonState.showCancelBid) && (\r\n            <ClickOnceButton\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              startIcon={<FontAwesomeSvgIcon icon={IconUtil.getPunkEventTypeIcon(PunkEventType.CancelBid)} />}\r\n              callbackFn={handleCancelBidAsync}>\r\n              Cancel bid\r\n            </ClickOnceButton>\r\n          )}\r\n          {(showAll || showButtonState.showCancelSale) && (\r\n            <ClickOnceButton\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              startIcon={<FontAwesomeSvgIcon icon={IconUtil.getCancelSaleEventTypeIcon()} />}\r\n              callbackFn={handleCancelSaleAsync}>\r\n              Cancel sale\r\n            </ClickOnceButton>\r\n          )}\r\n          {(showAll || showButtonState.showCancelGift) && (\r\n            <ClickOnceButton\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              startIcon={<FontAwesomeSvgIcon icon={IconUtil.getCancelSaleEventTypeIcon()} />}\r\n              callbackFn={async () => { handleCancelSaleAsync(true) }}>\r\n              Cancel gift\r\n            </ClickOnceButton>\r\n          )}\r\n        </Stack>\r\n      )}\r\n      <PunkDialog item={props.item} state={dialogState} setState={setDialogState} refetchAsync={props.refetchAsync}></PunkDialog>\r\n    </>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { Verified } from '@mui/icons-material';\r\nimport { Box, Card, Chip, Skeleton, Stack, styled, Typography } from '@mui/material';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { usePunkInfo } from '../../../../hooks/punk.hook';\r\nimport { GET_MARKET_INFO_QUERY } from '../../../../queries';\r\nimport { GetMarketInfo } from '../../../../queries/__generated__/GetMarketInfo';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { DocumentState, GlobalEvent, Punk, PunkChangedEvent } from '../../../../util/types';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { ExplorerLink, ExplorerLinkType } from '../../../common/components/explorer-link';\r\nimport { BootstrapTooltip, ExtendedBootstrapTooltip } from '../../../common/components/tooltip';\r\nimport { PunkInfoActions } from '../info-actions';\r\n\r\nconst logger = getLogger();\r\n\r\nconst InfoContainer = styled(Card)(\r\n  ({ theme }) => `\r\n  position: relative;\r\n  overflow: auto;\r\n  width: 100%;\r\n  height: 80vw; \r\n  max-height: 400px;\r\n  background-color: rgba(255, 255, 255, 0.5);\r\n`,\r\n);\r\n\r\nconst BottomContent = styled(Box)(\r\n  ({ theme }) => `\r\n  position: absolute;\r\n  bottom: 24px;\r\n  left: 24px;\r\n  width: calc(100% - 48px);\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  item: Punk\r\n}\r\n\r\nexport const PunkInfo: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [marketStarted, setMarketStarted] = useState(false);\r\n  const { punkExtended, loading, error, refetchAsync } = usePunkInfo(props.item);\r\n  const query = useQuery<GetMarketInfo>(GET_MARKET_INFO_QUERY, {\r\n    fetchPolicy: 'network-only'\r\n  });\r\n  const context = useConnectedWeb3Context();\r\n  const emitter = getEmitter();\r\n\r\n  const refetch = query.refetch;\r\n\r\n  useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (error) {\r\n      logger.error(error)();\r\n    }\r\n  }, [error]);\r\n\r\n  useEffect(() => {\r\n    if (mounted.current) {\r\n      const info = query.data?.marketInfo;\r\n      if (info && mounted.current) {\r\n        setMarketStarted(info.marketStarted);\r\n      }\r\n    }\r\n  }, [query.data]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (mounted.current) {\r\n        if (state === DocumentState.Active) {\r\n          refetchAsync();\r\n        }\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetchAsync]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = () => {\r\n      if (mounted.current) {\r\n        refetch();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.MarketChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.MarketChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      if (mounted.current) {\r\n        if (e.punkId === parseInt(props.item.id)) {\r\n          refetchAsync();\r\n        }\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, props.item.id, refetchAsync]);\r\n\r\n  const formatBigNumber = (number: BigNumber, decimals: number = CommonConstants.CURRENCY_DECIMALS) => {\r\n    return TokenUtil.formatBigNumber(number, CommonConstants.CURRENCY_DECIMALS, decimals);\r\n  }\r\n\r\n  return (\r\n    <InfoContainer>\r\n      <Box sx={{ p: 3 }}>\r\n        <Typography variant=\"h5\" color=\"primary\" paragraph>{CommonConstants.PUNK_NAME} #{props.item.id}</Typography>\r\n        {props.item.attributes.length > 0 && (\r\n          <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n            {props.item.attributes?.map((a: string) => (\r\n              <Chip key={a} label={a} variant=\"outlined\" />\r\n            ))}\r\n          </Stack>\r\n        )}\r\n        {error ? (\r\n          <Alert message={FormatUtil.formatMessage(error)} type=\"warning\"></Alert>\r\n        ) : (\r\n          <>\r\n            <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n              <Typography display=\"inline\">\r\n                <b>Owner</b>:\r\n              </Typography>\r\n              {loading ? (\r\n                <Skeleton animation=\"wave\" height={24} width=\"40%\" sx={{ display: \"inline\" }} />\r\n              ) : (\r\n                <Typography display=\"inline\" component=\"div\">\r\n                  {!punkExtended.owner ? (\r\n                    <>\r\n                      Not minted yet.\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <ExplorerLink type={ExplorerLinkType.Address} value={punkExtended.owner}>\r\n                        <ExtendedBootstrapTooltip title={punkExtended.owner}>\r\n                          <span>{CommonUtil.truncateStringInTheMiddle(punkExtended.owner, 20, 5)}</span>\r\n                        </ExtendedBootstrapTooltip>\r\n                      </ExplorerLink>\r\n                      {context.account && punkExtended.owner.toLowerCase() === context.account.toLowerCase() && (\r\n                        <Chip size=\"small\" icon={<Verified />} label=\"You own this punk\" variant=\"filled\" sx={{ borderRadius: 1, ml: 1 }} color=\"secondary\" />\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </Typography>\r\n              )}\r\n            </Stack>\r\n            <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n              <Typography display=\"inline\">\r\n                <b>Current bid</b>:\r\n              </Typography>\r\n              {loading ? (\r\n                <Skeleton animation=\"wave\" height={24} width=\"60%\" sx={{ display: \"inline\" }} />\r\n              ) : (\r\n                <Typography display=\"inline\">\r\n                  {!punkExtended.bid ? (\r\n                    <>\r\n                      -\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <BootstrapTooltip title={formatBigNumber(punkExtended.bid.amount)}>\r\n                        <span>{formatBigNumber(punkExtended.bid.amount, 4)} {CommonConstants.CURRENCY_NAME}</span>\r\n                      </BootstrapTooltip>\r\n                      &nbsp;by <ExplorerLink type={ExplorerLinkType.Address} value={punkExtended.bid.bidder}><ExtendedBootstrapTooltip title={punkExtended.bid.bidder}>\r\n                        <span>{CommonUtil.truncateStringInTheMiddle(punkExtended.bid.bidder, 10, 5)}</span>\r\n                      </ExtendedBootstrapTooltip></ExplorerLink>\r\n                    </>\r\n                  )}\r\n                </Typography>\r\n              )}\r\n            </Stack>\r\n            <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n              {(loading || punkExtended.offer) ? (\r\n                <>\r\n                  <Typography display=\"inline\">\r\n                    <b>Current sale offer</b>:\r\n                  </Typography>\r\n                  {loading ? (\r\n                    <Skeleton animation=\"wave\" height={24} width=\"30%\" sx={{ display: \"inline\" }} />\r\n                  ) : (\r\n                    <Typography display=\"inline\">\r\n                      {!punkExtended.offer ? (\r\n                        <>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <BootstrapTooltip title={formatBigNumber(punkExtended.offer.minAmount)}>\r\n                            <span>{formatBigNumber(punkExtended.offer.minAmount, 4)} {CommonConstants.CURRENCY_NAME}</span>\r\n                          </BootstrapTooltip>\r\n                          {punkExtended.offer.onlySellTo && !CommonUtil.isNullOrWhitespace(punkExtended.offer.onlySellTo) && (\r\n                            <>\r\n                              &nbsp;(<ExplorerLink type={ExplorerLinkType.Address} value={punkExtended.offer.onlySellTo}><ExtendedBootstrapTooltip title={punkExtended.offer.onlySellTo}>\r\n                                <span>{CommonUtil.truncateStringInTheMiddle(punkExtended.offer.onlySellTo, 10, 5)}</span>\r\n                              </ExtendedBootstrapTooltip></ExplorerLink>)\r\n                            </>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </Typography>\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <Chip label=\"Not for sale\" variant=\"filled\" sx={{ borderRadius: 1 }} />\r\n              )}\r\n            </Stack>\r\n          </>\r\n        )}\r\n        <BottomContent>\r\n          <PunkInfoActions marketStarted={marketStarted} item={punkExtended} refetchAsync={refetchAsync}></PunkInfoActions>\r\n        </BottomContent>\r\n      </Box>\r\n    </InfoContainer>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { Container, Grid } from '@mui/material';\r\nimport React from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { GET_PUNK_QUERY } from '../../../../queries';\r\nimport { GetPunk, GetPunkVariables } from '../../../../queries/__generated__/GetPunk';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { PunkActivity } from '../activity';\r\nimport { PunkImage } from '../image';\r\nimport { PunkInfo } from '../info';\r\n\r\nexport const PunkDetails: React.FC = (props: any) => {\r\n  const { id } = useParams();\r\n\r\n  const query = useQuery<GetPunk, GetPunkVariables>(GET_PUNK_QUERY, {\r\n    variables: {\r\n      id: id ?? \"-1\"\r\n    },\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  const error = query.error;\r\n  const loading = query.loading;\r\n\r\n  if (error) {\r\n    return <Alert message={FormatUtil.formatMessage(error)} type=\"warning\"></Alert>\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {loading || !query.data ? (\r\n        <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n      ) : (\r\n        <Container maxWidth=\"lg\">\r\n          <Grid container spacing={3} direction=\"row\" marginBottom={3}>\r\n            <Grid item xs={12} md={5}>\r\n              <PunkImage image={query.data.punk.image}></PunkImage>\r\n            </Grid>\r\n            <Grid item xs={12} md={7}>\r\n              <PunkInfo item={query.data.punk}></PunkInfo>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n              <PunkActivity item={query.data.punk}></PunkActivity>\r\n            </Grid>\r\n          </Grid>\r\n        </Container>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Slide, SlideProps } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { GlobalEvent } from '../../../../util/types';\r\n\r\nconst Transition = React.forwardRef(function Transition(props: SlideProps, ref: React.Ref<unknown>) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\nexport const ConfirmTransactionDialog: React.FC = () => {\r\n  const [open, setOpen] = useState(false);\r\n  const emitter = getEmitter();\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (open: boolean) => {\r\n      setOpen(open)\r\n    }\r\n    emitter.on(GlobalEvent.ConfirmTransactionDialog, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.ConfirmTransactionDialog, handleEvent)\r\n    };\r\n  }, [emitter, setOpen])\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      TransitionComponent={Transition}\r\n      keepMounted\r\n      onClose={handleClose}\r\n      style={{ zIndex: 9999 }}\r\n    >\r\n      <DialogTitle>ViteConnect</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          Please confirm transaction on VITE Wallet App\r\n        </DialogContentText>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose} color=\"primary\">\r\n          Close\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { ApolloClient, FetchPolicy, NormalizedCacheObject } from \"@apollo/client\";\r\nimport { getApolloClient } from \"../clients/apollo.client\";\r\nimport { CommonConfig } from \"../common/config\";\r\nimport { GET_QUOTA_QUERY } from \"../queries/general\";\r\nimport { GetQuota, GetQuotaVariables } from \"../queries/__generated__/GetQuota\";\r\n\r\nclass GeneralService {\r\n  private readonly _apollo: ApolloClient<NormalizedCacheObject>;\r\n\r\n  constructor() {\r\n    this._apollo = getApolloClient();\r\n  }\r\n\r\n  getContractQuota = (_fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetQuota, GetQuotaVariables>({\r\n      query: GET_QUOTA_QUERY,\r\n      variables: {\r\n        address: CommonConfig.CONTRACT_ADDRESS\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n}\r\n\r\nconst service = new GeneralService();\r\n\r\nexport const getGeneralService = () => {\r\n  return service;\r\n}","import LaunchIcon from '@mui/icons-material/Launch';\r\nimport { Alert, Button, Container, Stack, Typography } from '@mui/material';\r\nimport { styled } from '@mui/system';\r\nimport BigNumber from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getGeneralService } from '../../../../services/general.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { GlobalEvent, ViteQuotaResult } from '../../../../util/types';\r\nimport { BootstrapTooltip } from '../../../common/components/tooltip';\r\n\r\nconst logger = getLogger();\r\n\r\nconst QuotaContainer = styled(Container)(({ theme }) => (`\r\n  position: absolute;\r\n  top: 64px;\r\n  right: 0;\r\n  width: 100%;\r\n  z-index: 9999;\r\n`));\r\n\r\nconst QuotaAlert = styled(Alert)(({ theme }) => (`\r\n  float: right;\r\n  background-color: rgba(255, 255, 255);\r\n`));\r\n\r\nexport const ContractQuota: React.FC = (props: any) => {\r\n  const mounted = React.useRef(false);\r\n  const [quota, setQuota] = useState<ViteQuotaResult>({\r\n    currentQuota: new BigNumber(\"0\"),\r\n    maxQuota: new BigNumber(\"0\"),\r\n    stakeAmount: new BigNumber(\"0\")\r\n  });\r\n  const [showContainer, setShowContainer] = useState<boolean>(false);\r\n  const service = getGeneralService();\r\n  const emitter = getEmitter();\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let interval: NodeJS.Timeout;\r\n    if (showContainer) {\r\n      interval = setInterval(async () => {\r\n        const result = await service.getContractQuota();\r\n        logger.info(result.data.quota)();\r\n        if (mounted.current && result.data.quota) {\r\n          const quotaResult = result.data.quota as ViteQuotaResult;\r\n          if (quotaResult.currentQuota.gte(quotaResult.maxQuota)) {\r\n            clearInterval(interval);\r\n            setShowContainer(false);\r\n          }\r\n          setQuota({\r\n            currentQuota: quotaResult.currentQuota,\r\n            maxQuota: quotaResult.maxQuota,\r\n            stakeAmount: quotaResult.stakeAmount\r\n          });\r\n        }\r\n      }, 2000);\r\n    }\r\n    return () => {\r\n      logger.info(\"clearInterval(interval)\")();\r\n      if (interval) {\r\n        clearInterval(interval);\r\n      }\r\n    }\r\n  }, [service, showContainer]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (_address: string, _quota: ViteQuotaResult) => {\r\n      if (mounted.current && CommonConstants.QUOTA_THRESHOLD.gte(_quota.currentQuota.minus(CommonConstants.QUOTA_THRESHOLD))) {\r\n        setQuota({\r\n          currentQuota: _quota.currentQuota,\r\n          maxQuota: _quota.maxQuota,\r\n          stakeAmount: _quota.stakeAmount\r\n        });\r\n        setShowContainer(true);\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.QuotaChanged, handleEvent);\r\n    return () => {\r\n      logger.info(\"emitter.off(GlobalEvent.QuotaChanged, handleEvent)\")();\r\n      emitter.off(GlobalEvent.QuotaChanged, handleEvent);\r\n    };\r\n  }, [emitter]);\r\n\r\n  const formatBigNumber = (bn: BigNumber, decimals: number = CommonConstants.CURRENCY_DECIMALS) => {\r\n    return TokenUtil.formatBigNumber(bn, 0, decimals);\r\n  }\r\n\r\n  if (!showContainer || quota.maxQuota.eq(0)) {\r\n    return (\r\n      <>\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <QuotaContainer maxWidth=\"xl\">\r\n      <QuotaAlert icon={false} severity=\"info\" onClose={() => { setShowContainer(false) }} sx={{ mt: 3, mr: 2 }}>\r\n        <Typography marginBottom={1} paragraph>\r\n          <b>Contract quota is recharging...</b>\r\n        </Typography>\r\n        <BootstrapTooltip title={formatBigNumber(quota.currentQuota)} placement=\"left\" arrow>\r\n          <Typography marginBottom={1} paragraph>\r\n            {formatBigNumber(quota.currentQuota, 6)} / {formatBigNumber(quota.maxQuota, 6)}\r\n          </Typography>\r\n        </BootstrapTooltip>\r\n        <Typography marginBottom={1}>You can help by staking {CommonConstants.CURRENCY_NAME}</Typography>\r\n        <Stack spacing={1} direction=\"row\">\r\n          <Typography>What does this mean?</Typography>\r\n          <Button variant=\"outlined\" size=\"small\" href={CommonConstants.QUOTA_WIKI_URL} target=\"_blank\" endIcon={<LaunchIcon />}>\r\n            More info\r\n          </Button>\r\n        </Stack>\r\n      </QuotaAlert>\r\n    </QuotaContainer>\r\n  )\r\n}\r\n","import { useSnackbar } from 'notistack';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { HashRouter, Route, Routes } from 'react-router-dom';\r\nimport { CommonConfig } from '../../../../common/config';\r\nimport { getCommonContext } from '../../../../contexts/common.context';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { DocumentState, GlobalEvent } from '../../../../util/types';\r\nimport { AccountDetails } from '../../../account/components/details';\r\nimport { Test } from '../../../common/components/test';\r\nimport { TestImage } from '../../../common/components/test-image';\r\nimport { LandingMain } from '../../../landing/components/main';\r\nimport { Header } from '../../../layout/components/header';\r\nimport { MainScroll } from '../../../layout/components/main-scroll';\r\nimport { MainWrapper } from '../../../layout/components/main-wrapper';\r\nimport { MarketplaceBrowse } from '../../../marketplace/components/browse';\r\nimport { MarketplaceItem } from '../../../marketplace/components/item';\r\nimport { MintDialog } from '../../../punk/components/dialog-mint';\r\nimport { PunkDetails } from '../../../punk/components/main';\r\nimport { ConfirmTransactionDialog } from '../dialog-transaction';\r\nimport { ContractQuota } from '../quota';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const Main: React.FC = (props: any) => {\r\n  const [visibility, setVisibility] = useState<DocumentState>(DocumentState.Unknown);\r\n  const emitter = getEmitter();\r\n  const context = getCommonContext();\r\n  const basename = CommonConfig.BASENAME ?? \"\";\r\n  SnackbarUtil.snackbar = useSnackbar();\r\n\r\n  useEffect(() => {\r\n    const handleEvent = async () => {\r\n      try {\r\n        await context.datasource.initAsync(context.network);\r\n        emitter.emitVisibilityChanged(CommonUtil.getDocumentState());\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.ReInit, handleEvent);\r\n    return () => {\r\n      logger.info(\"emitter.off(GlobalEvent.ReInit, handleEvent)\")();\r\n      emitter.off(GlobalEvent.ReInit, handleEvent);\r\n    };\r\n  }, [emitter, context.datasource, context.network]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = async () => {\r\n      const state = CommonUtil.getDocumentState();\r\n      if (visibility !== state) {\r\n        if (state === DocumentState.Active) {\r\n          // await context.datasource.initAsync(context.network);\r\n        }\r\n        logger.info(`visibilitychange before ${visibility} after ${state}`)();\r\n        setVisibility(state);\r\n        emitter.emitVisibilityChanged(state);\r\n      }\r\n    }\r\n    document.addEventListener('visibilitychange', handleEvent);\r\n    return () => {\r\n      logger.info(\"removeEventListener visibilitychange\")();\r\n      document.removeEventListener('visibilitychange', handleEvent);\r\n    };\r\n  }, [emitter, visibility, context.datasource, context.network]);\r\n\r\n  return (\r\n    <MainWrapper>\r\n      <HashRouter basename={basename}>\r\n        <Header />\r\n        <MainScroll>\r\n          <ContractQuota></ContractQuota>\r\n          <Routes>\r\n            <Route path=\"/account/:address\" element={<AccountDetails />} />\r\n            <Route path=\"/marketplace\" element={<MarketplaceBrowse />} />\r\n            <Route path=\"/marketplace/:tab\" element={<MarketplaceBrowse />} />\r\n            <Route path=\"/marketplace/item/:id\" element={<MarketplaceItem />} />\r\n            <Route path=\"/punk/:id\" element={<PunkDetails />} />\r\n            <Route path=\"/test-image\" element={<TestImage />} />\r\n            <Route path=\"/test\" element={<Test />} />\r\n            <Route path=\"/\" element={<LandingMain />} />\r\n          </Routes>\r\n          <MintDialog></MintDialog>\r\n          <ConfirmTransactionDialog></ConfirmTransactionDialog>\r\n        </MainScroll>\r\n      </HashRouter>\r\n    </MainWrapper>\r\n  )\r\n}\r\n","import { ApolloProvider } from '@apollo/client';\r\nimport { LocalizationProvider } from '@mui/lab';\r\nimport DateAdapter from '@mui/lab/AdapterMoment';\r\nimport { styled } from '@mui/material/styles';\r\nimport { SnackbarProvider } from 'notistack';\r\nimport React from 'react';\r\nimport { getApolloClient } from './clients/apollo.client';\r\nimport { CommonConstants } from './common/constants';\r\nimport { ConnectedWeb3 } from './contexts/connectedWeb3';\r\nimport { Web3Provider } from './contexts/web3';\r\nimport { Main } from './features/main/components/main';\r\n\r\nconst Background = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.BG_URL}');\r\n`,\r\n);\r\n\r\nconst App: React.FC = () => {\r\n  const apolloClient = React.useMemo(() => getApolloClient(), [])\r\n  // Almost never return exponential notation\r\n  // BigNumber.config({ EXPONENTIAL_AT: 1e+9 })\r\n  return (\r\n    <LocalizationProvider dateAdapter={DateAdapter}>\r\n      <Background>\r\n        <SnackbarProvider maxSnack={3}>\r\n          <ApolloProvider client={apolloClient}>\r\n            <Web3Provider>\r\n              <ConnectedWeb3>\r\n                <Main />\r\n              </ConnectedWeb3>\r\n            </Web3Provider>\r\n          </ApolloProvider>\r\n        </SnackbarProvider>\r\n      </Background>\r\n    </LocalizationProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { createTheme } from '@mui/material/styles';\r\n\r\n// A custom theme for this app\r\n// https://github.com/mui-org/material-ui/tree/master/examples/create-react-app-with-typescript\r\nconst theme = createTheme({\r\n  typography: {\r\n    fontFamily: [\r\n      '-apple-system',\r\n      'BlinkMacSystemFont',\r\n      '\"Segoe UI\"',\r\n      'Roboto',\r\n      '\"Helvetica Neue\"',\r\n      'Arial',\r\n      'sans-serif',\r\n      '\"Apple Color Emoji\"',\r\n      '\"Segoe UI Emoji\"',\r\n      '\"Segoe UI Symbol\"',\r\n    ].join(','),\r\n  },\r\n  palette: {\r\n    primary: {\r\n      main: '#133995',\r\n    },\r\n    secondary: {\r\n      main: '#6817ff',\r\n    }\r\n  },\r\n});\r\n\r\nexport default theme;","import CssBaseline from '@mui/material/CssBaseline';\r\nimport { ThemeProvider } from '@mui/material/styles';\r\nimport * as React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport './index.css';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport theme from './theme';\r\n\r\nReactDOM.render(\r\n  <ThemeProvider theme={theme}>\r\n    {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\r\n    <CssBaseline />\r\n    <App />\r\n  </ThemeProvider>,\r\n  document.querySelector('#root'),\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import { CommonConfig } from '../common/config';\r\nimport { CommonUtil } from './common.util';\r\n\r\nexport class LogEventModel {\r\n  banner?: string;\r\n  args?: any[];\r\n\r\n  public constructor(init?: Partial<LogEventModel>) {\r\n    Object.assign(this, init);\r\n  }\r\n}\r\n\r\nexport interface ILogger {\r\n  // Make sure level is selected e.g. 'Verbose' in Chrome\r\n  readonly debug: any;\r\n  readonly info: any;\r\n  readonly warn: any;\r\n  readonly error: any;\r\n}\r\n\r\nconst noop = (): any => undefined;\r\n\r\nexport class ConsoleLogger implements ILogger {\r\n\r\n  private get isEnabled(): boolean {\r\n    return CommonConfig.ENABLE_LOGGER;\r\n  }\r\n\r\n  get debug() {\r\n    if (this.isEnabled) {\r\n      return console.debug.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n\r\n  get info() {\r\n    if (this.isEnabled) {\r\n      return console.info.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n\r\n  get warn() {\r\n    if (this.isEnabled) {\r\n      return console.warn.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n\r\n  get error() {\r\n    if (this.isEnabled) {\r\n      return console.error.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n}\r\n\r\nexport class ExtendedConsoleLogger implements ILogger {\r\n\r\n  private get isEnabled(): boolean {\r\n    return CommonConfig.ENABLE_LOGGER;\r\n  }\r\n\r\n  private timestamp(type: string): string {\r\n    return `[${type} ${new Date().toLocaleTimeString()}]`;\r\n  }\r\n\r\n  private createLogEventModel(type: string, ...args: any[]): LogEventModel {\r\n    const mapFn = (e: any) => {\r\n      if (CommonUtil.isString(e)) {\r\n        return e;\r\n      } else if (e instanceof Error) {\r\n        return e.message;\r\n      }\r\n      return CommonUtil.toJsonString(e);\r\n    };\r\n    const result = new LogEventModel({\r\n      banner: this.timestamp(type),\r\n      args: args?.map(e => Array.isArray(e) ? e.map(e1 => mapFn(e1)) : mapFn(e))\r\n    });\r\n    return result;\r\n  }\r\n\r\n  get debug() {\r\n    if (this.isEnabled) {\r\n      return (...args: any[]) => {\r\n        const result = this.createLogEventModel('DEBUG', args);\r\n        return Function.prototype.bind.call(console.debug, console, result.banner, ...args);\r\n      };\r\n    } else {\r\n      return (...args: any[]) => {\r\n        return noop;\r\n      };\r\n    }\r\n  }\r\n\r\n  get info() {\r\n    if (this.isEnabled) {\r\n      return (...args: any[]) => {\r\n        const result = this.createLogEventModel('INFO', args);\r\n        return Function.prototype.bind.call(console.info, console, result.banner, ...args);\r\n      };\r\n    } else {\r\n      return (...args: any[]) => {\r\n        return noop;\r\n      };\r\n    }\r\n  }\r\n\r\n  get warn() {\r\n    if (this.isEnabled) {\r\n      return (...args: any[]) => {\r\n        const result = this.createLogEventModel('WARN', args);\r\n        return Function.prototype.bind.call(console.warn, console, result.banner, ...args);\r\n      };\r\n    } else {\r\n      return (...args: any[]) => {\r\n        return noop;\r\n      };\r\n    }\r\n  }\r\n\r\n  get error() {\r\n    return (...args: any[]) => {\r\n      if (args?.length > 0) {\r\n        if (!CommonUtil.isString(args[0])) {\r\n          args.push('(See console output for more information.)');\r\n        }\r\n      }\r\n      const result = this.createLogEventModel('ERROR', args);\r\n      return Function.prototype.bind.call(console.error, console, result.banner, ...args);\r\n    };\r\n  }\r\n}\r\n\r\nconst logger = new ExtendedConsoleLogger();\r\n\r\nexport const getLogger = (): ILogger => {\r\n  return logger;\r\n}","import EventEmitter from 'events';\r\nimport { DocumentState, GlobalEvent, MarketChangedEvent, PunkChangedEvent, PunkFilterValues, ViteQuotaResult } from './types';\r\n\r\nexport interface IGlobalEmitter {\r\n  emitReInit(): void\r\n  emitVisibilityChanged(state: DocumentState): void\r\n  emitConfirmTransactionDialog(open: boolean): void\r\n  emitConnectWalletDialog(open: boolean): void\r\n  emitQuotaChanged(address: string, quota: ViteQuotaResult): void\r\n  emitMarketChanged(event: MarketChangedEvent): void\r\n  emitPunkChanged(event: PunkChangedEvent): void\r\n  emitPunkFilterValuesChanged(oldValues: PunkFilterValues, newValues: PunkFilterValues): void\r\n  on(event: string | symbol, listener: (...args: any[]) => void): this\r\n  off(event: string | symbol, listener: (...args: any[]) => void): this\r\n}\r\n\r\nexport class GlobalEmitter extends EventEmitter implements IGlobalEmitter {\r\n  emitReInit(): void {\r\n    this.emit(GlobalEvent.ReInit)\r\n  }\r\n  emitVisibilityChanged(state: DocumentState): void {\r\n    this.emit(GlobalEvent.DocumentVisibilityChanged, state)\r\n  }\r\n  emitConfirmTransactionDialog(open: boolean): void {\r\n    this.emit(GlobalEvent.ConfirmTransactionDialog, open)\r\n  }\r\n  emitConnectWalletDialog(open: boolean): void {\r\n    this.emit(GlobalEvent.ConnectWalletDialog, open)\r\n  }\r\n  emitQuotaChanged(address: string, quota: ViteQuotaResult): void {\r\n    this.emit(GlobalEvent.QuotaChanged, address, quota);\r\n  }\r\n  emitMarketChanged(event: MarketChangedEvent): void {\r\n    this.emit(GlobalEvent.MarketChanged, event);\r\n  }\r\n  emitPunkChanged(event: PunkChangedEvent): void {\r\n    this.emit(GlobalEvent.PunkChanged, event);\r\n  }\r\n  emitPunkFilterValuesChanged(oldValues: PunkFilterValues, newValues: PunkFilterValues): void {\r\n    this.emit(GlobalEvent.PunkFilterValuesChanged, oldValues, newValues)\r\n  }\r\n}\r\n\r\nconst emitter = new GlobalEmitter();\r\n\r\nexport const getEmitter = (): IGlobalEmitter => {\r\n  return emitter;\r\n}\r\n","export abstract class CommonConfig {\r\n  static get IS_PRODUCTION(): boolean {\r\n    if (!process.env.REACT_APP_IS_PRODUCTION) {\r\n      throw new Error(\"REACT_APP_IS_PRODUCTION is not defined\");\r\n    }\r\n    return process.env.REACT_APP_IS_PRODUCTION === \"true\";\r\n  }\r\n  static get CONTRACT_ADDRESS(): string {\r\n    if (!process.env.REACT_APP_CONTRACT_ADDRESS) {\r\n      throw new Error(\"REACT_APP_CONTRACT_ADDRESS is not defined\");\r\n    }\r\n    return process.env.REACT_APP_CONTRACT_ADDRESS;\r\n  }\r\n  static get EXPLORER_URL(): string {\r\n    if (!process.env.REACT_APP_EXPLORER_URL) {\r\n      throw new Error(\"REACT_APP_EXPLORER_URL is not defined\");\r\n    }\r\n    return process.env.REACT_APP_EXPLORER_URL;\r\n  }\r\n  static get ENABLE_LOGGER(): boolean {\r\n    if (!process.env.REACT_APP_ENABLE_LOGGER) {\r\n      throw new Error(\"REACT_APP_ENABLE_LOGGER is not defined\");\r\n    }\r\n    return process.env.REACT_APP_ENABLE_LOGGER === \"true\";\r\n  }\r\n  static get ENABLE_MNEMONIC_LOGIN(): boolean {\r\n    if (!process.env.REACT_APP_ENABLE_MNEMONIC_LOGIN) {\r\n      throw new Error(\"REACT_APP_ENABLE_MNEMONIC_LOGIN is not defined\");\r\n    }\r\n    return process.env.REACT_APP_ENABLE_MNEMONIC_LOGIN === \"true\";\r\n  }\r\n  static get NETWORK_ID(): number {\r\n    if (!process.env.REACT_APP_NETWORK_ID) {\r\n      throw new Error(\"REACT_APP_NETWORK_ID is not defined\");\r\n    }\r\n    return parseInt(process.env.REACT_APP_NETWORK_ID);\r\n  }\r\n  static get BASENAME(): Maybe<string> {\r\n    return process.env.REACT_APP_BASENAME;\r\n  }\r\n}","export enum WalletType {\r\n  Web = 'Web',\r\n  Session = 'Session'\r\n}\r\n\r\nexport abstract class Wallet<T> {\r\n  private readonly _type: WalletType\r\n\r\n  active?: T\r\n  accounts: T[] = []\r\n\r\n  constructor(type: WalletType, init?: Partial<Wallet<T>>) {\r\n    this._type = type\r\n    this.baseInitinit(init)\r\n  }\r\n\r\n  static fromJS(data: any): Maybe<WebWallet | SessionWallet> {\r\n    data = typeof data === 'object' ? data : {}\r\n    switch (data._type) {\r\n      case WalletType.Web:\r\n        return new WebWallet(data)\r\n      case WalletType.Session:\r\n        return new SessionWallet(data)\r\n      default:\r\n        break\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  get type(): WalletType {\r\n    return this._type\r\n  }\r\n\r\n  protected abstract createAccount(data: any): T\r\n\r\n  private baseInitinit(data?: any): void {\r\n    if (data) {\r\n      this.active = data.active ? this.createAccount(data.active) : undefined\r\n      if (data.accounts && Array.isArray(data.accounts)) {\r\n        data.accounts.forEach((account: any) => {\r\n          this.accounts.push(this.createAccount(account))\r\n        })\r\n      }\r\n    }\r\n    if (!this.accounts) {\r\n      this.accounts = []\r\n    }\r\n  }\r\n}\r\n\r\nexport class WebWallet extends Wallet<WebWalletAccount> {\r\n  mnemonic!: string\r\n\r\n  constructor(init?: Partial<WebWallet>) {\r\n    super(WalletType.Web, init)\r\n    this.init(init)\r\n  }\r\n\r\n  init(data?: any): void {\r\n    if (data) {\r\n      this.mnemonic = data.mnemonic\r\n    }\r\n  }\r\n\r\n  protected createAccount(data: any): WebWalletAccount {\r\n    return new WebWalletAccount(data)\r\n  }\r\n}\r\n\r\nexport class SessionWallet extends Wallet<SessionWalletAccount> {\r\n  session!: string\r\n  timestamp!: number\r\n\r\n  constructor(init?: Partial<SessionWallet>) {\r\n    super(WalletType.Session, init)\r\n    this.init(init)\r\n  }\r\n\r\n  init(data?: any): void {\r\n    if (data) {\r\n      this.session = data.session\r\n      this.timestamp = data.timestamp\r\n    }\r\n  }\r\n\r\n  protected createAccount(data: any): SessionWalletAccount {\r\n    return new SessionWalletAccount(data)\r\n  }\r\n}\r\n\r\nexport enum WalletAccountType {\r\n  Web = 'Web',\r\n  Session = 'Session'\r\n}\r\n\r\nexport abstract class WalletAccount {\r\n  private readonly _type: WalletAccountType\r\n\r\n  id!: string\r\n  address!: string\r\n\r\n  constructor(type: WalletAccountType, init?: Partial<WalletAccount>) {\r\n    this._type = type\r\n    this.baseInit(init)\r\n  }\r\n\r\n  static fromJS(data: any): Maybe<WalletAccount> {\r\n    data = typeof data === 'object' ? data : {}\r\n    switch (data._type) {\r\n      case WalletType.Web:\r\n        return new WebWalletAccount(data)\r\n      case WalletType.Session:\r\n        return new SessionWalletAccount(data)\r\n      default:\r\n        break\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  get type(): WalletAccountType {\r\n    return this._type\r\n  }\r\n\r\n  private baseInit(data?: any): void {\r\n    if (data) {\r\n      this.id = data.id\r\n      this.address = data.address\r\n    }\r\n  }\r\n}\r\n\r\nexport class WebWalletAccount extends WalletAccount {\r\n  privateKey!: string\r\n\r\n  constructor(init?: Partial<WebWalletAccount>) {\r\n    super(WalletAccountType.Web, init)\r\n    this.init(init)\r\n  }\r\n\r\n  init(data?: any): void {\r\n    if (data) {\r\n      this.privateKey = data.privateKey\r\n    }\r\n  }\r\n}\r\n\r\nexport class SessionWalletAccount extends WalletAccount {\r\n  constructor(init?: Partial<SessionWalletAccount>) {\r\n    super(WalletAccountType.Session, init)\r\n  }\r\n}","import Connector from '@vite/connector';\r\nimport { WalletManager } from '.';\r\nimport { getLogger } from '../util/logger';\r\nimport { SessionWallet, SessionWalletAccount } from './types';\r\n\r\nconst logger = getLogger()\r\n\r\nexport interface IWalletConnector {\r\n  readonly uri: string\r\n  createSession(): Promise<string>\r\n  sendTransactionAsync(...args: any): Promise<any>\r\n  signMessageAsync(...args: any): Promise<any>\r\n  killSessionAsync(): Promise<void>\r\n  on(event: string | symbol, listener: (...args: any[]) => void): this\r\n  off(event: string | symbol, listener: (...args: any[]) => void): this\r\n}\r\n\r\nexport class WalletConnector extends Connector implements IWalletConnector {\r\n  private readonly _walletManager: WalletManager;\r\n\r\n  constructor(walletManager: WalletManager, opts: any, meta?: any) {\r\n    super(opts, meta);\r\n    this._walletManager = walletManager;\r\n    this.on('connect', (err: any, payload: any) => {\r\n      logger.info('WalletConnector.connect', err, payload)()\r\n      const { accounts } = payload.params[0];\r\n      this.saveSession(accounts);\r\n    });\r\n    this.on('disconnect', (err: any, payload: any) => {\r\n      logger.info('WalletConnector.disconnect', err, payload)()\r\n      this.stopBizHeartBeat()\r\n      this._walletManager.removeWallet()\r\n    });\r\n    this.on('session_update', (err: any, payload: any) => {\r\n      logger.info('WalletConnector.session_update', err, payload)()\r\n      const session = payload[0];\r\n      if (session && session.accounts) {\r\n        this.saveSession(session.accounts);\r\n      }\r\n    });\r\n  }\r\n\r\n  get uri(): string {\r\n    return super.uri\r\n  }\r\n\r\n  on(event: string | symbol, listener: (...args: any[]) => void): this {\r\n    return super.on(event, listener)\r\n  }\r\n\r\n  off(event: string | symbol, listener: (...args: any[]) => void): this {\r\n    return super.off(event, listener)\r\n  }\r\n\r\n  saveSession(accounts: string[]): void {\r\n    if (!accounts || !accounts[0]) {\r\n      throw new Error('address is null');\r\n    }\r\n    const sessionAccounts: SessionWalletAccount[] = []\r\n    for (let index = 0; index < accounts.length; index++) {\r\n      const address = accounts[index];\r\n      sessionAccounts.push(new SessionWalletAccount({\r\n        id: index.toString(),\r\n        address: address\r\n      }))\r\n    }\r\n    const wallet = new SessionWallet({\r\n      active: sessionAccounts[0],\r\n      accounts: sessionAccounts,\r\n      session: this.session,\r\n      timestamp: new Date().getTime()\r\n    })\r\n    this._walletManager.setWallet(wallet)\r\n  }\r\n\r\n  updateSession(): void {\r\n    const existing = this._walletManager.getWallet()\r\n    if (existing && existing instanceof SessionWallet) {\r\n      existing.timestamp = new Date().getTime()\r\n      this._walletManager.updateWalletStore(existing)\r\n    }\r\n  }\r\n\r\n  async createSession(): Promise<string> {\r\n    await super.createSession();\r\n    return this.uri;\r\n  }\r\n\r\n  async sendTransactionAsync(...args: any): Promise<any> {\r\n    return new Promise((res, rej) => {\r\n      this.on('disconnect', () => {\r\n        rej(\"Request aborted due to disconnect.\");\r\n      });\r\n\r\n      this.sendCustomRequest({ method: 'vite_signAndSendTx', params: args }).then((r: any) => {\r\n        this.updateSession();\r\n        res(r);\r\n      }).catch((e: any) => {\r\n        rej(e);\r\n      });\r\n    });\r\n  }\r\n\r\n  async signMessageAsync(...args: any): Promise<any> {\r\n    return new Promise((res, rej) => {\r\n      this.on('disconnect', () => {\r\n        rej(\"Request aborted due to disconnect.\");\r\n      });\r\n\r\n      this.sendCustomRequest({ method: 'vite_signMessage', params: args }).then((r: any) => {\r\n        this.updateSession();\r\n        res(r);\r\n      }).catch((e: any) => {\r\n        rej(e);\r\n      });\r\n    });\r\n  }\r\n\r\n  async killSessionAsync(): Promise<any> {\r\n    await super.killSession();\r\n  }\r\n}","import { IWalletConnector, WalletConnector, WalletManager } from '.';\r\nimport { CommonUtil } from '../util/common.util';\r\nimport { getLogger } from '../util/logger';\r\nimport { Network } from '../util/types';\r\n\r\nconst logger = getLogger()\r\n\r\nexport class WalletConnectorFactory {\r\n  private readonly _walletManager: WalletManager\r\n\r\n  constructor(walletManager: WalletManager) {\r\n    this._walletManager = walletManager\r\n  }\r\n\r\n  private get session(): Maybe<string> {\r\n    return this._walletManager.getValidSession()\r\n  }\r\n\r\n  private createConnector(network: Network): IWalletConnector {\r\n    const account = this._walletManager.getActiveAccount()\r\n    const opts = {\r\n      bridge: network.connectorUrl,\r\n      session: this.session\r\n    }\r\n    const meta = account ? { lastAccount: account.address } : undefined\r\n    const connector = new WalletConnector(this._walletManager, opts, meta)\r\n    return connector\r\n  }\r\n\r\n  create(network: Network): IWalletConnector {\r\n    const connector = this.createConnector(network)\r\n\r\n    if (!this.session) {\r\n      connector.createSession().then(() => logger.info('IWalletConnector connected', connector.uri)())\r\n    }\r\n\r\n    return connector\r\n  }\r\n\r\n  async createAsync(network: Network): Promise<IWalletConnector> {\r\n    const connector = this.createConnector(network)\r\n\r\n    if (!this.session) {\r\n      await CommonUtil.timeout(1000)\r\n      await connector.createSession()\r\n      logger.info('IWalletConnector connected', connector.uri)()\r\n    }\r\n\r\n    return connector\r\n  }\r\n}","import { SessionWallet, Wallet, WebWallet } from '.';\r\nimport { CommonConstants } from '../common/constants';\r\nimport { getLogger } from '../util/logger';\r\nimport { WalletType } from './types';\r\n\r\nconst logger = getLogger()\r\n\r\nexport class WalletStore {\r\n\r\n  private readonly _webWalletKey = CommonConstants.WEB_WALLET_STORAGE_SPACE;\r\n  private readonly _sessionWalletKey = CommonConstants.SESSION_WALLET_STORAGE_SPACE\r\n\r\n  clear(): void {\r\n    localStorage.removeItem(this._webWalletKey);\r\n    sessionStorage.removeItem(this._sessionWalletKey);\r\n  }\r\n\r\n  getItem(): Maybe<WebWallet | SessionWallet> {\r\n    let data;\r\n\r\n    try {\r\n      data = localStorage.getItem(this._webWalletKey);\r\n      if (!data) {\r\n        data = sessionStorage.getItem(this._sessionWalletKey);\r\n      }\r\n    } catch (err) {\r\n      logger.error(err)();\r\n      return undefined;\r\n    }\r\n\r\n    if (!data) {\r\n      return undefined;\r\n    }\r\n\r\n    try {\r\n      return Wallet.fromJS(JSON.parse(data));\r\n    } catch (err) {\r\n      logger.error(err)();\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  setItem(data: WebWallet | SessionWallet): void {\r\n    const saveData = JSON.stringify(data);\r\n\r\n    try {\r\n      switch (data.type) {\r\n        case WalletType.Web:\r\n          localStorage.setItem(this._webWalletKey, saveData);\r\n          break;\r\n        case WalletType.Session:\r\n          sessionStorage.setItem(this._sessionWalletKey, saveData);\r\n          break;\r\n        default:\r\n          throw new Error(`Wallet type '${data.type}' is not supported.`)\r\n      }\r\n    } catch (err) {\r\n      logger.error(err)();\r\n    }\r\n  }\r\n}","import { wallet } from '@vite/vitejs';\r\nimport { SessionWallet, WalletAccount, WebWallet, WebWalletAccount } from '.';\r\nimport { getLogger } from '../util/logger';\r\nimport { WalletStore } from './store';\r\n\r\nconst logger = getLogger()\r\n\r\nexport class WalletManager {\r\n  private readonly _store: WalletStore;\r\n  private _wallet?: WebWallet | SessionWallet;\r\n  private _mnemonicDeriveIndex = 0;\r\n  private _setWalletCallback?: (wallet?: WebWallet | SessionWallet | undefined) => void;\r\n\r\n  constructor() {\r\n    this._store = new WalletStore();\r\n  }\r\n\r\n  initWallet(): void {\r\n    const wallet = this._store.getItem();\r\n    if (wallet) {\r\n      this._wallet = wallet;\r\n      this._mnemonicDeriveIndex = wallet.accounts.length;\r\n      this.updateWallet();\r\n    }\r\n  }\r\n\r\n  set onSetWalletCallback(cb: (wallet?: WebWallet | SessionWallet | undefined) => void) {\r\n    this._setWalletCallback = cb;\r\n  }\r\n\r\n  getWallet(): Maybe<WebWallet | SessionWallet> {\r\n    return this._wallet;\r\n  }\r\n\r\n  setWallet(wallet?: WebWallet | SessionWallet): void {\r\n    this._wallet = wallet;\r\n    this.updateWalletStore(wallet)\r\n    this.updateWallet()\r\n  }\r\n\r\n  updateWallet(): void {\r\n    if (this._setWalletCallback) {\r\n      this._setWalletCallback(this._wallet);\r\n    }\r\n  }\r\n\r\n  updateWalletStore(wallet?: WebWallet | SessionWallet): void {\r\n    if (wallet) {\r\n      this._store.setItem(wallet);\r\n    }\r\n  }\r\n\r\n  createWebWallet(mnemonic: string): Maybe<WebWallet> {\r\n    if (!this.validateMnemonic(mnemonic)) {\r\n      return undefined;\r\n    }\r\n    this.resetWallet();\r\n    const account = this.createWebWalletAccount(mnemonic, 0);\r\n    const wallet = new WebWallet({\r\n      active: account,\r\n      mnemonic,\r\n      accounts: [\r\n        account\r\n      ]\r\n    });\r\n    this.setWallet(wallet);\r\n    return wallet;\r\n  }\r\n\r\n  removeWallet(): void {\r\n    this.resetWallet();\r\n    this.updateWallet();\r\n  }\r\n\r\n  getAccountByAddress(address: string): Maybe<WalletAccount> {\r\n    return this._wallet?.accounts?.find(e => e.address === address)\r\n  }\r\n\r\n  addAccount(): Maybe<WalletAccount> {\r\n    if (this._wallet instanceof WebWallet) {\r\n      const account = this.createWebWalletAccount(this._wallet.mnemonic);\r\n      this._wallet.accounts.push(account);\r\n      this.setActiveAccount(account);\r\n      return account;\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  getActiveAccount(): Maybe<WalletAccount> {\r\n    return this._wallet?.active\r\n  }\r\n\r\n  setActiveAccount(account: WalletAccount): boolean {\r\n    if (this._wallet) {\r\n      this._wallet.active = account;\r\n      this._store.setItem(this._wallet);\r\n      this.updateWallet();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getAccounts(): WalletAccount[] {\r\n    if (this._wallet) {\r\n      return this._wallet.accounts;\r\n    }\r\n    return [];\r\n  }\r\n\r\n  getValidSession(): Maybe<string> {\r\n    const wallet = this._store.getItem();\r\n    if (wallet && wallet instanceof SessionWallet) {\r\n      if (new Date().getTime() - wallet.timestamp < 1000 * 60 * 10) {\r\n        return wallet.session;\r\n      } else {\r\n        logger.info('Found expired session.', wallet)();\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private resetWallet(): void {\r\n    this._wallet = undefined;\r\n    this._mnemonicDeriveIndex = 0;\r\n    this._store.clear();\r\n  }\r\n\r\n  private createWebWalletAccount(mnemonic: string, index = this._mnemonicDeriveIndex): WebWalletAccount {\r\n    const { privateKey } = wallet.deriveAddress({\r\n      mnemonics: mnemonic,\r\n      index\r\n    });\r\n    let account = new WebWalletAccount({\r\n      id: index.toString(),\r\n      privateKey,\r\n      address: wallet.createAddressByPrivateKey(privateKey).address\r\n    });\r\n    this._mnemonicDeriveIndex = index + 1;\r\n    return account;\r\n  }\r\n\r\n  private validateMnemonic(mnemonic: Maybe<string>): Boolean {\r\n    if (mnemonic) {\r\n      return wallet.validateMnemonics(mnemonic);\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nconst manager = new WalletManager();\r\n\r\nexport const getWalletManager = () => {\r\n  return manager;\r\n}","/* tslint:disable */\n/* eslint-disable */\n// @generated\n// This file was automatically generated and should not be edited.\n\n//==============================================================\n// START Enums and Input Objects\n//==============================================================\n\nexport enum OrderBy {\n  ASC = \"ASC\",\n  DESC = \"DESC\",\n}\n\nexport enum PunkSortBy {\n  ID = \"ID\",\n  RANK = \"RANK\",\n}\n\n//==============================================================\n// END Enums and Input Objects\n//==============================================================\n"],"sourceRoot":""}