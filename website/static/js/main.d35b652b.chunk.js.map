{"version":3,"sources":["clients/vite.client.ts","util/types.ts","common/constants.ts","util/common.util.ts","util/retry.util.ts","util/task.ts","util/file.util.ts","search/punk.search.ts","util/compress.util.ts","util/ensure.ts","contracts/punks.contract.ts","util/filter.util.ts","util/moment.util.ts","datasources/base.datasource.ts","util/transform.util.ts","datasources/mock.datasource.ts","util/format.util.ts","contracts/base.contract.ts","datasources/vite.datasource.ts","contexts/common.context.ts","mutations/market.ts","mutations/punk.ts","queries/punk.ts","queries/market.ts","queries/general.ts","clients/apollo.client.ts","common/network.ts","features/layout/components/footer/component.tsx","features/layout/components/header-loading/component.tsx","features/layout/components/main-scroll/component.tsx","features/layout/components/main-wrapper/component.tsx","contexts/web3.tsx","contexts/connectedWeb3.tsx","features/main/components/loading/component.tsx","util/snackbar.util.ts","features/common/components/alert/component.tsx","util/url.util.ts","features/common/components/fa-icon/component.tsx","features/common/components/tooltip/component.tsx","features/marketplace/components/browse-item/component.tsx","features/account/components/details/component.tsx","features/common/components/test/component.tsx","services/punk.service.ts","features/landing/components/main-image/component.tsx","features/common/components/test-image/component.tsx","util/token.util.ts","features/common/components/click-once-button/component.tsx","features/common/components/countdown/component.tsx","features/landing/components/faq/component.tsx","features/landing/components/mints-remaining/component.tsx","features/landing/components/main/component.tsx","features/main/components/qrcode/component.tsx","features/main/components/login/component.tsx","features/layout/components/header/component.tsx","services/market.service.ts","util/icon.util.ts","util/explorer.util.ts","features/common/components/explorer-link/component.tsx","features/common/components/event-list/component.tsx","features/marketplace/components/browse-activity/component.tsx","features/marketplace/components/browse-items-filter/component.tsx","features/marketplace/components/browse-items/component.tsx","features/marketplace/components/browse/component.tsx","features/marketplace/components/item/component.tsx","features/punk/components/image/component.tsx","features/punk/components/dialog-mint/component.tsx","features/punk/components/activity/component.tsx","hooks/punk.hook.ts","features/punk/components/dialog-bid/component.tsx","features/punk/components/dialog-offer/component.tsx","features/punk/components/dialog/component.tsx","features/punk/components/info-actions/component.tsx","features/punk/components/info/component.tsx","features/punk/components/main/component.tsx","features/main/components/dialog-transaction/component.tsx","services/general.service.ts","features/main/components/quota/component.tsx","features/main/components/main/component.tsx","App.tsx","reportWebVitals.ts","theme.tsx","index.tsx","util/logger.ts","util/emitter.ts","common/config.ts","wallet/types.ts","wallet/connector.ts","wallet/factory.ts","wallet/store.ts","wallet/manager.ts","__generated__/globalTypes.ts"],"names":["WS_RPC","require","logger","getLogger","providerOptions","retryTimes","retryInterval","ViteClient","_network","_retryCount","_isConnected","_connector","_provider","_client","_emitter","_walletManager","_connectorFactory","initAsync","network","a","Promise","resolve","reject","info","create","rpcUrl","isResolved","on","emitReInit","err","error","ViteAPI","path","this","getEmitter","getWalletManager","WalletConnectorFactory","destroy","type","param","abiutils","encodeParameter","jsonFunction","methodName","encodeLogSignature","method","args","result","RetryUtil","promiseRetry","request","catch","message","toLowerCase","includes","CommonUtil","timeout","Error","requestAsync","BigNumber","address","blockCount","balanceInfoMap","CommonConstants","VITE_TOKEN_ID","balance","currentQuota","maxQuota","stakeAmount","account","toAddress","amount","tokenId","block","accountBlock","createAccountBlock","sendAccountBlockAsync","beneficiaryAddress","abi","params","binary","code","responseLatency","quotaMultiplier","randomDegree","contractAddress","offchaincode","data","encodeFunctionCall","dataBase64","Buffer","from","toString","selfAddr","offChainCode","resultBytes","outputs","i","length","push","offchainDecodeResult","decodeParameters","resultList","name","value","vmLog","topics","j","abiItem","decodeVmLogByAbiItem","topic","decodeLog","inputs","utils","_Buffer","slice","event","fromHeight","toHeight","gt","toFixed","payload","addressHeightRange","midHeight","plus","div","getEventsByBlockAsync","arr2","subscribe","unsubscribe","listener","results","console","log","decodeVmLog","vmlog","height","undefined","timestamp","Date","now","Task","blockByHeight","receiveBlockHash","blockByHash","getAccountBlockStatus","start","blocks","ab","sendBlockHash","hash","RECEIVE_PER_ROUND","receiveTransactionAsync","receiveAllOnroadTxAsync","WebWalletAccount","setProvider","setPrivateKey","privateKey","autoSetPreviousAccountBlock","sign","send","SessionWalletAccount","connector","emitConfirmTransactionDialog","sendTransactionAsync","status","resolveAccountBlockData","statusTxt","blockType","bytes","client","getViteClient","DocumentState","WalletType","OrderType","PunkSortType","PunkDialogType","PunkEventType","MarketplaceTab","MarketEventType","GlobalEvent","ViteQuotaType","VmLogEvent","TypeNames","Punk","PunkExtended","PunkEvent","APP_NAME","PUNK_NAME","USE_MOCK_DATASOURCE","NETWORK_ID","WEB_WALLET_STORAGE_SPACE","SESSION_WALLET_STORAGE_SPACE","BG_URL","ITEM_BG_URL","SAMPLE_PUNK_URL","LANDING_IMAGE_URL","QUOTA_WIKI_URL","DISCORD_URL","TWITTER_URL","GITHUB_URL","QUOTA_THRESHOLD","EXPLORER_URL","ZERO_ADDRESS","CURRENCY_NAME","CURRENCY_DECIMALS","TOTAL_MINTS","Networks","id","networkId","connectorUrl","PunkSortTypes","OrderBy","ASC","DESC","PunkSortBy","ID","RANK","PunkEventTypes","Unknown","Mint","Offer","NewBid","CancelBid","Buy","CancelOffer","DefaultPunkFilterValues","sortBy","orderBy","search","String","isNaN","parseInt","isFinite","isString","trim","defaultValue","isNullOrWhitespace","ms","setTimeout","JSON","stringify","encoding","Uint8Array","url","fetch","blob","min","max","Math","floor","random","current","goal","Big","mul","toNumber","total","rpp","page","uuidv4","_path","_appendix","appendix","startsWith","substring","endsWith","truncateString","str","maxLength","truncateStringInTheMiddle","strPositionStart","strPositionEnd","getDocumentState","document","visibilityState","Hidden","Active","fn","retries","task","interval","_taskTimer","_taskInterval","_task","_callback","_onStop","_run","callback","window","clearTimeout","FileUtilType","_index","clear","FlexsearchDocument","tag","index","punks","p","add","query","isNumber","mappedResult","split","limit","map","e","enrich","intersectedResult","intersection","ids","intersectionWith","o","CompressUtil","pako","gzip","to","ungzip","Ensure","property","propertyName","FileUtil","BrowserFileUtil","response","arrayBuffer","text","LocalFileUtil","fs","readFileSync","AbiItemType","getFileUtil","Browser","Local","FilterUtil","sort","order","Number","rank","MomentUtil","moment","locale","navigator","language","date","unix","utc","local","getLocal","format","getLocalTime","getLocalDate","unit","diff","duration","BaseDataSource","_moment","_fileUtil","_actionPrice","_mintPrice","_punkSearch","_punkAttributes","_punks","_punksFiltered","searchTerm","items","readFileAsync","attributes","parse","decompress","toUint8Array","punk","__typename","image","unshift","initPunkAttributesAsync","initPunksAsync","disposeProtected","getActiveAccount","notNull","punkId","_limit","_offset","_sort","_order","_search","hasChanged","sortPunks","getMarketInfoAsync","actionPrice","mintPrice","uuid","TransformUtil","number","toMaybeBigNumber","defaultBigNumber","getTime","accountBlockHash","accountBlockHeight","eventType","toBigNumber","fromAddress","MockDataSource","_events","clearMock","events","toPunkEvent","reverse","_address","_id","_height","blockHeight","filter","find","getPunkAsync","itemIndex","bidder","getPunkOwnerAsync","seller","minAmount","onlySellTo","marketStarted","mintsRemaining","shiftedBy","_tokenId","_amount","ds","FormatUtil","defaultMessage","graphQLErrors","substr","toLocaleString","BaseContract","_minQuota","_contract","objectFromEntries","entries","Object","fromEntries","entry","basePath","initAsyncProtected","_quota","getQuotaAsync","lte","_account","_methodName","_params","ensureQuotaAsync","callContractAsync","result1","waitForAccountBlockAsync","result2","formatMessage","stakeForQuotaAsync","logs","createAddressListenerAsync","PunksContract","_abiMap","Map","appendPath","punksContract","CommonConfig","CONTRACT_ADDRESS","set","getDeveloper","getAbiItem","getMarketInfo","isContract","balanceOf","ownerOf","getMappedIndex","totalSupply","getTokensOf","tokenURI","getBaseUrl","getOffer","getBid","transferEvent","marketChangedEvent","punkChangedEvent","_type","_name","_abiItemType","get","callOffChainMethodAsync","getAbiItemByType","offChain","_price","MintPrice","ActionPrice","toBoolean","market_started","mints_remaining","mint_price","action_price","_started","_owner","_refId","_indices","_startIndex","_baseUrl","_punkId","isForSale","hasBid","_minSalePrice","_fee","_minPrice","contract","ViteDataSource","_listener","handleVmLogAsync","removeListener","dispose","encodedLogSignature","getEventsFromHeight","getAccountBlockHeightAsync","toPunkEvents","ownerOfAsync","getTokensOfAsync","getBidAsync","getOfferAsync","checkQuotaAsync","getMintPriceAsync","mintAsync","getAccount","getFeeAsync","fee","offerToAddressAsync","offerAsync","cancelOfferAsync","buyAsync","enterBidAsync","acceptBidAsync","cancelBidAsync","MarketChanged","PunkChanged","marketEvent","emitMarketChanged","punkEvent","emitPunkChanged","Array","isArray","transformed","decoded","getActionPriceAsync","IS_PRODUCTION","quota","emitQuotaChanged","CommonContext","_datasource","initBaseAsync","context","getCommonContext","OFFER_MUTATION","gql","CANCEL_OFFER_MUTATION","BUY_MUTATION","BID_MUTATION","ACCEPT_BID_MUTATION","CANCEL_BID_MUTATION","MarketMutations","offer","parent","datasource","cancelOffer","buy","bid","bidAsync","acceptBid","cancelBid","MINT_MUTATION","PunkMutations","mint","PUNK_FIELDS","PUNK_EVENT_FIELDS","GET_PUNK_ATTRIBUTES_QUERY","GET_PUNK_EVENTS_QUERY","GET_PUNK_OWNER_QUERY","GET_PUNK_QUERY","GET_PUNKS_QUERY","GET_PUNKS_BY_ADDRESS_QUERY","PunkQueries","punkAttributes","getPunkAttributesAsync","punkEvents","offset","getPunkEventsAsync","punkOwner","getPunksAsync","punksByAddress","getPunksByAddressAsync","GET_MARKET_INFO_QUERY","GET_MARKET_BID_QUERY","GET_MARKET_OFFER_QUERY","GET_MARKET_EVENTS_QUERY","MarketQueries","marketInfo","marketBid","getMarketBidAsync","marketOffer","getMarketOfferAsync","marketEvents","getMarketEventsAsync","GET_QUOTA_QUERY","GeneralQueries","ApolloClientWrapper","ApolloClient","cache","InMemoryCache","typePolicies","Query","fields","offsetLimitPagination","resolvers","GraphQLScalarType","description","serialize","parseValue","Mutation","headers","process","getApolloClient","manager","_networkHeight","_setNetworkCallback","cb","getNetworkManager","Root","styled","theme","Footer","Typography","TitleTypography","HeaderLoading","props","AppBar","position","Toolbar","variant","MainScrollStyled","MainScrollInner","MainScroll","children","restProps","Container","maxWidth","MainWrapperStyled","MainWrapper","Web3Context","React","createContext","Web3Provider","useState","setError","wallet","setWallet","setNetwork","onSetWalletCallback","onSetNetworkCallback","Provider","ConnectedWeb3Context","useConnectedWeb3Context","useContext","ConnectedWeb3","connection","setConnection","web3Context","useWeb3Context","commonContext","useEffect","initWallet","networkManager","getNetwork","logout","useCallback","removeWallet","location","reload","active","SnackbarUtil","emitConnectWalletDialog","snackbar","enqueueSnackbar","Alert","color","backgroundColor","toJsonString","Paper","Box","sx","padding","textAlign","UrlUtil","FontAwesomeSvgIcon","forwardRef","ref","icon","width","svgPathData","SvgIcon","viewBox","d","style","opacity","ExtendedBootstrapTooltip","BootstrapTooltip","tooltipClasses","tooltip","className","Tooltip","classes","popper","palette","common","white","boxShadow","shadows","fontSize","arrow","black","CustomCardMedia","typography","pxToRem","border","PunkImage","MarketplaceBrowseItem","Card","CardActionArea","component","RouterLink","item","top","right","mr","title","placement","Chip","size","faGem","marginLeft","label","backgroundImage","getPunkUrl","CardContent","overflow","mb","EmptyResult","loading","AccountDetails","useParams","isLoading","setIsLoading","hasMore","setHasMore","useQuery","variables","fetchPolicy","fetchMoreDataAsync","currentLength","fetchMore","pt","gutterBottom","pb","dataLength","next","loader","Grid","container","spacing","justifyContent","alignItems","xs","md","scrollableTarget","marginBottom","sm","lg","Test","walletManager","viteClient","onClick","confetti","particleCount","spread","getWallet","Button","PunkService","_apollo","getById","_fetchPolicy","getOwnerAsync","getEventsAsync","getExtendedAsync","_punk","defaultPunkExtended","ownerQuery","bidQuery","offerQuery","punkExtended","owner","mutate","mutation","Boolean","service","getPunkService","ImageContainer","Image","Img1","Img2","LandingMainImage","imageUrl1","setImageUrl1","imageUrl2","setImageUrl2","setImageUrlsAsync","punkId1","punk1","punkId2","punk2","TestImage","TokenUtil","bn","tokenDecimals","decimals","pow","decimalPlaces","ROUND_DOWN","toFormat","ClickOnceButton","mounted","useRef","isDisabled","setIsDisabled","handleClick","callbackFn","enqueueError","LoadingButton","fullWidth","disabled","startIcon","Countdown","useMemo","getDuration","days","hours","minutes","seconds","state","setState","asSeconds","Accordion","disableGutters","elevation","square","divider","borderBottom","display","mode","AccordionSummary","expandIcon","flexDirection","transform","AccordionDetails","MuiAccordionDetails","borderTop","LandingFaq","faqExpanded","setFaqExpanded","handleChange","panel","newExpanded","expanded","onChange","Link","underline","href","target","marginTop","MintsRemaining","pct","setPct","minValue","px","Skeleton","animation","formatNumber","LinearProgress","LandingMain","displayNumber","setMintPrice","setMarketStarted","canMint","setCanMint","setMintsRemaining","emitter","punkService","refetch","handleEvent","DocumentVisibilityChanged","off","formatBigNumber","handleMintAsync","enqueueMessage","mt","direction","paragraph","toISOString","Stack","minWidth","alt","src","IconButton","faTwitter","faGithub","faDiscord","QrCode","elementRef","defaultOpt","ecLevel","HIGH","minVersion","background","modes","DRAW_WITH_IMAGE_BOX","radius","mSize","clientWidth","innerHTML","qrcode","generate","then","LoginDialog","uri","setUri","mnemonic","setMnemonic","onClose","open","setOpen","connectorFactory","handleCreateSession","createAsync","ConnectWalletDialog","Dialog","DialogTitle","DialogContent","DialogContentText","ENABLE_MNEMONIC_LOGIN","FormControl","InputLabel","htmlFor","Input","autoComplete","createWebWallet","Header","navigate","useNavigate","useTheme","matches","useMediaQuery","breakpoints","up","loginOpen","setLoginOpen","showAccount","textDecoration","Fragment","MarketService","getMarketService","IconUtil","getBuyEventTypeIcon","faDonate","getClaimEventTypeIcon","faGift","getOfferEventTypeIcon","faFileInvoiceDollar","getCancelSaleEventTypeIcon","faPowerOff","getCancelGiftEventTypeIcon","faEraser","getPunkEventTypeIcon","faTrophy","faHandHoldingUsd","faBan","faQuestion","ExplorerLinkType","ExplorerUtil","baseUrl","DEFAULT_BASE_URL","_tx","ExplorerLink","getUrl","Address","getAddressUrl","getTxUrl","setUrl","CustomAvatar","Avatar","CustomTableCell","TableCell","EventTableRow","momentUtil","TableRow","scope","getEventName","align","Transaction","getLocalReverseFormatted","getFromUnix","EventListLoading","EventList","newEvents","TableContainer","Table","stickyHeader","TableHead","TableBody","MarketplaceBrowseActivity","setEvents","setNewEvents","onCompleted","refresh","addNewEvent","MarketplaceBrowseItemsFilter","values","setValues","attributesQuery","emitEvent","oldValues","newValues","emitPunkFilterValuesChanged","Autocomplete","multiple","freeSolo","options","getOptionLabel","option","join","filterSelectedOptions","renderInput","TextField","FormGroup","Select","labelId","MenuItem","ToggleButtonGroup","exclusive","ToggleButton","MarketplaceLoading","MarketplaceBrowseItems","setFilter","PunkFilterValuesChanged","scrollThreshold","TabPanel","other","role","hidden","MarketplaceBrowse","initialValue","tab","Activity","setValue","borderColor","Tabs","newValue","Tab","MarketplaceItem","CardContainer","Img","maxHeight","MintDialog","setPunkId","punkImage","setPunkImage","zIndex","handleClose","transitionDuration","keepMounted","paddingBottom","DialogActions","PunkActivity","PunkBidDialog","setAmount","setDisabled","changeAmount","updateFee","handleConfirmAsync","refetchAsync","autoFocus","startAdornment","InputAdornment","PunkOfferDialog","setAddress","lt","placeholder","PunkDialog","setFee","BID","OFFER","PunkInfoActions","hasOwner","setHasOwner","showAll","showAny","showBuy","showClaim","showBid","showSell","showAcceptBid","showCancelBid","showCancelSale","showCancelGift","showButtonState","setShowButtonState","dialogState","setDialogState","isOwner","handleFailureAsync","handleBuyAsync","isClaim","actionName","handleAcceptBidAsync","handleCancelBidAsync","handleCancelSaleAsync","isGift","actName","handleOpenDialog","faCheck","InfoContainer","BottomContent","PunkInfo","down","setPunkExtended","dateRef","setDateRef","notifyOnNetworkStatusChange","refetchWritePolicy","all","newOwner","newBid","newOffer","usePunkInfo","Verified","borderRadius","ml","PunkDetails","Transition","Slide","ConfirmTransactionDialog","TransitionComponent","getContractQuota","QuotaContainer","QuotaAlert","ContractQuota","setQuota","showContainer","setShowContainer","setInterval","quotaResult","gte","clearInterval","minus","QuotaChanged","eq","severity","endIcon","Main","visibility","setVisibility","basename","BASENAME","useSnackbar","emitVisibilityChanged","ReInit","addEventListener","removeEventListener","element","Background","App","apolloClient","LocalizationProvider","dateAdapter","DateAdapter","maxSnack","ApolloProvider","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","createTheme","fontFamily","primary","main","secondary","ReactDOM","render","ThemeProvider","CssBaseline","querySelector","LogEventModel","init","banner","assign","noop","ExtendedConsoleLogger","ENABLE_LOGGER","toLocaleTimeString","mapFn","e1","isEnabled","createLogEventModel","prototype","bind","call","debug","warn","GlobalEmitter","emit","EventEmitter","WalletAccountType","Wallet","accounts","baseInitinit","createAccount","forEach","Web","WebWallet","Session","SessionWallet","session","WalletAccount","baseInit","WalletConnector","opts","meta","saveSession","stopBizHeartBeat","sessionAccounts","existing","updateWalletStore","res","rej","sendCustomRequest","r","updateSession","Connector","getValidSession","bridge","lastAccount","createConnector","createSession","WalletStore","_webWalletKey","_sessionWalletKey","localStorage","removeItem","sessionStorage","getItem","fromJS","saveData","setItem","WalletManager","_store","_wallet","_mnemonicDeriveIndex","_setWalletCallback","updateWallet","validateMnemonic","resetWallet","createWebWalletAccount","setActiveAccount","deriveAddress","mnemonics","createAddressByPrivateKey","validateMnemonics"],"mappings":"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","file":"static/js/main.d35b652b.chunk.js","sourcesContent":["import { abi as abiutils, accountBlock, utils, ViteAPI } from \"@vite/vitejs\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport { CommonConstants } from \"../common/constants\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getEmitter, IGlobalEmitter } from \"../util/emitter\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { RetryUtil } from \"../util/retry.util\";\r\nimport { Task } from \"../util/task\";\r\nimport { Network, ViteQuotaResult, ViteVmLog, ViteVmLogEvent, VmLog } from \"../util/types\";\r\nimport { getWalletManager, IWalletConnector, SessionWalletAccount, WalletAccount, WalletConnectorFactory, WalletManager, WebWalletAccount } from \"../wallet\";\r\nconst { WS_RPC } = require('@vite/vitejs-ws');\r\n\r\nconst logger = getLogger();\r\n\r\nconst providerTimeout = 10000;\r\nconst providerOptions = { retryTimes: 10, retryInterval: 1000 };\r\n\r\nexport class ViteClient {\r\n  private _network?: Network;\r\n  private _retryCount: number;\r\n  private _isConnected: boolean;\r\n  private _connector?: IWalletConnector;\r\n  private _provider?: any;\r\n  private _client?: any;\r\n  private readonly _emitter: IGlobalEmitter;\r\n  private readonly _walletManager: WalletManager;\r\n  private readonly _connectorFactory: WalletConnectorFactory;\r\n\r\n  constructor() {\r\n    this._retryCount = 0;\r\n    this._isConnected = false;\r\n    this._emitter = getEmitter();\r\n    this._walletManager = getWalletManager();\r\n    this._connectorFactory = new WalletConnectorFactory(this._walletManager);\r\n  }\r\n\r\n  get isConnected(): boolean {\r\n    return this._isConnected;\r\n  }\r\n\r\n  get connector(): Maybe<IWalletConnector> {\r\n    return this._connector;\r\n  }\r\n\r\n  initAsync = async (network: Network) => new Promise<void>((resolve, reject) => {\r\n    logger.info(\"initAsync\", network)();\r\n    this._network = network;\r\n    this._connector = this._connectorFactory.create(network);\r\n    this._provider = new WS_RPC(network.rpcUrl, providerTimeout, providerOptions);\r\n    let isResolved = false;\r\n    // https://github.com/vitelabs/vite.js/blob/master/src/WS/index.js\r\n    this._provider.on('close', () => {\r\n      logger.info('Vite provider closed')();\r\n      this._emitter.emitReInit();\r\n    });\r\n    this._provider.on('error', (err: any) => {\r\n      logger.error('Vite provider error', this._retryCount)();\r\n      if (isResolved) return;\r\n      this._isConnected = false;\r\n      if (this._retryCount >= providerOptions.retryTimes) {\r\n        reject(err);\r\n      } else {\r\n        this._retryCount++;\r\n      }\r\n    });\r\n    this._client = new ViteAPI(this._provider, () => {\r\n      logger.info(`ViteAPI connected to ${this._provider.path}`)();\r\n      isResolved = true;\r\n      this._retryCount = 0;\r\n      this._isConnected = true;\r\n      resolve();\r\n    });\r\n  });\r\n\r\n  dispose(): void {\r\n    logger.info(\"Disposing ViteClient\")();\r\n    this._provider?.destroy();\r\n    this._isConnected = false;\r\n  }\r\n\r\n  encodeParameter(type: string, param: string): string {\r\n    return abiutils.encodeParameter(type, param);\r\n  }\r\n\r\n  encodeLogSignature(jsonFunction: any, methodName?: string): string {\r\n    return abiutils.encodeLogSignature(jsonFunction, methodName);\r\n  }\r\n\r\n  async requestAsync(method: string, ...args: any[]): Promise<any> {\r\n    if (this._isConnected && this._client) {\r\n      const result = RetryUtil.promiseRetry(async () => {\r\n        return this._client.request(method, ...args).catch(async (error: any) => {\r\n          if (error?.message?.toLowerCase().includes(\"connection error\")) {\r\n            logger.error(\"CONNECTION ERROR -> reconnect\", this._network)();\r\n            this._emitter.emitReInit();\r\n            await CommonUtil.timeout(3000);\r\n            throw error;\r\n          } else {\r\n            throw error;\r\n          }\r\n        })\r\n      });\r\n      return result;\r\n    } else {\r\n      throw new Error('Vite client is not ready to make requests.');\r\n    }\r\n  }\r\n\r\n  async getSnapshotChainHeightAsync(): Promise<BigNumber> {\r\n    const result = await this.requestAsync('ledger_getSnapshotChainHeight');\r\n    return new BigNumber(result);\r\n  }\r\n\r\n  async getAccountBlockHeightAsync(address: string): Promise<BigNumber> {\r\n    const result = await this.requestAsync(\"ledger_getAccountInfoByAddress\", address);\r\n    return new BigNumber(result.blockCount);\r\n  }\r\n\r\n  async getBalanceAsync(address: string): Promise<BigNumber> {\r\n    const result = await this.requestAsync(\"ledger_getAccountInfoByAddress\", address);\r\n    return new BigNumber(result.balanceInfoMap[CommonConstants.VITE_TOKEN_ID].balance);\r\n  }\r\n\r\n  async getQuotaAsync(address: string): Promise<ViteQuotaResult> {\r\n    const result = await this.requestAsync(\"contract_getQuotaByAccount\", address);\r\n    return {\r\n      currentQuota: new BigNumber(result.currentQuota),\r\n      maxQuota: new BigNumber(result.maxQuota),\r\n      stakeAmount: new BigNumber(result.stakeAmount)\r\n    }\r\n  }\r\n\r\n  async sendAsync(account: WalletAccount, toAddress: string, amount: string, tokenId: any = CommonConstants.VITE_TOKEN_ID): Promise<any> {\r\n    let block = accountBlock\r\n      .createAccountBlock(\"send\", {\r\n        address: account.address,\r\n        toAddress: toAddress,\r\n        tokenId,\r\n        amount\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async stakeForQuotaAsync(account: WalletAccount, beneficiaryAddress: string, amount: string): Promise<any> {\r\n    let block = accountBlock\r\n      .createAccountBlock(\"stakeForQuota\", {\r\n        address: account.address,\r\n        beneficiaryAddress: beneficiaryAddress,\r\n        amount\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async callContractAsync(account: WalletAccount, methodName: string, abi: any, params: any, toAddress: string, amount: string = '0', tokenId: any = CommonConstants.VITE_TOKEN_ID): Promise<any> {\r\n    let block = accountBlock\r\n      .createAccountBlock(\"callContract\", {\r\n        address: account.address,\r\n        abi,\r\n        methodName,\r\n        tokenId,\r\n        amount,\r\n        toAddress,\r\n        params,\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async createContractAsync(account: WalletAccount, abi: any, binary: any): Promise<any> {\r\n    let responseLatency = 1;\r\n    let quotaMultiplier = 10;\r\n    let randomDegree = 1;\r\n    let block = accountBlock\r\n      .createAccountBlock(\"createContract\", {\r\n        address: account.address,\r\n        abi,\r\n        code: binary,\r\n        responseLatency,\r\n        params: [],\r\n        quotaMultiplier,\r\n        randomDegree\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, block);\r\n  }\r\n\r\n  async callOffChainMethodAsync(contractAddress: string, abi: any, offchaincode: string, params: any): Promise<any> {\r\n    let data = abiutils.encodeFunctionCall(abi, params);\r\n    let dataBase64 = Buffer.from(data, \"hex\").toString(\"base64\");\r\n    let result = await this.requestAsync(\"contract_callOffChainMethod\", {\r\n      selfAddr: contractAddress,\r\n      offChainCode: offchaincode,\r\n      data: dataBase64,\r\n    });\r\n    if (result) {\r\n      let resultBytes = Buffer.from(result, \"base64\").toString(\"hex\");\r\n      let outputs = [];\r\n      for (let i = 0; i < abi.outputs.length; i++) {\r\n        outputs.push(abi.outputs[i].type);\r\n      }\r\n      let offchainDecodeResult = abiutils.decodeParameters(outputs, resultBytes);\r\n      let resultList = [];\r\n      if (offchainDecodeResult) {\r\n        for (let i = 0; i < abi.outputs.length; i++) {\r\n          if (abi.outputs[i].name) {\r\n            resultList.push({\r\n              name: abi.outputs[i].name,\r\n              value: offchainDecodeResult[i],\r\n            });\r\n          } else {\r\n            resultList.push({\r\n              name: \"\",\r\n              value: offchainDecodeResult[i],\r\n            });\r\n          }\r\n        }\r\n      }\r\n      return resultList;\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  decodeVmLog(vmLog: ViteVmLog, abi: any): Maybe<VmLog> {\r\n    let topics = vmLog.topics;\r\n    for (let j = 0; j < abi.length; j++) {\r\n      let abiItem = abi[j];\r\n      if (abiutils.encodeLogSignature(abiItem) === topics[0]) {\r\n        let result = this.decodeVmLogByAbiItem(vmLog, abiItem);\r\n        if (result) {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  decodeVmLogByAbiItem(vmLog: ViteVmLog, abiItem: any): Maybe<VmLog> {\r\n    if (!vmLog || !vmLog.data || !vmLog.topics) {\r\n      return undefined;\r\n    }\r\n    let topics = vmLog.topics;\r\n    let log: VmLog = {\r\n      topic: topics[0],\r\n      args: abiutils.decodeLog(\r\n        abiItem.inputs,\r\n        utils._Buffer.from(vmLog.data, \"base64\").toString(\"hex\"),\r\n        topics.slice(1)\r\n      ),\r\n      event: abiItem.name,\r\n    };\r\n    return log;\r\n  }\r\n\r\n  async getEventsByBlockAsync(address: string, fromHeight: BigNumber, toHeight: BigNumber, topics?: string[][]): Promise<ViteVmLogEvent[]> {\r\n    if (fromHeight.gt(toHeight)) {\r\n      logger.info(`getEventsByBlockAsync ${fromHeight.toFixed()} > ${toHeight.toFixed()}`)();\r\n      return [];\r\n    }\r\n    const payload = {\r\n      addressHeightRange: {\r\n        [address]: {\r\n          fromHeight: fromHeight.toFixed(),\r\n          toHeight: toHeight.toFixed(),\r\n        },\r\n      },\r\n      topics: topics\r\n    };\r\n    try {\r\n      const result = await this.requestAsync(\"ledger_getVmLogsByFilter\", payload);\r\n      return result;\r\n    } catch (error) {\r\n      const midHeight = fromHeight.plus(toHeight).div(2);\r\n      logger.info(`Divide and conquer block fromHeight: ${fromHeight.toFixed()} toHeight: ${toHeight.toFixed()} midHeight: ${midHeight.toFixed()}`)();\r\n      //const arr1 = await this.getEventsByBlockAsync(address, fromHeight, midHeight, topics);\r\n      const arr2 = await this.getEventsByBlockAsync(address, midHeight.plus(1), toHeight, topics);\r\n      //return [...arr1, ...arr2];\r\n      return arr2;\r\n    }\r\n  }\r\n\r\n  async createAddressListenerAsync(address: string): Promise<any> {\r\n    const payload = {\r\n      addressHeightRange: {\r\n        [address]: {\r\n          fromHeight: \"0\",\r\n          toHeight: \"0\",\r\n        },\r\n      },\r\n    };\r\n    const result = await this._client?.subscribe(\"createVmlogSubscription\", payload);\r\n    return result;\r\n  }\r\n\r\n  removeListener(event: any): void {\r\n    logger.info('removeListener')();\r\n    this._client?.unsubscribe(event);\r\n  }\r\n\r\n  async waitForNextVmLogEventAsync(listener: any, abi: any): Promise<Maybe<VmLog>> {\r\n    logger.info('waitForNextVmLogEvent')();\r\n    return new Promise(async (resolve) => {\r\n      // listener = EventEmitter\r\n      // https://github.com/vitelabs/vite.js/blob/14b87a6ddc68fe5836816f949f85d6161e6cfed8/src/viteAPI/eventEmitter.ts\r\n      listener.on(async (results: any[]) => {\r\n        if (results.length !== 1) {\r\n          console.log(results)\r\n          throw new Error('Unexpected results');\r\n        }\r\n        const result = results[results.length - 1];\r\n        // console.log(result);\r\n        const vmLog = this.decodeVmLog(result.vmlog, abi);\r\n        logger.info(\"vmLog\", vmLog)();\r\n        // https://github.com/vitelabs/vite.js/blob/14b87a6ddc68fe5836816f949f85d6161e6cfed8/src/viteAPI/provider.ts\r\n        // Don't unsubscribe, listener should be reusable!\r\n        // provider.unsubscribe(listener);\r\n        resolve(vmLog);\r\n      });\r\n    });\r\n  }\r\n\r\n  async waitForAccountBlockAsync(address: string, height: string): Promise<any> {\r\n    return new Promise(async (resolve, reject) => {\r\n      let result: any = undefined;\r\n      let error: any = undefined;\r\n      let timestamp = Date.now();\r\n      const task = new Task(async () => {\r\n        try {\r\n          if (Date.now() - timestamp >= providerTimeout) {\r\n            throw new Error(\"Task timed out\")\r\n          }\r\n\r\n          let blockByHeight = await this.requestAsync(\r\n            'ledger_getAccountBlockByHeight',\r\n            address,\r\n            height\r\n          );\r\n\r\n          if (!blockByHeight) {\r\n            return true;\r\n          }\r\n\r\n          let receiveBlockHash = blockByHeight.receiveBlockHash;\r\n          if (!receiveBlockHash) {\r\n            return true;\r\n          }\r\n\r\n          let blockByHash = await this.requestAsync('ledger_getAccountBlockByHash', receiveBlockHash);\r\n          if (!blockByHash) {\r\n            return true;\r\n          }\r\n\r\n          result = {\r\n            ...this.getAccountBlockStatus(blockByHash),\r\n            accountBlock: blockByHash\r\n          }\r\n\r\n          return false;\r\n        } catch (err) {\r\n          error = err;\r\n          return false;\r\n        }\r\n      }, 500);\r\n      task.start(() => {\r\n        if (error) {\r\n          reject(error);\r\n        } else {\r\n          resolve(result);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  async receiveTransactionAsync(account: WalletAccount, block?: any): Promise<any> {\r\n    if (!block) {\r\n      // get the first unreceived block\r\n      let blocks = await this.requestAsync(\r\n        \"ledger_getUnreceivedBlocksByAddress\",\r\n        account.address,\r\n        0,\r\n        1\r\n      );\r\n      if (blocks && blocks.length > 0) {\r\n        block = blocks[0];\r\n      }\r\n    }\r\n\r\n    if (!block) {\r\n      logger.info(`No Unreceived Blocks: ${account.address}`)();\r\n      return;\r\n    }\r\n\r\n    let ab = accountBlock\r\n      .createAccountBlock(\"receive\", {\r\n        address: account.address,\r\n        sendBlockHash: block.hash,\r\n      });\r\n\r\n    return this.sendAccountBlockAsync(account, ab);\r\n  }\r\n\r\n  async receiveAllOnroadTxAsync(account: WalletAccount): Promise<void> {\r\n    const RECEIVE_PER_ROUND = 10;\r\n    let blocks = await this.requestAsync(\r\n      \"ledger_getUnreceivedBlocksByAddress\",\r\n      account.address,\r\n      0,\r\n      RECEIVE_PER_ROUND\r\n    );\r\n\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      let block = blocks[i];\r\n      await this.receiveTransactionAsync(account, block);\r\n    }\r\n    if (blocks.length >= RECEIVE_PER_ROUND) {\r\n      await this.receiveAllOnroadTxAsync(account);\r\n    }\r\n  }\r\n\r\n  private async sendAccountBlockAsync(account: WalletAccount, block: any): Promise<any> {\r\n    if (account instanceof WebWalletAccount) {\r\n      block = block.setProvider(this._client).setPrivateKey(account.privateKey);\r\n      await block.autoSetPreviousAccountBlock();\r\n      const result = await block.sign().send();\r\n      return result;\r\n    } else if (account instanceof SessionWalletAccount) {\r\n      if (this.connector) {\r\n        this._emitter.emitConfirmTransactionDialog(true);\r\n        try {\r\n          const result = await this.connector.sendTransactionAsync({\r\n            block: block.accountBlock\r\n          });\r\n          this._emitter.emitConfirmTransactionDialog(false);\r\n          return result;\r\n        } catch (error) {\r\n          this._emitter.emitConfirmTransactionDialog(false);\r\n          throw error\r\n        }\r\n      } else {\r\n        throw new Error(\"Connector is not defined\");\r\n      }\r\n    } else {\r\n      throw new Error(\"Account not supported\");\r\n    }\r\n  }\r\n\r\n  private getAccountBlockStatus(accountBlock: any) {\r\n    let status = this.resolveAccountBlockData(accountBlock);\r\n    let statusTxt = '';\r\n    switch (status) {\r\n      case 0:\r\n        statusTxt = '0, Execution succeed';\r\n        break;\r\n      case 1:\r\n        statusTxt = '1, Execution reverted';\r\n        break;\r\n      case 2:\r\n        statusTxt = '2, Max call depth exceeded';\r\n        break;\r\n    }\r\n    return {\r\n      status,\r\n      statusTxt\r\n    };\r\n  }\r\n\r\n  private resolveAccountBlockData(accountBlock: any) {\r\n    if (\r\n      (accountBlock.blockType !== 4 && accountBlock.blockType !== 5) ||\r\n      !accountBlock.data\r\n    ) {\r\n      return 0;\r\n    }\r\n    let bytes = utils._Buffer.from(accountBlock.data, 'base64');\r\n\r\n    if (bytes.length !== 33) {\r\n      return 0;\r\n    }\r\n    return bytes[32];\r\n  }\r\n}\r\n\r\nconst client = new ViteClient();\r\n\r\nexport const getViteClient = () => {\r\n  return client;\r\n}","import BigNumber from \"bignumber.js\"\r\n\r\nexport enum DocumentState {\r\n  Unknown,\r\n  Hidden,\r\n  Active\r\n}\r\n\r\nexport enum WalletType {\r\n  MetaMask = 'MetaMask',\r\n}\r\n\r\nexport enum OrderType {\r\n  ASC = 0,\r\n  DESC = 1\r\n}\r\n\r\nexport type Network = {\r\n  id: number\r\n  networkId: number\r\n  name: string\r\n  rpcUrl: string\r\n  connectorUrl: string\r\n}\r\n\r\nexport interface GenericType {\r\n  name: string\r\n  type: string\r\n}\r\n\r\nexport type DisplayBigNumber = {\r\n  number: BigNumber\r\n  displayNumber: string\r\n}\r\n\r\nexport type Contract = {\r\n  address: string\r\n  contractName: string\r\n  binary: string\r\n  offChain: string\r\n  abi: any[]\r\n}\r\n\r\nexport const TypeNames = {\r\n  Punk: \"Punk\",\r\n  PunkExtended: \"PunkExtended\",\r\n  PunkEvent: \"PunkEvent\"\r\n}\r\n\r\nexport type Punk = {\r\n  __typename: string\r\n  id: string\r\n  rank: number\r\n  image: string\r\n  attributes: string[]\r\n}\r\n\r\nexport type PunkExtended = Punk & {\r\n  owner?: Maybe<string>\r\n  bid?: Maybe<MarketBid>\r\n  offer?: Maybe<MarketOffer>\r\n}\r\n\r\nexport type PunkFilterValues = {\r\n  sortBy: string\r\n  orderBy: string\r\n  search: string\r\n}\r\n\r\nexport enum PunkSortType {\r\n  ID = 0,\r\n  RANK = 1\r\n}\r\n\r\nexport type PunkDialogState = {\r\n  type: PunkDialogType\r\n  open: boolean\r\n}\r\n\r\nexport enum PunkDialogType {\r\n  BID = 0,\r\n  OFFER = 1\r\n}\r\n\r\nexport enum PunkEventType {\r\n  Unknown,\r\n  Mint,\r\n  Offer,\r\n  NewBid,\r\n  CancelBid,\r\n  Buy,\r\n  CancelOffer\r\n}\r\n\r\nexport type PunkEvent = {\r\n  __typename: string\r\n  id: string\r\n  accountBlockHash: string\r\n  accountBlockHeight: BigNumber\r\n  timestamp: BigNumber\r\n  eventType: number\r\n  punkId: number\r\n  amount?: Maybe<BigNumber>\r\n  fromAddress?: Maybe<string>\r\n  toAddress?: Maybe<string>\r\n}\r\n\r\nexport type PunkEvents = {\r\n  blockHeight: BigNumber\r\n  events: PunkEvent[]\r\n}\r\n\r\nexport type PunkChangedEvent = {\r\n  accountBlockHash: string\r\n  accountBlockHeight: BigNumber\r\n  timestamp: BigNumber\r\n  eventType: PunkEventType\r\n  punkId: number\r\n  amount?: Maybe<BigNumber>\r\n  fromAddress?: Maybe<string>\r\n  toAddress?: Maybe<string>\r\n}\r\n\r\nexport type FilteredCollection<T> = {\r\n  sortBy: string\r\n  orderBy: string\r\n  searchTerm?: string\r\n  items: T[]\r\n}\r\n\r\nexport enum MarketplaceTab {\r\n  Items = 'items',\r\n  Activity = 'activity'\r\n}\r\n\r\nexport enum MarketEventType {\r\n  Unknown,\r\n  Start,\r\n  Stop,\r\n  MintPrice,\r\n  ActionPrice\r\n}\r\n\r\nexport type MarketChangedEvent = {\r\n  timestamp: BigNumber\r\n  eventType: MarketEventType\r\n  value: BigNumber\r\n}\r\n\r\nexport type ContractMarketInfo = {\r\n  market_started: string\r\n  mints_remaining: string\r\n  mint_price: string\r\n  action_price: string\r\n}\r\n\r\nexport type MarketInfo = {\r\n  marketStarted: boolean\r\n  mintsRemaining: number\r\n  mintPrice: BigNumber\r\n  actionPrice: BigNumber\r\n}\r\n\r\nexport type MarketOffer = {\r\n  itemIndex: BigNumber\r\n  seller: string\r\n  minAmount: BigNumber\r\n  onlySellTo?: Maybe<string>\r\n}\r\n\r\nexport type ContractMarketOffer = MarketOffer & {\r\n  isForSale: boolean\r\n}\r\n\r\nexport type MarketBid = {\r\n  itemIndex: BigNumber\r\n  bidder: string\r\n  amount: BigNumber\r\n}\r\n\r\nexport type ContractMarketBid = MarketBid & {\r\n  hasBid: boolean\r\n}\r\n\r\nexport enum GlobalEvent {\r\n  ReInit = 'ReInit',\r\n  DocumentVisibilityChanged = 'DocumentVisibilityChanged',\r\n  ConfirmTransactionDialog = 'ConfirmTransactionDialog',\r\n  ConnectWalletDialog = 'ConnectWalletDialog',\r\n  QuotaChanged = 'QuotaChanged',\r\n  PunkFilterValuesChanged = 'PunkFilterValuesChanged',\r\n  MarketChanged = 'MarketChanged',\r\n  PunkChanged = 'PunkChanged'\r\n}\r\n\r\nexport enum ViteQuotaType {\r\n  Account = \"Account\",\r\n  Contract = \"Contract\"\r\n}\r\n\r\nexport type ViteQuotaResult = {\r\n  currentQuota: BigNumber\r\n  maxQuota: BigNumber\r\n  stakeAmount: BigNumber\r\n}\r\n\r\nexport type ViteSubscriptionResult = {\r\n  logs: any[],\r\n  listener: any\r\n}\r\n\r\nexport type ViteVmLogEvent = {\r\n  accountBlockHash: string\r\n  accountBlockHeight: string\r\n  address: string\r\n  vmlog: ViteVmLog\r\n}\r\n\r\nexport type ViteVmLog = {\r\n  data: string\r\n  topics: string[]\r\n}\r\n\r\nexport type VmLog = {\r\n  event: string\r\n  topic: string\r\n  args: any\r\n}\r\n\r\nexport enum VmLogEvent {\r\n  MarketChanged = 'MarketChanged',\r\n  PunkChanged = 'PunkChanged'\r\n}","import BigNumber from \"bignumber.js\"\r\nimport { GenericType, Network, PunkEventType, PunkFilterValues } from \"../util/types\"\r\nimport { OrderBy, PunkSortBy } from \"../__generated__/globalTypes\"\r\n\r\nexport const CommonConstants = {\r\n  APP_NAME: 'VitePunks',\r\n  PUNK_NAME: 'VitePunk',\r\n  USE_MOCK_DATASOURCE: false,\r\n  NETWORK_ID: 2,\r\n  WEB_WALLET_STORAGE_SPACE: 'VITEPUNKS_WEB_WALLET',\r\n  SESSION_WALLET_STORAGE_SPACE: 'VITEPUNKS_SESSION_WALLET',\r\n  BG_URL: './assets/images/bg.png',\r\n  ITEM_BG_URL: './assets/images/item_bg.png',\r\n  SAMPLE_PUNK_URL: './assets/images/punk_8311.png',\r\n  LANDING_IMAGE_URL: './assets/images/landing.png',\r\n  QUOTA_WIKI_URL: 'https://github.com/vitepunks/resources/wiki',\r\n  DISCORD_URL: 'https://discord.gg/FsB2uZTn5u',\r\n  TWITTER_URL: 'https://twitter.com/VitePunks',\r\n  GITHUB_URL: 'https://github.com/vitepunks',\r\n  QUOTA_THRESHOLD: new BigNumber(\"100000\"),\r\n  EXPLORER_URL: 'https://buidl.viteview.xyz/#/', // 'https://vitescan.io/'\r\n  ZERO_ADDRESS: 'vite_0000000000000000000000000000000000000000a4f3a0cb58',\r\n  VITE_TOKEN_ID: 'tti_5649544520544f4b454e6e40',\r\n  CURRENCY_NAME: 'VITE',\r\n  CURRENCY_DECIMALS: 18,\r\n  TOTAL_MINTS: 10000\r\n}\r\n\r\nexport const Networks: Network[] = [\r\n  {\r\n    id: 0,\r\n    networkId: 0,\r\n    name: 'UNKNOWN',\r\n    rpcUrl: '',\r\n    connectorUrl: ''\r\n  },\r\n  {\r\n    id: 1,\r\n    networkId: 1,\r\n    name: 'MAINNET',\r\n    rpcUrl: 'wss://node.vite.net/gvite/ws',\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  },\r\n  {\r\n    id: 2,\r\n    networkId: 2,\r\n    name: 'TESTNET',\r\n    rpcUrl: 'wss://buidl.vite.net/gvite/ws', //'ws://localhost:41420/', //'wss://buidl.vite.net/gvite/ws', // https://buidl.vite.net/gvite\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  },\r\n  {\r\n    id: 3,\r\n    networkId: 2,\r\n    name: 'TESTNET+MOCK',\r\n    rpcUrl: 'wss://buidl.vite.net/gvite/ws',\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  },\r\n  {\r\n    id: 4,\r\n    networkId: 5,\r\n    name: 'DEBUG',\r\n    rpcUrl: 'ws://localhost:23457',\r\n    connectorUrl: 'wss://biforst.vite.net'\r\n  }\r\n]\r\n\r\nexport const OrderTypes: GenericType[] = [\r\n  {\r\n    name: \"Asc\",\r\n    type: OrderBy.ASC\r\n  },\r\n  {\r\n    name: \"Desc\",\r\n    type: OrderBy.DESC\r\n  }\r\n]\r\n\r\n\r\nexport const PunkSortTypes: GenericType[] = [\r\n  {\r\n    name: \"Id\",\r\n    type: PunkSortBy.ID\r\n  },\r\n  {\r\n    name: \"Rank\",\r\n    type: PunkSortBy.RANK\r\n  }\r\n]\r\n\r\nexport const PunkEventTypes: GenericType[] = [\r\n  {\r\n    name: \"Unknown\",\r\n    type: PunkEventType.Unknown.toString()\r\n  },\r\n  {\r\n    name: \"Mint\",\r\n    type: PunkEventType.Mint.toString()\r\n  },\r\n  {\r\n    name: \"Sale offer\",\r\n    type: PunkEventType.Offer.toString()\r\n  },\r\n  {\r\n    name: \"New bid\",\r\n    type: PunkEventType.NewBid.toString()\r\n  },\r\n  {\r\n    name: \"Cancel bid\",\r\n    type: PunkEventType.CancelBid.toString()\r\n  },\r\n  {\r\n    name: \"Buy\",\r\n    type: PunkEventType.Buy.toString()\r\n  },\r\n  {\r\n    name: \"Clear offer\",\r\n    type: PunkEventType.CancelOffer.toString()\r\n  },\r\n]\r\n\r\nexport const DefaultPunkFilterValues: PunkFilterValues = {\r\n  sortBy: PunkSortBy.ID,\r\n  orderBy: OrderBy.DESC,\r\n  search: \"\"\r\n}","import Big from 'big.js';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { DocumentState } from './types';\r\n\r\nexport abstract class CommonUtil {\r\n  public static isString(value: any): boolean {\r\n    return typeof value === 'string' || value instanceof String;\r\n  }\r\n\r\n  public static isNumber(value: any): boolean {\r\n    return !isNaN(parseInt(value)) && isFinite(value);\r\n  }\r\n\r\n  public static isNullOrWhitespace(value?: Maybe<string>): boolean {\r\n    if (!CommonUtil.isString(value)) {\r\n      // console.log('Expected a string but got: ', value);\r\n      return true;\r\n    } else {\r\n      return value === null || value === undefined || value.trim() === '';\r\n    }\r\n  }\r\n\r\n  public static isNullOrDefault(value?: string, defaultValue?: string): boolean {\r\n    return CommonUtil.isNullOrWhitespace(value) || value === defaultValue\r\n  }\r\n\r\n  public static timeout(ms: number): Promise<void> {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  public static truncateString = (str: Maybe<string>, maxLength: number) => {\r\n    if (str) {\r\n      if (maxLength < str.length) {\r\n        return `${str.substring(0, maxLength)}...`\r\n      }\r\n    }\r\n    return str\r\n  }\r\n\r\n  public static truncateStringInTheMiddle = (str: Maybe<string>, strPositionStart: number, strPositionEnd: number) => {\r\n    if (str) {\r\n      const minTruncatedLength = strPositionStart + strPositionEnd\r\n      if (minTruncatedLength < str.length) {\r\n        return `${str.substring(0, strPositionStart)}...${str.substring(str.length - strPositionEnd, str.length)}`\r\n      }\r\n    }\r\n    return str\r\n  }\r\n\r\n  public static toJsonString(data: any): string {\r\n    return JSON.stringify(data, null, 2);\r\n  }\r\n\r\n  public static toUint8Array(data: string, encoding: BufferEncoding = 'utf8'): Uint8Array {\r\n    return new Uint8Array(Buffer.from(data, encoding));\r\n  }\r\n\r\n  public static getDocumentState = () => {\r\n    if (document.visibilityState === 'hidden') {\r\n      return DocumentState.Hidden;\r\n    }\r\n    return DocumentState.Active;\r\n  };\r\n\r\n  public static async imageUrlToBlob(url: string): Promise<Blob> {\r\n    return (await fetch(url)).blob();\r\n  }\r\n\r\n  public static random(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n  }\r\n\r\n  public static calculatePercentage(current: Maybe<string>, goal: Maybe<string>): number {\r\n    try {\r\n      if (current && goal) {\r\n        return Math.floor(Big(current).div(Big(goal)).mul(100).toNumber());\r\n      }\r\n    } catch (error) {\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  public static calculateMaxRows(total: number, rpp: number, page: number): number {\r\n    return Math.min(Math.min(total - rpp * page, rpp), total);\r\n  }\r\n\r\n  public static uuid(): string {\r\n    return uuidv4();\r\n  }\r\n\r\n  public static appendPath(_path: string, _appendix: string) {\r\n    if (!_path || !_appendix || CommonUtil.isNullOrWhitespace(_path) || CommonUtil.isNullOrWhitespace(_appendix)) {\r\n      return _path;\r\n    }\r\n    const delimiter = '/';\r\n    const appendix = _appendix.startsWith(delimiter) ? _appendix.substring(1, _appendix.length) : _appendix;\r\n    return _path.endsWith(delimiter) ? _path + appendix : _path + delimiter + appendix;\r\n  }\r\n}","export abstract class RetryUtil {\r\n  // https://stackoverflow.com/questions/45444601/promise-retries-until-success-failure-with-typescript\r\n  static async promiseRetry<T>(fn: () => Promise<T>, retries = 5, err?: any): Promise<T> {\r\n    await new Promise(resolve => setTimeout(resolve, (5 - retries) * 1000));\r\n    return !retries ? Promise.reject(err) : fn().catch(error => RetryUtil.promiseRetry(fn, (retries - 1), error));\r\n  }\r\n}","export class Task {\r\n  private _taskTimer: NodeJS.Timeout | undefined\r\n  private _taskInterval: number\r\n  private _task: () => Promise<boolean>\r\n  private _callback?: () => any\r\n\r\n  constructor(task: () => Promise<boolean>, interval: number) {\r\n    this._task = task;\r\n    this._taskInterval = interval;\r\n\r\n    return this;\r\n  }\r\n\r\n  _run(): void {\r\n    this._taskTimer = setTimeout(async () => {\r\n      if (!this._task) {\r\n        this._onStop();\r\n        return;\r\n      }\r\n      if (!(await this._task())) {\r\n        this._onStop();\r\n        return;\r\n      }\r\n      this._run();\r\n    }, this._taskInterval);\r\n  }\r\n\r\n  _onStop() {\r\n    this._callback && this._callback();\r\n  }\r\n\r\n  start(callback?: () => any): void {\r\n    this._callback = callback;\r\n    if (this._taskTimer) {\r\n      return;\r\n    }\r\n\r\n    this._run();\r\n  }\r\n\r\n\r\n  stop(): void {\r\n    this._onStop();\r\n    if (!this._taskTimer) {\r\n      return;\r\n    }\r\n    window.clearTimeout(this._taskTimer);\r\n    this._taskTimer = undefined;\r\n  }\r\n}","import fs from 'fs';\r\n\r\nexport abstract class FileUtil {\r\n  abstract readFileAsync(path: string, encoding?: BufferEncoding): Promise<any>;\r\n}\r\n\r\nexport class BrowserFileUtil extends FileUtil {\r\n  async readFileAsync(path: string, encoding: BufferEncoding = 'utf8'): Promise<any> {\r\n    const response = await fetch(path);\r\n    switch (encoding) {\r\n      case 'binary':\r\n        return response.arrayBuffer();\r\n      default:\r\n        return response.text();\r\n    }\r\n\r\n  }\r\n}\r\n\r\nexport class LocalFileUtil extends FileUtil {\r\n  public async readFileAsync(path: string, encoding: BufferEncoding = 'utf8'): Promise<any> {\r\n    return Promise.resolve(fs.readFileSync(path, encoding));\r\n  }\r\n}\r\n\r\nexport enum FileUtilType {\r\n  Browser = 0,\r\n  Local = 1\r\n}\r\n\r\nexport const getFileUtil = (type: FileUtilType = FileUtilType.Browser) => {\r\n  switch (type) {\r\n    case FileUtilType.Local:\r\n      return new LocalFileUtil();\r\n    default:\r\n      return new BrowserFileUtil();\r\n  }\r\n}","import { Document as FlexsearchDocument } from \"flexsearch\";\r\nimport { intersection, intersectionWith } from \"lodash\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Punk } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class PunkSearch {\r\n  private _index!: FlexsearchDocument<Punk, false>\r\n\r\n  constructor() {\r\n    this.clear();\r\n  }\r\n\r\n  private clear(): void {\r\n    this._index = new FlexsearchDocument({\r\n      document: {\r\n        id: \"id\",\r\n        tag: \"attributes\",\r\n        index: [\"id\"]\r\n      },\r\n      //preset: \"memory\",\r\n      //tokenize: \"forward\"\r\n    });\r\n  }\r\n\r\n  index(punks: Punk[]): void {\r\n    if (punks) {\r\n      this.clear();\r\n      for (const p of punks) {\r\n        this._index.add(p)\r\n      }\r\n    }\r\n  }\r\n\r\n  search(query: string, punks?: Maybe<Punk[]>): Maybe<Punk[]> {\r\n    try {\r\n      if (!punks || CommonUtil.isNullOrWhitespace(query)) {\r\n        return punks;\r\n      }\r\n      if (CommonUtil.isNumber(query)) {\r\n        const index = parseInt(query);\r\n        if (index > 0) {\r\n          const p = punks[index - 1];\r\n          return !p ? [] : [p];\r\n        }\r\n      }\r\n      const result = this._index.search({\r\n        tag: query.split(','),\r\n        limit: 10000\r\n      });\r\n      const mappedResult = result.map(e => e.result);\r\n      if (mappedResult.length > 0) {\r\n        if (mappedResult.length === 1) {\r\n          return this.enrich(mappedResult[0].map(e => e.toString()), punks);\r\n        } else {\r\n          const intersectedResult = intersection(...mappedResult);\r\n          return this.enrich(intersectedResult.map(e => e.toString()), punks);\r\n        }\r\n      }\r\n      return undefined;\r\n    } catch (error) {\r\n      logger.error(error)();\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private enrich(ids: string[], punks: Punk[]): Punk[] {\r\n    return intersectionWith(punks, ids, (o, id) => o.id === id)\r\n  }\r\n}\r\n\r\nconst search = new PunkSearch();\r\n\r\nexport const getPunkSearch = () => {\r\n  return search;\r\n}","import pako from \"pako\";\r\n\r\nexport abstract class CompressUtil {\r\n  static compress(data: any): string {\r\n    return pako.gzip(data, { to: \"string\" });\r\n  }\r\n\r\n  static decompress(data: any): string {\r\n    return pako.ungzip(data, { to: \"string\" });\r\n  }\r\n}","export class Ensure {\r\n\r\n  public static notNull(property: any, propertyName: string, message?: string) {\r\n    if (property === null || property === undefined) {\r\n      if (message) {\r\n        throw new Error(message);\r\n      } else {\r\n        throw new Error('Unexpected null exception. ' + propertyName);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static notNullOrWhiteSpace(property: Maybe<string>, propertyName: string, message?: string) {\r\n    if (property === null || property === undefined || property?.trim() === '') {\r\n      if (message) {\r\n        throw new Error(message);\r\n      } else {\r\n        throw new Error('Unexpected null exception. ' + propertyName);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static maxLength(property: Maybe<string>, propertyName: string, maxLength: number) {\r\n    if (property && property.length > maxLength) {\r\n      throw new Error(`${propertyName} exceeds the maximum length of ${maxLength}`);\r\n    }\r\n  }\r\n\r\n}\r\n","import BigNumber from \"bignumber.js\";\r\nimport { CommonConfig } from \"../common/config\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { CompressUtil } from \"../util/compress.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { TransformUtil } from \"../util/transform.util\";\r\nimport { ContractMarketBid, ContractMarketInfo, ContractMarketOffer, MarketEventType, MarketInfo } from \"../util/types\";\r\nimport { WalletAccount } from \"../wallet\";\r\nimport { BaseContract } from \"./base.contract\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport enum AbiItemType {\r\n  getDeveloper,\r\n  getMarketInfo,\r\n  isContract,\r\n  balanceOf,\r\n  ownerOf,\r\n  getMappedIndex,\r\n  totalSupply,\r\n  getTokensOf,\r\n  tokenURI,\r\n  getBaseUrl,\r\n  getOffer,\r\n  getBid,\r\n  transferEvent,\r\n  marketChangedEvent,\r\n  punkChangedEvent\r\n}\r\n\r\nexport class PunksContract extends BaseContract {\r\n  private _abiMap: Map<AbiItemType, any>;\r\n\r\n  constructor() {\r\n    super();\r\n    this._abiMap = new Map<AbiItemType, any>();\r\n  }\r\n\r\n  protected async initAsyncProtected(basePath: string): Promise<void> {\r\n    const punksContract = await this._fileUtil.readFileAsync(CommonUtil.appendPath(basePath, \"Punks.gz\"), \"binary\");\r\n    this._contract = JSON.parse(CompressUtil.decompress(CommonUtil.toUint8Array(punksContract, \"binary\")));\r\n    this._contract.address = CommonConfig.CONTRACT_ADDRESS;\r\n    this._abiMap.set(AbiItemType.getDeveloper, this.getAbiItem(\"offchain\", \"getDeveloper\"));\r\n    this._abiMap.set(AbiItemType.getMarketInfo, this.getAbiItem(\"offchain\", \"getMarketInfo\"));\r\n    this._abiMap.set(AbiItemType.isContract, this.getAbiItem(\"offchain\", \"isContract\"));\r\n    this._abiMap.set(AbiItemType.balanceOf, this.getAbiItem(\"offchain\", \"balanceOf\"));\r\n    this._abiMap.set(AbiItemType.ownerOf, this.getAbiItem(\"offchain\", \"ownerOf\"));\r\n    this._abiMap.set(AbiItemType.getMappedIndex, this.getAbiItem(\"offchain\", \"getMappedIndex\"));\r\n    this._abiMap.set(AbiItemType.totalSupply, this.getAbiItem(\"offchain\", \"totalSupply\"));\r\n    this._abiMap.set(AbiItemType.getTokensOf, this.getAbiItem(\"offchain\", \"getTokensOf\"));\r\n    this._abiMap.set(AbiItemType.tokenURI, this.getAbiItem(\"offchain\", \"tokenURI\"));\r\n    this._abiMap.set(AbiItemType.getBaseUrl, this.getAbiItem(\"offchain\", \"getBaseUrl\"));\r\n    this._abiMap.set(AbiItemType.getOffer, this.getAbiItem(\"offchain\", \"getOffer\"));\r\n    this._abiMap.set(AbiItemType.getBid, this.getAbiItem(\"offchain\", \"getBid\"));\r\n    this._abiMap.set(AbiItemType.transferEvent, this.getAbiItem(\"event\", \"Transfer\"));\r\n    this._abiMap.set(AbiItemType.marketChangedEvent, this.getAbiItem(\"event\", \"MarketChanged\"));\r\n    this._abiMap.set(AbiItemType.punkChangedEvent, this.getAbiItem(\"event\", \"PunkChanged\"));\r\n  }\r\n\r\n  private getAbiItem(_type: string, _name: string): any {\r\n    return this._contract.abi.find(e => e.type === _type && e.name === _name);\r\n  }\r\n\r\n  getAbiItemByType(_abiItemType: AbiItemType): any {\r\n    return this._abiMap.get(_abiItemType);\r\n  }\r\n\r\n  private async callOffChainMethodAsync(_abiItemType: AbiItemType, _params: any): Promise<any> {\r\n    return this._client.callOffChainMethodAsync(this._contract.address, this.getAbiItemByType(_abiItemType), this._contract.offChain, _params);\r\n  }\r\n\r\n  async setMintPriceAsync(_account: WalletAccount, _price: string): Promise<any> {\r\n    logger.info(\"setMintPriceAsync\", _price)();\r\n    return this.callContractAsync(_account, 'setPrice', [MarketEventType.MintPrice, _price]);\r\n  }\r\n\r\n  async setActionPriceAsync(_account: WalletAccount, _price: string): Promise<any> {\r\n    logger.info(\"setActionPriceAsync\", _price)();\r\n    return this.callContractAsync(_account, 'setPrice', [MarketEventType.ActionPrice, _price]);\r\n  }\r\n\r\n  async getDeveloperAsync(): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getDeveloper, []);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getDeveloperAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async setDeveloperAsync(_account: WalletAccount, _address: string): Promise<any> {\r\n    logger.info(\"setDeveloperAsync\", _address)();\r\n    return this.callContractAsync(_account, 'setDeveloper', [_address]);\r\n  }\r\n\r\n  async getMarketInfoAsync(): Promise<MarketInfo> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getMarketInfo, []);\r\n    const e = this.objectFromEntries(result) as ContractMarketInfo;\r\n    logger.info(\"getMarketInfoAsync\", e)();\r\n    return {\r\n      marketStarted: this.toBoolean(e.market_started),\r\n      mintsRemaining: parseInt(e.mints_remaining),\r\n      mintPrice: TransformUtil.toBigNumber(e.mint_price),\r\n      actionPrice: TransformUtil.toBigNumber(e.action_price)\r\n    };\r\n  }\r\n\r\n  async setMarketStartedAsync(_account: WalletAccount, _started: boolean): Promise<any> {\r\n    logger.info(\"setMarketStartedAsync\", _started)();\r\n    return this.callContractAsync(_account, 'setMarketStarted', [_started]);\r\n  }\r\n\r\n  async isContractAsync(_address: string): Promise<boolean> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.isContract, [_address]);\r\n    if (!result) {\r\n      return false;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"isContractAsync\", value)();\r\n    return this.toBoolean(value);\r\n  }\r\n\r\n  async balanceOfAsync(_owner: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.balanceOf, [_owner]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"balanceOfAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async ownerOfAsync(_tokenId: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.ownerOf, [_tokenId]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"ownerOfAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async getMappedIndexAsync(_refId: string): Promise<Maybe<BigNumber>> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getMappedIndex, [_refId]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getMappedIndexAsync\", _refId, \":\", value)();\r\n    return TransformUtil.toBigNumber(value);\r\n  }\r\n\r\n  async setMappedIndicesAsync(_account: WalletAccount, _indices: string[], _startIndex: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'setMappedIndices', [_indices, _startIndex]);\r\n  }\r\n\r\n  async mintAsync(_account: WalletAccount, _mintPrice: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'mint', [], _mintPrice);\r\n  }\r\n\r\n  async totalSupplyAsync(_owner: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.totalSupply, []);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"totalSupplyAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async getTokensOfAsync(_owner: string): Promise<string[]> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getTokensOf, [_owner]);\r\n    if (!result) {\r\n      return [];\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getTokensOfAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async tokenURIAsync(_tokenId: string): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.tokenURI, [_tokenId]);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"tokenURIAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async getBaseUrlAsync(): Promise<any> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getBaseUrl, []);\r\n    if (!result) {\r\n      return undefined;\r\n    }\r\n    const value = result[0].value;\r\n    logger.info(\"getBaseUrlAsync\", value)();\r\n    return value;\r\n  }\r\n\r\n  async setBaseUrlAsync(_account: WalletAccount, _baseUrl: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'setBaseUrl', [_baseUrl]);\r\n  }\r\n\r\n  async getOfferAsync(_punkId: string): Promise<ContractMarketOffer> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getOffer, [_punkId]);\r\n    logger.info(\"getOfferAsync\", \"_punkId\", _punkId, result)();\r\n    return {\r\n      isForSale: this.toBoolean(result[0].value),\r\n      itemIndex: new BigNumber(_punkId),\r\n      seller: result[1].value,\r\n      minAmount: new BigNumber(result[2].value),\r\n      onlySellTo: TransformUtil.toAddress(result[3].value)\r\n    };\r\n  }\r\n\r\n  async getBidAsync(_punkId: string): Promise<ContractMarketBid> {\r\n    const result = await this.callOffChainMethodAsync(AbiItemType.getBid, [_punkId]);\r\n    logger.info(\"getBidAsync\", \"_punkId\", _punkId, result)();\r\n    return {\r\n      hasBid: this.toBoolean(result[0].value),\r\n      itemIndex: new BigNumber(_punkId),\r\n      bidder: result[1].value,\r\n      amount: new BigNumber(result[2].value)\r\n    };\r\n  }\r\n\r\n  async cancelOfferAsync(_account: WalletAccount, _punkId: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'cancelOffer', [_punkId]);\r\n  }\r\n\r\n  async offerAsync(_account: WalletAccount, _punkId: string, _minSalePrice: string, _fee?: Maybe<string>): Promise<any> {\r\n    logger.info(`offerAsync punkId: ${_punkId} minSalePrice: ${_minSalePrice} fee: ${_fee}`)();\r\n    return this.callContractAsync(_account, 'offer', [_punkId, _minSalePrice], _fee ?? undefined);\r\n  }\r\n\r\n  async offerToAddressAsync(_account: WalletAccount, _punkId: string, _minSalePrice: string, _address: string, _fee?: Maybe<string>): Promise<any> {\r\n    logger.info(`offerToAddressAsync punkId: ${_punkId} minSalePrice: ${_minSalePrice} address: ${_address} fee: ${_fee}`)();\r\n    return this.callContractAsync(_account, 'offerToAddress', [_punkId, _minSalePrice, _address], _fee ?? undefined);\r\n  }\r\n\r\n  async buyAsync(_account: WalletAccount, _punkId: string, _amount: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'buy', [_punkId], _amount);\r\n  }\r\n\r\n  async cancelBidAsync(_account: WalletAccount, _punkId: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'cancelBid', [_punkId]);\r\n  }\r\n\r\n  async enterBidAsync(_account: WalletAccount, _punkId: string, _amount: string, _fee?: Maybe<string>): Promise<any> {\r\n    logger.info(`enterBidAsync punkId: ${_punkId} amount: ${_amount} fee: ${_fee}`)();\r\n    let amount = _amount;\r\n    if (_fee && !CommonUtil.isNullOrWhitespace(_fee)) {\r\n      amount = new BigNumber(_amount).plus(new BigNumber(_fee)).toFixed();\r\n      logger.info(`enterBidAsync amount+fee: ${amount}`)();\r\n    }\r\n    return this.callContractAsync(_account, 'enterBid', [_punkId], amount);\r\n  }\r\n\r\n  async acceptBidAsync(_account: WalletAccount, _punkId: string, _minPrice: string): Promise<any> {\r\n    return this.callContractAsync(_account, 'acceptBid', [_punkId, _minPrice]);\r\n  }\r\n}\r\n\r\nconst contract = new PunksContract();\r\n\r\nexport const getPunksContract = () => {\r\n  return contract;\r\n}","import { orderBy } from \"lodash\";\r\nimport { OrderBy, PunkSortBy } from \"../__generated__/globalTypes\";\r\nimport { Punk } from \"./types\";\r\n\r\nexport abstract class FilterUtil {\r\n  static sortPunks(sort: PunkSortBy, order: OrderBy, punks?: Maybe<Punk[]>): Maybe<Punk[]> {\r\n    if (!punks || !sort || !order) {\r\n      return punks;\r\n    }\r\n    switch (sort) {\r\n      case PunkSortBy.ID:\r\n        return orderBy(\r\n          punks,\r\n          (p: Punk) => Number(p.id),\r\n          order === OrderBy.ASC ? 'asc' : 'desc',\r\n        )\r\n      case PunkSortBy.RANK:\r\n        return orderBy(\r\n          punks,\r\n          (p: Punk) => p.rank,\r\n          order === OrderBy.ASC ? 'asc' : 'desc',\r\n        )\r\n      default:\r\n        return punks;\r\n    }\r\n  }\r\n}","import moment from 'moment';\r\n\r\nexport class MomentUtil {\r\n  constructor() {\r\n    moment.locale(navigator.language);\r\n  }\r\n\r\n  public setLocale(language: string): void {\r\n    moment.locale(language);\r\n  }\r\n\r\n  public get(): moment.Moment {\r\n    return moment()\r\n  }\r\n\r\n  public getFromUnix(date: number) {\r\n    return moment.unix(date);\r\n  }\r\n\r\n  public getFromMilliseconds(date: number) {\r\n    return moment(date, 'x');\r\n  }\r\n\r\n  public getLocal(date: any): moment.Moment {\r\n    return moment.utc(date).local();\r\n  }\r\n\r\n  public getLocalTime(date: any): string {\r\n    return this.getLocal(date).format('LTS');\r\n  }\r\n\r\n  public getLocalDate(date: any): string {\r\n    return this.getLocal(date).format('L');\r\n  }\r\n\r\n  public getLocalFormatted(date: any): string {\r\n    return this.getLocalTime(date) + ' ' + this.getLocalDate(date);\r\n  }\r\n\r\n  public getLocalReverseFormatted(date: any): string {\r\n    return this.getLocalDate(date) + ' ' + this.getLocalTime(date);\r\n  }\r\n\r\n  public getDuration(date: any, unit: moment.unitOfTime.DurationConstructor | undefined = \"seconds\"): moment.Duration {\r\n    const diff = moment(date).unix() - moment().unix();\r\n    return moment.duration(diff, unit);\r\n  }\r\n\r\n  public isExpired(timestamp: any): boolean {\r\n    try {\r\n      if (timestamp) {\r\n        return moment.utc().unix() >= Number(timestamp);\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n}","import { BigNumber } from \"bignumber.js\";\r\nimport { DefaultPunkFilterValues } from \"../common/constants\";\r\nimport { getPunkSearch, PunkSearch } from \"../search\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { CompressUtil } from \"../util/compress.util\";\r\nimport { getEmitter, IGlobalEmitter } from \"../util/emitter\";\r\nimport { Ensure } from \"../util/ensure\";\r\nimport { FileUtil, getFileUtil } from \"../util/file.util\";\r\nimport { FilterUtil } from \"../util/filter.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { MomentUtil } from \"../util/moment.util\";\r\nimport { FilteredCollection, MarketBid, MarketInfo, MarketOffer, Network, Punk, PunkEvents, TypeNames, ViteQuotaResult } from \"../util/types\";\r\nimport { getWalletManager, WalletAccount, WalletManager } from \"../wallet\";\r\nimport { OrderBy, PunkSortBy } from \"../__generated__/globalTypes\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport interface IDataSource {\r\n  initBaseAsync(network: Network): Promise<void>;\r\n  initAsync(network: Network): Promise<void>;\r\n  dispose(): void;\r\n  getQuotaAsync(_address: string): Promise<ViteQuotaResult>;\r\n  getPunkAttributesAsync(): Promise<string[]>;\r\n  getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  getPunkOwnerAsync(_id: string): Promise<Maybe<string>>;\r\n  getPunkAsync(_id: string): Promise<Punk>;\r\n  getPunksAsync(_limit: number, _offset: number, _sort: string, _order: string, _search: string): Promise<Punk[]>;\r\n  getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]>;\r\n  getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>>;\r\n  getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>>;\r\n  getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  getMarketInfoAsync(): Promise<MarketInfo>;\r\n  getActionPriceAsync(): Promise<BigNumber>;\r\n  getMintPriceAsync(): Promise<BigNumber>;\r\n  mintAsync(): Promise<boolean>;\r\n  offerAsync(_id: string, _amount: string, _address?: Maybe<string>): Promise<boolean>;\r\n  cancelOfferAsync(_id: string): Promise<boolean>;\r\n  buyAsync(_id: string, _amount: string): Promise<boolean>;\r\n  bidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  acceptBidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  cancelBidAsync(_id: string): Promise<boolean>;\r\n}\r\n\r\nexport abstract class BaseDataSource implements IDataSource {\r\n  protected readonly _emitter: IGlobalEmitter;\r\n  protected _moment: MomentUtil = new MomentUtil();\r\n  protected readonly _fileUtil: FileUtil;\r\n  protected _actionPrice?: BigNumber;\r\n  protected _mintPrice?: BigNumber;\r\n  private readonly _walletManager: WalletManager;\r\n  private readonly _punkSearch: PunkSearch;\r\n  private _punkAttributes!: string[];\r\n  private _punks!: Punk[];\r\n  private _punksFiltered!: FilteredCollection<Punk>;\r\n\r\n  constructor() {\r\n    this._emitter = getEmitter();\r\n    this._fileUtil = getFileUtil();\r\n    this._walletManager = getWalletManager();\r\n    this._punkSearch = getPunkSearch();\r\n    this.clear();\r\n  }\r\n\r\n  private clear(): void {\r\n    this._punkAttributes = [];\r\n    this._punks = [];\r\n    this._punksFiltered = {\r\n      sortBy: DefaultPunkFilterValues.sortBy,\r\n      orderBy: DefaultPunkFilterValues.orderBy,\r\n      searchTerm: DefaultPunkFilterValues.search,\r\n      items: []\r\n    }\r\n  }\r\n\r\n  private async initPunkAttributesAsync(): Promise<void> {\r\n    let attributes = await this._fileUtil.readFileAsync(\"./assets/data/punk_attributes.json\");\r\n    attributes = JSON.parse(attributes);\r\n    this._punkAttributes = attributes;\r\n  }\r\n\r\n  private async initPunksAsync(): Promise<void> {\r\n    let punks = await this._fileUtil.readFileAsync(\"./assets/data/punks.gz\", \"binary\");\r\n    punks = JSON.parse(CompressUtil.decompress(CommonUtil.toUint8Array(punks)));\r\n    for (let index = 0; index < punks.length; index++) {\r\n      const p = punks[index];\r\n      const punk: Punk = {\r\n        __typename: TypeNames.Punk,\r\n        id: p.index.toString(),\r\n        rank: p.rank,\r\n        image: p.image,\r\n        attributes: p.attributes\r\n      };\r\n      this._punks.push(punk);\r\n      if (this._punksFiltered.orderBy === OrderBy.ASC) {\r\n        this._punksFiltered.items.push(punk);\r\n      } else {\r\n        this._punksFiltered.items.unshift(punk);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  async initBaseAsync(network: Network): Promise<void> {\r\n    logger.info(\"Init BaseDataSource\")();\r\n    this._moment = new MomentUtil();\r\n    this.clear();\r\n    await this.initPunkAttributesAsync();\r\n    await this.initPunksAsync();\r\n    await this.initAsync(network);\r\n    this._punkSearch.index(this._punks);\r\n  }\r\n\r\n  dispose(): void {\r\n    logger.info(\"Disposing BaseDataSource\")();\r\n    this.disposeProtected();\r\n  }\r\n\r\n  getAccount(): WalletAccount {\r\n    const account = this._walletManager.getActiveAccount();\r\n    Ensure.notNull(account, \"account\", \"Please connect your wallet first.\");\r\n    return account as WalletAccount;\r\n  }\r\n\r\n  async getPunkAttributesAsync(): Promise<string[]> {\r\n    return this._punkAttributes;\r\n  }\r\n\r\n  async getPunkAsync(id: string): Promise<Punk> {\r\n    if (!CommonUtil.isNumber(id)) {\r\n      throw new Error(\"Invalid punk identifier.\");\r\n    }\r\n    const punkId = parseInt(id) - 1;\r\n    if (punkId < 0 || punkId >= this._punks.length) {\r\n      throw new Error(\"Punk does not exist.\");\r\n    }\r\n    return this._punks[punkId];\r\n  }\r\n\r\n  async getPunksAsync(_limit: number, _offset: number, _sort: string, _order: string, _search: string): Promise<Punk[]> {\r\n    // check if sort, order or search changed -> update punksFiltered\r\n    let hasChanged = false;\r\n    if (this._punksFiltered.searchTerm !== _search) {\r\n      hasChanged = true;\r\n      this._punksFiltered.searchTerm = _search;\r\n      this._punksFiltered.items = this._punkSearch.search(_search, this._punks) ?? [];\r\n    }\r\n    if (hasChanged || this._punksFiltered.sortBy !== _sort || this._punksFiltered.orderBy !== _order) {\r\n      logger.info(\"limit\", _limit, \"offset\", _offset, \"sort\", _sort, \"order\", _order)();\r\n      this._punksFiltered.sortBy = _sort;\r\n      this._punksFiltered.orderBy = _order;\r\n      this._punksFiltered.items = FilterUtil.sortPunks(this._punksFiltered.sortBy as PunkSortBy, this._punksFiltered.orderBy as OrderBy, this._punksFiltered.items) ?? [];\r\n    }\r\n    return this._punksFiltered.items.slice(_offset, _offset + _limit);\r\n  }\r\n\r\n  async getActionPriceAsync(): Promise<BigNumber> {\r\n    if (!this._actionPrice) {\r\n      const result = await this.getMarketInfoAsync();\r\n      this._actionPrice = result.actionPrice;\r\n    }\r\n    return this._actionPrice;\r\n  }\r\n\r\n  async getMintPriceAsync(): Promise<BigNumber> {\r\n    if (!this._mintPrice) {\r\n      const result = await this.getMarketInfoAsync();\r\n      this._mintPrice = result.mintPrice;\r\n    }\r\n    return this._mintPrice;\r\n  }\r\n\r\n  protected createId(): string {\r\n    return CommonUtil.uuid();\r\n  }\r\n\r\n  abstract initAsync(network: Network): Promise<void>;\r\n  protected abstract disposeProtected(): void;\r\n  abstract getQuotaAsync(_address: string): Promise<ViteQuotaResult>;\r\n  abstract getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  abstract getPunkOwnerAsync(_id: string): Promise<Maybe<string>>;\r\n  abstract getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]>;\r\n  abstract getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>>;\r\n  abstract getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>>;\r\n  abstract getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents>;\r\n  abstract getMarketInfoAsync(): Promise<MarketInfo>;\r\n  abstract mintAsync(): Promise<boolean>;\r\n  abstract offerAsync(_id: string, _amount: string, _address?: Maybe<string>): Promise<boolean>;\r\n  abstract cancelOfferAsync(_id: string): Promise<boolean>;\r\n  abstract buyAsync(_id: string, _amount: string): Promise<boolean>;\r\n  abstract bidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  abstract acceptBidAsync(_id: string, _amount: string): Promise<boolean>;\r\n  abstract cancelBidAsync(_id: string): Promise<boolean>;\r\n}","import { BigNumber } from 'bignumber.js';\r\nimport { CommonConstants } from '../common/constants';\r\nimport { CommonUtil } from './common.util';\r\nimport { PunkEvent, TypeNames } from './types';\r\n\r\nexport abstract class TransformUtil {\r\n  static get defaultBigNumber(): BigNumber {\r\n    return new BigNumber(\"0\");\r\n  }\r\n\r\n  static toBigNumber(number: string): BigNumber {\r\n    return TransformUtil.toMaybeBigNumber(number) ?? TransformUtil.defaultBigNumber;\r\n  }\r\n\r\n  static toMaybeBigNumber(number: Maybe<string>): Maybe<BigNumber> {\r\n    if (!number || (CommonUtil.isNullOrWhitespace(number) && !CommonUtil.isNumber(number))) {\r\n      return undefined;\r\n    }\r\n    return new BigNumber(number);\r\n  }\r\n\r\n  static toAddress(value: string): Maybe<string> {\r\n    if (CommonUtil.isNullOrWhitespace(value) || value === CommonConstants.ZERO_ADDRESS) {\r\n      return undefined;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  static toTimestamp(date: Maybe<Date>): string {\r\n    if (date) {\r\n      return Math.floor(date.getTime() / 1000).toString();\r\n    }\r\n    return \"0\";\r\n  }\r\n\r\n  static toPunkEvent(event: any): PunkEvent {\r\n    return {\r\n      __typename: event.__typename ?? TypeNames.PunkEvent,\r\n      id: event.id ?? `${event.accountBlockHash}-${event.accountBlockHeight}-${event.eventType}`,\r\n      accountBlockHash: event.accountBlockHash,\r\n      accountBlockHeight: TransformUtil.toBigNumber(event.accountBlockHeight),\r\n      timestamp: TransformUtil.toBigNumber(event.timestamp),\r\n      eventType: Number(event.eventType),\r\n      punkId: event.punkId,\r\n      amount: TransformUtil.toBigNumber(event.amount),\r\n      fromAddress: TransformUtil.toAddress(event.fromAddress) ?? '',\r\n      toAddress: TransformUtil.toAddress(event.toAddress) ?? ''\r\n    };\r\n  }\r\n}","import { BigNumber } from \"bignumber.js\";\r\nimport { BaseDataSource } from \".\";\r\nimport { CommonConstants } from \"../common/constants\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { TransformUtil } from \"../util/transform.util\";\r\nimport { MarketBid, MarketInfo, MarketOffer, Network, Punk, PunkEvent, PunkEvents, PunkEventType, ViteQuotaResult } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class MockDataSource extends BaseDataSource {\r\n  private _events!: PunkEvent[];\r\n\r\n  constructor() {\r\n    super();\r\n    this.clearMock();\r\n  }\r\n\r\n  private clearMock(): void {\r\n    this._events = [];\r\n  }\r\n\r\n  async initAsync(network: Network): Promise<void> {\r\n    logger.info('Init MockDataSource')();\r\n    let events = await this._fileUtil.readFileAsync(\"./assets/data/mock_events.json\");\r\n    events = JSON.parse(events);\r\n    this.clearMock();\r\n    for (let index = 0; index < events.length; index++) {\r\n      const e = events[index];\r\n      this._events.push(TransformUtil.toPunkEvent(e));\r\n    }\r\n    this._events = this._events.reverse();\r\n  }\r\n\r\n  protected disposeProtected(): void {\r\n    logger.info('Dispose MockDataSource')();\r\n    this.clearMock();\r\n  }\r\n\r\n  async getQuotaAsync(_address: string): Promise<ViteQuotaResult> {\r\n    return {\r\n      currentQuota: new BigNumber(\"1000\"),\r\n      maxQuota: new BigNumber(\"2000\"),\r\n      stakeAmount: new BigNumber(\"10000\")\r\n    };\r\n  }\r\n\r\n  async getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"id\", _id, \"limit\", _limit, \"offset\", _offset, \"height\", _height)();\r\n    await CommonUtil.timeout(2000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return {\r\n        blockHeight: TransformUtil.defaultBigNumber,\r\n        events: []\r\n      };\r\n    }\r\n    return {\r\n      blockHeight: TransformUtil.defaultBigNumber,\r\n      events: this._events.filter(e => e.punkId === parseInt(_id)).slice(_offset, _offset + _limit)\r\n    };\r\n  }\r\n\r\n  async getPunkOwnerAsync(_id: string): Promise<Maybe<string>> {\r\n    await CommonUtil.timeout(2000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return undefined;\r\n    }\r\n    const e = this._events.find(e => e.punkId.toString() === _id && e.eventType === PunkEventType.Mint);\r\n    if (!e) {\r\n      return undefined;\r\n    }\r\n    return e.toAddress;\r\n  }\r\n\r\n  async getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]> {\r\n    logger.info(\"_address\", _address, \"limit\", _limit, \"offset\", _offset)();\r\n    const punks = [\r\n      await this.getPunkAsync(\"101\"),\r\n      await this.getPunkAsync(\"201\"),\r\n      await this.getPunkAsync(\"301\"),\r\n      await this.getPunkAsync(\"401\"),\r\n      await this.getPunkAsync(\"501\"),\r\n      await this.getPunkAsync(\"601\"),\r\n      await this.getPunkAsync(\"701\"),\r\n      await this.getPunkAsync(\"801\"),\r\n      await this.getPunkAsync(\"9999\")\r\n    ];\r\n    return punks.slice(_offset, _offset + _limit);\r\n  }\r\n\r\n  async getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>> {\r\n    await CommonUtil.timeout(1000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return undefined;\r\n    }\r\n    const e = this._events.find(e => e.punkId.toString() === _id && e.eventType === PunkEventType.NewBid);\r\n    if (!e) {\r\n      return undefined;\r\n    }\r\n    return {\r\n      itemIndex: TransformUtil.toBigNumber(_id),\r\n      bidder: e.fromAddress ?? CommonConstants.ZERO_ADDRESS,\r\n      amount: e.amount ?? TransformUtil.defaultBigNumber\r\n    }\r\n  }\r\n\r\n  async getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>> {\r\n    await CommonUtil.timeout(1000);\r\n    if (!CommonUtil.isNumber(_id)) {\r\n      return undefined;\r\n    }\r\n    const e = this._events.find(e => e.punkId.toString() === _id && e.eventType === PunkEventType.Offer);\r\n    if (!e) {\r\n      return undefined;\r\n    }\r\n    const seller = await this.getPunkOwnerAsync(_id);\r\n    return {\r\n      itemIndex: TransformUtil.toBigNumber(_id),\r\n      seller: seller ?? CommonConstants.ZERO_ADDRESS,\r\n      minAmount: e.amount ?? TransformUtil.defaultBigNumber,\r\n      onlySellTo: e.toAddress\r\n    }\r\n  }\r\n\r\n  async getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"limit\", _limit, \"offset\", _offset)();\r\n    await CommonUtil.timeout(500);\r\n    return {\r\n      blockHeight: new BigNumber(\"0\"),\r\n      events: this._events.slice(_offset, _offset + _limit)\r\n    }\r\n  }\r\n\r\n  async getMarketInfoAsync(): Promise<MarketInfo> {\r\n    logger.info(\"getMarketInfoAsync\")();\r\n    return {\r\n      marketStarted: true,\r\n      mintsRemaining: CommonConstants.TOTAL_MINTS - this._events.filter(e => e.eventType === PunkEventType.Mint).length,\r\n      mintPrice: new BigNumber(\"12\").shiftedBy(18),\r\n      actionPrice: new BigNumber(\"3.1\").shiftedBy(18),\r\n    };\r\n  }\r\n\r\n  async mintAsync(): Promise<boolean> {\r\n    throw new Error(\"Method 'mintAsync' not implemented.\");\r\n  }\r\n\r\n  async offerAsync(_id: string, _tokenId: string, _amount: string, _address?: string | null): Promise<boolean> {\r\n    logger.info(\"offerAsync\", \"id\", _id, \"tokenId\", _tokenId, \"amount\", _amount, \"address\", _address)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async cancelOfferAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelOfferAsync\", \"id\", _id)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async buyAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"buyAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async bidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"bidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async acceptBidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"acceptBidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n\r\n  async cancelBidAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelBidAsync\", \"id\", _id)();\r\n    await CommonUtil.timeout(2000);\r\n    return true;\r\n  }\r\n}\r\n\r\nconst ds = new MockDataSource();\r\n\r\nexport const getMockDataSource = () => {\r\n  return ds;\r\n}","import { CommonUtil } from './common.util';\r\n\r\nexport abstract class FormatUtil {\r\n  static formatMessage(data: any): string {\r\n    const defaultMessage = \"Something went wrong. Probably your account has insufficient balance or quota.\"\r\n    if (data) {\r\n      console.log(data)\r\n      let message: string\r\n      if (!CommonUtil.isString(data)) {\r\n        if (data.message) {\r\n          message = data.message\r\n        }\r\n        else if (data.error?.message) {\r\n          message = data.error.message\r\n        } else if (data.graphQLErrors) {\r\n          if (data.graphQLErrors.length > 0) {\r\n            message = data.graphQLErrors[0].message\r\n          } else {\r\n            message = defaultMessage\r\n          }\r\n        } else {\r\n          message = JSON.stringify(data)\r\n          if (message === \"{}\") {\r\n            message = defaultMessage\r\n          }\r\n        }\r\n      } else {\r\n        message = data\r\n      }\r\n      if (message.length > 128) {\r\n        return message.substr(0, 128) + \"...\"\r\n      }\r\n      return message\r\n    }\r\n    return defaultMessage\r\n  }\r\n\r\n  static formatNumber(number: Maybe<number>): string {\r\n    if (!number) {\r\n      return \"0\";\r\n    }\r\n    return number.toLocaleString(navigator.language ?? 'en-US');\r\n  }\r\n}","import BigNumber from \"bignumber.js\";\r\nimport { ViteClient } from \"../clients/vite.client\";\r\nimport { FileUtil, getFileUtil } from \"../util/file.util\";\r\nimport { FormatUtil } from \"../util/format.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Contract, ViteSubscriptionResult } from \"../util/types\";\r\nimport { WalletAccount } from \"../wallet\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport abstract class BaseContract {\r\n  protected readonly _fileUtil: FileUtil;\r\n  private readonly _minQuota: BigNumber = new BigNumber(\"10000\");\r\n  protected _client!: ViteClient;\r\n  protected _contract!: Contract;\r\n\r\n  constructor() {\r\n    this._fileUtil = getFileUtil();\r\n  }\r\n\r\n  async initAsync(client: ViteClient, basePath: string): Promise<void> {\r\n    this._client = client;\r\n    await this.initAsyncProtected(basePath);\r\n  }\r\n\r\n  protected abstract initAsyncProtected(basePath: string): Promise<void>;\r\n\r\n  get contract(): Contract {\r\n    return this._contract;\r\n  }\r\n\r\n  protected async ensureQuotaAsync(_quota: BigNumber = this._minQuota): Promise<void> {\r\n    const result = await this._client.getQuotaAsync(this._contract.address);\r\n    if (result.currentQuota.lte(_quota)) {\r\n      throw new Error(\"Contract has insufficient quota\");\r\n    }\r\n  }\r\n\r\n  protected toBoolean(value: string): boolean {\r\n    if (value === \"0\") {\r\n      return false;\r\n    } else if (value === \"1\") {\r\n      return true;\r\n    } else {\r\n      throw new Error(`Value ${value} is not boolean`)\r\n    }\r\n  }\r\n\r\n  protected objectFromEntries = (entries: any) => {\r\n    return Object.fromEntries(\r\n      entries.map((entry: any) => {\r\n        return [entry.name, entry.value];\r\n      })\r\n    );\r\n  }\r\n\r\n  protected async callContractAsync(_account: WalletAccount, _methodName: string, _params: any[], amount?: string, tokenId?: string): Promise<any> {\r\n    await this.ensureQuotaAsync();\r\n    try {\r\n      const result1 = await this._client.callContractAsync(_account, _methodName, this._contract.abi, _params, this._contract.address, amount, tokenId);\r\n      const result2 = await this._client.waitForAccountBlockAsync(_account.address, result1.height);\r\n      return result2;\r\n    } catch (error: any) {\r\n      const message = FormatUtil.formatMessage(error);\r\n      if (message) {\r\n        throw new Error(message)\r\n      } else {\r\n        throw new Error(\"Error\");\r\n      }\r\n    }\r\n  }\r\n\r\n  async stakeForQuotaAsync(_account: WalletAccount, _amount: string): Promise<any> {\r\n    const result1 = await this._client.stakeForQuotaAsync(_account, this._contract.address, _amount);\r\n    const result2 = await this._client.waitForAccountBlockAsync(_account.address, result1.height);\r\n    return result2;\r\n  }\r\n\r\n  async createAddressListenerAsync(): Promise<ViteSubscriptionResult> {\r\n    const logs: any[] = [];\r\n    const listener = await this._client.createAddressListenerAsync(this._contract.address);\r\n    listener.on((results: any[]) => {\r\n      for (let index = 0; index < results.length; index++) {\r\n        const result = results[index];\r\n        logger.info(result)();\r\n        const vmLog = this._client.decodeVmLog(result.vmlog, this._contract.abi);\r\n        logs.push(vmLog);\r\n      }\r\n    });\r\n\r\n    return {\r\n      logs,\r\n      listener\r\n    }\r\n  }\r\n}","import { BigNumber } from \"bignumber.js\";\r\nimport { BaseDataSource } from \".\";\r\nimport { getViteClient, ViteClient } from \"../clients/vite.client\";\r\nimport { CommonConfig } from \"../common/config\";\r\nimport { AbiItemType, getPunksContract, PunksContract } from \"../contracts/punks.contract\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { TransformUtil } from \"../util/transform.util\";\r\nimport { MarketBid, MarketChangedEvent, MarketEventType, MarketInfo, MarketOffer, Network, Punk, PunkChangedEvent, PunkEvent, PunkEvents, ViteQuotaResult, ViteVmLogEvent, VmLog, VmLogEvent } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class ViteDataSource extends BaseDataSource {\r\n  private readonly _client: ViteClient;\r\n  private readonly _contract: PunksContract;\r\n  private _listener: any;\r\n\r\n  constructor() {\r\n    super();\r\n    this._client = getViteClient();\r\n    this._contract = getPunksContract();\r\n  }\r\n\r\n  async initAsync(network: Network): Promise<void> {\r\n    logger.info('Init ViteDataSource')();\r\n    this.disposeProtected();\r\n    await this._client.initAsync(network);\r\n    await this._contract.initAsync(this._client, \"./assets/contracts\");\r\n    this._listener = await this._client.createAddressListenerAsync(this._contract.contract.address);\r\n    this._listener.on((results: ViteVmLogEvent[]) => {\r\n      if (!this._contract?.contract.abi) {\r\n        logger.error('Could not decode vmlog because contract abi is not defined.')();\r\n      } else {\r\n        for (let index = 0; index < results.length; index++) {\r\n          const result = results[index];\r\n          const vmLog = this._client.decodeVmLog(result.vmlog, this._contract.contract.abi);\r\n          logger.info(vmLog ?? result)();\r\n          if (vmLog) {\r\n            this.handleVmLogAsync(result.accountBlockHash, result.accountBlockHeight, vmLog);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  protected disposeProtected(): void {\r\n    logger.info('Dispose ViteDataSource')();\r\n    if (this._listener) {\r\n      this._client.removeListener(this._listener);\r\n    }\r\n    this._client.dispose();\r\n  }\r\n\r\n  async getQuotaAsync(_address: string): Promise<ViteQuotaResult> {\r\n    return this._client.getQuotaAsync(_address);\r\n  }\r\n\r\n  async getPunkEventsAsync(_id: string, _limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"id\", _id, \"limit\", _limit, \"offset\", _offset, \"height\", _height)();\r\n    if (CommonUtil.isNullOrWhitespace(_id)) {\r\n      return {\r\n        blockHeight: TransformUtil.defaultBigNumber,\r\n        events: []\r\n      };\r\n    }\r\n    const abiItem = this._contract.getAbiItemByType(AbiItemType.punkChangedEvent);\r\n    const encodedLogSignature = this._client.encodeLogSignature(abiItem);\r\n    const topics: string[][] = [\r\n      [\r\n        encodedLogSignature\r\n      ],\r\n      [\r\n        // don't filter based on eventType\r\n      ],\r\n      [\r\n        // filter based on punkId\r\n        this._client.encodeParameter('uint256', _id)\r\n      ]\r\n    ]\r\n    const fromHeight = this.getEventsFromHeight();\r\n    const toHeight = await this.getAccountBlockHeightAsync(this._contract.contract.address, _height);\r\n    let result = await this._client.getEventsByBlockAsync(this._contract.contract.address, fromHeight, toHeight, topics);\r\n    result = result?.reverse().slice(_offset, _offset + _limit);\r\n    const events = this.toPunkEvents(result);\r\n    return {\r\n      blockHeight: toHeight,\r\n      events: events\r\n    };\r\n  }\r\n\r\n  async getPunkOwnerAsync(_id: string): Promise<Maybe<string>> {\r\n    const result = await this._contract.ownerOfAsync(_id);\r\n    return result;\r\n  }\r\n\r\n  async getPunksByAddressAsync(_address: string, _limit: number, _offset: number): Promise<Punk[]> {\r\n    logger.info(\"_address\", _address, \"limit\", _limit, \"offset\", _offset)();\r\n    if (CommonUtil.isNullOrWhitespace(_address)) {\r\n      return [];\r\n    }\r\n    let result = await this._contract.getTokensOfAsync(_address);\r\n    result = result.slice(_offset, _offset + _limit);\r\n    const punks = [];\r\n    for (const id of result) {\r\n      const punk = await this.getPunkAsync(id);\r\n      punks.push(punk)\r\n    }\r\n    return punks;\r\n  }\r\n\r\n  async getMarketBidAsync(_id: string): Promise<Maybe<MarketBid>> {\r\n    const result = await this._contract.getBidAsync(_id);\r\n    if (!result || !result.hasBid) {\r\n      return null;\r\n    }\r\n    return {\r\n      itemIndex: result.itemIndex,\r\n      amount: result.amount,\r\n      bidder: result.bidder\r\n    };\r\n  }\r\n\r\n  async getMarketOfferAsync(_id: string): Promise<Maybe<MarketOffer>> {\r\n    const result = await this._contract.getOfferAsync(_id);\r\n    if (!result || !result.isForSale) {\r\n      return null;\r\n    }\r\n    return {\r\n      itemIndex: result.itemIndex,\r\n      minAmount: result.minAmount,\r\n      seller: result.seller,\r\n      onlySellTo: result.onlySellTo ?? ''\r\n    };\r\n  }\r\n\r\n  async getMarketEventsAsync(_limit: number, _offset: number, _height?: Maybe<string>): Promise<PunkEvents> {\r\n    logger.info(\"limit\", _limit, \"offset\", _offset)();\r\n    const abiItem = this._contract.getAbiItemByType(AbiItemType.punkChangedEvent);\r\n    const encodedLogSignature = this._client.encodeLogSignature(abiItem);\r\n    const topics: string[][] = [\r\n      [\r\n        encodedLogSignature\r\n      ]\r\n    ]\r\n    const fromHeight = this.getEventsFromHeight();\r\n    const toHeight = await this.getAccountBlockHeightAsync(this._contract.contract.address, _height);\r\n    let result = await this._client.getEventsByBlockAsync(this._contract.contract.address, fromHeight, toHeight, topics);\r\n    result = result?.reverse().slice(_offset, _offset + _limit);\r\n    const events = this.toPunkEvents(result);\r\n    return {\r\n      blockHeight: toHeight,\r\n      events: events\r\n    };\r\n  }\r\n\r\n  async getMarketInfoAsync(): Promise<MarketInfo> {\r\n    const result = await this._contract.getMarketInfoAsync();\r\n    this._actionPrice = result.actionPrice;\r\n    this._mintPrice = result.mintPrice;\r\n    logger.info(\"getMarketInfoAsync\", result)();\r\n    return result;\r\n  }\r\n\r\n  async mintAsync(): Promise<boolean> {\r\n    await this.checkQuotaAsync();\r\n    const mintPrice = await this.getMintPriceAsync();\r\n    const result = await this._contract.mintAsync(this.getAccount(), mintPrice.toFixed());\r\n    logger.info(\"mintAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async offerAsync(_id: string, _amount: string, _address?: string | null): Promise<boolean> {\r\n    logger.info(\"offerAsync\", \"id\", _id, \"amount\", _amount, \"address\", _address)();\r\n    await this.checkQuotaAsync();\r\n    const fee = await this.getFeeAsync();\r\n    let result;\r\n    if (_address && !CommonUtil.isNullOrWhitespace(_address)) {\r\n      result = await this._contract.offerToAddressAsync(this.getAccount(), _id, _amount, _address, fee);\r\n    } else {\r\n      result = await this._contract.offerAsync(this.getAccount(), _id, _amount, fee);\r\n    }\r\n    logger.info(\"offerAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async cancelOfferAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelOfferAsync\", \"id\", _id)();\r\n    await this.checkQuotaAsync();\r\n    const result = await this._contract.cancelOfferAsync(this.getAccount(), _id);\r\n    logger.info(\"cancelOfferAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async buyAsync(_id: string, _amount: string): Promise<boolean> {\r\n    await this.checkQuotaAsync();\r\n    logger.info(\"buyAsync\", \"id\", _id, \"amount\", _amount)();\r\n    const result = await this._contract.buyAsync(this.getAccount(), _id, _amount);\r\n    logger.info(\"buyAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async bidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"bidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await this.checkQuotaAsync();\r\n    const fee = await this.getFeeAsync();\r\n    const result = await this._contract.enterBidAsync(this.getAccount(), _id, _amount, fee);\r\n    logger.info(result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async acceptBidAsync(_id: string, _amount: string): Promise<boolean> {\r\n    logger.info(\"acceptBidAsync\", \"id\", _id, \"amount\", _amount)();\r\n    await this.checkQuotaAsync();\r\n    const result = await this._contract.acceptBidAsync(this.getAccount(), _id, _amount);\r\n    logger.info(\"acceptBidAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  async cancelBidAsync(_id: string): Promise<boolean> {\r\n    logger.info(\"cancelBidAsync\", \"id\", _id)();\r\n    await this.checkQuotaAsync();\r\n    const result = await this._contract.cancelBidAsync(this.getAccount(), _id);\r\n    logger.info(\"cancelBidAsync\", result)();\r\n    return result.status === 0;\r\n  }\r\n\r\n  private async handleVmLogAsync(accountBlockHash: string, accountBlockHeight: string, vmlog: VmLog): Promise<void> {\r\n    try {\r\n      switch (vmlog.event) {\r\n        case VmLogEvent.MarketChanged:\r\n          const marketEvent: MarketChangedEvent = {\r\n            timestamp: new BigNumber(vmlog.args.timestamp),\r\n            eventType: parseInt(vmlog.args.eventType),\r\n            value: new BigNumber(vmlog.args.value)\r\n          }\r\n          switch (marketEvent.eventType) {\r\n            case MarketEventType.ActionPrice:\r\n              this._actionPrice = marketEvent.value;\r\n              break;\r\n            case MarketEventType.MintPrice:\r\n              this._mintPrice = marketEvent.value;\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          this._emitter.emitMarketChanged(marketEvent);\r\n          break;\r\n        case VmLogEvent.PunkChanged:\r\n          const punkEvent: PunkChangedEvent = {\r\n            accountBlockHash: accountBlockHash,\r\n            accountBlockHeight: new BigNumber(accountBlockHeight),\r\n            timestamp: new BigNumber(vmlog.args.timestamp),\r\n            eventType: parseInt(vmlog.args.eventType),\r\n            punkId: parseInt(vmlog.args.punkId),\r\n            amount: new BigNumber(vmlog.args.amount),\r\n            fromAddress: vmlog.args.fromAddress,\r\n            toAddress: vmlog.args.toAddress\r\n          }\r\n          this._emitter.emitPunkChanged(punkEvent);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      logger.error(error)();\r\n    }\r\n  }\r\n\r\n  private toPunkEvents(events: ViteVmLogEvent[]): PunkEvent[] {\r\n    if (!Array.isArray(events)) {\r\n      return [];\r\n    }\r\n    const result: PunkEvent[] = [];\r\n    for (const e of events) {\r\n      const transformed = this.toPunkEvent(e);\r\n      if (transformed) {\r\n        result.push(transformed);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private toPunkEvent(event: ViteVmLogEvent): Maybe<PunkEvent> {\r\n    if (!event) {\r\n      return null;\r\n    }\r\n    const abiItem = this._contract.getAbiItemByType(AbiItemType.punkChangedEvent);\r\n    const decoded = this._client.decodeVmLogByAbiItem(event.vmlog, abiItem);\r\n    if (!decoded) {\r\n      return null;\r\n    }\r\n    const transformed = {\r\n      accountBlockHash: event.accountBlockHash,\r\n      accountBlockHeight: event.accountBlockHeight,\r\n      timestamp: decoded.args.timestamp,\r\n      eventType: decoded.args.eventType,\r\n      punkId: decoded.args.punkId,\r\n      amount: decoded.args.amount,\r\n      fromAddress: decoded.args.fromAddress,\r\n      toAddress: decoded.args.toAddress\r\n    };\r\n    return TransformUtil.toPunkEvent(transformed);\r\n  }\r\n\r\n  private async getFeeAsync(): Promise<Maybe<string>> {\r\n    const actionPrice = await this.getActionPriceAsync();\r\n    if (actionPrice.gt(0)) {\r\n      return actionPrice.toFixed();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private async getAccountBlockHeightAsync(_address: string, _height?: Maybe<string>): Promise<BigNumber> {\r\n    let height = new BigNumber(\"0\");\r\n    if (_height && !CommonUtil.isNullOrWhitespace(_height)) {\r\n      height = new BigNumber(_height);\r\n    } else {\r\n      height = await this._client.getAccountBlockHeightAsync(_address);\r\n    }\r\n    return height;\r\n  }\r\n\r\n  private getEventsFromHeight(): BigNumber {\r\n    if (CommonConfig.IS_PRODUCTION) {\r\n      // Hide events before official launch\r\n      return new BigNumber(\"1150\");\r\n    }\r\n    return new BigNumber(\"0\");\r\n  }\r\n\r\n  private async checkQuotaAsync(): Promise<void> {\r\n    const address = this._contract.contract.address;\r\n    const quota = await this.getQuotaAsync(address);\r\n    this._emitter.emitQuotaChanged(address, quota);\r\n  }\r\n}\r\n\r\nconst ds = new ViteDataSource();\r\n\r\nexport const getViteDataSource = () => {\r\n  return ds;\r\n}","import { CommonConfig } from \"../common/config\";\r\nimport { CommonConstants, Networks } from \"../common/constants\";\r\nimport { getMockDataSource, IDataSource } from \"../datasources\";\r\nimport { getViteDataSource } from \"../datasources/vite.datasource\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Network } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport class CommonContext {\r\n  private _network!: Network;\r\n  private _datasource!: IDataSource;\r\n\r\n  async initAsync(): Promise<void> {\r\n    if (CommonConstants.USE_MOCK_DATASOURCE) {\r\n      this._datasource = getMockDataSource();\r\n    } else {\r\n      this._datasource = getViteDataSource();\r\n    }\r\n    const networkId = CommonConfig.NETWORK_ID;\r\n    this._network = Networks.find(e => e.id === networkId) ?? Networks[0];\r\n    await this._datasource.initBaseAsync(this._network);\r\n  }\r\n\r\n  dispose(): void {\r\n    logger.info(\"Disposing CommonContext\")();\r\n    this._datasource?.dispose();\r\n  }\r\n\r\n  get network(): Network {\r\n    return this._network;\r\n  }\r\n\r\n  get datasource(): IDataSource {\r\n    return this._datasource;\r\n  }\r\n}\r\n\r\nconst context = new CommonContext();\r\n\r\nexport const getCommonContext = () => {\r\n  return context;\r\n}\r\n","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\n\r\nexport const OFFER_MUTATION = gql`\r\n  mutation Offer($id: ID!, $amount: String!, $address: String) {\r\n    offer(id: $id, amount: $amount, address: $address) @client\r\n  }\r\n`;\r\n\r\nexport const CANCEL_OFFER_MUTATION = gql`\r\n  mutation CancelOffer($id: ID!) {\r\n    cancelOffer(id: $id) @client\r\n  }\r\n`;\r\n\r\nexport const BUY_MUTATION = gql`\r\n  mutation Buy($id: ID!, $amount: String!) {\r\n    buy(id: $id, amount: $amount) @client\r\n  }\r\n`;\r\n\r\nexport const BID_MUTATION = gql`\r\n  mutation Bid($id: ID!, $amount: String!) {\r\n    bid(id: $id, amount: $amount) @client\r\n  }\r\n`;\r\n\r\nexport const ACCEPT_BID_MUTATION = gql`\r\n  mutation AcceptBid($id: ID!, $amount: String!) {\r\n    acceptBid(id: $id, amount: $amount) @client\r\n  }\r\n`;\r\n\r\nexport const CANCEL_BID_MUTATION = gql`\r\n  mutation CancelBid($id: ID!) {\r\n    cancelBid(id: $id) @client\r\n  }\r\n`;\r\n\r\nexport const MarketMutations = {\r\n  async offer(parent: any, { id, amount, address }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.offerAsync(id, amount, address);\r\n  },\r\n  async cancelOffer(parent: any, { id }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.cancelOfferAsync(id);\r\n  },\r\n  async buy(parent: any, { id, amount }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.buyAsync(id, amount);\r\n  },\r\n  async bid(parent: any, { id, amount }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.bidAsync(id, amount);\r\n  },\r\n  async acceptBid(parent: any, { id, amount }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.acceptBidAsync(id, amount);\r\n  },\r\n  async cancelBid(parent: any, { id }: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.cancelBidAsync(id);\r\n  },\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\n\r\nexport const MINT_MUTATION = gql`\r\n  mutation Mint {\r\n    mint @client\r\n  }\r\n`;\r\n\r\nexport const PunkMutations = {\r\n  async mint(parent: any, params: any, context: ApolloContext): Promise<boolean> {\r\n    return context.client.datasource.mintAsync();\r\n  },\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\nimport { Punk, PunkEvents } from \"../util/types\";\r\n\r\nexport const PUNK_FIELDS = gql`\r\n  fragment PunkFields on Punk {\r\n    id\r\n    rank\r\n    image\r\n    attributes\r\n  }\r\n`;\r\n\r\nexport const PUNK_EVENT_FIELDS = gql`\r\n  fragment PunkEventFields on PunkEvent {\r\n    id\r\n    accountBlockHash\r\n    accountBlockHeight\r\n    timestamp\r\n    eventType\r\n    punkId\r\n    amount\r\n    fromAddress\r\n    toAddress\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_ATTRIBUTES_QUERY = gql`\r\n  query GetPunkAttributes {\r\n    punkAttributes @client\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_EVENTS_QUERY = gql`\r\n  ${PUNK_EVENT_FIELDS}\r\n  query GetPunkEvents($id: String!, $limit: Int!, $offset: Int!, $height: String) {\r\n    punkEvents(id: $id, limit: $limit, offset: $offset, height: $height) @client {\r\n      blockHeight\r\n      events {\r\n        ...PunkEventFields\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_OWNER_QUERY = gql`\r\n  query GetPunkOwner($id: String!) {\r\n    punkOwner(id: $id) @client\r\n  }\r\n`;\r\n\r\nexport const GET_PUNK_QUERY = gql`\r\n  ${PUNK_FIELDS}\r\n  query GetPunk($id: ID!) {\r\n    punk(id: $id) @client {\r\n      ...PunkFields\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_PUNKS_QUERY = gql`\r\n  ${PUNK_FIELDS}\r\n  query GetPunks($limit: Int!, $offset: Int!, $sort: PunkSortBy!, $order: OrderBy!, $search: String) {\r\n    punks(limit: $limit, offset: $offset, sort: $sort, order: $order, search: $search) @client {\r\n      ...PunkFields\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_PUNKS_BY_ADDRESS_QUERY = gql`\r\n  ${PUNK_FIELDS}\r\n  query GetPunksByAddress($address: String!, $limit: Int!, $offset: Int!) {\r\n    punksByAddress(address: $address, limit: $limit, offset: $offset) @client {\r\n      ...PunkFields\r\n    }\r\n  }\r\n`;\r\n\r\nexport const PunkQueries = {\r\n  async punkAttributes(parent: any, params: any, context: ApolloContext): Promise<string[]> {\r\n    const result = await context.client.datasource.getPunkAttributesAsync();\r\n    return result;\r\n  },\r\n  async punkEvents(parent: any, { id, limit, offset, height }: any, context: ApolloContext): Promise<PunkEvents> {\r\n    const result = await context.client.datasource.getPunkEventsAsync(id, limit, offset, height);\r\n    return result;\r\n  },\r\n  async punkOwner(parent: any, { id }: any, context: ApolloContext): Promise<Maybe<string>> {\r\n    const result = await context.client.datasource.getPunkOwnerAsync(id);\r\n    return result;\r\n  },\r\n  async punk(parent: any, { id }: any, context: ApolloContext): Promise<Punk> {\r\n    const result = await context.client.datasource.getPunkAsync(id);\r\n    return result;\r\n  },\r\n  async punks(parent: any, { limit, offset, sort, order, search }: any, context: ApolloContext): Promise<Punk[]> {\r\n    const result = await context.client.datasource.getPunksAsync(limit, offset, sort, order, search);\r\n    return result;\r\n  },\r\n  async punksByAddress(parent: any, { address, limit, offset }: any, context: ApolloContext): Promise<Punk[]> {\r\n    const result = await context.client.datasource.getPunksByAddressAsync(address, limit, offset);\r\n    return result;\r\n  },\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\nimport { MarketBid, MarketInfo, MarketOffer, PunkEvents } from \"../util/types\";\r\nimport { PUNK_EVENT_FIELDS } from \"./punk\";\r\n\r\nexport const GET_MARKET_INFO_QUERY = gql`\r\n  query GetMarketInfo {\r\n    marketInfo @client {\r\n      marketStarted\r\n      mintsRemaining\r\n      mintPrice\r\n      actionPrice\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_MARKET_BID_QUERY = gql`\r\n  query GetMarketBid($id: String!) {\r\n    marketBid(id: $id) @client {\r\n      itemIndex\r\n      bidder\r\n      amount\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_MARKET_OFFER_QUERY = gql`\r\n  query GetMarketOffer($id: String!) {\r\n    marketOffer(id: $id) @client {\r\n      itemIndex\r\n      seller\r\n      minAmount\r\n      onlySellTo\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GET_MARKET_EVENTS_QUERY = gql`\r\n  ${PUNK_EVENT_FIELDS}\r\n  query GetMarketEvents($limit: Int!, $offset: Int!, $height: String) {\r\n    marketEvents(limit: $limit, offset: $offset, height: $height) @client {\r\n      blockHeight\r\n      events {\r\n        ...PunkEventFields\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nexport const MarketQueries = {\r\n  async marketInfo(parent: any, params: any, context: ApolloContext): Promise<MarketInfo> {\r\n    const result = await context.client.datasource.getMarketInfoAsync();\r\n    return result;\r\n  },\r\n  async marketBid(parent: any, { id }: any, context: ApolloContext): Promise<Maybe<MarketBid>> {\r\n    const result = await context.client.datasource.getMarketBidAsync(id);\r\n    return result;\r\n  },\r\n  async marketOffer(parent: any, { id }: any, context: ApolloContext): Promise<Maybe<MarketOffer>> {\r\n    const result = await context.client.datasource.getMarketOfferAsync(id);\r\n    return result;\r\n  },\r\n  async marketEvents(parent: any, { limit, offset, height }: any, context: ApolloContext): Promise<PunkEvents> {\r\n    const result = await context.client.datasource.getMarketEventsAsync(limit, offset, height);\r\n    return result;\r\n  }\r\n}","import { gql } from \"@apollo/client\";\r\nimport { ApolloContext } from \"../clients/apollo.client\";\r\nimport { ViteQuotaResult } from \"../util/types\";\r\n\r\nexport const GET_QUOTA_QUERY = gql`\r\n  query GetQuota($address: String!) {\r\n    quota(address: $address) @client {\r\n      currentQuota\r\n      maxQuota\r\n      stakeAmount\r\n    }\r\n  }\r\n`;\r\n\r\nexport const GeneralQueries = {\r\n  async quota(parent: any, { address }: any, context: ApolloContext): Promise<Maybe<ViteQuotaResult>> {\r\n    const result = await context.client.datasource.getQuotaAsync(address);\r\n    return result;\r\n  },\r\n}","import { ApolloClient, InMemoryCache, NormalizedCacheObject } from '@apollo/client';\r\nimport { offsetLimitPagination } from '@apollo/client/utilities';\r\nimport BigNumber from 'bignumber.js';\r\nimport { GraphQLScalarType } from 'graphql';\r\nimport { getCommonContext } from '../contexts/common.context';\r\nimport { IDataSource } from '../datasources';\r\nimport { MarketMutations, PunkMutations } from '../mutations';\r\nimport { MarketQueries, PunkQueries } from '../queries';\r\nimport { GeneralQueries } from '../queries/general';\r\n\r\nexport type ApolloContext = {\r\n  cache: InMemoryCache,\r\n  client: ApolloClientWrapper,\r\n  clientAwareness: any,\r\n  getCacheKey: (obj: any) => string | undefined\r\n}\r\n\r\nexport class ApolloClientWrapper extends ApolloClient<NormalizedCacheObject> {\r\n  get datasource(): IDataSource {\r\n    return getCommonContext().datasource;\r\n  }\r\n}\r\n\r\nconst cache: InMemoryCache = new InMemoryCache({\r\n  typePolicies: {\r\n    Query: {\r\n      fields: {\r\n        // https://www.apollographql.com/docs/react/pagination/offset-based/\r\n        punks: offsetLimitPagination([\"order\", \"sort\"]),\r\n        punksByAddress: offsetLimitPagination(),\r\n        //marketEvents: offsetLimitPagination()\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nconst bigNumberScalar = new GraphQLScalarType({\r\n  name: 'BigNumber',\r\n  description: 'BigNumber custom scalar type',\r\n  serialize(value: BigNumber) {\r\n    return value.toFixed();\r\n  },\r\n  parseValue(value: string) {\r\n    return new BigNumber(value);\r\n  }\r\n});\r\n\r\nconst resolvers: any = {\r\n  BigNumber: bigNumberScalar,\r\n  Query: {\r\n    ...GeneralQueries,\r\n    ...PunkQueries,\r\n    ...MarketQueries\r\n  },\r\n  Mutation: {\r\n    ...PunkMutations,\r\n    ...MarketMutations\r\n  }\r\n};\r\n\r\n// https://www.apollographql.com/docs/react/networking/authentication/#header\r\nconst client = new ApolloClientWrapper({\r\n  // link: authLink.concat(httpLink),\r\n  cache: cache,\r\n  resolvers,\r\n  headers: {\r\n    'client-name': process.env.REACT_APP_NAME || 'client',\r\n    'client-version': process.env.REACT_APP_VERSION || '0',\r\n  },\r\n})\r\n\r\nexport const getApolloClient = () => {\r\n  return client;\r\n}","import BigNumber from \"bignumber.js\";\r\nimport { Network } from \"../util/types\";\r\n\r\nexport class NetworkManager {\r\n  private _networkHeight: BigNumber;\r\n  private _network?: Maybe<Network>;\r\n  private _setNetworkCallback?: (network?: Maybe<Network>) => void;\r\n\r\n  constructor() {\r\n    this._networkHeight = new BigNumber(\"0\");\r\n  }\r\n\r\n  set networkHeight(height: BigNumber) {\r\n    this._networkHeight = height;\r\n  }\r\n\r\n  get networkHeight(): BigNumber {\r\n    return this._networkHeight;\r\n  }\r\n\r\n  set onSetNetworkCallback(cb: (network?: Maybe<Network>) => void) {\r\n    this._setNetworkCallback = cb;\r\n  }\r\n\r\n  getNetwork(): Maybe<Network> {\r\n    return this._network;\r\n  }\r\n\r\n  setNetwork(network?: Maybe<Network>): void {\r\n    this._network = network;\r\n    if (this._setNetworkCallback) {\r\n      this._setNetworkCallback(this._network);\r\n    }\r\n  }\r\n}\r\n\r\nconst manager = new NetworkManager();\r\n\r\nexport const getNetworkManager = () => {\r\n  return manager;\r\n}","import { styled, Typography } from '@mui/material';\r\n\r\nconst Root = styled('div')(\r\n  ({ theme }) => `\r\n  padding-bottom: 10px;\r\n  padding-top: 10px;\r\n  padding-left: 24px;\r\n  padding-right: 24px;\r\n  text-align: right;\r\n`,\r\n);\r\n\r\nexport const Footer = () => {\r\n  return (\r\n    <>\r\n      <Root>\r\n        <Typography>v{process.env.REACT_APP_VERSION}</Typography>\r\n      </Root>\r\n    </>\r\n  )\r\n}\r\n","import { AppBar, styled, Toolbar, Typography } from '@mui/material';\r\nimport React from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\n\r\nconst Root = styled('div')(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n`,\r\n);\r\n\r\nconst TitleTypography = styled(Typography)(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n  margin-left: 10px !important;\r\n`,\r\n);\r\n\r\nexport const HeaderLoading: React.FC = (props: any) => {\r\n  return (\r\n    <Root>\r\n      <AppBar position=\"static\">\r\n        <Toolbar>\r\n          <TitleTypography variant=\"h6\">\r\n            {CommonConstants.APP_NAME}\r\n          </TitleTypography>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Root>\r\n  )\r\n}","import { Container, styled } from '@mui/material';\r\nimport * as React from 'react';\r\n\r\nconst MainScrollStyled = styled('div')(\r\n  ({ theme }) => `\r\n  display: flex;\r\n  flex-direction: column;\r\n  flex-grow: 1;\r\n  align-items: center;\r\n  padding-bottom: 15px;\r\n  padding-top: 30px;\r\n  overflow: auto;\r\n  overflow-x: hidden;\r\n`,\r\n);\r\n\r\nconst MainScrollInner = styled('div')(\r\n  ({ theme }) => `\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n`,\r\n);\r\n\r\nexport const MainScroll: React.FC = props => {\r\n  const { children, ...restProps } = props\r\n\r\n  return (\r\n    <MainScrollStyled id=\"mainscroll\" {...restProps}>\r\n      <Container maxWidth=\"xl\">\r\n        <MainScrollInner>{children}</MainScrollInner>\r\n      </Container>\r\n    </MainScrollStyled>\r\n  )\r\n}\r\n","import { styled } from '@mui/material';\r\nimport React from 'react';\r\n\r\nconst MainWrapperStyled = styled('div')(\r\n  ({ theme }) => `\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100vh;\r\n`,\r\n);\r\n\r\nexport const MainWrapper: React.FC = props => {\r\n  const { children, ...restProps } = props\r\n\r\n  return <MainWrapperStyled {...restProps}>{children}</MainWrapperStyled>\r\n}\r\n","import React, { useState } from 'react';\r\nimport { getNetworkManager } from '../common/network';\r\nimport { Network } from '../util/types';\r\nimport { getWalletManager, SessionWallet, WebWallet } from '../wallet';\r\n\r\nexport interface IWeb3Context {\r\n  setError: (error: Error) => void,\r\n  error?: Maybe<Error>,\r\n  wallet?: Maybe<WebWallet | SessionWallet>\r\n  network?: Maybe<Network>\r\n}\r\n\r\nconst Web3Context = React.createContext<Maybe<IWeb3Context>>(undefined)\r\n\r\nexport const useWeb3Context = () => {\r\n  const context = React.useContext(Web3Context)\r\n\r\n  if (!context) {\r\n    throw new Error('Component rendered outside the provider tree')\r\n  }\r\n\r\n  return context\r\n}\r\n\r\ninterface Props {\r\n  children?: React.ReactNode\r\n}\r\n\r\nexport const Web3Provider: React.FC<Props> = (props: Props) => {\r\n  const [error, setError] = useState<Maybe<Error>>(null)\r\n  const [wallet, setWallet] = useState<Maybe<WebWallet | SessionWallet>>(null)\r\n  const [network, setNetwork] = useState<Maybe<Network>>(null)\r\n\r\n  const walletManager = getWalletManager()\r\n  walletManager.onSetWalletCallback = setWallet\r\n\r\n  const networkManager = getNetworkManager()\r\n  networkManager.onSetNetworkCallback = setNetwork\r\n\r\n  const context: IWeb3Context = {\r\n    setError,\r\n    error,\r\n    wallet,\r\n    network\r\n  }\r\n\r\n  return (\r\n    <Web3Context.Provider value={context}>{props.children}</Web3Context.Provider>\r\n  )\r\n}\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { CommonConfig } from '../common/config';\r\nimport { Networks } from '../common/constants';\r\nimport { getNetworkManager } from '../common/network';\r\nimport { MainLoading } from '../features/main/components/loading';\r\nimport { getLogger } from '../util/logger';\r\nimport { Network } from '../util/types';\r\nimport { getWalletManager } from '../wallet';\r\nimport { getCommonContext } from './common.context';\r\nimport { useWeb3Context } from './web3';\r\n\r\nconst logger = getLogger()\r\n\r\nexport interface IConnectedWeb3Context {\r\n  account?: string\r\n  network?: Maybe<Network>\r\n  logout: () => void\r\n}\r\n\r\nconst ConnectedWeb3Context = React.createContext<Maybe<IConnectedWeb3Context>>(undefined)\r\n\r\n/**\r\n * This hook can only be used by components under the `ConnectedWeb3` component. Otherwise it will throw.\r\n */\r\nexport const useConnectedWeb3Context = () => {\r\n  const context = React.useContext(ConnectedWeb3Context)\r\n\r\n  if (!context) {\r\n    throw new Error('Component rendered outside the provider tree')\r\n  }\r\n\r\n  return context\r\n}\r\n\r\ninterface Props {\r\n  children?: React.ReactNode\r\n}\r\n\r\n/**\r\n * Component used to render components that depend on Web3 being available. These components can then\r\n * `useConnectedWeb3Context` safely to get web3 stuff without having to null check it.\r\n */\r\nexport const ConnectedWeb3: React.FC<Props> = (props: Props) => {\r\n  const [connection, setConnection] = useState<IConnectedWeb3Context | null>(null)\r\n  const web3Context = useWeb3Context()\r\n  const commonContext = getCommonContext()\r\n\r\n  const { wallet, network } = web3Context\r\n\r\n  useEffect(() => {\r\n    if (!wallet) {\r\n      const walletManager = getWalletManager()\r\n      walletManager.initWallet()\r\n    }\r\n  }, [wallet])\r\n\r\n  useEffect(() => {\r\n    if (!network) {\r\n      const networkManager = getNetworkManager()\r\n      const networkId = CommonConfig.NETWORK_ID;\r\n      networkManager.setNetwork(Networks.find(e => e.id === networkId))\r\n      logger.info(\"Network:\", networkManager.getNetwork())()\r\n    }\r\n  }, [network])\r\n\r\n  const logout = useCallback(() => {\r\n    const walletManager = getWalletManager()\r\n    walletManager.removeWallet()\r\n    window.location.reload()\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const value = {\r\n      account: wallet?.active?.address,\r\n      network,\r\n      logout\r\n    }\r\n\r\n    logger.info('ConnectedWeb3.account', wallet?.active?.address)()\r\n\r\n    const initAsync = async () => {\r\n      if (network) {\r\n        logger.info('Init ConnectedWeb3')()\r\n        try {\r\n          setConnection(null)\r\n          await commonContext.initAsync()\r\n          setConnection(value)\r\n        } catch (error) {\r\n          logger.error(error)();\r\n        }\r\n      }\r\n    }\r\n    initAsync()\r\n    return () => {\r\n      commonContext.dispose()\r\n    }\r\n  }, [wallet, network, logout, commonContext])\r\n\r\n  if (!connection) {\r\n    return MainLoading()\r\n  }\r\n\r\n  const value = {\r\n    ...connection\r\n  }\r\n\r\n  return (\r\n    <ConnectedWeb3Context.Provider value={value}>{props.children}</ConnectedWeb3Context.Provider>\r\n  )\r\n}","\r\nimport { Typography } from '@mui/material';\r\nimport { Footer } from '../../../layout/components/footer';\r\nimport { HeaderLoading } from '../../../layout/components/header-loading';\r\nimport { MainScroll } from '../../../layout/components/main-scroll';\r\nimport { MainWrapper } from '../../../layout/components/main-wrapper';\r\n\r\nexport const MainLoading = () => {\r\n\r\n  return (\r\n    <MainWrapper>\r\n      <HeaderLoading />\r\n      <MainScroll>\r\n        <Typography>Loading...</Typography>\r\n      </MainScroll>\r\n      <Footer />\r\n    </MainWrapper>\r\n  )\r\n}\r\n","import { ProviderContext } from \"notistack\";\r\nimport { getEmitter } from \"./emitter\";\r\nimport { FormatUtil } from \"./format.util\";\r\n\r\nexport abstract class SnackbarUtil {\r\n  static snackbar: ProviderContext;\r\n  static enqueueError(error: any): void {\r\n    const message = FormatUtil.formatMessage(error);\r\n    if (message === \"Session currently disconnected\") {\r\n      const emitter = getEmitter();\r\n      emitter.emitConnectWalletDialog(true);\r\n    }\r\n    SnackbarUtil.snackbar.enqueueSnackbar(message);\r\n  }\r\n  static enqueueMessage(message: string): void {\r\n    SnackbarUtil.snackbar.enqueueSnackbar(message);\r\n  }\r\n}","import React from 'react';\r\nimport { Box, Paper, Typography } from '@mui/material';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\n\r\ninterface Props {\r\n  message: string\r\n  type: 'default' | 'warning'\r\n  error?: any\r\n  color?: string\r\n  backgroundColor?: string\r\n}\r\n\r\nexport const Alert: React.FC<Props> = (props: Props) => {\r\n  let color = '#000000';\r\n  let backgroundColor = 'rgba(255, 255, 255, 0.5)';\r\n\r\n  switch (props.type) {\r\n    case 'warning':\r\n      color = '#611a15';\r\n      backgroundColor = 'rgba(255, 0, 0, 0.1)';\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  if (props.error) {\r\n    console.log(CommonUtil.toJsonString(props.error));\r\n  }\r\n\r\n  return (\r\n    <Paper>\r\n      <Box sx={{\r\n        color: props.color ?? color,\r\n        backgroundColor: props.backgroundColor ?? backgroundColor,\r\n        padding: '15px',\r\n        textAlign: 'center'\r\n      }}>\r\n        <Typography>{props.message}</Typography>\r\n      </Box>\r\n    </Paper>\r\n  );\r\n}\r\n","import { CommonUtil } from \"./common.util\";\r\n\r\nexport abstract class UrlUtil {\r\n  static getPunkUrl(image?: Maybe<string>): string {\r\n    if (image && !CommonUtil.isNullOrWhitespace(image)) {\r\n      return `https://cdn.vitepunks.com/punks/iso/${image}`;\r\n    }\r\n    return \"\";\r\n  }\r\n}","import { SvgIcon, SxProps, Theme } from \"@mui/material\";\r\nimport React from \"react\";\r\n\r\ntype FontAwesomeSvgIconProps = {\r\n  icon: any;\r\n  sx?: SxProps<Theme>\r\n};\r\n\r\n// interface CustomSVGSVGElement extends SVGSVGElement {\r\n//   sx?: SxProps<Theme>\r\n// }\r\n\r\nexport const FontAwesomeSvgIcon = React.forwardRef<SVGSVGElement, FontAwesomeSvgIconProps>(\r\n  (props, ref) => {\r\n    const { icon } = props;\r\n\r\n    const {\r\n      icon: [width, height, , , svgPathData],\r\n    } = icon;\r\n\r\n    return (\r\n      <SvgIcon ref={ref} viewBox={`0 0 ${width} ${height}`} sx={props.sx}>\r\n        {typeof svgPathData === 'string' ? (\r\n          <path d={svgPathData} />\r\n        ) : (\r\n          /**\r\n           * A multi-path Font Awesome icon seems to imply a duotune icon. The 0th path seems to\r\n           * be the faded element (referred to as the \"secondary\" path in the Font Awesome docs)\r\n           * of a duotone icon. 40% is the default opacity.\r\n           *\r\n           * @see https://fontawesome.com/how-to-use/on-the-web/styling/duotone-icons#changing-opacity\r\n           */\r\n          svgPathData.map((d: string, i: number) => (\r\n            <path style={{ opacity: i === 0 ? 0.4 : 1 }} d={d} />\r\n          ))\r\n        )}\r\n      </SvgIcon>\r\n    );\r\n  },\r\n);","import { styled } from '@mui/material/styles';\r\nimport Tooltip, { tooltipClasses, TooltipProps } from '@mui/material/Tooltip';\r\nimport * as React from 'react';\r\n\r\nexport interface CustomTooltipProps extends TooltipProps {\r\n  fullWidth?: boolean\r\n}\r\n\r\nexport const ExtendedBootstrapTooltip: React.FC<CustomTooltipProps> = (props: CustomTooltipProps) => {\r\n  return (\r\n    <BootstrapTooltip {...props} sx={{ [`& .${tooltipClasses.tooltip}`]: { maxWidth: \"none\" } }}></BootstrapTooltip>\r\n  )\r\n}\r\n\r\nexport const LightTooltip = styled(({ className, ...props }: TooltipProps) => (\r\n  <Tooltip {...props} classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: theme.palette.common.white,\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    boxShadow: theme.shadows[1],\r\n    fontSize: 11,\r\n  },\r\n}));\r\n\r\nexport const BootstrapTooltip = styled(({ className, ...props }: TooltipProps) => (\r\n  <Tooltip {...props} arrow classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.arrow}`]: {\r\n    color: theme.palette.common.black,\r\n  },\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: theme.palette.common.black,\r\n  },\r\n}));\r\n\r\nexport const HtmlTooltip = styled(({ className, ...props }: TooltipProps) => (\r\n  <Tooltip {...props} classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: '#f5f5f9',\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    maxWidth: 220,\r\n    fontSize: theme.typography.pxToRem(12),\r\n    border: '1px solid #dadde9',\r\n  },\r\n}));","\r\nimport { faGem } from '@fortawesome/free-regular-svg-icons';\r\nimport { Box, CardActionArea, Chip, styled } from '@mui/material';\r\nimport Card from '@mui/material/Card';\r\nimport CardContent from '@mui/material/CardContent';\r\nimport Typography from '@mui/material/Typography';\r\nimport React from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { Punk } from '../../../../util/types';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\nimport { FontAwesomeSvgIcon } from '../../../common/components/fa-icon';\r\nimport { ExtendedBootstrapTooltip } from '../../../common/components/tooltip';\r\n\r\nconst CustomCardMedia = styled('div')(({ theme }) => (`\r\n  position: relative;\r\n  height: 320px;\r\n  // animation: lightning 4s ease-out infinite;\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n`));\r\n\r\nconst PunkImage = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  image-rendering: pixelated;\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  item: Punk\r\n}\r\n\r\nexport const MarketplaceBrowseItem: React.FC<Props> = (props: Props) => {\r\n\r\n  return (\r\n    <Card>\r\n      <CardActionArea component={RouterLink} to={`/punk/${props.item.id}`}>\r\n        <CustomCardMedia>\r\n          <Box sx={{ position: \"absolute\", top: 5, right: 5 }}>\r\n            <ExtendedBootstrapTooltip sx={{ mr: 1 }} title={<span>Rarity rank</span>} placement=\"bottom\" arrow>\r\n              <Chip size=\"small\" icon={<FontAwesomeSvgIcon icon={faGem} sx={{ fontSize: \"small\", marginLeft: 1 }} />} sx={{ fontSize: \"0.7rem\" }} label={props.item.rank} />\r\n            </ExtendedBootstrapTooltip>\r\n          </Box>\r\n          <PunkImage sx={{ backgroundImage: `url('${UrlUtil.getPunkUrl(props.item.image)}')` }} />\r\n        </CustomCardMedia>\r\n        <CardContent sx={{ p: 0 }}>\r\n          <Typography variant=\"h6\" component=\"div\" sx={{ p: 1 }}>\r\n            {CommonConstants.PUNK_NAME} #{props.item.id}\r\n          </Typography>\r\n          <Box sx={{ height: \"70px\", overflow: \"auto\" }}>\r\n            <Box sx={{ p: 1 }}>\r\n              {props.item.attributes?.map((a: string) => (\r\n                <Chip key={a} label={a} variant=\"outlined\" sx={{ mb: 1, mr: 1 }} size=\"small\" />\r\n              ))}\r\n            </Box>\r\n          </Box>\r\n        </CardContent>\r\n      </CardActionArea>\r\n    </Card>\r\n  )\r\n}\r\n","import { ApolloError, QueryResult, useQuery } from '@apollo/client';\r\nimport { Container, Grid, Typography } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport { useParams } from 'react-router-dom';\r\nimport { GET_PUNKS_BY_ADDRESS_QUERY } from '../../../../queries';\r\nimport { GetPunksByAddress, GetPunksByAddressVariables, GetPunksByAddress_punksByAddress } from '../../../../queries/__generated__/GetPunksByAddress';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { Punk } from '../../../../util/types';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { MarketplaceBrowseItem } from '../../../marketplace/components/browse-item';\r\n\r\ninterface EmptyResultProps {\r\n  error: ApolloError | undefined\r\n  query: QueryResult<GetPunksByAddress, GetPunksByAddressVariables>\r\n}\r\n\r\nconst EmptyResult: React.FC<EmptyResultProps> = (props: EmptyResultProps) => {\r\n  return (\r\n    <>\r\n      {props.error ? (\r\n        <Alert message={FormatUtil.formatMessage(props.error)} type=\"warning\"></Alert>\r\n      ) : (\r\n        <>\r\n          {props.query.loading || (props.query.data && props.query.data.punksByAddress.length > 0) ? (\r\n            <></>\r\n          ) : (\r\n            <Alert message=\"No punks found\" type=\"default\" ></Alert>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport const AccountDetails: React.FC = (props: any) => {\r\n  const { address } = useParams();\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n\r\n  const query = useQuery<GetPunksByAddress, GetPunksByAddressVariables>(GET_PUNKS_BY_ADDRESS_QUERY, {\r\n    variables: {\r\n      address: address ?? \"\",\r\n      offset: 0,\r\n      limit: limit\r\n    },\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    const currentLength = query.data?.punksByAddress.length ?? 0;\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await query.fetchMore({\r\n        variables: {\r\n          offset: currentLength,\r\n          limit: limit\r\n        }\r\n      });\r\n      setHasMore(result.data.punksByAddress.length >= limit);\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Typography variant=\"h2\" component=\"div\" textAlign=\"center\" sx={{ pt: 3 }}>\r\n        Account\r\n      </Typography>\r\n      <Typography variant=\"subtitle1\" component=\"div\" textAlign=\"center\" gutterBottom>\r\n        {address}\r\n      </Typography>\r\n      <Container sx={{ pt: 3, pb: 6 }} maxWidth=\"xl\">\r\n        {isLoading || (query.data && query.data.punksByAddress.length > 0) ? (\r\n          <InfiniteScroll\r\n            dataLength={query.data?.punksByAddress.length ?? 0}\r\n            next={fetchMoreDataAsync}\r\n            hasMore={hasMore}\r\n            loader={\r\n              <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n                <Grid item key='1' xs={12} md={6}>\r\n                  {isLoading ? (\r\n                    <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n                  ) : (\r\n                    <EmptyResult error={error} query={query}></EmptyResult>\r\n                  )}\r\n                </Grid>\r\n              </Grid>\r\n            }\r\n            scrollableTarget=\"mainscroll\"\r\n          >\r\n            <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\" marginBottom={3}>\r\n              {query.data?.punksByAddress.map((p: GetPunksByAddress_punksByAddress) => (\r\n                <Grid item key={p.id} xs={12} sm={6} md={4} lg={3}>\r\n                  <MarketplaceBrowseItem item={p as Punk}></MarketplaceBrowseItem>\r\n                </Grid>\r\n              ))}\r\n            </Grid>\r\n          </InfiniteScroll>\r\n        ) : (\r\n          <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n            <Grid item key='1' xs={12} md={6}>\r\n              <EmptyResult error={error} query={query}></EmptyResult>\r\n            </Grid>\r\n          </Grid>\r\n        )}\r\n      </Container>\r\n    </>\r\n  )\r\n}\r\n","import { Button } from '@mui/material';\r\nimport confetti from 'canvas-confetti';\r\nimport React, { useCallback } from 'react';\r\nimport { getViteClient } from '../../../../clients/vite.client';\r\nimport { getWalletManager } from '../../../../wallet';\r\n\r\nexport const Test = () => {\r\n  const walletManager = getWalletManager();\r\n  const viteClient = getViteClient();\r\n\r\n  const onClick = useCallback(() => {\r\n    confetti({\r\n      particleCount: 150,\r\n      spread: 60\r\n    });\r\n    const wallet = walletManager.getWallet();\r\n    if (wallet?.active) {\r\n      viteClient.receiveAllOnroadTxAsync(wallet.active);\r\n    }\r\n  }, [viteClient, walletManager]);\r\n  return (\r\n    <>\r\n      Test {process.env.REACT_APP_VERSION} {process.env.REACT_APP_EXPLORER_URL}\r\n      <Button onClick={onClick}>Test</Button>\r\n    </>\r\n  );\r\n}\r\n","import { ApolloClient, FetchPolicy, NormalizedCacheObject } from \"@apollo/client\";\r\nimport { getApolloClient } from \"../clients/apollo.client\";\r\nimport { MINT_MUTATION } from \"../mutations\";\r\nimport { Mint } from \"../mutations/__generated__/Mint\";\r\nimport { GET_MARKET_BID_QUERY, GET_MARKET_OFFER_QUERY, GET_PUNK_EVENTS_QUERY, GET_PUNK_OWNER_QUERY, GET_PUNK_QUERY } from \"../queries\";\r\nimport { GetMarketBid, GetMarketBidVariables } from \"../queries/__generated__/GetMarketBid\";\r\nimport { GetMarketOffer, GetMarketOfferVariables } from \"../queries/__generated__/GetMarketOffer\";\r\nimport { GetPunk, GetPunkVariables } from \"../queries/__generated__/GetPunk\";\r\nimport { GetPunkEvents, GetPunkEventsVariables } from \"../queries/__generated__/GetPunkEvents\";\r\nimport { GetPunkOwner, GetPunkOwnerVariables } from \"../queries/__generated__/GetPunkOwner\";\r\nimport { Punk, PunkExtended, TypeNames } from \"../util/types\";\r\n\r\nclass PunkService {\r\n  private readonly _apollo: ApolloClient<NormalizedCacheObject>;\r\n\r\n  constructor() {\r\n    this._apollo = getApolloClient();\r\n  }\r\n\r\n  getById = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetPunk, GetPunkVariables>({\r\n      query: GET_PUNK_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getOwnerAsync = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetPunkOwner, GetPunkOwnerVariables>({\r\n      query: GET_PUNK_OWNER_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getBidAsync = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketBid, GetMarketBidVariables>({\r\n      query: GET_MARKET_BID_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getOfferAsync = (_id: string, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketOffer, GetMarketOfferVariables>({\r\n      query: GET_MARKET_OFFER_QUERY,\r\n      variables: {\r\n        id: _id\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getEventsAsync = (_id: string, _offset: number, _limit: number, _height?: Maybe<string>, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetPunkEvents, GetPunkEventsVariables>({\r\n      query: GET_PUNK_EVENTS_QUERY,\r\n      variables: {\r\n        id: _id,\r\n        offset: _offset,\r\n        limit: _limit,\r\n        height: _height\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getExtendedAsync = async (_punk: Punk, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    const defaultPunkExtended = {\r\n      __typename: TypeNames.PunkExtended,\r\n      id: _punk.id,\r\n      rank: _punk.rank,\r\n      image: _punk.image,\r\n      attributes: _punk.attributes\r\n    };\r\n    const ownerQuery = await this.getOwnerAsync(_punk.id, _fetchPolicy);\r\n    const bidQuery = await this.getBidAsync(_punk.id, _fetchPolicy);\r\n    const offerQuery = await this.getOfferAsync(_punk.id, _fetchPolicy);\r\n\r\n    const punkExtended: PunkExtended = {\r\n      ...defaultPunkExtended,\r\n      owner: ownerQuery.data.punkOwner,\r\n      bid: bidQuery.data.marketBid,\r\n      offer: offerQuery.data.marketOffer\r\n    }\r\n\r\n    const error = ownerQuery.error || bidQuery.error || offerQuery.error;\r\n    const loading = ownerQuery.loading || bidQuery.loading || offerQuery.loading;\r\n\r\n    return {\r\n      punkExtended,\r\n      ownerQuery,\r\n      bidQuery,\r\n      offerQuery,\r\n      error,\r\n      loading\r\n    };\r\n  }\r\n\r\n  async mintAsync(): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Mint>({\r\n      mutation: MINT_MUTATION\r\n    });\r\n    return Boolean(result.data?.mint ?? false);\r\n  }\r\n}\r\n\r\nconst service = new PunkService();\r\n\r\nexport const getPunkService = () => {\r\n  return service;\r\n}","import { styled } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\n\r\nconst ImageContainer = styled('div')(\r\n  ({ theme }) => `\r\n  position: relative;\r\n  width: 80vw;\r\n  height: 80vw; \r\n  max-width: 400px;\r\n  max-height: 400px;\r\n  animation: lightning 4s ease-out infinite;\r\n`,\r\n);\r\n\r\nconst Image = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  border: 5px solid #fff;\r\n  border-radius: 50%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n`,\r\n);\r\n\r\nconst Img1 = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.SAMPLE_PUNK_URL}');\r\n  border-radius: 50%;\r\n  animation: toggle 4s linear -2s infinite alternate;\r\n  image-rendering: pixelated;\r\n`,\r\n);\r\n\r\n\r\nconst Img2 = styled('img')(\r\n  ({ theme }) => `\r\n  top: 0;\r\n  left: 0;\r\n  position: fixed;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  border: 5px solid #fff;\r\n  border-radius: 50%;\r\n  visibility: hidden;\r\n  animation: toggle 4s linear 2s infinite alternate;\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  punkId1?: Maybe<number>\r\n  punkId2?: Maybe<number>\r\n}\r\n\r\n\r\nexport const LandingMainImage: React.FC<Props> = (props: Props) => {\r\n  const [imageUrl1, setImageUrl1] = useState<Maybe<string>>(undefined);\r\n  const [imageUrl2, setImageUrl2] = useState<Maybe<string>>(undefined);\r\n  const service = getPunkService();\r\n\r\n  useEffect(() => {\r\n    const setImageUrlsAsync = async () => {\r\n      if (props.punkId1) {\r\n        const punk1 = await service.getById(props.punkId1.toString());\r\n        setImageUrl1(UrlUtil.getPunkUrl(punk1.data.punk.image));\r\n      }\r\n      if (props.punkId2) {\r\n        const punk2 = await service.getById(props.punkId2.toString());\r\n        setImageUrl2(UrlUtil.getPunkUrl(punk2.data.punk.image));\r\n      }\r\n    }\r\n    setImageUrlsAsync();\r\n  }, [props.punkId1, props.punkId2, service])\r\n\r\n  return (\r\n    <ImageContainer>\r\n      <Image>\r\n        <Img1 sx={{ backgroundImage: `url('${imageUrl1 ?? CommonConstants.SAMPLE_PUNK_URL}')` }} />\r\n        <Img2 sx={{ backgroundImage: `url('${imageUrl2 ?? CommonConstants.SAMPLE_PUNK_URL}')` }} />\r\n      </Image>\r\n    </ImageContainer>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { LandingMainImage } from '../../../landing/components/main-image';\r\n\r\nexport const TestImage = () => {\r\n  return (\r\n    <>\r\n      <LandingMainImage punkId1={5667} punkId2={3848}></LandingMainImage>\r\n    </>\r\n  );\r\n}\r\n","import { BigNumber } from \"bignumber.js\";\r\n\r\nexport abstract class TokenUtil {\r\n  static formatBigNumber(bn: BigNumber, tokenDecimals: number, decimals: number): string {\r\n    return bn.div(new BigNumber(\"10\").pow(tokenDecimals)).decimalPlaces(decimals, BigNumber.ROUND_DOWN).toFormat();\r\n  }\r\n}","import { LoadingButton } from '@mui/lab';\r\nimport { SxProps, Theme } from '@mui/system';\r\nimport React from 'react';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n  size?: 'small' | 'medium' | 'large'\r\n  variant?: 'text' | 'outlined' | 'contained'\r\n  color?: 'inherit' | 'primary' | 'secondary' | 'success' | 'error' | 'info' | 'warning',\r\n  fullWidth?: boolean\r\n  autoFocus?: boolean\r\n  disabled?: boolean\r\n  startIcon?: React.ReactNode;\r\n  sx?: SxProps<Theme>\r\n  callbackFn: () => Promise<void>\r\n}\r\n\r\nexport const ClickOnceButton: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [isDisabled, setIsDisabled] = React.useState(false);\r\n\r\n  const handleClick = async () => {\r\n    setIsDisabled(true);\r\n    try {\r\n      await props.callbackFn();\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(FormatUtil.formatMessage(error));\r\n    }\r\n    if (mounted.current) {\r\n      setIsDisabled(false);\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <LoadingButton\r\n      loading={isDisabled}\r\n      size={props.size ?? \"small\"}\r\n      variant={props.variant ?? \"contained\"}\r\n      color={props.color ?? \"primary\"}\r\n      fullWidth={props.fullWidth}\r\n      disabled={props.disabled}\r\n      onClick={handleClick}\r\n      startIcon={props.startIcon}\r\n      sx={props.sx}\r\n    >\r\n      {props.children}\r\n    </LoadingButton>\r\n  );\r\n}\r\n","import { Typography } from '@mui/material';\r\nimport React from 'react';\r\nimport { MomentUtil } from '../../../../util/moment.util';\r\n\r\ninterface Props {\r\n  date: string\r\n}\r\n\r\ntype CountdownState = {\r\n  days: number\r\n  hours: number\r\n  minutes: number\r\n  seconds: number\r\n}\r\n\r\nexport const Countdown: React.FC<Props> = (props: Props) => {\r\n  const moment = React.useMemo<MomentUtil>(() => {\r\n    return new MomentUtil();\r\n  }, []);\r\n  const duration = moment.getDuration(props.date);\r\n  const mounted = React.useRef(false);\r\n  const [state, setState] = React.useState<CountdownState>({\r\n    days: duration.days() > 0 ? duration.days() : 0,\r\n    hours: duration.hours() > 0 ? duration.hours() : 0,\r\n    minutes: duration.minutes() > 0 ? duration.minutes() : 0,\r\n    seconds: duration.seconds() > 0 ? duration.seconds() : 0\r\n  });\r\n\r\n  if (duration.asSeconds() > 0) {\r\n    setTimeout(() => {\r\n      const duration = moment.getDuration(props.date);\r\n      if (mounted.current) {\r\n        setState({\r\n          days: duration.days(),\r\n          hours: duration.hours(),\r\n          minutes: duration.minutes(),\r\n          seconds: duration.seconds()\r\n        });\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n      <b>{state.days}</b> days <b>{state.hours}</b> hours <b>{state.minutes}</b> minutes <b>{state.seconds}</b> seconds\r\n    </Typography>\r\n  );\r\n}\r\n","import ArrowForwardIosSharpIcon from '@mui/icons-material/ArrowForwardIosSharp';\r\nimport { Accordion as MuiAccordion, AccordionDetails as MuiAccordionDetails, AccordionProps, AccordionSummary as MuiAccordionSummary, AccordionSummaryProps, Box, Link, styled, Typography } from '@mui/material';\r\nimport React from 'react';\r\n\r\nconst Accordion = styled((props: AccordionProps) => (\r\n  <MuiAccordion disableGutters elevation={0} square {...props} />\r\n))(({ theme }) => ({\r\n  border: `1px solid ${theme.palette.divider}`,\r\n  '&:not(:last-child)': {\r\n    borderBottom: 0,\r\n  },\r\n  '&:before': {\r\n    display: 'none',\r\n  },\r\n  backgroundColor:\r\n    theme.palette.mode === 'dark'\r\n      ? 'rgba(0, 0, 0, .2)'\r\n      : 'rgba(255, 255, 255, .2)',\r\n}));\r\n\r\nconst AccordionSummary = styled((props: AccordionSummaryProps) => (\r\n  <MuiAccordionSummary\r\n    expandIcon={<ArrowForwardIosSharpIcon sx={{ fontSize: '0.9rem' }} />}\r\n    {...props}\r\n  />\r\n))(({ theme }) => ({\r\n  backgroundColor:\r\n    theme.palette.mode === 'dark'\r\n      ? 'rgba(255, 255, 255, .05)'\r\n      : 'rgba(0, 0, 0, .03)',\r\n  flexDirection: 'row-reverse',\r\n  '& .MuiAccordionSummary-expandIconWrapper.Mui-expanded': {\r\n    transform: 'rotate(90deg)',\r\n  },\r\n  '& .MuiAccordionSummary-content': {\r\n    marginLeft: theme.spacing(1),\r\n  },\r\n}));\r\n\r\nconst AccordionDetails = styled(MuiAccordionDetails)(({ theme }) => ({\r\n  padding: theme.spacing(2),\r\n  borderTop: '1px solid rgba(0, 0, 0, .125)',\r\n}));\r\n\r\nexport const LandingFaq = () => {\r\n  const [faqExpanded, setFaqExpanded] = React.useState<string | false>('faq0');\r\n\r\n  const handleChange = (panel: string) => (event: React.SyntheticEvent, newExpanded: boolean) => {\r\n    setFaqExpanded(newExpanded ? panel : false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" marginBottom={2}>\r\n        <div>\r\n          <Typography variant=\"h5\" color=\"textSecondary\" textAlign=\"center\">\r\n            FAQ\r\n          </Typography>\r\n          <Typography variant=\"subtitle1\" color=\"textSecondary\" textAlign=\"center\">\r\n            Frequently Asked Questions\r\n          </Typography>\r\n        </div>\r\n      </Box>\r\n      <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n        <Box maxWidth={800}>\r\n          <Accordion expanded={faqExpanded === 'faq0'} onChange={handleChange('faq0')}>\r\n            <AccordionSummary aria-controls=\"faq0-content\" id=\"faq0-header\">\r\n              <Typography>What is the vision behind VitePunks?</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography>\r\n                Our main vision is to develop the best possible marketplace for our punks and maybe open it to other artists at some point, depending on what other NFT marketplaces will be released on Vite in the near future.\r\n                What is very important to us is long-term availability. We would like to guarantee that our punks will be accessible as long as Vite exists.\r\n                For example we plan to store our images on IPFS in addition to our own cloud storage.\r\n                <br></br>\r\n                <br></br>\r\n                The compiled version of this website can already be\r\n                cloned and forked on <Link underline=\"hover\" href=\"https://github.com/vitepunks/vitepunks.github.io\" target=\"_blank\">GitHub</Link> or\r\n                accessed by this link <Link underline=\"hover\" href=\"https://vitepunks.github.io/website/\" target=\"_blank\">https://vitepunks.github.io/website/</Link>.\r\n                Always with the hope to ensure resiliency and establish more trust overall long-term.\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n          <Accordion expanded={faqExpanded === 'faq1'} onChange={handleChange('faq1')}>\r\n            <AccordionSummary aria-controls=\"faq1-content\" id=\"faq1-header\">\r\n              <Typography>Why is the smart contract not open-source yet?</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography>\r\n                We understand that the situation for some is not satisfactory right now. Being pioneers in any space is always coupled with a lot of work, sometimes it gets rewarded, more often not.\r\n                What we can assure is that we will make our smart contract public as soon as another high-quality project delivers something similar to us.\r\n                Maybe this is the wrong approach but ultimately this is actually a really hard decision to make.\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n          <Accordion expanded={faqExpanded === 'faq2'} onChange={handleChange('faq2')}>\r\n            <AccordionSummary aria-controls=\"faq2-content\" id=\"faq2-header\">\r\n              <Typography>Where can I download the Vite Wallet App?</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography>\r\n                The Vite App Wallet can be downloaded for <Link underline=\"hover\" href=\"https://play.google.com/store/apps/details?id=net.vite.wallet\" target=\"_blank\">Android</Link>\r\n                &nbsp;or <Link underline=\"hover\" href=\"https://apps.apple.com/ch/app/vite-multi-chain-wallet/id1437629486\" target=\"_blank\">iOS</Link>.\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n          <Accordion expanded={faqExpanded === 'faq3'} onChange={handleChange('faq3')}>\r\n            <AccordionSummary aria-controls=\"faq3-content\" id=\"faq3-header\">\r\n              <Typography>How can I connect my wallet on my smartphone?</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography>\r\n                Connecting the wallet on your smartphone can be tricky because it is not possible to scan the QR code currently being displayed on your screen.\r\n                To overcome this limitation detailed instructions can be found in our <Link underline=\"hover\" href=\"https://github.com/vitepunks/resources/wiki/Connect-Wallet\" target=\"_blank\">wiki article</Link>.\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n          <Accordion expanded={faqExpanded === 'faq4'} onChange={handleChange('faq4')}>\r\n            <AccordionSummary aria-controls=\"faq4-content\" id=\"faq4-header\">\r\n              <Typography>Is it possible to view my minted punks in my wallet?</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography>\r\n                Before this can be achieved, the Vite community has to agree on a commonly accepted standard.\r\n                Currently it is being worked on as a bounty started by ViteLabs. You can find it <Link underline=\"hover\" href=\"https://gitcoin.co/issue/vitelabs/bounties/18/100027282\" target=\"_blank\">here</Link>.\r\n                So in this sense we are truly similar to the original CryptoPunks project which pioneered the NFT space without having a standard at hand when released.\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n          <Accordion expanded={faqExpanded === 'faq5'} onChange={handleChange('faq5')}>\r\n            <AccordionSummary aria-controls=\"faq5-content\" id=\"faq5-header\">\r\n              <Typography>How can I gift/transfer my punk to someone else?</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography>\r\n                This can be achieved by offering your punk for sale for 0 VITE to a specific address. Only this address will be able to claim the punk.\r\n                Just follow the steps described in this <Link underline=\"hover\" href=\"https://github.com/vitepunks/resources/wiki/Gifting\" target=\"_blank\">wiki article</Link>.\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </Box>\r\n      </Box>\r\n      <Typography variant=\"subtitle1\" color=\"textSecondary\" textAlign=\"center\" marginTop={2}>\r\n        Community articles\r\n      </Typography>\r\n      <Typography variant=\"subtitle2\" color=\"textSecondary\" textAlign=\"center\">\r\n        <Link underline=\"hover\" href=\"https://medium.com/@CPCLinoCrypto/cuestionario-realizado-a-vitepunks-dd6f3e40dae8\" target=\"_blank\">[Spanish]</Link>\r\n        &nbsp;\r\n        <Link underline=\"hover\" href=\"https://medium.com/@CPCLinoCrypto/questionnaire-answered-by-vitepunk-c1a9657c20ec\" target=\"_blank\">[English]</Link>\r\n      </Typography>\r\n    </>\r\n  );\r\n}\r\n","import { Box, LinearProgress, Paper, Skeleton, Typography } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\n\r\ninterface Props {\r\n  loading: boolean\r\n  mintsRemaining?: Maybe<number>\r\n}\r\n\r\nexport const MintsRemaining: React.FC<Props> = (props: Props) => {\r\n  const [pct, setPct] = useState(100);\r\n\r\n  useEffect(() => {\r\n    if (props.mintsRemaining && props.mintsRemaining > 0) {\r\n      const minValue = props.mintsRemaining === CommonConstants.TOTAL_MINTS ? 100 : 90;\r\n      setPct(Math.min(minValue, props.mintsRemaining / CommonConstants.TOTAL_MINTS * 100));\r\n    } else {\r\n      setPct(100);\r\n    }\r\n  }, [props.mintsRemaining]);\r\n\r\n  return (\r\n    <Paper elevation={3} sx={{ width: \"60%\", textAlign: \"center\", mb: 3 }}>\r\n      <Box sx={{ px: 2, pt: 2, pb: 1.5 }}>\r\n        {props.loading || !props.mintsRemaining ? (\r\n          <Skeleton animation=\"wave\" width=\"50%\"></Skeleton>\r\n        ) : (\r\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n            <b>{FormatUtil.formatNumber(props.mintsRemaining)}</b> of {FormatUtil.formatNumber(CommonConstants.TOTAL_MINTS)} mintable\r\n          </Typography>\r\n        )}\r\n      </Box>\r\n      <LinearProgress sx={{ height: \"8px\" }} variant=\"determinate\" color={pct <= 40 ? \"error\" : \"primary\"} value={pct} />\r\n    </Paper>\r\n  );\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { faDiscord, faGithub, faTwitter } from '@fortawesome/free-brands-svg-icons';\r\nimport { Box, Button, Container, Grid, IconButton, Link, Paper, Stack, Typography } from '@mui/material';\r\nimport BigNumber from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { GET_MARKET_INFO_QUERY } from '../../../../queries';\r\nimport { GetMarketInfo } from '../../../../queries/__generated__/GetMarketInfo';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { MomentUtil } from '../../../../util/moment.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { DisplayBigNumber, DocumentState, GlobalEvent, MarketChangedEvent, PunkChangedEvent } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\nimport { Countdown } from '../../../common/components/countdown';\r\nimport { FontAwesomeSvgIcon } from '../../../common/components/fa-icon';\r\nimport { LandingFaq } from '../faq';\r\nimport { MintsRemaining } from '../mints-remaining';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const LandingMain = () => {\r\n  const moment = React.useMemo<MomentUtil>(() => {\r\n    return new MomentUtil();\r\n  }, []);\r\n  const date = moment.getLocal(\"2021-12-21T17:00:00+0000\");\r\n\r\n  const mounted = React.useRef(false);\r\n  const [mintPrice, setMintPrice] = useState<DisplayBigNumber>({\r\n    number: new BigNumber(\"0\"),\r\n    displayNumber: \"0\"\r\n  });\r\n  const [marketStarted, setMarketStarted] = useState(false);\r\n  const [canMint, setCanMint] = useState(false);\r\n  const [mintsRemaining, setMintsRemaining] = useState<Maybe<number>>(undefined);\r\n  const emitter = getEmitter();\r\n  const punkService = getPunkService();\r\n\r\n  const query = useQuery<GetMarketInfo>(GET_MARKET_INFO_QUERY, {\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  const refetch = query.refetch;\r\n\r\n  useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (state === DocumentState.Active) {\r\n        logger.info(\"Refreshing market info\")();\r\n        refetch();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: MarketChangedEvent) => {\r\n      logger.info(`eventType: ${e.eventType} amount: ${e.value.toFixed()} timestamp: ${e.timestamp.toFixed()}`)();\r\n      refetch();\r\n    }\r\n    emitter.on(GlobalEvent.MarketChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.MarketChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      logger.info(`eventType: ${e.eventType} punkId: ${e.punkId} amount: ${e.amount?.toFixed()} fromAddress: ${e.fromAddress} toAddress: ${e.toAddress} timestamp: ${e.timestamp.toFixed()}`)();\r\n      refetch();\r\n    }\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const info = query.data?.marketInfo;\r\n    if (info && mounted.current) {\r\n      setMintPrice({\r\n        number: new BigNumber(info.mintPrice),\r\n        displayNumber: TokenUtil.formatBigNumber(new BigNumber(info.mintPrice), CommonConstants.CURRENCY_DECIMALS, 2)\r\n      });\r\n      setMarketStarted(info.marketStarted);\r\n      setCanMint(info.marketStarted && info.mintsRemaining > 0);\r\n      setMintsRemaining(info.mintsRemaining);\r\n    }\r\n  }, [query.data]);\r\n\r\n  const handleMintAsync = async () => {\r\n    try {\r\n      const result = await punkService.mintAsync();\r\n      if (result) {\r\n        SnackbarUtil.enqueueMessage(\"Mint success\");\r\n      } else {\r\n        SnackbarUtil.enqueueError(\"Mint failed\");\r\n      }\r\n    } catch (error) {\r\n      logger.error(error)();\r\n      SnackbarUtil.enqueueError(error);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Container maxWidth=\"lg\" sx={{ mt: 10 }}>\r\n      <Grid container spacing={3} direction=\"row\" justifyContent=\"center\" alignItems=\"center\" marginBottom={3}>\r\n        <Grid item sm={12} md={6}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <div>\r\n              <Typography variant=\"h3\" color=\"primary\">\r\n                {CommonConstants.APP_NAME}\r\n              </Typography>\r\n              <Typography variant=\"subtitle1\" color=\"textSecondary\" paragraph>\r\n                The very first NFT collection powered by <Link underline=\"hover\" href=\"https://www.vite.org/\" target=\"_blank\">Vite chain</Link>. Now is your chance to make Vite history and become owner of an isometric punk.\r\n                Get yourself ready for the metaverse.\r\n                {!marketStarted ? (\r\n                  <>\r\n                    &nbsp;Minting will open in:\r\n                  </>\r\n\r\n                ) : (\r\n                  <>\r\n                    &nbsp;Mint a punk for {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME} now!\r\n                  </>\r\n                )}\r\n              </Typography>\r\n              {!marketStarted ? (\r\n                <Paper elevation={3} sx={{ p: 2, width: \"60%\", textAlign: \"center\", mb: 3 }}>\r\n                  <Countdown date={date.toISOString()}></Countdown>\r\n                </Paper>\r\n              ) : (\r\n                <MintsRemaining loading={query.loading} mintsRemaining={mintsRemaining}></MintsRemaining>\r\n              )}\r\n              <Stack spacing={2} direction=\"row\">\r\n                <ClickOnceButton variant=\"contained\" color=\"primary\" callbackFn={handleMintAsync} sx={{ minWidth: \"100px\" }} disabled={!canMint}>\r\n                  Mint\r\n                </ClickOnceButton>\r\n                <Button variant=\"outlined\" color=\"primary\" component={RouterLink} to='/marketplace'>\r\n                  Browse\r\n                </Button>\r\n              </Stack>\r\n            </div>\r\n          </Box>\r\n        </Grid>\r\n        <Grid item sm={12} md={6}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            {/* <LandingMainImage></LandingMainImage> */}\r\n            <img alt=\"main\" src={CommonConstants.LANDING_IMAGE_URL}></img>\r\n          </Box>\r\n        </Grid>\r\n        <Grid item xs={12} marginTop={10}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n              Connect with us\r\n            </Typography>\r\n          </Box>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <Stack spacing={2} direction=\"row\">\r\n              <IconButton aria-label=\"Twitter\" href={CommonConstants.TWITTER_URL} target=\"_blank\">\r\n                <FontAwesomeSvgIcon icon={faTwitter} />\r\n              </IconButton>\r\n              <IconButton aria-label=\"GitHub\" href={CommonConstants.GITHUB_URL} target=\"_blank\">\r\n                <FontAwesomeSvgIcon icon={faGithub} />\r\n              </IconButton>\r\n              <IconButton aria-label=\"Discord\" href={CommonConstants.DISCORD_URL} target=\"_blank\">\r\n                <FontAwesomeSvgIcon icon={faDiscord} />\r\n              </IconButton>\r\n            </Stack>\r\n          </Box>\r\n        </Grid>\r\n        <Grid item xs={12} marginTop={10}>\r\n          <LandingFaq></LandingFaq>\r\n        </Grid>\r\n        <Grid item xs={12} marginTop={10}>\r\n          <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\r\n            <div>\r\n              <Typography variant=\"h5\" color=\"textSecondary\" textAlign=\"center\" paragraph>\r\n                Disclaimer\r\n              </Typography>\r\n              <Typography variant=\"subtitle1\" color=\"textSecondary\" textAlign=\"center\" paragraph>\r\n                The intention of {CommonConstants.APP_NAME} is to showcase the capabilities of the Vite Blockchain. {CommonConstants.APP_NAME} is not affiliated with CryptoPunks and LarvaLabs.\r\n                The value of a {CommonConstants.PUNK_NAME} is not related to the value of a CryptoPunk. {CommonConstants.APP_NAME} is a homage to the CryptoPunk project of LarvaLabs.\r\n                With {CommonConstants.APP_NAME} we thank LarvaLabs for their pioneering and for creating the CryptoPunk project. The project that basically started the ever growing NFT movement.\r\n\r\n                {marketStarted && mintPrice.number.gt(0) && (\r\n                  <>\r\n                    &nbsp;Why mint for {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME}?\r\n                    The minting of {CommonConstants.APP_NAME} is set at {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME}.\r\n                    This means that during the initial minting phase, you will be able to generate a random punk for {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME}.\r\n                    When all 10,000 Punks are minted, you can get a Punk by using the marketplace.\r\n\r\n                    That the minting is set at {mintPrice.displayNumber} {CommonConstants.CURRENCY_NAME} has a couple of reasons. As you know, keeping up, maintaining and further developing a system costs money.\r\n                    We want to keep {CommonConstants.APP_NAME} running for years to come and we hope to integrate {CommonConstants.APP_NAME} with other NFT marketplaces in the near future.\r\n                  </>\r\n                )}\r\n              </Typography>\r\n            </div>\r\n          </Box>\r\n        </Grid>\r\n      </Grid>\r\n    </Container >\r\n  );\r\n}\r\n","import { ecLevel, modes, qrcode } from 'qrcode.es';\r\nimport React, { useEffect, useRef } from 'react';\r\n\r\ninterface Props {\r\n  text?: string\r\n}\r\n\r\nexport const QrCode: React.FC<Props> = (props: Props) => {\r\n  const elementRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const defaultOpt = {\r\n      size: 240,\r\n      ecLevel: ecLevel.HIGH,\r\n      minVersion: 4,\r\n      background: '#fff',\r\n      mode: modes.DRAW_WITH_IMAGE_BOX,\r\n      radius: 0,\r\n      image: process.env.PUBLIC_URL + '/assets/images/logo640.png',\r\n      mSize: 0.3\r\n    };\r\n\r\n    if (props.text && elementRef.current) {\r\n      defaultOpt.size = Math.min(240, elementRef.current.clientWidth - 10);\r\n      elementRef.current.innerHTML = ''\r\n      const q = new qrcode(elementRef.current);\r\n      q.generate(props.text, defaultOpt).then(() => {\r\n        console.log('QR code generated')\r\n      });\r\n    }\r\n  }, [props.text])\r\n\r\n  return (\r\n    <div ref={elementRef}></div>\r\n  );\r\n}\r\n","import { Button, Dialog, DialogContent, DialogContentText, DialogTitle, FormControl, Input, InputLabel, Link, Typography } from '@mui/material';\r\nimport { Box } from '@mui/system';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConfig } from '../../../../common/config';\r\nimport { getCommonContext } from '../../../../contexts/common.context';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { GlobalEvent } from '../../../../util/types';\r\nimport { getWalletManager, WalletConnectorFactory } from '../../../../wallet';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\nimport { QrCode } from '../qrcode';\r\n\r\nconst logger = getLogger();\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  setOpen: React.Dispatch<React.SetStateAction<boolean>>;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const LoginDialog: React.FC<Props> = (props: Props) => {\r\n  const [uri, setUri] = useState<string>(\"\");\r\n  const [error, setError] = useState(false);\r\n  const [mnemonic, setMnemonic] = useState<Maybe<string>>(undefined);\r\n  const { onClose, open, setOpen } = props;\r\n  const context = getCommonContext();\r\n  const walletManager = getWalletManager();\r\n  const emitter = getEmitter();\r\n  const connectorFactory = React.useMemo<WalletConnectorFactory>(() => {\r\n    return new WalletConnectorFactory(walletManager);\r\n  }, [walletManager]);\r\n  const handleCreateSession = React.useCallback(async () => {\r\n    try {\r\n      const connector = await connectorFactory.createAsync(context.network);\r\n      logger.info(connector.uri)();\r\n      setUri(connector.uri);\r\n      setError(false);\r\n    } catch (error) {\r\n      logger.error(error)();\r\n      setError(true);\r\n    }\r\n  }, [connectorFactory, context.network]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (open: boolean) => {\r\n      setOpen(open)\r\n    }\r\n    emitter.on(GlobalEvent.ConnectWalletDialog, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.ConnectWalletDialog, handleEvent)\r\n      setUri(\"\");\r\n      setError(false);\r\n    };\r\n  }, [emitter, setOpen]);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      setMnemonic(undefined);\r\n      handleCreateSession();\r\n    }\r\n  }, [open, handleCreateSession]);\r\n\r\n  const handleClose = () => {\r\n    onClose();\r\n  };\r\n\r\n  const handleMnemonicChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    setMnemonic(event.target.value);\r\n  };\r\n\r\n  const handleLogin = () => {\r\n    const wallet = walletManager.createWebWallet(CommonUtil.isNullOrWhitespace(mnemonic) ? process.env.REACT_APP_MNEMONIC ?? \"\" : mnemonic ?? \"\");\r\n    if (!wallet) {\r\n      SnackbarUtil.enqueueError('Invalid mnemonic');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog onClose={handleClose} open={open} maxWidth=\"xs\">\r\n      <DialogTitle>Connect Wallet</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          Scan the QR code via Vite Wallet App\r\n        </DialogContentText>\r\n        <Box sx={{ mt: 2, textAlign: \"center\" }}>\r\n          {CommonUtil.isNullOrWhitespace(uri) ? (\r\n            <>\r\n              {error ? (\r\n                <>\r\n                  <Typography gutterBottom>Error</Typography>\r\n                  <ClickOnceButton variant=\"outlined\" callbackFn={handleCreateSession}>Retry</ClickOnceButton>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  Loading...\r\n                </>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <QrCode text={uri}></QrCode>\r\n          )}\r\n          <DialogContentText marginTop={1}>\r\n            Don't have the Vite Wallet App? <Link underline=\"hover\" href=\"https://vite.org/airdrop\" target=\"_blank\">Download here</Link>\r\n          </DialogContentText>\r\n        </Box>\r\n        {CommonConfig.ENABLE_MNEMONIC_LOGIN && (\r\n          <Box sx={{ mt: 2, textAlign: \"center\" }}>\r\n            <FormControl fullWidth variant=\"standard\" >\r\n              <InputLabel htmlFor=\"mnemonic\">Mnemonic</InputLabel>\r\n              <Input\r\n                id=\"mnemonic\"\r\n                value={mnemonic}\r\n                onChange={handleMnemonicChange}\r\n                type=\"text\"\r\n                autoComplete=\"new-password\"\r\n              />\r\n            </FormControl>\r\n            <Button variant=\"contained\" sx={{ mt: 1 }} onClick={handleLogin}>Use test account</Button>\r\n          </Box>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","import AccountCircleTwoToneIcon from '@mui/icons-material/AccountCircleTwoTone';\r\nimport LogoutIcon from '@mui/icons-material/Logout';\r\nimport ShoppingCartIcon from '@mui/icons-material/ShoppingCart';\r\nimport { AppBar, Button, Chip, styled, Toolbar, Typography, useMediaQuery, useTheme } from '@mui/material';\r\nimport React from 'react';\r\nimport { Link as RouterLink, useNavigate } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { ExtendedBootstrapTooltip } from '../../../common/components/tooltip';\r\nimport { LoginDialog } from '../../../main/components/login';\r\n\r\nconst Root = styled('div')(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n`);\r\n\r\nconst TitleTypography = styled(Typography)(\r\n  ({ theme }) => `\r\n  flex-grow: 1;\r\n  margin-left: 10px !important;\r\n`);\r\n\r\nexport const Header: React.FC = (props: any) => {\r\n  const navigate = useNavigate();\r\n  const theme = useTheme();\r\n  const matches = useMediaQuery(theme.breakpoints.up('sm'));\r\n  const context = useConnectedWeb3Context();\r\n  const [loginOpen, setLoginOpen] = React.useState(false);\r\n\r\n  const handleClickLogin = () => {\r\n    setLoginOpen(true);\r\n  };\r\n\r\n  const handleClickLogout = () => {\r\n    context.logout();\r\n  };\r\n\r\n  const handleLoginClose = () => {\r\n    setLoginOpen(false);\r\n  };\r\n\r\n  const truncateAddress = (address?: string) => {\r\n    return CommonUtil.truncateStringInTheMiddle(address, 10, 5)\r\n  }\r\n\r\n  const showAccount = () => {\r\n    navigate(`/account/${context.account}`);\r\n  }\r\n\r\n  return (\r\n    <Root>\r\n      <AppBar position=\"static\" color=\"transparent\">\r\n        <Toolbar>\r\n          <a href=\"./\" style={{ height: \"40px\" }}>\r\n            <img src={\"./assets/images/logo640.png\"} alt=\"logo\" width=\"40\" />\r\n          </a>\r\n          <TitleTypography variant=\"h6\" color=\"#fff\">\r\n            <a href=\"./\" style={{ color: \"inherit\", textDecoration: \"inherit\" }}>\r\n              {CommonConstants.APP_NAME}\r\n            </a>\r\n          </TitleTypography>\r\n          <Button sx={{ mr: 2 }} component={RouterLink} to='/marketplace'>\r\n            {matches ? (\r\n              <>\r\n                Marketplace\r\n              </>\r\n            ) : (\r\n              <ShoppingCartIcon />\r\n            )}\r\n          </Button>\r\n          {context.account ? (\r\n            <>\r\n              <ExtendedBootstrapTooltip sx={{ mr: 1 }} title={\r\n                <React.Fragment>\r\n                  <p>{context.account}</p>\r\n                </React.Fragment>\r\n              } placement=\"bottom\" arrow>\r\n                {matches ? (\r\n                  <Chip icon={<AccountCircleTwoToneIcon />} label={truncateAddress(context.account)} variant=\"outlined\" onClick={showAccount} />\r\n                ) : (\r\n                  <Button color=\"inherit\" onClick={showAccount}>\r\n                    <AccountCircleTwoToneIcon />\r\n                  </Button>\r\n                )}\r\n              </ExtendedBootstrapTooltip>\r\n              <Button color=\"inherit\" onClick={handleClickLogout}>\r\n                <LogoutIcon />\r\n              </Button>\r\n            </>\r\n          ) : (\r\n            <Button variant=\"contained\" color=\"primary\" onClick={handleClickLogin}>\r\n              Connect wallet\r\n            </Button>\r\n          )}\r\n          <LoginDialog open={loginOpen} setOpen={setLoginOpen} onClose={handleLoginClose}></LoginDialog>\r\n        </Toolbar>\r\n      </AppBar >\r\n    </Root >\r\n  )\r\n}","import { ApolloClient, FetchPolicy, NormalizedCacheObject } from \"@apollo/client\";\r\nimport { getApolloClient } from \"../clients/apollo.client\";\r\nimport { ACCEPT_BID_MUTATION, BID_MUTATION, BUY_MUTATION, CANCEL_BID_MUTATION, CANCEL_OFFER_MUTATION, OFFER_MUTATION } from \"../mutations\";\r\nimport { AcceptBid, AcceptBidVariables } from \"../mutations/__generated__/AcceptBid\";\r\nimport { Bid, BidVariables } from \"../mutations/__generated__/Bid\";\r\nimport { Buy, BuyVariables } from \"../mutations/__generated__/Buy\";\r\nimport { CancelBid, CancelBidVariables } from \"../mutations/__generated__/CancelBid\";\r\nimport { CancelOffer, CancelOfferVariables } from \"../mutations/__generated__/CancelOffer\";\r\nimport { Offer, OfferVariables } from \"../mutations/__generated__/Offer\";\r\nimport { GET_MARKET_EVENTS_QUERY, GET_MARKET_INFO_QUERY } from \"../queries\";\r\nimport { GetMarketEvents, GetMarketEventsVariables } from \"../queries/__generated__/GetMarketEvents\";\r\nimport { GetMarketInfo } from \"../queries/__generated__/GetMarketInfo\";\r\nimport { CommonUtil } from \"../util/common.util\";\r\n\r\nclass MarketService {\r\n  private readonly _apollo: ApolloClient<NormalizedCacheObject>;\r\n\r\n  constructor() {\r\n    this._apollo = getApolloClient();\r\n  }\r\n\r\n  getMarketInfoAsync = (_fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketInfo>({\r\n      query: GET_MARKET_INFO_QUERY,\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  getEventsAsync = (_offset: number, _limit: number, _height?: Maybe<string>, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetMarketEvents, GetMarketEventsVariables>({\r\n      query: GET_MARKET_EVENTS_QUERY,\r\n      variables: {\r\n        offset: _offset,\r\n        limit: _limit,\r\n        height: _height\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n\r\n  async offerAsync(id: string, amount: string, address?: Maybe<string>): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Offer, OfferVariables>({\r\n      mutation: OFFER_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount,\r\n        address: CommonUtil.isNullOrWhitespace(address) ? undefined : address\r\n      }\r\n    });\r\n    return Boolean(result.data?.offer ?? false);\r\n  }\r\n\r\n  async cancelOfferAsync(id: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<CancelOffer, CancelOfferVariables>({\r\n      mutation: CANCEL_OFFER_MUTATION,\r\n      variables: {\r\n        id: id\r\n      }\r\n    });\r\n    return Boolean(result.data?.cancelOffer ?? false);\r\n  }\r\n\r\n  async buyAsync(id: string, amount: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Buy, BuyVariables>({\r\n      mutation: BUY_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount\r\n      }\r\n    });\r\n    return Boolean(result.data?.buy ?? false);\r\n  }\r\n\r\n  async bidAsync(id: string, amount: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<Bid, BidVariables>({\r\n      mutation: BID_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount\r\n      }\r\n    });\r\n    return Boolean(result.data?.bid ?? false);\r\n  }\r\n\r\n  async acceptBidAsync(id: string, amount: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<AcceptBid, AcceptBidVariables>({\r\n      mutation: ACCEPT_BID_MUTATION,\r\n      variables: {\r\n        id: id,\r\n        amount: amount\r\n      }\r\n    });\r\n    return Boolean(result.data?.acceptBid ?? false);\r\n  }\r\n\r\n  async cancelBidAsync(id: string): Promise<boolean> {\r\n    const result = await this._apollo.mutate<CancelBid, CancelBidVariables>({\r\n      mutation: CANCEL_BID_MUTATION,\r\n      variables: {\r\n        id: id\r\n      }\r\n    });\r\n    return Boolean(result.data?.cancelBid ?? false);\r\n  }\r\n}\r\n\r\nconst service = new MarketService();\r\n\r\nexport const getMarketService = () => {\r\n  return service;\r\n}","import { faBan, faDonate, faEraser, faFileInvoiceDollar, faGift, faHandHoldingUsd, faPowerOff, faQuestion, faTrophy } from '@fortawesome/free-solid-svg-icons';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { PunkEventType } from './types';\r\n\r\nexport abstract class IconUtil {\r\n  static getBuyEventTypeIcon = () => {\r\n    return faDonate;\r\n  }\r\n  static getClaimEventTypeIcon = () => {\r\n    return faGift;\r\n  }\r\n  static getOfferEventTypeIcon = () => {\r\n    return faFileInvoiceDollar;\r\n  }\r\n  static getCancelSaleEventTypeIcon = () => {\r\n    return faPowerOff;\r\n  }\r\n  static getCancelGiftEventTypeIcon = () => {\r\n    return faEraser;\r\n  }\r\n  static getPunkEventTypeIcon = (eventType: PunkEventType, amount?: Maybe<BigNumber>) => {\r\n    switch (eventType) {\r\n      case PunkEventType.Mint:\r\n        return faTrophy;\r\n      case PunkEventType.Offer:\r\n        if (amount && amount.gt(0)) {\r\n          return IconUtil.getOfferEventTypeIcon();\r\n        }\r\n        return IconUtil.getClaimEventTypeIcon();\r\n      case PunkEventType.NewBid:\r\n        return faHandHoldingUsd;;\r\n      case PunkEventType.CancelBid:\r\n        return faBan;\r\n      case PunkEventType.Buy:\r\n        if (amount && amount.gt(0)) {\r\n          return IconUtil.getBuyEventTypeIcon();\r\n        }\r\n        return IconUtil.getClaimEventTypeIcon();\r\n      case PunkEventType.CancelOffer:\r\n        if (amount && amount.gt(0)) {\r\n          return IconUtil.getCancelSaleEventTypeIcon();\r\n        }\r\n        return IconUtil.getCancelGiftEventTypeIcon();\r\n      default:\r\n        return faQuestion;\r\n    }\r\n  }\r\n}","import { CommonConfig } from \"../common/config\";\r\nimport { CommonUtil } from \"./common.util\";\r\n\r\nexport abstract class ExplorerUtil {\r\n  private static DEFAULT_BASE_URL = \"https://vitescan.io\";\r\n\r\n  private static getBaseUrl(_baseUrl?: string): string {\r\n    let baseUrl = _baseUrl;\r\n    if (!baseUrl || CommonUtil.isNullOrWhitespace(baseUrl)) {\r\n      baseUrl = CommonConfig.EXPLORER_URL;\r\n    }\r\n    baseUrl = baseUrl.endsWith('/') ? baseUrl.substring(0, baseUrl.length - 1) : baseUrl;\r\n    return baseUrl;\r\n  }\r\n\r\n  static getAddressUrl(_address?: Maybe<string>, _baseUrl?: string): string {\r\n    const baseUrl = ExplorerUtil.getBaseUrl(_baseUrl);\r\n    if (baseUrl === ExplorerUtil.DEFAULT_BASE_URL) {\r\n      return `${baseUrl}/address/${_address}`;\r\n    }\r\n    return `${baseUrl}/account/${_address}`;\r\n  }\r\n\r\n  static getTxUrl(_tx?: Maybe<string>, _baseUrl?: string): string {\r\n    const baseUrl = ExplorerUtil.getBaseUrl(_baseUrl);\r\n    if (baseUrl === ExplorerUtil.DEFAULT_BASE_URL) {\r\n      return `${baseUrl}/tx/${_tx}`;\r\n    }\r\n    return `${baseUrl}/tx/${_tx}`;\r\n  }\r\n}","import { Link } from '@mui/material';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { ExplorerUtil } from '../../../../util/explorer.util';\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n  value?: Maybe<string>\r\n  type: ExplorerLinkType\r\n}\r\n\r\nexport enum ExplorerLinkType {\r\n  Address,\r\n  Transaction\r\n}\r\n\r\nexport const ExplorerLink: React.FC<Props> = (props: Props) => {\r\n  const getUrl = useCallback(() => {\r\n    if (!props.value || CommonUtil.isNullOrWhitespace(props.value)) {\r\n      return undefined;\r\n    }\r\n    switch (props.type) {\r\n      case ExplorerLinkType.Address:\r\n        return ExplorerUtil.getAddressUrl(props.value);\r\n      default:\r\n        return ExplorerUtil.getTxUrl(props.value);\r\n    }\r\n  }, [props.value, props.type]);\r\n  const [url, setUrl] = useState<Maybe<string>>(getUrl());\r\n\r\n  useEffect(() => {\r\n    setUrl(getUrl());\r\n  }, [props.value, props.type, getUrl]);\r\n\r\n  if (!url || CommonUtil.isNullOrWhitespace(url)) {\r\n    return (\r\n      <>\r\n        {props.children}\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Link underline=\"hover\" href={url} target=\"_blank\">\r\n      {props.children}\r\n    </Link>\r\n  );\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { Avatar, Grid, Link, Paper, styled, Table, TableBody, TableCell, TableContainer, TableHead, TableRow } from '@mui/material';\r\nimport React from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants, PunkEventTypes } from '../../../../common/constants';\r\nimport { GET_PUNK_QUERY } from '../../../../queries';\r\nimport { GetPunk, GetPunkVariables } from '../../../../queries/__generated__/GetPunk';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { IconUtil } from '../../../../util/icon.util';\r\nimport { MomentUtil } from '../../../../util/moment.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { PunkEvent, PunkEventType } from '../../../../util/types';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\nimport { Alert } from '../alert';\r\nimport { ExplorerLink, ExplorerLinkType } from '../explorer-link';\r\nimport { ExtendedBootstrapTooltip } from '../tooltip';\r\n\r\ninterface EventTableRowProps {\r\n  item: PunkEvent\r\n}\r\n\r\nconst CustomAvatar = styled(Avatar)(({ theme }) => (`\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  image-rendering: pixelated;\r\n  margin-right: 10px;\r\n`));\r\n\r\nconst CustomTableCell = styled(TableCell)(({ theme }) => (`\r\n  background-color: rgba(255, 255, 255, 0.3);\r\n`));\r\n\r\nconst EventTableRow: React.FC<EventTableRowProps> = (props: EventTableRowProps) => {\r\n  const query = useQuery<GetPunk, GetPunkVariables>(GET_PUNK_QUERY, {\r\n    variables: {\r\n      id: props.item.punkId.toString()\r\n    }\r\n  });\r\n  const momentUtil = new MomentUtil();\r\n\r\n  const formatTimestamp = (timestamp: any) => {\r\n    return momentUtil.getLocalReverseFormatted(momentUtil.getFromUnix(timestamp));\r\n  }\r\n\r\n  const getEventName = (): string => {\r\n    const eventType = props.item.eventType as PunkEventType;\r\n    switch (eventType) {\r\n      case PunkEventType.Offer:\r\n        if (!props.item.amount || props.item.amount.lte(0)) {\r\n          return \"Gift\";\r\n        }\r\n        break;\r\n      case PunkEventType.Buy:\r\n        if (!props.item.amount || props.item.amount.lte(0)) {\r\n          return \"Claim gift\";\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return PunkEventTypes[props.item.eventType].name;\r\n  }\r\n\r\n  return (\r\n    <TableRow sx={{ '&:last-child td, &:last-child th': { border: 0 } }}>\r\n      <TableCell component=\"th\" scope=\"row\">\r\n        <FontAwesomeIcon icon={IconUtil.getPunkEventTypeIcon(props.item.eventType as PunkEventType, props.item.amount)} /> <b>{getEventName()}</b>\r\n      </TableCell>\r\n      <TableCell>\r\n        <Link underline=\"hover\" component={RouterLink} to={`/punk/${props.item.punkId}`} display=\"flex\" alignItems=\"center\">\r\n          <CustomAvatar variant=\"rounded\" src={UrlUtil.getPunkUrl(query.data?.punk.image)}>\r\n          </CustomAvatar>\r\n          {CommonConstants.PUNK_NAME} #{props.item.punkId}\r\n        </Link>\r\n      </TableCell>\r\n      <TableCell>\r\n        {props.item.amount?.gt(0) ? `${TokenUtil.formatBigNumber(props.item.amount, CommonConstants.CURRENCY_DECIMALS, 2)} ${CommonConstants.CURRENCY_NAME}` : ''}\r\n      </TableCell>\r\n      <TableCell>\r\n        <ExplorerLink type={ExplorerLinkType.Address} value={props.item.fromAddress}>\r\n          <ExtendedBootstrapTooltip title={props.item.fromAddress ?? \"\"}>\r\n            <span>{CommonUtil.truncateStringInTheMiddle(props.item.fromAddress, 10, 5)}</span>\r\n          </ExtendedBootstrapTooltip>\r\n        </ExplorerLink>\r\n      </TableCell>\r\n      <TableCell>\r\n        <ExplorerLink type={ExplorerLinkType.Address} value={props.item.toAddress}>\r\n          <ExtendedBootstrapTooltip title={props.item.toAddress ?? \"\"}>\r\n            <span>{CommonUtil.truncateStringInTheMiddle(props.item.toAddress, 10, 5)}</span>\r\n          </ExtendedBootstrapTooltip>\r\n        </ExplorerLink>\r\n      </TableCell>\r\n      <TableCell align=\"right\">\r\n        <ExplorerLink type={ExplorerLinkType.Transaction} value={props.item.accountBlockHash}>\r\n          {formatTimestamp(props.item.timestamp.toFixed())}\r\n        </ExplorerLink>\r\n      </TableCell>\r\n    </TableRow>\r\n  )\r\n}\r\n\r\nconst EventListLoading: React.FC<Props> = (props: Props) => {\r\n  return (\r\n    <Grid item key='1' xs={12} md={6}>\r\n      {props.loading ? (\r\n        <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n      ) : (\r\n        <>\r\n          {props.error ? (\r\n            <Alert message={FormatUtil.formatMessage(props.error)} type=\"warning\"></Alert>\r\n          ) : (\r\n            <>\r\n              {props.events.length > 0 ? (\r\n                <></>\r\n              ) : (\r\n                <Alert message=\"No activity yet\" type=\"default\"></Alert>\r\n              )}\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n    </Grid>\r\n  )\r\n}\r\n\r\ninterface Props {\r\n  events: PunkEvent[]\r\n  newEvents: PunkEvent[]\r\n  error: any\r\n  loading: boolean\r\n  hasMore: boolean\r\n  height?: number\r\n  fetchMoreDataAsync(): Promise<void>\r\n}\r\n\r\nexport const EventList: React.FC<Props> = (props: Props) => {\r\n  return (\r\n    <Paper\r\n      id=\"event-list\"\r\n      style={{\r\n        height: props.height ?? 300,\r\n        overflow: 'auto',\r\n        backgroundColor: 'rgba(255, 255, 255, 0.5)'\r\n      }}\r\n    >\r\n      {props.newEvents.length > 0 || props.events.length > 0 ? (\r\n        <InfiniteScroll\r\n          dataLength={props.events.length ?? 0}\r\n          next={props.fetchMoreDataAsync}\r\n          hasMore={props.hasMore}\r\n          loader={\r\n            <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n              <EventListLoading {...props}></EventListLoading>\r\n            </Grid>\r\n          }\r\n          scrollableTarget=\"event-list\"\r\n        >\r\n          <TableContainer>\r\n            <Table stickyHeader>\r\n              <TableHead>\r\n                <TableRow>\r\n                  <CustomTableCell></CustomTableCell>\r\n                  <CustomTableCell><b>Punk</b></CustomTableCell>\r\n                  <CustomTableCell><b>Amount</b></CustomTableCell>\r\n                  <CustomTableCell><b>From</b></CustomTableCell>\r\n                  <CustomTableCell><b>To</b></CustomTableCell>\r\n                  <CustomTableCell align=\"right\"><b>Date</b></CustomTableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {props.newEvents.map((e: PunkEvent) => (\r\n                  <EventTableRow key={`new-events-${e.id}`} item={e} />\r\n                ))}\r\n                {props.events.map((e: PunkEvent) => (\r\n                  <EventTableRow key={`events-${e.id}`} item={e} />\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          </TableContainer>\r\n        </InfiniteScroll>) : (\r\n        <Grid sx={{ height: \"100%\" }} container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n          <EventListLoading {...props}></EventListLoading>\r\n        </Grid>\r\n      )}\r\n    </Paper>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { GET_MARKET_EVENTS_QUERY } from '../../../../queries';\r\nimport { GetMarketEvents, GetMarketEventsVariables } from '../../../../queries/__generated__/GetMarketEvents';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TransformUtil } from '../../../../util/transform.util';\r\nimport { DocumentState, GlobalEvent, PunkChangedEvent, PunkEvent } from '../../../../util/types';\r\nimport { EventList } from '../../../common/components/event-list';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const MarketplaceBrowseActivity: React.FC = (props: any) => {\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n  const [events, setEvents] = useState<PunkEvent[]>([]);\r\n  const [newEvents, setNewEvents] = useState<PunkEvent[]>([]);\r\n  const service = getMarketService();\r\n  const emitter = getEmitter();\r\n\r\n  const query = useQuery<GetMarketEvents, GetMarketEventsVariables>(GET_MARKET_EVENTS_QUERY, {\r\n    variables: {\r\n      offset: 0,\r\n      limit: limit\r\n    },\r\n    fetchPolicy: 'network-only',\r\n    onCompleted: (data) => {\r\n      setEvents(data.marketEvents.events.map(e => TransformUtil.toPunkEvent(e)));\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    logger.info(\"fetchMoreDataAsync\", events.length)();\r\n    const blockHeight: Maybe<string> = query.data?.marketEvents.blockHeight.toString();\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await service.getEventsAsync(events.length, limit, blockHeight);\r\n      setHasMore(result.data.marketEvents.events.length >= limit);\r\n      if (result.data.marketEvents.events.length > 0) {\r\n        setEvents([\r\n          ...events,\r\n          ...result.data.marketEvents.events.map(e => TransformUtil.toPunkEvent(e))\r\n        ]);\r\n      }\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const refetch = query.refetch;\r\n\r\n  const refresh = useCallback(() => {\r\n    logger.info(\"Refreshing market activity\")();\r\n    refetch();\r\n    setNewEvents([]);\r\n  }, [refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (state === DocumentState.Active) {\r\n        refresh();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refresh]);\r\n\r\n  const addNewEvent = useCallback((e: PunkChangedEvent) => {\r\n    setNewEvents([\r\n      TransformUtil.toPunkEvent(e),\r\n      ...newEvents\r\n    ]);\r\n  }, [newEvents]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      logger.info(\"newMarketEvent\", e)();\r\n      addNewEvent(e);\r\n    }\r\n    logger.info('emitter.on', GlobalEvent.PunkChanged)();\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent);\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.PunkChanged)();\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, addNewEvent]);\r\n\r\n  return (\r\n    <EventList\r\n      events={events}\r\n      newEvents={newEvents}\r\n      error={error}\r\n      loading={isLoading}\r\n      hasMore={hasMore}\r\n      height={500}\r\n      fetchMoreDataAsync={fetchMoreDataAsync}>\r\n    </EventList>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport SortIcon from '@mui/icons-material/Sort';\r\nimport { Autocomplete, FormControl, FormGroup, Grid, InputLabel, MenuItem, Select, SelectChangeEvent, Stack, TextField, ToggleButton, ToggleButtonGroup } from '@mui/material';\r\nimport React, { SyntheticEvent, useState } from 'react';\r\nimport { DefaultPunkFilterValues, PunkSortTypes } from '../../../../common/constants';\r\nimport { GET_PUNK_ATTRIBUTES_QUERY } from '../../../../queries';\r\nimport { GetPunkAttributes } from '../../../../queries/__generated__/GetPunkAttributes';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { PunkFilterValues } from '../../../../util/types';\r\nimport { OrderBy, PunkSortBy } from '../../../../__generated__/globalTypes';\r\n\r\nexport const MarketplaceBrowseItemsFilter: React.FC = () => {\r\n  const [values, setValues] = useState<PunkFilterValues>(DefaultPunkFilterValues);\r\n  const emitter = getEmitter();\r\n\r\n  const attributesQuery = useQuery<GetPunkAttributes>(GET_PUNK_ATTRIBUTES_QUERY, {\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  const emitEvent = (oldValues: PunkFilterValues, newValues: PunkFilterValues) => {\r\n    emitter.emitPunkFilterValuesChanged(oldValues, newValues);\r\n  }\r\n\r\n  const handleSortByChange = (event: SelectChangeEvent) => {\r\n    const newValues: PunkFilterValues = { ...values, sortBy: event.target.value as PunkSortBy };\r\n    setValues(newValues);\r\n    emitEvent(values, newValues);\r\n  };\r\n\r\n  const handleSearchChange = (event: SyntheticEvent<Element, Event>, value: string[]) => {\r\n    const newValues: PunkFilterValues = { ...values, search: value.join(',') };\r\n    setValues(newValues);\r\n    emitEvent(values, newValues);\r\n  };\r\n\r\n  const handleCheckedChange = (event: React.MouseEvent<HTMLElement, MouseEvent>, value: any) => {\r\n    const newValues: PunkFilterValues = { ...values, orderBy: value };\r\n    setValues(newValues);\r\n    emitEvent(values, newValues);\r\n  };\r\n\r\n  return (\r\n    <Grid container sx={{ mb: 2 }} spacing={3}>\r\n      <Grid item md={3}></Grid>\r\n      <Grid item xs={12} md={6}>\r\n        <Autocomplete\r\n          multiple\r\n          freeSolo\r\n          id=\"search-autocomplete\"\r\n          options={attributesQuery.data?.punkAttributes ?? []}\r\n          getOptionLabel={(option) => option}\r\n          size=\"small\"\r\n          fullWidth={true}\r\n          onChange={handleSearchChange}\r\n          filterSelectedOptions\r\n          renderInput={(params) => (\r\n            <TextField\r\n              {...params}\r\n              label=\"Search\"\r\n            />\r\n          )}\r\n        />\r\n      </Grid>\r\n      <Grid item xs={12} md={3}>\r\n        <FormGroup>\r\n          <Stack direction=\"row\" justifyContent=\"end\" spacing={2}>\r\n            <FormControl size=\"small\">\r\n              <InputLabel id=\"sortby-select-label\">Sort by</InputLabel>\r\n              <Select\r\n                labelId=\"sortby-select-label\"\r\n                id=\"sortby-select\"\r\n                value={values.sortBy}\r\n                label=\"Sort by\"\r\n                onChange={handleSortByChange}\r\n              >\r\n                {PunkSortTypes.map(e => (\r\n                  <MenuItem key={e.type} value={e.type}>{e.name}&nbsp;</MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n            {/* <Stack direction=\"row\" alignItems=\"center\" >\r\n              <Switch color=\"default\" checked={values.orderByAsc} onChange={handleCheckedChange('orderByAsc')} />\r\n              {values.orderByAsc ? (\r\n                <ArrowUpward fontSize=\"small\" />\r\n              ) : (\r\n                <ArrowDownward fontSize=\"small\" />\r\n              )}\r\n            </Stack> */}\r\n            <ToggleButtonGroup size=\"small\" exclusive value={values.orderBy} onChange={handleCheckedChange}>\r\n              <ToggleButton value={OrderBy.ASC}>\r\n                <SortIcon sx={{ transform: \"rotate(180deg)\" }} />\r\n              </ToggleButton>\r\n              <ToggleButton value={OrderBy.DESC}>\r\n                <SortIcon />\r\n              </ToggleButton>\r\n            </ToggleButtonGroup>\r\n          </Stack>\r\n        </FormGroup>\r\n      </Grid>\r\n    </Grid>\r\n  )\r\n}\r\n","import { ApolloError, QueryResult, useQuery } from '@apollo/client';\r\nimport { Grid } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport { DefaultPunkFilterValues } from '../../../../common/constants';\r\nimport { GET_PUNKS_QUERY } from '../../../../queries';\r\nimport { GetPunks, GetPunksVariables, GetPunks_punks } from '../../../../queries/__generated__/GetPunks';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { GlobalEvent, Punk, PunkFilterValues } from '../../../../util/types';\r\nimport { OrderBy, PunkSortBy } from '../../../../__generated__/globalTypes';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { MarketplaceBrowseItem } from '../browse-item';\r\nimport { MarketplaceBrowseItemsFilter } from '../browse-items-filter';\r\n\r\nconst logger = getLogger()\r\n\r\ninterface EmptyResultProps {\r\n  error: ApolloError | undefined\r\n  query: QueryResult<GetPunks, GetPunksVariables>\r\n}\r\n\r\nconst EmptyResult: React.FC<EmptyResultProps> = (props: EmptyResultProps) => {\r\n  return (\r\n    <>\r\n      {props.error ? (\r\n        <Alert message={FormatUtil.formatMessage(props.error)} type=\"warning\"></Alert>\r\n      ) : (\r\n        <>\r\n          {props.query.loading || (props.query.data && props.query.data.punks.length > 0) ? (\r\n            <></>\r\n          ) : (\r\n            <Alert message=\"No punks found\" type=\"default\" ></Alert>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\ninterface MarketplaceLoadingProps {\r\n  loading: boolean\r\n  error: ApolloError | undefined\r\n  query: QueryResult<GetPunks, GetPunksVariables>\r\n}\r\n\r\nconst MarketplaceLoading: React.FC<MarketplaceLoadingProps> = (props: MarketplaceLoadingProps) => {\r\n  return (\r\n    <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\">\r\n      <Grid item key='1' xs={12} md={6}>\r\n        {props.loading ? (\r\n          <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n        ) : (\r\n          <EmptyResult error={props.error} query={props.query}></EmptyResult>\r\n        )}\r\n      </Grid>\r\n    </Grid>\r\n  )\r\n}\r\n\r\nexport const MarketplaceBrowseItems: React.FC = (props: any) => {\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n  const [filter, setFilter] = useState<PunkFilterValues>({\r\n    sortBy: DefaultPunkFilterValues.sortBy,\r\n    orderBy: DefaultPunkFilterValues.orderBy,\r\n    search: ''\r\n  })\r\n  const emitter = getEmitter();\r\n\r\n  const query = useQuery<GetPunks, GetPunksVariables>(GET_PUNKS_QUERY, {\r\n    variables: {\r\n      offset: 0,\r\n      limit: limit,\r\n      sort: filter.sortBy as PunkSortBy,\r\n      order: filter.orderBy as OrderBy,\r\n      search: filter.search\r\n    },\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    const currentLength = query.data?.punks.length ?? 0;\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await query.fetchMore({\r\n        variables: {\r\n          offset: currentLength,\r\n          limit: limit\r\n        }\r\n      });\r\n      setHasMore(result.data.punks.length >= limit);\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const refetch = query.refetch;\r\n\r\n  useEffect(() => {\r\n    refetch({\r\n      offset: 0,\r\n      limit: limit,\r\n      sort: filter.sortBy as PunkSortBy,\r\n      order: filter.orderBy as OrderBy,\r\n      search: filter.search\r\n    })\r\n  }, [filter, refetch])\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (oldValues: PunkFilterValues, newValues: PunkFilterValues) => {\r\n      setHasMore(true);\r\n      setFilter({\r\n        sortBy: newValues.sortBy,\r\n        orderBy: newValues.orderBy,\r\n        search: newValues.search\r\n      });\r\n    }\r\n    emitter.on(GlobalEvent.PunkFilterValuesChanged, handleEvent)\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.PunkFilterValuesChanged)()\r\n      emitter.off(GlobalEvent.PunkFilterValuesChanged, handleEvent)\r\n    };\r\n  }, [emitter])\r\n\r\n  return (\r\n    <>\r\n      <MarketplaceBrowseItemsFilter></MarketplaceBrowseItemsFilter>\r\n      {isLoading || (query.data && query.data.punks.length > 0) ? (\r\n        <InfiniteScroll\r\n          dataLength={query.data?.punks.length ?? 0}\r\n          next={fetchMoreDataAsync}\r\n          hasMore={hasMore}\r\n          loader={\r\n            <MarketplaceLoading loading={isLoading} error={error} query={query}></MarketplaceLoading>\r\n          }\r\n          scrollThreshold=\"200px\"\r\n          scrollableTarget=\"mainscroll\"\r\n        >\r\n          <Grid container spacing={3} justifyContent=\"center\" alignItems=\"center\" marginBottom={3}>\r\n            {query.data?.punks.map((p: GetPunks_punks) => (\r\n              <Grid item key={p.id} xs={12} sm={6} md={4} lg={3}>\r\n                <MarketplaceBrowseItem item={p as Punk}></MarketplaceBrowseItem>\r\n              </Grid>\r\n            ))}\r\n          </Grid>\r\n        </InfiniteScroll>\r\n      ) : (\r\n        <MarketplaceLoading loading={isLoading} error={error} query={query}></MarketplaceLoading>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import GridOnIcon from '@mui/icons-material/GridOn';\r\nimport TimelineIcon from '@mui/icons-material/Timeline';\r\nimport { Box, Container, Tab, Tabs, Typography } from '@mui/material';\r\nimport React from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { MarketplaceTab } from '../../../../util/types';\r\nimport { MarketplaceBrowseActivity } from '../browse-activity';\r\nimport { MarketplaceBrowseItems } from '../browse-items';\r\n\r\ninterface TabPanelProps {\r\n  children?: React.ReactNode;\r\n  index: number;\r\n  value: number;\r\n}\r\n\r\nfunction TabPanel(props: TabPanelProps) {\r\n  const { children, value, index, ...other } = props;\r\n\r\n  return (\r\n    <div\r\n      role=\"tabpanel\"\r\n      hidden={value !== index}\r\n      id={`marketplace-tabpanel-${index}`}\r\n      aria-labelledby={`marketplace-tab-${index}`}\r\n      {...other}\r\n    >\r\n      {value === index && (\r\n        <Box sx={{ p: 2 }}>\r\n          {children}\r\n        </Box>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport const MarketplaceBrowse: React.FC = (props: any) => {\r\n  const navigate = useNavigate();\r\n  const { tab } = useParams();\r\n  const getTab = (): number => {\r\n    if (tab === MarketplaceTab.Activity) {\r\n      return 1;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  const initialValue = getTab();\r\n  const [value, setValue] = React.useState<number>(initialValue);\r\n  if (initialValue !== value) {\r\n    setValue(initialValue)\r\n  }\r\n\r\n  const handleChange = (event: React.SyntheticEvent, newValue: number) => {\r\n    setValue(newValue);\r\n    switch (newValue) {\r\n      case 1:\r\n        navigate(\"/marketplace/activity\");\r\n        break;\r\n      default:\r\n        navigate(\"/marketplace\");\r\n        break;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Typography variant=\"h2\" component=\"div\" textAlign=\"center\" sx={{ pt: 3 }} gutterBottom>\r\n        Marketplace\r\n      </Typography>\r\n      <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>\r\n        <Tabs value={value} onChange={handleChange}>\r\n          <Tab icon={<GridOnIcon />} label=\"Items\" value={0} />\r\n          <Tab icon={<TimelineIcon />} label=\"Activity\" value={1} />\r\n        </Tabs>\r\n      </Box>\r\n      <Container sx={{ pb: 6 }} maxWidth=\"xl\">\r\n        <TabPanel value={value} index={0}>\r\n          <MarketplaceBrowseItems></MarketplaceBrowseItems>\r\n        </TabPanel>\r\n        <TabPanel value={value} index={1}>\r\n          <Box marginTop={5}>\r\n            <MarketplaceBrowseActivity></MarketplaceBrowseActivity>\r\n          </Box>\r\n        </TabPanel>\r\n      </Container>\r\n    </>\r\n  )\r\n}\r\n","import React from 'react';\r\n\r\nexport const MarketplaceItem: React.FC = (props: any) => {\r\n  return (\r\n    <>\r\n      MarketplaceItem\r\n    </>\r\n  )\r\n}\r\n","import { Card } from '@mui/material';\r\nimport { styled } from '@mui/material/styles';\r\nimport * as React from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { UrlUtil } from '../../../../util/url.util';\r\n\r\nconst CardContainer = styled(Card)(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100vw; \r\n  background-color: rgba(255, 255, 255, 0.5);\r\n`,\r\n);\r\n\r\nconst ImageContainer = styled('div')(\r\n  ({ theme }) => `\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n`,\r\n);\r\n\r\nconst Image = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.ITEM_BG_URL}');\r\n`,\r\n);\r\n\r\nconst Img = styled('img')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: contain;\r\n  image-rendering: pixelated;\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  image: string\r\n  maxHeight?: string\r\n}\r\n\r\nexport const PunkImage: React.FC<Props> = (props: Props) => {\r\n  return (\r\n    <CardContainer sx={{ maxHeight: props.maxHeight ?? \"400px\" }}>\r\n      <ImageContainer>\r\n        <Image>\r\n          <Img sx={{ backgroundImage: `url('${UrlUtil.getPunkUrl(props.image)}')` }} />\r\n        </Image>\r\n      </ImageContainer>\r\n    </CardContainer>\r\n  );\r\n}","import { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Link } from '@mui/material';\r\nimport confetti from 'canvas-confetti';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { GlobalEvent, PunkChangedEvent, PunkEventType } from '../../../../util/types';\r\nimport { PunkImage } from '../image';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const MintDialog: React.FC = () => {\r\n  const [open, setOpen] = useState(false);\r\n  const [punkId, setPunkId] = useState(-1);\r\n  const [punkImage, setPunkImage] = useState(\"\");\r\n  const emitter = getEmitter();\r\n  const service = getPunkService();\r\n  const context = useConnectedWeb3Context();\r\n\r\n  useEffect(() => {\r\n    const handleEvent = async (e: PunkChangedEvent) => {\r\n      //logger.info(`eventType: ${e.eventType} punkId: ${e.punkId} amount: ${e.amount?.toString()} fromAddress: ${e.fromAddress} toAddress: ${e.toAddress} timestamp: ${e.timestamp.toString()}`)();\r\n      if (e.eventType === PunkEventType.Mint && e.toAddress?.toLowerCase() === context.account?.toLowerCase()) {\r\n        logger.info(\"Show mint dialog\")();\r\n        const punk = await service.getById(e.punkId.toString());\r\n        setPunkId(e.punkId);\r\n        setPunkImage(punk.data.punk.image);\r\n        setOpen(true);\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent)\r\n    };\r\n  }, [emitter, service, context.account, setOpen]);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      const triggerConfetti = () => {\r\n        confetti({\r\n          particleCount: 200,\r\n          spread: 100,\r\n          zIndex: 9999\r\n        });\r\n      }\r\n      for (let index = 1; index < 4; index++) {\r\n        setTimeout(() => {\r\n          triggerConfetti();\r\n        }, index * 225);\r\n      }\r\n    }\r\n  }, [open]);\r\n\r\n  const handleClose = () => {\r\n    setPunkImage(\"\");\r\n    setOpen(false);\r\n  };\r\n\r\n  if (punkId < 0) {\r\n    return (\r\n      <>\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      transitionDuration={500}\r\n      keepMounted\r\n      onClose={handleClose}\r\n      style={{ zIndex: 9999 }}\r\n    >\r\n      <DialogTitle>🎉 Mint success!</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText paddingBottom={1}>\r\n          You have successfully minted <Link underline=\"hover\" component={RouterLink} to={`/punk/${punkId}`} onClick={handleClose}>{CommonConstants.PUNK_NAME} #{punkId}</Link>\r\n        </DialogContentText>\r\n        <PunkImage image={punkImage} maxHeight=\"300px\"></PunkImage>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>\r\n          Close\r\n        </Button>\r\n        <Button component={RouterLink} to={`/account/${context.account}`} variant=\"contained\" onClick={handleClose}>\r\n          My punks\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { GET_PUNK_EVENTS_QUERY } from '../../../../queries';\r\nimport { GetPunkEvents, GetPunkEventsVariables } from '../../../../queries/__generated__/GetPunkEvents';\r\nimport { getPunkService } from '../../../../services/punk.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TransformUtil } from '../../../../util/transform.util';\r\nimport { DocumentState, GlobalEvent, Punk, PunkChangedEvent, PunkEvent } from '../../../../util/types';\r\nimport { EventList } from '../../../common/components/event-list';\r\n\r\nconst logger = getLogger();\r\n\r\ninterface Props {\r\n  item: Punk\r\n}\r\n\r\nexport const PunkActivity: React.FC<Props> = (props: Props) => {\r\n  const limit = 8;\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [error, setError] = useState<any>(undefined);\r\n  const [events, setEvents] = useState<PunkEvent[]>([]);\r\n  const [newEvents, setNewEvents] = useState<PunkEvent[]>([]);\r\n  const service = getPunkService();\r\n  const emitter = getEmitter();\r\n\r\n  const query = useQuery<GetPunkEvents, GetPunkEventsVariables>(GET_PUNK_EVENTS_QUERY, {\r\n    variables: {\r\n      id: props.item.id,\r\n      offset: 0,\r\n      limit: limit\r\n    },\r\n    fetchPolicy: 'network-only',\r\n    onCompleted: (data) => {\r\n      setEvents(data.punkEvents.events.map(e => TransformUtil.toPunkEvent(e)));\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    setIsLoading(query.loading);\r\n  }, [query.loading]);\r\n\r\n  useEffect(() => {\r\n    setError(query.error);\r\n  }, [query.error]);\r\n\r\n  const fetchMoreDataAsync = async () => {\r\n    logger.info(\"fetchMoreDataAsync\", events.length)();\r\n    const blockHeight: Maybe<string> = query.data?.punkEvents.blockHeight.toString();\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await service.getEventsAsync(props.item.id, events.length, limit, blockHeight);\r\n      setHasMore(result.data.punkEvents.events.length >= limit);\r\n      if (result.data.punkEvents.events.length > 0) {\r\n        setEvents([\r\n          ...events,\r\n          ...result.data.punkEvents.events.map(e => TransformUtil.toPunkEvent(e))\r\n        ]);\r\n      }\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const refetch = query.refetch;\r\n\r\n  const refresh = useCallback(() => {\r\n    logger.info(\"Refreshing punk activity\")();\r\n    refetch();\r\n    setNewEvents([]);\r\n  }, [refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (state === DocumentState.Active) {\r\n        refresh();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refresh]);\r\n\r\n  const addNewEvent = useCallback((e: PunkChangedEvent) => {\r\n    setNewEvents([\r\n      TransformUtil.toPunkEvent(e),\r\n      ...newEvents\r\n    ]);\r\n  }, [newEvents]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      logger.info(\"newPunkEvent\", e)();\r\n      if (e.punkId === parseInt(props.item.id)) {\r\n        addNewEvent(e);\r\n      }\r\n    }\r\n    logger.info('emitter.on', GlobalEvent.PunkChanged)();\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent);\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.PunkChanged)();\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, props.item.id, addNewEvent]);\r\n\r\n  return (\r\n    <EventList\r\n      events={events}\r\n      newEvents={newEvents}\r\n      error={error}\r\n      loading={isLoading}\r\n      hasMore={hasMore}\r\n      fetchMoreDataAsync={fetchMoreDataAsync}>\r\n    </EventList>\r\n  )\r\n}\r\n","import { FetchPolicy, useQuery } from \"@apollo/client\";\r\nimport React from \"react\";\r\nimport { GET_MARKET_BID_QUERY, GET_MARKET_OFFER_QUERY, GET_PUNK_OWNER_QUERY } from \"../queries\";\r\nimport { GetMarketBid, GetMarketBidVariables } from \"../queries/__generated__/GetMarketBid\";\r\nimport { GetMarketOffer, GetMarketOfferVariables } from \"../queries/__generated__/GetMarketOffer\";\r\nimport { GetPunkOwner, GetPunkOwnerVariables } from \"../queries/__generated__/GetPunkOwner\";\r\nimport { getPunkService } from \"../services/punk.service\";\r\nimport { getLogger } from \"../util/logger\";\r\nimport { Punk, PunkExtended, TypeNames } from \"../util/types\";\r\n\r\nconst logger = getLogger();\r\n\r\nexport const usePunkInfo = (_punk: Punk, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n  const defaultPunkExtended = React.useMemo<PunkExtended>(() => {\r\n    return {\r\n      __typename: TypeNames.PunkExtended,\r\n      id: _punk.id,\r\n      rank: _punk.rank,\r\n      image: _punk.image,\r\n      attributes: _punk.attributes\r\n    };\r\n  }, [_punk]);\r\n  const [punkExtended, setPunkExtended] = React.useState<PunkExtended>(defaultPunkExtended);\r\n  const [dateRef, setDateRef] = React.useState<Date>(new Date(0));\r\n\r\n  const ownerQuery = useQuery<GetPunkOwner, GetPunkOwnerVariables>(GET_PUNK_OWNER_QUERY, {\r\n    variables: {\r\n      id: _punk.id.toString()\r\n    },\r\n    notifyOnNetworkStatusChange: true,\r\n    fetchPolicy: _fetchPolicy,\r\n    refetchWritePolicy: \"overwrite\",\r\n    onCompleted: (data) => {\r\n      setPunkExtended({\r\n        ...punkExtended,\r\n        owner: data.punkOwner\r\n      });\r\n    }\r\n  });\r\n\r\n  const bidQuery = useQuery<GetMarketBid, GetMarketBidVariables>(GET_MARKET_BID_QUERY, {\r\n    variables: {\r\n      id: _punk.id.toString()\r\n    },\r\n    notifyOnNetworkStatusChange: true,\r\n    fetchPolicy: _fetchPolicy,\r\n    refetchWritePolicy: \"overwrite\",\r\n    onCompleted: (data) => {\r\n      setPunkExtended({\r\n        ...punkExtended,\r\n        bid: data.marketBid\r\n      });\r\n    }\r\n  });\r\n\r\n  const offerQuery = useQuery<GetMarketOffer, GetMarketOfferVariables>(GET_MARKET_OFFER_QUERY, {\r\n    variables: {\r\n      id: _punk.id.toString()\r\n    },\r\n    notifyOnNetworkStatusChange: true,\r\n    fetchPolicy: _fetchPolicy,\r\n    refetchWritePolicy: \"overwrite\",\r\n    onCompleted: (data) => {\r\n      setPunkExtended({\r\n        ...punkExtended,\r\n        offer: data.marketOffer\r\n      });\r\n    }\r\n  });\r\n\r\n  const error = ownerQuery.error || bidQuery.error || offerQuery.error;\r\n  const loading = ownerQuery.loading || bidQuery.loading || offerQuery.loading;\r\n\r\n  const refetchAsync = async () => {\r\n    logger.info(\"refetchAsync\", new Date().getTime(), dateRef.getTime())();\r\n    if (new Date().getTime() >= dateRef.getTime() + 500) {\r\n      setDateRef(new Date());\r\n      let newOwner;\r\n      let newBid;\r\n      let newOffer;\r\n      try {\r\n        await Promise.all([\r\n          ownerQuery.refetch().then(e => newOwner = e.data.punkOwner),\r\n          bidQuery.refetch().then(e => newBid = e.data.marketBid),\r\n          offerQuery.refetch().then(e => newOffer = e.data.marketOffer)\r\n        ]);\r\n        logger.info(`Refetching punk ${_punk.id}`, newOwner, newBid, newOffer)();\r\n        setPunkExtended({\r\n          ...defaultPunkExtended,\r\n          owner: newOwner,\r\n          bid: newBid,\r\n          offer: newOffer\r\n        });\r\n      } catch (error) {\r\n        logger.error(error)();\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    punkExtended,\r\n    error,\r\n    loading,\r\n    refetchAsync\r\n  };\r\n}\r\n\r\nexport const usePunkInfoV2 = (_punk: Punk, _fetchPolicy: FetchPolicy = \"network-only\") => {\r\n  const service = getPunkService();\r\n  const defaultPunkExtended = React.useMemo<PunkExtended>(() => {\r\n    return {\r\n      __typename: TypeNames.PunkExtended,\r\n      id: _punk.id,\r\n      rank: _punk.rank,\r\n      image: _punk.image,\r\n      attributes: _punk.attributes\r\n    };\r\n  }, [_punk]);\r\n  const [punkExtended, setPunkExtended] = React.useState<PunkExtended>(defaultPunkExtended);\r\n  const [loading, setLoading] = React.useState<boolean>(true);\r\n  const [error, setError] = React.useState<Maybe<any>>(undefined);\r\n\r\n  const refetchAsync = async () => {\r\n    setLoading(true);\r\n    setError(undefined);\r\n    try {\r\n      const { punkExtended, loading, error } = await service.getExtendedAsync(_punk, _fetchPolicy);\r\n      setPunkExtended(punkExtended);\r\n      setLoading(loading);\r\n      setError(error);\r\n    } catch (error) {\r\n      setLoading(false);\r\n      setError(error);\r\n    }\r\n  }\r\n\r\n  return {\r\n    punkExtended,\r\n    loading,\r\n    error,\r\n    refetchAsync\r\n  }\r\n}\r\n\r\n","import { FetchPolicy } from '@apollo/client';\r\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, FormControl, Input, InputAdornment, InputLabel } from '@mui/material';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { PunkDialogState, PunkExtended } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\n\r\ninterface Props {\r\n  item: PunkExtended\r\n  state: PunkDialogState\r\n  fee: BigNumber\r\n  updateFee: (_fetchPolicy?: FetchPolicy) => Promise<void>\r\n  setState: React.Dispatch<React.SetStateAction<PunkDialogState>>\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkBidDialog: React.FC<Props> = (props: Props) => {\r\n  const [amount, setAmount] = useState<string>(\"\");\r\n  const [disabled, setDisabled] = useState<boolean>(false);\r\n  const service = getMarketService();\r\n\r\n  const changeAmount = (amount: string) => {\r\n    setAmount(amount);\r\n    setDisabled(CommonUtil.isNullOrWhitespace(amount) || new BigNumber(amount).lte(0));\r\n  }\r\n\r\n  const updateFee = props.updateFee;\r\n\r\n  useEffect(() => {\r\n    if (props.state.open) {\r\n      changeAmount(\"\");\r\n      updateFee(\"cache-first\");\r\n    }\r\n  }, [props.state, updateFee]);\r\n\r\n  const handleClose = () => {\r\n    props.setState({\r\n      ...props.state,\r\n      open: false\r\n    })\r\n  };\r\n\r\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    changeAmount(event.target.value);\r\n  };\r\n\r\n  const handleConfirmAsync = async () => {\r\n    try {\r\n      const _amount = new BigNumber(amount).shiftedBy(CommonConstants.CURRENCY_DECIMALS);\r\n      const _success = await service.bidAsync(props.item.id, _amount.toFixed());\r\n      if (_success) {\r\n        SnackbarUtil.enqueueMessage(\"Bid success\");\r\n        handleClose();\r\n      } else {\r\n        SnackbarUtil.enqueueError(\"Error\");\r\n        updateFee();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog onClose={handleClose} open={props.state.open} maxWidth=\"xs\" fullWidth>\r\n      <DialogTitle>Bid</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          Place a bid for {CommonConstants.PUNK_NAME} #{props.item.id}\r\n        </DialogContentText>\r\n        <FormControl fullWidth sx={{ mt: 2 }} variant=\"standard\" >\r\n          <InputLabel htmlFor=\"amount\">Amount</InputLabel>\r\n          <Input\r\n            id=\"amount\"\r\n            value={amount}\r\n            onChange={handleChange}\r\n            type=\"number\"\r\n            autoFocus\r\n            startAdornment={<InputAdornment position=\"start\">${CommonConstants.CURRENCY_NAME}</InputAdornment>}\r\n          />\r\n        </FormControl>\r\n        {props.fee.gt(0) && (\r\n          <DialogContentText align='right'>\r\n            + {TokenUtil.formatBigNumber(props.fee, CommonConstants.CURRENCY_DECIMALS, 2)} {CommonConstants.CURRENCY_NAME} protocol fee\r\n          </DialogContentText>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>Cancel</Button>\r\n        <ClickOnceButton size=\"medium\" color=\"primary\" callbackFn={handleConfirmAsync} disabled={disabled}>\r\n          Confirm\r\n        </ClickOnceButton>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { FetchPolicy } from '@apollo/client';\r\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, FormControl, Input, InputAdornment, InputLabel } from '@mui/material';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { PunkDialogState, PunkExtended } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\n\r\ninterface Props {\r\n  item: PunkExtended\r\n  state: PunkDialogState\r\n  fee: BigNumber\r\n  updateFee: (_fetchPolicy?: FetchPolicy) => Promise<void>\r\n  setState: React.Dispatch<React.SetStateAction<PunkDialogState>>\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkOfferDialog: React.FC<Props> = (props: Props) => {\r\n  const [amount, setAmount] = useState<string>(\"\");\r\n  const [address, setAddress] = useState<string>(\"\");\r\n  const [disabled, setDisabled] = useState<boolean>(false);\r\n  const service = getMarketService();\r\n\r\n  const changeAmount = (amount: string) => {\r\n    setAmount(amount);\r\n    setDisabled(CommonUtil.isNullOrWhitespace(amount) || new BigNumber(amount).lt(0));\r\n  }\r\n\r\n  const updateFee = props.updateFee;\r\n\r\n  useEffect(() => {\r\n    if (props.state.open) {\r\n      changeAmount(\"\");\r\n      setAddress(\"\");\r\n      updateFee(\"cache-first\");\r\n    }\r\n  }, [props.state, updateFee]);\r\n\r\n  const handleClose = () => {\r\n    props.setState({\r\n      ...props.state,\r\n      open: false\r\n    })\r\n  };\r\n\r\n  const handleAmountChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    changeAmount(event.target.value);\r\n  };\r\n\r\n  const handleAddressChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    setAddress(event.target.value);\r\n  };\r\n\r\n  const handleConfirmAsync = async () => {\r\n    try {\r\n      const _amount = new BigNumber(amount).shiftedBy(CommonConstants.CURRENCY_DECIMALS);\r\n      const _success = await service.offerAsync(props.item.id, _amount.toFixed(), CommonUtil.isNullOrWhitespace(address) ? undefined : address);\r\n      if (_success) {\r\n        SnackbarUtil.enqueueMessage(\"Listed for sale\");\r\n        handleClose();\r\n      } else {\r\n        SnackbarUtil.enqueueError(\"Error\");\r\n        updateFee();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog onClose={handleClose} open={props.state.open} maxWidth=\"xs\" fullWidth>\r\n      <DialogTitle>Sell</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          List {CommonConstants.PUNK_NAME} #{props.item.id} for sale\r\n        </DialogContentText>\r\n        <FormControl fullWidth sx={{ mt: 2 }} variant=\"standard\" >\r\n          <InputLabel htmlFor=\"amount\">Amount</InputLabel>\r\n          <Input\r\n            id=\"amount\"\r\n            value={amount}\r\n            onChange={handleAmountChange}\r\n            type=\"number\"\r\n            autoFocus\r\n            startAdornment={<InputAdornment position=\"start\">${CommonConstants.CURRENCY_NAME}</InputAdornment>}\r\n          />\r\n        </FormControl>\r\n        {props.fee.gt(0) ? (\r\n          <DialogContentText align='right'>\r\n            + {TokenUtil.formatBigNumber(props.fee, CommonConstants.CURRENCY_DECIMALS, 2)} {CommonConstants.CURRENCY_NAME} protocol fee\r\n          </DialogContentText>\r\n        ) : (\r\n          <Box marginTop={2}></Box>\r\n        )}\r\n        <FormControl fullWidth variant=\"standard\" >\r\n          <InputLabel htmlFor=\"address\">Address (optional)</InputLabel>\r\n          <Input\r\n            id=\"address\"\r\n            value={address}\r\n            onChange={handleAddressChange}\r\n            placeholder=\"Only this address will be eligible to buy\"\r\n            type=\"text\"\r\n          />\r\n        </FormControl>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose}>Cancel</Button>\r\n        <ClickOnceButton size=\"medium\" color=\"primary\" callbackFn={handleConfirmAsync} disabled={disabled}>\r\n          Confirm\r\n        </ClickOnceButton>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { FetchPolicy } from '@apollo/client';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TransformUtil } from '../../../../util/transform.util';\r\nimport { GlobalEvent, MarketChangedEvent, MarketInfo, PunkDialogState, PunkDialogType, PunkExtended } from '../../../../util/types';\r\nimport { PunkBidDialog } from '../dialog-bid';\r\nimport { PunkOfferDialog } from '../dialog-offer';\r\n\r\nconst logger = getLogger();\r\n\r\ninterface Props {\r\n  item: PunkExtended\r\n  state: PunkDialogState\r\n  setState: React.Dispatch<React.SetStateAction<PunkDialogState>>\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkDialog: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [fee, setFee] = useState<BigNumber>(TransformUtil.defaultBigNumber);\r\n  const service = getMarketService();\r\n  const emitter = getEmitter();\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  const updateFee = useCallback(async (_fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    if (mounted.current) {\r\n      setFee(TransformUtil.defaultBigNumber);\r\n      try {\r\n        const result = await service.getMarketInfoAsync(_fetchPolicy);\r\n        if (mounted.current) {\r\n          const info = result.data.marketInfo as MarketInfo;\r\n          if (info && info.actionPrice.gt(0)) {\r\n            setFee(info.actionPrice);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        logger.error(error)();\r\n      }\r\n    }\r\n  }, [service]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: MarketChangedEvent) => {\r\n      logger.info(`eventType: ${e.eventType} amount: ${e.value.toFixed()} timestamp: ${e.timestamp.toFixed()}`)();\r\n      updateFee();\r\n    }\r\n    logger.info('emitter.on', GlobalEvent.MarketChanged)();\r\n    emitter.on(GlobalEvent.MarketChanged, handleEvent);\r\n    return () => {\r\n      logger.info('emitter.off', GlobalEvent.MarketChanged)();\r\n      emitter.off(GlobalEvent.MarketChanged, handleEvent);\r\n    };\r\n  }, [emitter, updateFee]);\r\n\r\n  switch (props.state.type) {\r\n    case PunkDialogType.BID:\r\n      return <PunkBidDialog item={props.item} state={props.state} fee={fee} updateFee={updateFee} setState={props.setState} refetchAsync={props.refetchAsync}></PunkBidDialog>\r\n    case PunkDialogType.OFFER:\r\n      return <PunkOfferDialog item={props.item} state={props.state} fee={fee} updateFee={updateFee} setState={props.setState} refetchAsync={props.refetchAsync}></PunkOfferDialog>\r\n    default:\r\n      return <></>\r\n  }\r\n}\r\n","import { faCheck } from '@fortawesome/free-solid-svg-icons';\r\nimport { Button, Stack } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { getMarketService } from '../../../../services/market.service';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { IconUtil } from '../../../../util/icon.util';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { PunkDialogState, PunkDialogType, PunkEventType, PunkExtended } from '../../../../util/types';\r\nimport { ClickOnceButton } from '../../../common/components/click-once-button';\r\nimport { FontAwesomeSvgIcon } from '../../../common/components/fa-icon';\r\nimport { PunkDialog } from '../dialog';\r\n\r\nconst logger = getLogger();\r\n\r\ntype ShowButtonState = {\r\n  showAny: boolean\r\n  showBuy: boolean\r\n  showClaim: boolean\r\n  showBid: boolean\r\n  showSell: boolean\r\n  showAcceptBid: boolean\r\n  showCancelBid: boolean\r\n  showCancelSale: boolean\r\n  showCancelGift: boolean\r\n}\r\n\r\ninterface Props {\r\n  marketStarted: boolean,\r\n  item: PunkExtended,\r\n  refetchAsync: () => Promise<void>\r\n}\r\n\r\nexport const PunkInfoActions: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const [hasOwner, setHasOwner] = useState<boolean>(false);\r\n  const [showAll] = useState<boolean>(false);\r\n  const [showButtonState, setShowButtonState] = useState<ShowButtonState>({\r\n    showAny: false,\r\n    showBuy: false,\r\n    showClaim: false,\r\n    showBid: false,\r\n    showSell: false,\r\n    showAcceptBid: false,\r\n    showCancelBid: false,\r\n    showCancelSale: false,\r\n    showCancelGift: false\r\n  })\r\n  const [dialogState, setDialogState] = useState<PunkDialogState>({\r\n    type: PunkDialogType.BID,\r\n    open: false\r\n  });\r\n  const context = useConnectedWeb3Context();\r\n  const service = getMarketService();\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (mounted.current) {\r\n      let isOwner = props.item.owner?.toLowerCase() === context.account?.toLowerCase();\r\n      const state: ShowButtonState = {\r\n        showAny: false,\r\n        showBuy: false,\r\n        showClaim: false,\r\n        showBid: false,\r\n        showSell: false,\r\n        showAcceptBid: false,\r\n        showCancelBid: false,\r\n        showCancelSale: false,\r\n        showCancelGift: false\r\n      }\r\n      // setHasOwner\r\n      if (props.item.owner && !CommonUtil.isNullOrWhitespace(props.item.owner)) {\r\n        setHasOwner(true);\r\n      } else {\r\n        setHasOwner(false);\r\n      }\r\n      if (props.marketStarted && !CommonUtil.isNullOrWhitespace(context.account)) {\r\n        state.showAny = true;\r\n      }\r\n      if (!isOwner && props.item.offer && (CommonUtil.isNullOrWhitespace(props.item.offer.onlySellTo) || props.item.offer.onlySellTo?.toLowerCase() === context.account?.toLowerCase())) {\r\n        if (props.item.offer.minAmount.gt(0)) {\r\n          state.showBuy = true;\r\n        } else {\r\n          state.showClaim = true;\r\n        }\r\n      }\r\n      if (!isOwner && props.item.bid?.bidder.toLowerCase() !== context.account?.toLowerCase()) {\r\n        state.showBid = true;\r\n      }\r\n      if (isOwner && !props.item.offer) {\r\n        state.showSell = true;\r\n      }\r\n      if (isOwner && props.item.bid) {\r\n        state.showAcceptBid = true;\r\n      }\r\n      if (!isOwner && props.item.bid?.bidder.toLowerCase() === context.account?.toLowerCase()) {\r\n        state.showCancelBid = true;\r\n      }\r\n      if (isOwner && props.item.offer) {\r\n        if (props.item.offer.minAmount.gt(0)) {\r\n          state.showCancelSale = true;\r\n        } else {\r\n          state.showCancelGift = true;\r\n        }\r\n      }\r\n      setShowButtonState(state);\r\n    }\r\n  }, [props.marketStarted, props.item, context.account]);\r\n\r\n  const handleFailureAsync = async () => {\r\n    SnackbarUtil.enqueueMessage('Transaction failed');\r\n    try {\r\n      // Update actionPrice just in case\r\n      await service.getMarketInfoAsync();\r\n    } catch (error) {\r\n      logger.error(error)();\r\n    }\r\n  }\r\n\r\n  const handleBuyAsync = async (isClaim: boolean = false) => {\r\n    try {\r\n      if (!props.item.offer) {\r\n        throw new Error(`${CommonConstants.PUNK_NAME} #${props.item.id} is not for sale`);\r\n      }\r\n      const success = await service.buyAsync(props.item.id, props.item.offer.minAmount.toFixed());\r\n      if (success) {\r\n        const actionName = isClaim ? \"claimed\" : \"bought\";\r\n        SnackbarUtil.enqueueMessage(`Congratulations! You ${actionName} ${CommonConstants.PUNK_NAME} #${props.item.id}`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleAcceptBidAsync = async () => {\r\n    try {\r\n      if (!props.item.bid) {\r\n        throw new Error(`${CommonConstants.PUNK_NAME} #${props.item.id} has no bid`);\r\n      }\r\n      const success = await service.acceptBidAsync(props.item.id, props.item.bid.amount.toFixed());\r\n      if (success) {\r\n        SnackbarUtil.enqueueMessage(`Congratulations! You sold ${CommonConstants.PUNK_NAME} #${props.item.id}`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleCancelBidAsync = async () => {\r\n    try {\r\n      const success = await service.cancelBidAsync(props.item.id);\r\n      if (success) {\r\n        SnackbarUtil.enqueueMessage(`Bid cancelled`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleCancelSaleAsync = async (isGift: boolean = false) => {\r\n    try {\r\n      const success = await service.cancelOfferAsync(props.item.id);\r\n      if (success) {\r\n        const actName = isGift ? \"Gift\" : \"Sale\";\r\n        SnackbarUtil.enqueueMessage(`${actName} cancelled`);\r\n      } else {\r\n        await handleFailureAsync();\r\n      }\r\n    } catch (error) {\r\n      SnackbarUtil.enqueueError(error);\r\n    } finally {\r\n      await props.refetchAsync();\r\n    }\r\n  }\r\n\r\n  const handleOpenDialog = (type: PunkDialogType) => {\r\n    if (mounted.current) {\r\n      setDialogState({\r\n        ...dialogState,\r\n        type: type,\r\n        open: true\r\n      })\r\n    }\r\n  }\r\n\r\n  if (!hasOwner || !showButtonState.showAny) {\r\n    return (\r\n      <></>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Stack spacing={1} direction=\"row\">\r\n        {(showAll || showButtonState.showBuy) && (\r\n          <ClickOnceButton\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getBuyEventTypeIcon()} />}\r\n            callbackFn={handleBuyAsync}>\r\n            Buy\r\n          </ClickOnceButton>\r\n        )}\r\n        {(showAll || showButtonState.showClaim) && (\r\n          <ClickOnceButton\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getClaimEventTypeIcon()} />}\r\n            callbackFn={async () => { await handleBuyAsync(true) }}>\r\n            Claim\r\n          </ClickOnceButton>\r\n        )}\r\n        {(showAll || showButtonState.showBid) && (\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getPunkEventTypeIcon(PunkEventType.NewBid)} />}\r\n            onClick={() => { handleOpenDialog(PunkDialogType.BID) }}>\r\n            Bid\r\n          </Button>\r\n        )}\r\n        {(showAll || showButtonState.showSell) && (\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={IconUtil.getOfferEventTypeIcon()} />}\r\n            onClick={() => { handleOpenDialog(PunkDialogType.OFFER) }}>\r\n            Sell\r\n          </Button>\r\n        )}\r\n        {(showAll || showButtonState.showAcceptBid) && (\r\n          <ClickOnceButton\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            startIcon={<FontAwesomeSvgIcon icon={faCheck} />}\r\n            callbackFn={handleAcceptBidAsync}>\r\n            Accept bid\r\n          </ClickOnceButton>\r\n        )}\r\n      </Stack>\r\n      {(showAll || showButtonState.showCancelBid || showButtonState.showCancelSale || showButtonState.showCancelGift) && (\r\n        <Stack spacing={1} direction=\"row\" marginTop={1}>\r\n          {(showAll || showButtonState.showCancelBid) && (\r\n            <ClickOnceButton\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              startIcon={<FontAwesomeSvgIcon icon={IconUtil.getPunkEventTypeIcon(PunkEventType.CancelBid)} />}\r\n              callbackFn={handleCancelBidAsync}>\r\n              Cancel bid\r\n            </ClickOnceButton>\r\n          )}\r\n          {(showAll || showButtonState.showCancelSale) && (\r\n            <ClickOnceButton\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              startIcon={<FontAwesomeSvgIcon icon={IconUtil.getCancelSaleEventTypeIcon()} />}\r\n              callbackFn={handleCancelSaleAsync}>\r\n              Cancel sale\r\n            </ClickOnceButton>\r\n          )}\r\n          {(showAll || showButtonState.showCancelGift) && (\r\n            <ClickOnceButton\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              startIcon={<FontAwesomeSvgIcon icon={IconUtil.getCancelSaleEventTypeIcon()} />}\r\n              callbackFn={async () => { handleCancelSaleAsync(true) }}>\r\n              Cancel gift\r\n            </ClickOnceButton>\r\n          )}\r\n        </Stack>\r\n      )}\r\n      <PunkDialog item={props.item} state={dialogState} setState={setDialogState} refetchAsync={props.refetchAsync}></PunkDialog>\r\n    </>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { faGem } from '@fortawesome/free-regular-svg-icons';\r\nimport { Verified } from '@mui/icons-material';\r\nimport { Box, Card, Chip, Skeleton, Stack, styled, Typography, useMediaQuery, useTheme } from '@mui/material';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { useConnectedWeb3Context } from '../../../../contexts/connectedWeb3';\r\nimport { usePunkInfo } from '../../../../hooks/punk.hook';\r\nimport { GET_MARKET_INFO_QUERY } from '../../../../queries';\r\nimport { GetMarketInfo } from '../../../../queries/__generated__/GetMarketInfo';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { DocumentState, GlobalEvent, Punk, PunkChangedEvent } from '../../../../util/types';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { ExplorerLink, ExplorerLinkType } from '../../../common/components/explorer-link';\r\nimport { FontAwesomeSvgIcon } from '../../../common/components/fa-icon';\r\nimport { BootstrapTooltip, ExtendedBootstrapTooltip } from '../../../common/components/tooltip';\r\nimport { PunkInfoActions } from '../info-actions';\r\n\r\nconst logger = getLogger();\r\n\r\nconst InfoContainer = styled(Card)(\r\n  ({ theme }) => `\r\n  position: relative;\r\n  overflow: auto;\r\n  width: 100%;\r\n  height: 80vw;\r\n  min-height: 320px;\r\n  max-height: 400px;\r\n  background-color: rgba(255, 255, 255, 0.5);\r\n`,\r\n);\r\n\r\nconst BottomContent = styled(Box)(\r\n  ({ theme }) => `\r\n  position: absolute;\r\n  bottom: 24px;\r\n  left: 24px;\r\n  width: calc(100% - 48px);\r\n`,\r\n);\r\n\r\ninterface Props {\r\n  item: Punk\r\n}\r\n\r\nexport const PunkInfo: React.FC<Props> = (props: Props) => {\r\n  const mounted = React.useRef(false);\r\n  const theme = useTheme();\r\n  const matches = useMediaQuery(theme.breakpoints.down('sm'));\r\n  const [marketStarted, setMarketStarted] = useState(false);\r\n  const { punkExtended, loading, error, refetchAsync } = usePunkInfo(props.item);\r\n  const query = useQuery<GetMarketInfo>(GET_MARKET_INFO_QUERY, {\r\n    fetchPolicy: 'network-only'\r\n  });\r\n  const context = useConnectedWeb3Context();\r\n  const emitter = getEmitter();\r\n\r\n  const refetch = query.refetch;\r\n\r\n  useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (error) {\r\n      logger.error(error)();\r\n    }\r\n  }, [error]);\r\n\r\n  useEffect(() => {\r\n    if (mounted.current) {\r\n      const info = query.data?.marketInfo;\r\n      if (info && mounted.current) {\r\n        setMarketStarted(info.marketStarted);\r\n      }\r\n    }\r\n  }, [query.data]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (state: DocumentState) => {\r\n      if (mounted.current) {\r\n        if (state === DocumentState.Active) {\r\n          refetchAsync();\r\n        }\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.DocumentVisibilityChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetchAsync]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = () => {\r\n      if (mounted.current) {\r\n        refetch();\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.MarketChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.MarketChanged, handleEvent);\r\n    };\r\n  }, [emitter, refetch]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (e: PunkChangedEvent) => {\r\n      if (mounted.current) {\r\n        if (e.punkId === parseInt(props.item.id)) {\r\n          refetchAsync();\r\n        }\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.PunkChanged, handleEvent);\r\n    return () => {\r\n      emitter.off(GlobalEvent.PunkChanged, handleEvent);\r\n    };\r\n  }, [emitter, props.item.id, refetchAsync]);\r\n\r\n  const formatBigNumber = (number: BigNumber, decimals: number = CommonConstants.CURRENCY_DECIMALS) => {\r\n    return TokenUtil.formatBigNumber(number, CommonConstants.CURRENCY_DECIMALS, decimals);\r\n  }\r\n\r\n  return (\r\n    <InfoContainer>\r\n      <Box sx={{ p: 3 }}>\r\n        <Stack direction=\"row\" justifyContent=\"space-between\">\r\n          <Typography variant=\"h5\" fontSize={matches ? \"1.25rem\" : \"1.5rem\"} color=\"primary\" paragraph>{CommonConstants.PUNK_NAME} #{props.item.id}</Typography>\r\n          <Box>\r\n            <ExtendedBootstrapTooltip sx={{ mr: 1 }} title={<span>Rarity rank</span>} placement=\"bottom\" arrow>\r\n              <Chip size=\"small\" icon={<FontAwesomeSvgIcon icon={faGem} sx={{ fontSize: \"small\", marginLeft: 1 }} />} sx={{ fontSize: \"0.7rem\" }} label={props.item.rank} />\r\n            </ExtendedBootstrapTooltip>\r\n          </Box>\r\n        </Stack>\r\n        {props.item.attributes.length > 0 && (\r\n          <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n            {props.item.attributes?.map((a: string) => (\r\n              <Chip key={a} label={a} variant=\"outlined\" size={matches ? \"small\" : \"medium\"} />\r\n            ))}\r\n          </Stack>\r\n        )}\r\n        {error ? (\r\n          <Alert message={FormatUtil.formatMessage(error)} type=\"warning\"></Alert>\r\n        ) : (\r\n          <>\r\n            <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n              <Typography display=\"inline\">\r\n                <b>Owner</b>:\r\n              </Typography>\r\n              {loading ? (\r\n                <Skeleton animation=\"wave\" height={24} width=\"40%\" sx={{ display: \"inline\" }} />\r\n              ) : (\r\n                <Typography display=\"inline\" component=\"div\">\r\n                  {!punkExtended.owner ? (\r\n                    <>\r\n                      Not minted yet.\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <ExplorerLink type={ExplorerLinkType.Address} value={punkExtended.owner}>\r\n                        <ExtendedBootstrapTooltip title={punkExtended.owner}>\r\n                          <span>{CommonUtil.truncateStringInTheMiddle(punkExtended.owner, 20, 5)}</span>\r\n                        </ExtendedBootstrapTooltip>\r\n                      </ExplorerLink>\r\n                      {context.account && punkExtended.owner.toLowerCase() === context.account.toLowerCase() && (\r\n                        <Chip size=\"small\" icon={<Verified />} label=\"You own this punk\" variant=\"filled\" sx={{ borderRadius: 1, ml: 1 }} color=\"secondary\" />\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </Typography>\r\n              )}\r\n            </Stack>\r\n            <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n              <Typography display=\"inline\">\r\n                <b>Current bid</b>:\r\n              </Typography>\r\n              {loading ? (\r\n                <Skeleton animation=\"wave\" height={24} width=\"60%\" sx={{ display: \"inline\" }} />\r\n              ) : (\r\n                <Typography display=\"inline\">\r\n                  {!punkExtended.bid ? (\r\n                    <>\r\n                      -\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <BootstrapTooltip title={formatBigNumber(punkExtended.bid.amount)}>\r\n                        <span>{formatBigNumber(punkExtended.bid.amount, 4)} {CommonConstants.CURRENCY_NAME}</span>\r\n                      </BootstrapTooltip>\r\n                      &nbsp;by <ExplorerLink type={ExplorerLinkType.Address} value={punkExtended.bid.bidder}><ExtendedBootstrapTooltip title={punkExtended.bid.bidder}>\r\n                        <span>{CommonUtil.truncateStringInTheMiddle(punkExtended.bid.bidder, 10, 5)}</span>\r\n                      </ExtendedBootstrapTooltip></ExplorerLink>\r\n                    </>\r\n                  )}\r\n                </Typography>\r\n              )}\r\n            </Stack>\r\n            <Stack spacing={1} direction=\"row\" sx={{ mb: 2 }}>\r\n              {(loading || punkExtended.offer) ? (\r\n                <>\r\n                  <Typography display=\"inline\">\r\n                    <b>Current sale offer</b>:\r\n                  </Typography>\r\n                  {loading ? (\r\n                    <Skeleton animation=\"wave\" height={24} width=\"30%\" sx={{ display: \"inline\" }} />\r\n                  ) : (\r\n                    <Typography display=\"inline\">\r\n                      {!punkExtended.offer ? (\r\n                        <>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <BootstrapTooltip title={formatBigNumber(punkExtended.offer.minAmount)}>\r\n                            <span>{formatBigNumber(punkExtended.offer.minAmount, 4)} {CommonConstants.CURRENCY_NAME}</span>\r\n                          </BootstrapTooltip>\r\n                          {punkExtended.offer.onlySellTo && !CommonUtil.isNullOrWhitespace(punkExtended.offer.onlySellTo) && (\r\n                            <>\r\n                              &nbsp;(<ExplorerLink type={ExplorerLinkType.Address} value={punkExtended.offer.onlySellTo}><ExtendedBootstrapTooltip title={punkExtended.offer.onlySellTo}>\r\n                                <span>{CommonUtil.truncateStringInTheMiddle(punkExtended.offer.onlySellTo, 10, 5)}</span>\r\n                              </ExtendedBootstrapTooltip></ExplorerLink>)\r\n                            </>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </Typography>\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <Chip label=\"Not for sale\" variant=\"filled\" sx={{ borderRadius: 1 }} />\r\n              )}\r\n            </Stack>\r\n          </>\r\n        )}\r\n        <BottomContent>\r\n          <PunkInfoActions marketStarted={marketStarted} item={punkExtended} refetchAsync={refetchAsync}></PunkInfoActions>\r\n        </BottomContent>\r\n      </Box>\r\n    </InfoContainer>\r\n  )\r\n}\r\n","import { useQuery } from '@apollo/client';\r\nimport { Container, Grid } from '@mui/material';\r\nimport React from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { GET_PUNK_QUERY } from '../../../../queries';\r\nimport { GetPunk, GetPunkVariables } from '../../../../queries/__generated__/GetPunk';\r\nimport { FormatUtil } from '../../../../util/format.util';\r\nimport { Alert } from '../../../common/components/alert';\r\nimport { PunkActivity } from '../activity';\r\nimport { PunkImage } from '../image';\r\nimport { PunkInfo } from '../info';\r\n\r\nexport const PunkDetails: React.FC = (props: any) => {\r\n  const { id } = useParams();\r\n\r\n  const query = useQuery<GetPunk, GetPunkVariables>(GET_PUNK_QUERY, {\r\n    variables: {\r\n      id: id ?? \"-1\"\r\n    },\r\n    fetchPolicy: 'network-only'\r\n  });\r\n\r\n  const error = query.error;\r\n  const loading = query.loading;\r\n\r\n  if (error) {\r\n    return <Alert message={FormatUtil.formatMessage(error)} type=\"warning\"></Alert>\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {loading || !query.data ? (\r\n        <Alert message=\"Loading...\" type=\"default\" ></Alert>\r\n      ) : (\r\n        <Container maxWidth=\"lg\">\r\n          <Grid container spacing={3} direction=\"row\" marginBottom={3}>\r\n            <Grid item xs={12} md={5}>\r\n              <PunkImage image={query.data.punk.image}></PunkImage>\r\n            </Grid>\r\n            <Grid item xs={12} md={7}>\r\n              <PunkInfo item={query.data.punk}></PunkInfo>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n              <PunkActivity item={query.data.punk}></PunkActivity>\r\n            </Grid>\r\n          </Grid>\r\n        </Container>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Slide, SlideProps } from '@mui/material';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { GlobalEvent } from '../../../../util/types';\r\n\r\nconst Transition = React.forwardRef(function Transition(props: SlideProps, ref: React.Ref<unknown>) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\nexport const ConfirmTransactionDialog: React.FC = () => {\r\n  const [open, setOpen] = useState(false);\r\n  const emitter = getEmitter();\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (open: boolean) => {\r\n      setOpen(open)\r\n    }\r\n    emitter.on(GlobalEvent.ConfirmTransactionDialog, handleEvent)\r\n    return () => {\r\n      emitter.off(GlobalEvent.ConfirmTransactionDialog, handleEvent)\r\n    };\r\n  }, [emitter, setOpen])\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      TransitionComponent={Transition}\r\n      keepMounted\r\n      onClose={handleClose}\r\n      style={{ zIndex: 9999 }}\r\n    >\r\n      <DialogTitle>ViteConnect</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>\r\n          Please confirm transaction on VITE Wallet App\r\n        </DialogContentText>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose} color=\"primary\">\r\n          Close\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { ApolloClient, FetchPolicy, NormalizedCacheObject } from \"@apollo/client\";\r\nimport { getApolloClient } from \"../clients/apollo.client\";\r\nimport { CommonConfig } from \"../common/config\";\r\nimport { GET_QUOTA_QUERY } from \"../queries/general\";\r\nimport { GetQuota, GetQuotaVariables } from \"../queries/__generated__/GetQuota\";\r\n\r\nclass GeneralService {\r\n  private readonly _apollo: ApolloClient<NormalizedCacheObject>;\r\n\r\n  constructor() {\r\n    this._apollo = getApolloClient();\r\n  }\r\n\r\n  getContractQuota = (_fetchPolicy: FetchPolicy = \"network-only\") => {\r\n    return this._apollo.query<GetQuota, GetQuotaVariables>({\r\n      query: GET_QUOTA_QUERY,\r\n      variables: {\r\n        address: CommonConfig.CONTRACT_ADDRESS\r\n      },\r\n      fetchPolicy: _fetchPolicy\r\n    })\r\n  }\r\n}\r\n\r\nconst service = new GeneralService();\r\n\r\nexport const getGeneralService = () => {\r\n  return service;\r\n}","import LaunchIcon from '@mui/icons-material/Launch';\r\nimport { Alert, Button, Container, Stack, Typography } from '@mui/material';\r\nimport { styled } from '@mui/system';\r\nimport BigNumber from 'bignumber.js';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { CommonConstants } from '../../../../common/constants';\r\nimport { getGeneralService } from '../../../../services/general.service';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { TokenUtil } from '../../../../util/token.util';\r\nimport { GlobalEvent, ViteQuotaResult } from '../../../../util/types';\r\nimport { BootstrapTooltip } from '../../../common/components/tooltip';\r\n\r\nconst logger = getLogger();\r\n\r\nconst QuotaContainer = styled(Container)(({ theme }) => (`\r\n  position: absolute;\r\n  top: 64px;\r\n  right: 0;\r\n  width: 100%;\r\n  z-index: 9999;\r\n`));\r\n\r\nconst QuotaAlert = styled(Alert)(({ theme }) => (`\r\n  float: right;\r\n  background-color: rgba(255, 255, 255);\r\n`));\r\n\r\nexport const ContractQuota: React.FC = (props: any) => {\r\n  const mounted = React.useRef(false);\r\n  const [quota, setQuota] = useState<ViteQuotaResult>({\r\n    currentQuota: new BigNumber(\"0\"),\r\n    maxQuota: new BigNumber(\"0\"),\r\n    stakeAmount: new BigNumber(\"0\")\r\n  });\r\n  const [showContainer, setShowContainer] = useState<boolean>(false);\r\n  const service = getGeneralService();\r\n  const emitter = getEmitter();\r\n\r\n  React.useEffect(() => {\r\n    mounted.current = true;\r\n    return () => {\r\n      mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let interval: NodeJS.Timeout;\r\n    if (showContainer) {\r\n      interval = setInterval(async () => {\r\n        const result = await service.getContractQuota();\r\n        logger.info(result.data.quota)();\r\n        if (mounted.current && result.data.quota) {\r\n          const quotaResult = result.data.quota as ViteQuotaResult;\r\n          if (quotaResult.currentQuota.gte(quotaResult.maxQuota)) {\r\n            clearInterval(interval);\r\n            setShowContainer(false);\r\n          }\r\n          setQuota({\r\n            currentQuota: quotaResult.currentQuota,\r\n            maxQuota: quotaResult.maxQuota,\r\n            stakeAmount: quotaResult.stakeAmount\r\n          });\r\n        }\r\n      }, 2000);\r\n    }\r\n    return () => {\r\n      logger.info(\"clearInterval(interval)\")();\r\n      if (interval) {\r\n        clearInterval(interval);\r\n      }\r\n    }\r\n  }, [service, showContainer]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = (_address: string, _quota: ViteQuotaResult) => {\r\n      if (mounted.current && CommonConstants.QUOTA_THRESHOLD.gte(_quota.currentQuota.minus(CommonConstants.QUOTA_THRESHOLD))) {\r\n        setQuota({\r\n          currentQuota: _quota.currentQuota,\r\n          maxQuota: _quota.maxQuota,\r\n          stakeAmount: _quota.stakeAmount\r\n        });\r\n        setShowContainer(true);\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.QuotaChanged, handleEvent);\r\n    return () => {\r\n      logger.info(\"emitter.off(GlobalEvent.QuotaChanged, handleEvent)\")();\r\n      emitter.off(GlobalEvent.QuotaChanged, handleEvent);\r\n    };\r\n  }, [emitter]);\r\n\r\n  const formatBigNumber = (bn: BigNumber, decimals: number = CommonConstants.CURRENCY_DECIMALS) => {\r\n    return TokenUtil.formatBigNumber(bn, 0, decimals);\r\n  }\r\n\r\n  if (!showContainer || quota.maxQuota.eq(0)) {\r\n    return (\r\n      <>\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <QuotaContainer maxWidth=\"xl\">\r\n      <QuotaAlert icon={false} severity=\"info\" onClose={() => { setShowContainer(false) }} sx={{ mt: 3, mr: 2 }}>\r\n        <Typography marginBottom={1} paragraph>\r\n          <b>Contract quota is recharging...</b>\r\n        </Typography>\r\n        <BootstrapTooltip title={formatBigNumber(quota.currentQuota)} placement=\"left\" arrow>\r\n          <Typography marginBottom={1} paragraph>\r\n            {formatBigNumber(quota.currentQuota, 6)} / {formatBigNumber(quota.maxQuota, 6)}\r\n          </Typography>\r\n        </BootstrapTooltip>\r\n        <Typography marginBottom={1}>You can help by staking {CommonConstants.CURRENCY_NAME}</Typography>\r\n        <Stack spacing={1} direction=\"row\">\r\n          <Typography>What does this mean?</Typography>\r\n          <Button variant=\"outlined\" size=\"small\" href={CommonConstants.QUOTA_WIKI_URL} target=\"_blank\" endIcon={<LaunchIcon />}>\r\n            More info\r\n          </Button>\r\n        </Stack>\r\n      </QuotaAlert>\r\n    </QuotaContainer>\r\n  )\r\n}\r\n","import { useSnackbar } from 'notistack';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { HashRouter, Route, Routes } from 'react-router-dom';\r\nimport { CommonConfig } from '../../../../common/config';\r\nimport { getCommonContext } from '../../../../contexts/common.context';\r\nimport { CommonUtil } from '../../../../util/common.util';\r\nimport { getEmitter } from '../../../../util/emitter';\r\nimport { getLogger } from '../../../../util/logger';\r\nimport { SnackbarUtil } from '../../../../util/snackbar.util';\r\nimport { DocumentState, GlobalEvent } from '../../../../util/types';\r\nimport { AccountDetails } from '../../../account/components/details';\r\nimport { Test } from '../../../common/components/test';\r\nimport { TestImage } from '../../../common/components/test-image';\r\nimport { LandingMain } from '../../../landing/components/main';\r\nimport { Header } from '../../../layout/components/header';\r\nimport { MainScroll } from '../../../layout/components/main-scroll';\r\nimport { MainWrapper } from '../../../layout/components/main-wrapper';\r\nimport { MarketplaceBrowse } from '../../../marketplace/components/browse';\r\nimport { MarketplaceItem } from '../../../marketplace/components/item';\r\nimport { MintDialog } from '../../../punk/components/dialog-mint';\r\nimport { PunkDetails } from '../../../punk/components/main';\r\nimport { ConfirmTransactionDialog } from '../dialog-transaction';\r\nimport { ContractQuota } from '../quota';\r\n\r\nconst logger = getLogger();\r\n\r\nexport const Main: React.FC = (props: any) => {\r\n  const [visibility, setVisibility] = useState<DocumentState>(DocumentState.Unknown);\r\n  const emitter = getEmitter();\r\n  const context = getCommonContext();\r\n  const basename = CommonConfig.BASENAME ?? \"\";\r\n  SnackbarUtil.snackbar = useSnackbar();\r\n\r\n  useEffect(() => {\r\n    const handleEvent = async () => {\r\n      try {\r\n        await context.datasource.initAsync(context.network);\r\n        emitter.emitVisibilityChanged(CommonUtil.getDocumentState());\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n    emitter.on(GlobalEvent.ReInit, handleEvent);\r\n    return () => {\r\n      logger.info(\"emitter.off(GlobalEvent.ReInit, handleEvent)\")();\r\n      emitter.off(GlobalEvent.ReInit, handleEvent);\r\n    };\r\n  }, [emitter, context.datasource, context.network]);\r\n\r\n  useEffect(() => {\r\n    const handleEvent = async () => {\r\n      const state = CommonUtil.getDocumentState();\r\n      if (visibility !== state) {\r\n        if (state === DocumentState.Active) {\r\n          // await context.datasource.initAsync(context.network);\r\n        }\r\n        logger.info(`visibilitychange before ${visibility} after ${state}`)();\r\n        setVisibility(state);\r\n        emitter.emitVisibilityChanged(state);\r\n      }\r\n    }\r\n    document.addEventListener('visibilitychange', handleEvent);\r\n    return () => {\r\n      logger.info(\"removeEventListener visibilitychange\")();\r\n      document.removeEventListener('visibilitychange', handleEvent);\r\n    };\r\n  }, [emitter, visibility, context.datasource, context.network]);\r\n\r\n  return (\r\n    <MainWrapper>\r\n      <HashRouter basename={basename}>\r\n        <Header />\r\n        <MainScroll>\r\n          <ContractQuota></ContractQuota>\r\n          <Routes>\r\n            <Route path=\"/account/:address\" element={<AccountDetails />} />\r\n            <Route path=\"/marketplace\" element={<MarketplaceBrowse />} />\r\n            <Route path=\"/marketplace/:tab\" element={<MarketplaceBrowse />} />\r\n            <Route path=\"/marketplace/item/:id\" element={<MarketplaceItem />} />\r\n            <Route path=\"/punk/:id\" element={<PunkDetails />} />\r\n            <Route path=\"/test-image\" element={<TestImage />} />\r\n            <Route path=\"/test\" element={<Test />} />\r\n            <Route path=\"/\" element={<LandingMain />} />\r\n          </Routes>\r\n          <MintDialog></MintDialog>\r\n          <ConfirmTransactionDialog></ConfirmTransactionDialog>\r\n        </MainScroll>\r\n      </HashRouter>\r\n    </MainWrapper>\r\n  )\r\n}\r\n","import { ApolloProvider } from '@apollo/client';\r\nimport { LocalizationProvider } from '@mui/lab';\r\nimport DateAdapter from '@mui/lab/AdapterMoment';\r\nimport { styled } from '@mui/material/styles';\r\nimport { SnackbarProvider } from 'notistack';\r\nimport React from 'react';\r\nimport { getApolloClient } from './clients/apollo.client';\r\nimport { CommonConstants } from './common/constants';\r\nimport { ConnectedWeb3 } from './contexts/connectedWeb3';\r\nimport { Web3Provider } from './contexts/web3';\r\nimport { Main } from './features/main/components/main';\r\n\r\nconst Background = styled('div')(\r\n  ({ theme }) => `\r\n  width: 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n  background-image: url('${CommonConstants.BG_URL}');\r\n`,\r\n);\r\n\r\nconst App: React.FC = () => {\r\n  const apolloClient = React.useMemo(() => getApolloClient(), [])\r\n  // Almost never return exponential notation\r\n  // BigNumber.config({ EXPONENTIAL_AT: 1e+9 })\r\n  return (\r\n    <LocalizationProvider dateAdapter={DateAdapter}>\r\n      <Background>\r\n        <SnackbarProvider maxSnack={3}>\r\n          <ApolloProvider client={apolloClient}>\r\n            <Web3Provider>\r\n              <ConnectedWeb3>\r\n                <Main />\r\n              </ConnectedWeb3>\r\n            </Web3Provider>\r\n          </ApolloProvider>\r\n        </SnackbarProvider>\r\n      </Background>\r\n    </LocalizationProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { createTheme } from '@mui/material/styles';\r\n\r\n// A custom theme for this app\r\n// https://github.com/mui-org/material-ui/tree/master/examples/create-react-app-with-typescript\r\nconst theme = createTheme({\r\n  typography: {\r\n    fontFamily: [\r\n      '-apple-system',\r\n      'BlinkMacSystemFont',\r\n      '\"Segoe UI\"',\r\n      'Roboto',\r\n      '\"Helvetica Neue\"',\r\n      'Arial',\r\n      'sans-serif',\r\n      '\"Apple Color Emoji\"',\r\n      '\"Segoe UI Emoji\"',\r\n      '\"Segoe UI Symbol\"',\r\n    ].join(','),\r\n  },\r\n  palette: {\r\n    primary: {\r\n      main: '#133995',\r\n    },\r\n    secondary: {\r\n      main: '#6817ff',\r\n    }\r\n  },\r\n});\r\n\r\nexport default theme;","import CssBaseline from '@mui/material/CssBaseline';\r\nimport { ThemeProvider } from '@mui/material/styles';\r\nimport * as React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport './index.css';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport theme from './theme';\r\n\r\nReactDOM.render(\r\n  <ThemeProvider theme={theme}>\r\n    {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\r\n    <CssBaseline />\r\n    <App />\r\n  </ThemeProvider>,\r\n  document.querySelector('#root'),\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import { CommonConfig } from '../common/config';\r\nimport { CommonUtil } from './common.util';\r\n\r\nexport class LogEventModel {\r\n  banner?: string;\r\n  args?: any[];\r\n\r\n  public constructor(init?: Partial<LogEventModel>) {\r\n    Object.assign(this, init);\r\n  }\r\n}\r\n\r\nexport interface ILogger {\r\n  // Make sure level is selected e.g. 'Verbose' in Chrome\r\n  readonly debug: any;\r\n  readonly info: any;\r\n  readonly warn: any;\r\n  readonly error: any;\r\n}\r\n\r\nconst noop = (): any => undefined;\r\n\r\nexport class ConsoleLogger implements ILogger {\r\n\r\n  private get isEnabled(): boolean {\r\n    return CommonConfig.ENABLE_LOGGER;\r\n  }\r\n\r\n  get debug() {\r\n    if (this.isEnabled) {\r\n      return console.debug.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n\r\n  get info() {\r\n    if (this.isEnabled) {\r\n      return console.info.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n\r\n  get warn() {\r\n    if (this.isEnabled) {\r\n      return console.warn.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n\r\n  get error() {\r\n    if (this.isEnabled) {\r\n      return console.error.bind(console);\r\n    } else {\r\n      return noop;\r\n    }\r\n  }\r\n}\r\n\r\nexport class ExtendedConsoleLogger implements ILogger {\r\n\r\n  private get isEnabled(): boolean {\r\n    return CommonConfig.ENABLE_LOGGER;\r\n  }\r\n\r\n  private timestamp(type: string): string {\r\n    return `[${type} ${new Date().toLocaleTimeString()}]`;\r\n  }\r\n\r\n  private createLogEventModel(type: string, ...args: any[]): LogEventModel {\r\n    const mapFn = (e: any) => {\r\n      if (CommonUtil.isString(e)) {\r\n        return e;\r\n      } else if (e instanceof Error) {\r\n        return e.message;\r\n      }\r\n      return CommonUtil.toJsonString(e);\r\n    };\r\n    const result = new LogEventModel({\r\n      banner: this.timestamp(type),\r\n      args: args?.map(e => Array.isArray(e) ? e.map(e1 => mapFn(e1)) : mapFn(e))\r\n    });\r\n    return result;\r\n  }\r\n\r\n  get debug() {\r\n    if (this.isEnabled) {\r\n      return (...args: any[]) => {\r\n        const result = this.createLogEventModel('DEBUG', args);\r\n        return Function.prototype.bind.call(console.debug, console, result.banner, ...args);\r\n      };\r\n    } else {\r\n      return (...args: any[]) => {\r\n        return noop;\r\n      };\r\n    }\r\n  }\r\n\r\n  get info() {\r\n    if (this.isEnabled) {\r\n      return (...args: any[]) => {\r\n        const result = this.createLogEventModel('INFO', args);\r\n        return Function.prototype.bind.call(console.info, console, result.banner, ...args);\r\n      };\r\n    } else {\r\n      return (...args: any[]) => {\r\n        return noop;\r\n      };\r\n    }\r\n  }\r\n\r\n  get warn() {\r\n    if (this.isEnabled) {\r\n      return (...args: any[]) => {\r\n        const result = this.createLogEventModel('WARN', args);\r\n        return Function.prototype.bind.call(console.warn, console, result.banner, ...args);\r\n      };\r\n    } else {\r\n      return (...args: any[]) => {\r\n        return noop;\r\n      };\r\n    }\r\n  }\r\n\r\n  get error() {\r\n    return (...args: any[]) => {\r\n      if (args?.length > 0) {\r\n        if (!CommonUtil.isString(args[0])) {\r\n          args.push('(See console output for more information.)');\r\n        }\r\n      }\r\n      const result = this.createLogEventModel('ERROR', args);\r\n      return Function.prototype.bind.call(console.error, console, result.banner, ...args);\r\n    };\r\n  }\r\n}\r\n\r\nconst logger = new ExtendedConsoleLogger();\r\n\r\nexport const getLogger = (): ILogger => {\r\n  return logger;\r\n}","import EventEmitter from 'events';\r\nimport { DocumentState, GlobalEvent, MarketChangedEvent, PunkChangedEvent, PunkFilterValues, ViteQuotaResult } from './types';\r\n\r\nexport interface IGlobalEmitter {\r\n  emitReInit(): void\r\n  emitVisibilityChanged(state: DocumentState): void\r\n  emitConfirmTransactionDialog(open: boolean): void\r\n  emitConnectWalletDialog(open: boolean): void\r\n  emitQuotaChanged(address: string, quota: ViteQuotaResult): void\r\n  emitMarketChanged(event: MarketChangedEvent): void\r\n  emitPunkChanged(event: PunkChangedEvent): void\r\n  emitPunkFilterValuesChanged(oldValues: PunkFilterValues, newValues: PunkFilterValues): void\r\n  on(event: string | symbol, listener: (...args: any[]) => void): this\r\n  off(event: string | symbol, listener: (...args: any[]) => void): this\r\n}\r\n\r\nexport class GlobalEmitter extends EventEmitter implements IGlobalEmitter {\r\n  emitReInit(): void {\r\n    this.emit(GlobalEvent.ReInit)\r\n  }\r\n  emitVisibilityChanged(state: DocumentState): void {\r\n    this.emit(GlobalEvent.DocumentVisibilityChanged, state)\r\n  }\r\n  emitConfirmTransactionDialog(open: boolean): void {\r\n    this.emit(GlobalEvent.ConfirmTransactionDialog, open)\r\n  }\r\n  emitConnectWalletDialog(open: boolean): void {\r\n    this.emit(GlobalEvent.ConnectWalletDialog, open)\r\n  }\r\n  emitQuotaChanged(address: string, quota: ViteQuotaResult): void {\r\n    this.emit(GlobalEvent.QuotaChanged, address, quota);\r\n  }\r\n  emitMarketChanged(event: MarketChangedEvent): void {\r\n    this.emit(GlobalEvent.MarketChanged, event);\r\n  }\r\n  emitPunkChanged(event: PunkChangedEvent): void {\r\n    this.emit(GlobalEvent.PunkChanged, event);\r\n  }\r\n  emitPunkFilterValuesChanged(oldValues: PunkFilterValues, newValues: PunkFilterValues): void {\r\n    this.emit(GlobalEvent.PunkFilterValuesChanged, oldValues, newValues)\r\n  }\r\n}\r\n\r\nconst emitter = new GlobalEmitter();\r\n\r\nexport const getEmitter = (): IGlobalEmitter => {\r\n  return emitter;\r\n}\r\n","export abstract class CommonConfig {\r\n  static get IS_PRODUCTION(): boolean {\r\n    if (!process.env.REACT_APP_IS_PRODUCTION) {\r\n      throw new Error(\"REACT_APP_IS_PRODUCTION is not defined\");\r\n    }\r\n    return process.env.REACT_APP_IS_PRODUCTION === \"true\";\r\n  }\r\n  static get CONTRACT_ADDRESS(): string {\r\n    if (!process.env.REACT_APP_CONTRACT_ADDRESS) {\r\n      throw new Error(\"REACT_APP_CONTRACT_ADDRESS is not defined\");\r\n    }\r\n    return process.env.REACT_APP_CONTRACT_ADDRESS;\r\n  }\r\n  static get EXPLORER_URL(): string {\r\n    if (!process.env.REACT_APP_EXPLORER_URL) {\r\n      throw new Error(\"REACT_APP_EXPLORER_URL is not defined\");\r\n    }\r\n    return process.env.REACT_APP_EXPLORER_URL;\r\n  }\r\n  static get ENABLE_LOGGER(): boolean {\r\n    if (!process.env.REACT_APP_ENABLE_LOGGER) {\r\n      throw new Error(\"REACT_APP_ENABLE_LOGGER is not defined\");\r\n    }\r\n    return process.env.REACT_APP_ENABLE_LOGGER === \"true\";\r\n  }\r\n  static get ENABLE_MNEMONIC_LOGIN(): boolean {\r\n    if (!process.env.REACT_APP_ENABLE_MNEMONIC_LOGIN) {\r\n      throw new Error(\"REACT_APP_ENABLE_MNEMONIC_LOGIN is not defined\");\r\n    }\r\n    return process.env.REACT_APP_ENABLE_MNEMONIC_LOGIN === \"true\";\r\n  }\r\n  static get NETWORK_ID(): number {\r\n    if (!process.env.REACT_APP_NETWORK_ID) {\r\n      throw new Error(\"REACT_APP_NETWORK_ID is not defined\");\r\n    }\r\n    return parseInt(process.env.REACT_APP_NETWORK_ID);\r\n  }\r\n  static get BASENAME(): Maybe<string> {\r\n    return process.env.REACT_APP_BASENAME;\r\n  }\r\n}","export enum WalletType {\r\n  Web = 'Web',\r\n  Session = 'Session'\r\n}\r\n\r\nexport abstract class Wallet<T> {\r\n  private readonly _type: WalletType\r\n\r\n  active?: T\r\n  accounts: T[] = []\r\n\r\n  constructor(type: WalletType, init?: Partial<Wallet<T>>) {\r\n    this._type = type\r\n    this.baseInitinit(init)\r\n  }\r\n\r\n  static fromJS(data: any): Maybe<WebWallet | SessionWallet> {\r\n    data = typeof data === 'object' ? data : {}\r\n    switch (data._type) {\r\n      case WalletType.Web:\r\n        return new WebWallet(data)\r\n      case WalletType.Session:\r\n        return new SessionWallet(data)\r\n      default:\r\n        break\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  get type(): WalletType {\r\n    return this._type\r\n  }\r\n\r\n  protected abstract createAccount(data: any): T\r\n\r\n  private baseInitinit(data?: any): void {\r\n    if (data) {\r\n      this.active = data.active ? this.createAccount(data.active) : undefined\r\n      if (data.accounts && Array.isArray(data.accounts)) {\r\n        data.accounts.forEach((account: any) => {\r\n          this.accounts.push(this.createAccount(account))\r\n        })\r\n      }\r\n    }\r\n    if (!this.accounts) {\r\n      this.accounts = []\r\n    }\r\n  }\r\n}\r\n\r\nexport class WebWallet extends Wallet<WebWalletAccount> {\r\n  mnemonic!: string\r\n\r\n  constructor(init?: Partial<WebWallet>) {\r\n    super(WalletType.Web, init)\r\n    this.init(init)\r\n  }\r\n\r\n  init(data?: any): void {\r\n    if (data) {\r\n      this.mnemonic = data.mnemonic\r\n    }\r\n  }\r\n\r\n  protected createAccount(data: any): WebWalletAccount {\r\n    return new WebWalletAccount(data)\r\n  }\r\n}\r\n\r\nexport class SessionWallet extends Wallet<SessionWalletAccount> {\r\n  session!: string\r\n  timestamp!: number\r\n\r\n  constructor(init?: Partial<SessionWallet>) {\r\n    super(WalletType.Session, init)\r\n    this.init(init)\r\n  }\r\n\r\n  init(data?: any): void {\r\n    if (data) {\r\n      this.session = data.session\r\n      this.timestamp = data.timestamp\r\n    }\r\n  }\r\n\r\n  protected createAccount(data: any): SessionWalletAccount {\r\n    return new SessionWalletAccount(data)\r\n  }\r\n}\r\n\r\nexport enum WalletAccountType {\r\n  Web = 'Web',\r\n  Session = 'Session'\r\n}\r\n\r\nexport abstract class WalletAccount {\r\n  private readonly _type: WalletAccountType\r\n\r\n  id!: string\r\n  address!: string\r\n\r\n  constructor(type: WalletAccountType, init?: Partial<WalletAccount>) {\r\n    this._type = type\r\n    this.baseInit(init)\r\n  }\r\n\r\n  static fromJS(data: any): Maybe<WalletAccount> {\r\n    data = typeof data === 'object' ? data : {}\r\n    switch (data._type) {\r\n      case WalletType.Web:\r\n        return new WebWalletAccount(data)\r\n      case WalletType.Session:\r\n        return new SessionWalletAccount(data)\r\n      default:\r\n        break\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  get type(): WalletAccountType {\r\n    return this._type\r\n  }\r\n\r\n  private baseInit(data?: any): void {\r\n    if (data) {\r\n      this.id = data.id\r\n      this.address = data.address\r\n    }\r\n  }\r\n}\r\n\r\nexport class WebWalletAccount extends WalletAccount {\r\n  privateKey!: string\r\n\r\n  constructor(init?: Partial<WebWalletAccount>) {\r\n    super(WalletAccountType.Web, init)\r\n    this.init(init)\r\n  }\r\n\r\n  init(data?: any): void {\r\n    if (data) {\r\n      this.privateKey = data.privateKey\r\n    }\r\n  }\r\n}\r\n\r\nexport class SessionWalletAccount extends WalletAccount {\r\n  constructor(init?: Partial<SessionWalletAccount>) {\r\n    super(WalletAccountType.Session, init)\r\n  }\r\n}","import Connector from '@vite/connector';\r\nimport { WalletManager } from '.';\r\nimport { getLogger } from '../util/logger';\r\nimport { SessionWallet, SessionWalletAccount } from './types';\r\n\r\nconst logger = getLogger()\r\n\r\nexport interface IWalletConnector {\r\n  readonly uri: string\r\n  createSession(): Promise<string>\r\n  sendTransactionAsync(...args: any): Promise<any>\r\n  signMessageAsync(...args: any): Promise<any>\r\n  killSessionAsync(): Promise<void>\r\n  on(event: string | symbol, listener: (...args: any[]) => void): this\r\n  off(event: string | symbol, listener: (...args: any[]) => void): this\r\n}\r\n\r\nexport class WalletConnector extends Connector implements IWalletConnector {\r\n  private readonly _walletManager: WalletManager;\r\n\r\n  constructor(walletManager: WalletManager, opts: any, meta?: any) {\r\n    super(opts, meta);\r\n    this._walletManager = walletManager;\r\n    this.on('connect', (err: any, payload: any) => {\r\n      logger.info('WalletConnector.connect', err, payload)()\r\n      const { accounts } = payload.params[0];\r\n      this.saveSession(accounts);\r\n    });\r\n    this.on('disconnect', (err: any, payload: any) => {\r\n      logger.info('WalletConnector.disconnect', err, payload)()\r\n      this.stopBizHeartBeat()\r\n      this._walletManager.removeWallet()\r\n    });\r\n    this.on('session_update', (err: any, payload: any) => {\r\n      logger.info('WalletConnector.session_update', err, payload)()\r\n      const session = payload[0];\r\n      if (session && session.accounts) {\r\n        this.saveSession(session.accounts);\r\n      }\r\n    });\r\n  }\r\n\r\n  get uri(): string {\r\n    return super.uri\r\n  }\r\n\r\n  on(event: string | symbol, listener: (...args: any[]) => void): this {\r\n    return super.on(event, listener)\r\n  }\r\n\r\n  off(event: string | symbol, listener: (...args: any[]) => void): this {\r\n    return super.off(event, listener)\r\n  }\r\n\r\n  saveSession(accounts: string[]): void {\r\n    if (!accounts || !accounts[0]) {\r\n      throw new Error('address is null');\r\n    }\r\n    const sessionAccounts: SessionWalletAccount[] = []\r\n    for (let index = 0; index < accounts.length; index++) {\r\n      const address = accounts[index];\r\n      sessionAccounts.push(new SessionWalletAccount({\r\n        id: index.toString(),\r\n        address: address\r\n      }))\r\n    }\r\n    const wallet = new SessionWallet({\r\n      active: sessionAccounts[0],\r\n      accounts: sessionAccounts,\r\n      session: this.session,\r\n      timestamp: new Date().getTime()\r\n    })\r\n    this._walletManager.setWallet(wallet)\r\n  }\r\n\r\n  updateSession(): void {\r\n    const existing = this._walletManager.getWallet()\r\n    if (existing && existing instanceof SessionWallet) {\r\n      existing.timestamp = new Date().getTime()\r\n      this._walletManager.updateWalletStore(existing)\r\n    }\r\n  }\r\n\r\n  async createSession(): Promise<string> {\r\n    await super.createSession();\r\n    return this.uri;\r\n  }\r\n\r\n  async sendTransactionAsync(...args: any): Promise<any> {\r\n    return new Promise((res, rej) => {\r\n      this.on('disconnect', () => {\r\n        rej(\"Request aborted due to disconnect.\");\r\n      });\r\n\r\n      this.sendCustomRequest({ method: 'vite_signAndSendTx', params: args }).then((r: any) => {\r\n        this.updateSession();\r\n        res(r);\r\n      }).catch((e: any) => {\r\n        rej(e);\r\n      });\r\n    });\r\n  }\r\n\r\n  async signMessageAsync(...args: any): Promise<any> {\r\n    return new Promise((res, rej) => {\r\n      this.on('disconnect', () => {\r\n        rej(\"Request aborted due to disconnect.\");\r\n      });\r\n\r\n      this.sendCustomRequest({ method: 'vite_signMessage', params: args }).then((r: any) => {\r\n        this.updateSession();\r\n        res(r);\r\n      }).catch((e: any) => {\r\n        rej(e);\r\n      });\r\n    });\r\n  }\r\n\r\n  async killSessionAsync(): Promise<any> {\r\n    await super.killSession();\r\n  }\r\n}","import { IWalletConnector, WalletConnector, WalletManager } from '.';\r\nimport { CommonUtil } from '../util/common.util';\r\nimport { getLogger } from '../util/logger';\r\nimport { Network } from '../util/types';\r\n\r\nconst logger = getLogger()\r\n\r\nexport class WalletConnectorFactory {\r\n  private readonly _walletManager: WalletManager\r\n\r\n  constructor(walletManager: WalletManager) {\r\n    this._walletManager = walletManager\r\n  }\r\n\r\n  private get session(): Maybe<string> {\r\n    return this._walletManager.getValidSession()\r\n  }\r\n\r\n  private createConnector(network: Network): IWalletConnector {\r\n    const account = this._walletManager.getActiveAccount()\r\n    const opts = {\r\n      bridge: network.connectorUrl,\r\n      session: this.session\r\n    }\r\n    const meta = account ? { lastAccount: account.address } : undefined\r\n    const connector = new WalletConnector(this._walletManager, opts, meta)\r\n    return connector\r\n  }\r\n\r\n  create(network: Network): IWalletConnector {\r\n    const connector = this.createConnector(network)\r\n\r\n    if (!this.session) {\r\n      connector.createSession().then(() => logger.info('IWalletConnector connected', connector.uri)())\r\n    }\r\n\r\n    return connector\r\n  }\r\n\r\n  async createAsync(network: Network): Promise<IWalletConnector> {\r\n    const connector = this.createConnector(network)\r\n\r\n    if (!this.session) {\r\n      await CommonUtil.timeout(1000)\r\n      await connector.createSession()\r\n      logger.info('IWalletConnector connected', connector.uri)()\r\n    }\r\n\r\n    return connector\r\n  }\r\n}","import { SessionWallet, Wallet, WebWallet } from '.';\r\nimport { CommonConstants } from '../common/constants';\r\nimport { getLogger } from '../util/logger';\r\nimport { WalletType } from './types';\r\n\r\nconst logger = getLogger()\r\n\r\nexport class WalletStore {\r\n\r\n  private readonly _webWalletKey = CommonConstants.WEB_WALLET_STORAGE_SPACE;\r\n  private readonly _sessionWalletKey = CommonConstants.SESSION_WALLET_STORAGE_SPACE\r\n\r\n  clear(): void {\r\n    localStorage.removeItem(this._webWalletKey);\r\n    sessionStorage.removeItem(this._sessionWalletKey);\r\n  }\r\n\r\n  getItem(): Maybe<WebWallet | SessionWallet> {\r\n    let data;\r\n\r\n    try {\r\n      data = localStorage.getItem(this._webWalletKey);\r\n      if (!data) {\r\n        data = sessionStorage.getItem(this._sessionWalletKey);\r\n      }\r\n    } catch (err) {\r\n      logger.error(err)();\r\n      return undefined;\r\n    }\r\n\r\n    if (!data) {\r\n      return undefined;\r\n    }\r\n\r\n    try {\r\n      return Wallet.fromJS(JSON.parse(data));\r\n    } catch (err) {\r\n      logger.error(err)();\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  setItem(data: WebWallet | SessionWallet): void {\r\n    const saveData = JSON.stringify(data);\r\n\r\n    try {\r\n      switch (data.type) {\r\n        case WalletType.Web:\r\n          localStorage.setItem(this._webWalletKey, saveData);\r\n          break;\r\n        case WalletType.Session:\r\n          sessionStorage.setItem(this._sessionWalletKey, saveData);\r\n          break;\r\n        default:\r\n          throw new Error(`Wallet type '${data.type}' is not supported.`)\r\n      }\r\n    } catch (err) {\r\n      logger.error(err)();\r\n    }\r\n  }\r\n}","import { wallet } from '@vite/vitejs';\r\nimport { SessionWallet, WalletAccount, WebWallet, WebWalletAccount } from '.';\r\nimport { getLogger } from '../util/logger';\r\nimport { WalletStore } from './store';\r\n\r\nconst logger = getLogger()\r\n\r\nexport class WalletManager {\r\n  private readonly _store: WalletStore;\r\n  private _wallet?: WebWallet | SessionWallet;\r\n  private _mnemonicDeriveIndex = 0;\r\n  private _setWalletCallback?: (wallet?: WebWallet | SessionWallet | undefined) => void;\r\n\r\n  constructor() {\r\n    this._store = new WalletStore();\r\n  }\r\n\r\n  initWallet(): void {\r\n    const wallet = this._store.getItem();\r\n    if (wallet) {\r\n      this._wallet = wallet;\r\n      this._mnemonicDeriveIndex = wallet.accounts.length;\r\n      this.updateWallet();\r\n    }\r\n  }\r\n\r\n  set onSetWalletCallback(cb: (wallet?: WebWallet | SessionWallet | undefined) => void) {\r\n    this._setWalletCallback = cb;\r\n  }\r\n\r\n  getWallet(): Maybe<WebWallet | SessionWallet> {\r\n    return this._wallet;\r\n  }\r\n\r\n  setWallet(wallet?: WebWallet | SessionWallet): void {\r\n    this._wallet = wallet;\r\n    this.updateWalletStore(wallet)\r\n    this.updateWallet()\r\n  }\r\n\r\n  updateWallet(): void {\r\n    if (this._setWalletCallback) {\r\n      this._setWalletCallback(this._wallet);\r\n    }\r\n  }\r\n\r\n  updateWalletStore(wallet?: WebWallet | SessionWallet): void {\r\n    if (wallet) {\r\n      this._store.setItem(wallet);\r\n    }\r\n  }\r\n\r\n  createWebWallet(mnemonic: string): Maybe<WebWallet> {\r\n    if (!this.validateMnemonic(mnemonic)) {\r\n      return undefined;\r\n    }\r\n    this.resetWallet();\r\n    const account = this.createWebWalletAccount(mnemonic, 0);\r\n    const wallet = new WebWallet({\r\n      active: account,\r\n      mnemonic,\r\n      accounts: [\r\n        account\r\n      ]\r\n    });\r\n    this.setWallet(wallet);\r\n    return wallet;\r\n  }\r\n\r\n  removeWallet(): void {\r\n    this.resetWallet();\r\n    this.updateWallet();\r\n  }\r\n\r\n  getAccountByAddress(address: string): Maybe<WalletAccount> {\r\n    return this._wallet?.accounts?.find(e => e.address === address)\r\n  }\r\n\r\n  addAccount(): Maybe<WalletAccount> {\r\n    if (this._wallet instanceof WebWallet) {\r\n      const account = this.createWebWalletAccount(this._wallet.mnemonic);\r\n      this._wallet.accounts.push(account);\r\n      this.setActiveAccount(account);\r\n      return account;\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  getActiveAccount(): Maybe<WalletAccount> {\r\n    return this._wallet?.active\r\n  }\r\n\r\n  setActiveAccount(account: WalletAccount): boolean {\r\n    if (this._wallet) {\r\n      this._wallet.active = account;\r\n      this._store.setItem(this._wallet);\r\n      this.updateWallet();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getAccounts(): WalletAccount[] {\r\n    if (this._wallet) {\r\n      return this._wallet.accounts;\r\n    }\r\n    return [];\r\n  }\r\n\r\n  getValidSession(): Maybe<string> {\r\n    const wallet = this._store.getItem();\r\n    if (wallet && wallet instanceof SessionWallet) {\r\n      if (new Date().getTime() - wallet.timestamp < 1000 * 60 * 10) {\r\n        return wallet.session;\r\n      } else {\r\n        logger.info('Found expired session.', wallet)();\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private resetWallet(): void {\r\n    this._wallet = undefined;\r\n    this._mnemonicDeriveIndex = 0;\r\n    this._store.clear();\r\n  }\r\n\r\n  private createWebWalletAccount(mnemonic: string, index = this._mnemonicDeriveIndex): WebWalletAccount {\r\n    const { privateKey } = wallet.deriveAddress({\r\n      mnemonics: mnemonic,\r\n      index\r\n    });\r\n    let account = new WebWalletAccount({\r\n      id: index.toString(),\r\n      privateKey,\r\n      address: wallet.createAddressByPrivateKey(privateKey).address\r\n    });\r\n    this._mnemonicDeriveIndex = index + 1;\r\n    return account;\r\n  }\r\n\r\n  private validateMnemonic(mnemonic: Maybe<string>): Boolean {\r\n    if (mnemonic) {\r\n      return wallet.validateMnemonics(mnemonic);\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nconst manager = new WalletManager();\r\n\r\nexport const getWalletManager = () => {\r\n  return manager;\r\n}","/* tslint:disable */\n/* eslint-disable */\n// @generated\n// This file was automatically generated and should not be edited.\n\n//==============================================================\n// START Enums and Input Objects\n//==============================================================\n\nexport enum OrderBy {\n  ASC = \"ASC\",\n  DESC = \"DESC\",\n}\n\nexport enum PunkSortBy {\n  ID = \"ID\",\n  RANK = \"RANK\",\n}\n\n//==============================================================\n// END Enums and Input Objects\n//==============================================================\n"],"sourceRoot":""}